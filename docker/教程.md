# docker的使用



bilibili视频教学： 40分钟的Docker实战攻略，一期视频精通Docker

https://www.bilibili.com/video/BV1THKyzBER6/?spm_id_from=333.337.search-card.all.click&vd_source=08704ab849ba956e9d7acbdbd55b0991



笔记页面：https://blog.xinglovejiao.online/archives/3f97b9ba-140a-49f3-b4fa-cd96c75c1d60

docker可视化工具

简介：

![](.\img\1.png)

Docker 是一款开源的容器化平台，它通过轻量级的容器技术，实现了应用程序及其依赖环境的标准化打包、分发和运行，极大地简化了软件开发、测试和部署流程。以下从核心概念、主要优势、典型应用场景三个方面进行简单总结：

![](.\img\2.png)

### 一、核心概念

- **镜像（Image）**：是一个只读的模板，包含运行应用所需的代码、库、环境变量和配置文件等。例如，一个 Python 应用的镜像可能包含 Python 解释器、应用代码以及依赖的第三方库。
- **容器（Container）**：是镜像的可运行实例，是一个独立的运行环境。容器基于镜像创建，可被启动、停止、删除等，且容器间相互隔离，不会干扰彼此的运行。
- **仓库（Repository）**：用于存储和分发镜像的场所，类似代码仓库（如 GitHub）。Docker Hub 是官方公共仓库，用户也可搭建私有仓库。
- **Docker Engine**：Docker 的核心运行引擎，负责管理镜像、容器、网络和存储等资源，基于 Linux 内核的 Namespace（隔离）和 Cgroups（资源限制）技术实现容器化。

### 二、主要优势

- **轻量级**：容器共享宿主机内核，无需像虚拟机那样包含完整操作系统，因此启动快（秒级）、占用资源少。
- **一致性**：镜像一旦构建，在任何支持 Docker 的环境中都能以相同方式运行，解决了 “开发环境能跑，生产环境跑不了” 的问题。
- **隔离性**：容器间通过 Namespace 实现进程、网络、文件系统等资源的隔离，确保应用互不干扰。
- **可移植性**：镜像可在本地、云服务器、虚拟机等多种环境中迁移，部署流程标准化。
- **可扩展性**：结合 Kubernetes 等编排工具，可轻松实现容器的批量管理、自动扩缩容和故障恢复。

### 三、典型应用场景

- **应用打包与分发**：将应用及依赖打包成镜像，通过仓库分发，简化部署流程。
- **微服务架构**：每个微服务独立运行在容器中，便于单独开发、测试和升级。
- **持续集成 / 持续部署（CI/CD）**：在自动化流程中，通过容器快速构建、测试和部署应用。
- **开发环境标准化**：团队成员使用相同的镜像，确保开发环境一致，减少环境配置问题。
- **资源隔离与高效利用**：在一台宿主机上运行多个容器，比虚拟机更高效地利用硬件资源。



总之，Docker 凭借其轻量、一致、隔离的特性，已成为现代软件开发和部署的重要工具，推动了云原生技术的快速发展。

Kubernetes



1.  Docker Hub 镜像搜索  https://docker.fxxk.dedyn.io/
2. Docker安装 镜像站等教程： https://github.com/tech-shrimp/docker_installer





### Docker 和 Docker Compose  ，Dockerfile ，docker-compose.yml

使用 Docker 创建多个容器

```
# 第一个 Halo 容器
docker run \
  -it -d \
  --name halo-1 \
  -p 8090:8090 \
  -v ~/.halo2:/root/.halo2 \
  registry.fit2cloud.com/halo/halo:2.21 \

# 第二个 Halo 容器
docker run \
  -it -d \
  --name halo-2 \
  -p 8091:8090 \
  -v ~/.halo2_2:/root/.halo2 \
  registry.fit2cloud.com/halo/halo:2.21 \
```



## 使用docker部署项目和docker compose部署的区别

Docker 部署和 Docker Compose 部署的核心差异，在于**管理容器的数量和复杂度**—— 前者适合单容器应用（如单个博客、数据库），后者专为多容器协同场景（如博客 + 数据库 + 缓存）设计，以下从核心区别、使用场景、操作方式等维度详细对比：

| 对比维度       | Docker 部署（原生 Docker）                                   | Docker Compose 部署                                          |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **核心定位**   | 管理「单个容器」的生命周期（创建、启动、停止、删除）         | 定义和运行「多容器应用」的工具，通过配置文件统一管理多个关联容器 |
| **配置方式**   | 命令行参数直接传递（如 `-p` 映射端口、`-v` 挂载数据卷、`-e` 设置环境变量） | 所有配置写在 `docker-compose.yml` 文件中，支持 YAML 语法结构化管理 |
| **容器协同**   | 多容器需手动维护网络（如 `--link` 关联）、依赖顺序，操作繁琐 | 自动创建独立网络，容器间可通过服务名直接通信；支持 `depends_on` 定义启动顺序（如先启动数据库再启动应用） |
| **环境一致性** | 命令行参数易遗漏、写错，不同环境（开发 / 测试 / 生产）难以同步配置 | 配置文件可版本控制（如 Git 管理），跨环境复制 `docker-compose.yml` 即可复用，避免配置不一致 |
| **操作复杂度** | 单容器操作简单（一条命令启动）；多容器需逐行执行 `docker run`，维护成本高 | 单条命令（`docker-compose up -d`）启动所有容器，停止（`down`）、重启（`restart`）、日志查看（`logs`）均支持批量操作 |
| **依赖管理**   | 需手动处理容器依赖（如先启动 MySQL 再启动应用，否则连接失败） | 通过 `depends_on` 自动控制启动顺序（注：仅保证启动顺序，不保证服务就绪，需应用自身处理重试） |
| **适用场景**   | 1. 单容器应用（如单独部署 Halo 博客、Nginx 静态服务）；2. 临时测试单个镜像；3. 对容器数量无协同需求的场景 | 1. 多容器协同应用（如博客系统 + Halo+MySQL+Redis、前端 + 后端 + 数据库）；2. 开发 / 测试环境快速搭建完整服务栈；3. 需要统一管理配置和依赖的场景 |
| **学习成本**   | 低，只需掌握核心 `docker` 命令（`run`/`start`/`stop`/`rm`）  | 中，需额外学习 `docker-compose.yml` 配置语法（简单易懂，核心字段少） |

### 举个实际例子（对应 Halo 博客部署）

#### 1. Docker 部署（单容器，依赖外部数据库或内置 H2 数据库）

如果 Halo 用内置 H2 数据库（无需额外容器），Docker 部署只需一条命令：

bash

```bash
# 直接通过命令行参数配置端口、数据卷、环境变量
docker run -d \
  -p 8090:8090 \
  -v ~/.halo2:/root/.halo2 \
  -e HALO_ADMIN_PATH=/admin \
  --name halo \
  halo-dev/halo:latest
```

- 优点：命令简单，直接执行即可启动；
- 缺点：如果后续需要添加 MySQL 数据库（多容器），需再执行 `docker run` 启动 MySQL，手动配置网络关联，且每次启动都要重复输入一堆参数。

#### 2. Docker Compose 部署（多容器：Halo + MySQL）

如果 Halo 搭配 MySQL 数据库（更稳定，数据易迁移），用 Docker Compose 只需创建 `docker-compose.yml`：

yaml

```yaml
version: "3.8"
services:
  # Halo 应用容器
  halo:
    image: halo-dev/halo:latest
    ports:
      - "8090:8090"
    volumes:
      - ~/.halo2:/root/.halo2
    environment:
      - HALO_ADMIN_PATH=/admin
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/halo?useSSL=false&serverTimezone=Asia/Shanghai
      - SPRING_DATASOURCE_USERNAME=halo
      - SPRING_DATASOURCE_PASSWORD=halo123456
    depends_on:
      - mysql  # 先启动 mysql 再启动 halo
    restart: always

  # MySQL 数据库容器
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    volumes:
      - ~/.halo2/mysql:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=root123456
      - MYSQL_DATABASE=halo
      - MYSQL_USER=halo
      - MYSQL_PASSWORD=halo123456
    restart: always
```

然后执行一条命令即可启动所有服务：

bash

```bash
docker-compose up -d
```

- 优点：配置集中管理，下次启动 / 迁移时，直接复制 `docker-compose.yml` 执行命令即可，无需重复输入参数；容器间通过服务名 `mysql` 直接通信，无需手动配置网络；
- 缺点：比单容器多了一个配置文件，但学习成本极低。

### 总结建议

1. 如果你只是部署**单容器应用**（如仅用 Halo 内置数据库、或单独部署一个 Nginx）：用原生 Docker 即可，操作更简洁；
2. 如果你需要**多容器协同**（如 Halo+MySQL、应用 + 数据库 + 缓存）：优先用 Docker Compose，配置可复用、维护成本低，尤其适合开发 / 测试环境快速搭建；
3. 延伸：如果是生产环境大规模部署（如几十上百个容器），Docker Compose 就不够用了，需要用 Kubernetes（K8s），但个人博客完全用不到。

对于你的场景（部署 Halo 博客）：

- 若用内置数据库：Docker 部署更省事；
- 若搭配 MySQL/Redis（推荐，数据更稳定）：Docker Compose 更方便，后续迁移时直接复制 `docker-compose.yml` 和数据卷目录即可，无需单独配置数据库。







## 使用记录： 

 目标：使用docker部署 前端项目 ；并熟练docker的常用指令。



### Win11 安装 Docker 步骤

1. **检查系统要求**

   - 需开启硬件虚拟化（在 BIOS 中开启 Intel VT-x/AMD-V）
   - 启用 Hyper-V 和容器功能：
     控制面板 → 程序 → 启用或关闭 Windows 功能 → 勾选 Hyper-V、容器、Windows 虚拟机监控程序平台 → 重启电脑

2. **下载 Docker Desktop**
   官网地址：https://www.docker.com/products/docker-desktop
   点击 "Download for Windows" 下载安装包

3. **安装 Docker**

   - 双击安装包，勾选 "Use WSL 2 instead of Hyper-V"（推荐）
   - 点击 "OK"，等待安装完成后重启电脑

4. **验证安装**
   打开命令提示符 (CMD) 或 PowerShell，输入：

   bash

   ```bash
   docker --version
   ```

   显示版本信息即安装成功

### 资源占用

- **硬件要求**：至少 4GB 内存（推荐 8GB 以上），支持硬件虚拟化的 64 位处理器
- **硬盘占用**：安装包约 400MB，完整运行后占用空间约 2-5GB（视镜像和容器数量而定）

https://blog.csdn.net/mcanye/article/details/146024678?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522e769cc760177b6bd848489f89cd36239%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=e769cc760177b6bd848489f89cd36239&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-146024678-null-null.142^v102^pc_search_result_base8&utm_term=win11%E5%AE%89%E8%A3%85docker&spm=1018.2226.3001.4187



安装测试成功

1.安装包： https://docs.docker.com/desktop/setup/install/windows-install/  官网下载win

 2.docker的语言包，网上不好找。   自己fork仓库使用。https://gitee.com/lyxdemayun/DockerDesktop-CN

3. 关于本地win11:linux相关的驱动程序 无法加载问题。 （关闭本机的核心隔离保护；手动更新wsl驱动，Docker Desktop就可以启动成功了）

要调整系统安全设置以允许 VirtualBox 驱动加载，可按以下步骤操作：

### 步骤 1：关闭 “内存完整性”（核心隔离功能）

- 打开**设置**→**隐私和安全性**→**Windows 安全中心**→**设备安全性**→**核心隔离**，找到**内存完整性**，将其开关**关闭**。

要解决 Docker Desktop 提示的 WSL 更新失败问题，可按照以下步骤操作：

### 步骤 1：手动更新 WSL

根据提示，以**管理员身份**打开命令提示符（CMD）或 PowerShell，执行以下命令：

bash

```bash
wsl --update
```

执行后等待更新完成，期间可能需要下载 WSL 相关组件，请确保网络连接正常。

### 步骤 2：重启 WSL 服务

更新完成后，执行以下命令重启 WSL 服务：

bash

```bash
wsl --shutdown
```



















