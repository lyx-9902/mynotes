reactå…¨å®¶æ¡¶

## ä¸€ React ä»‹ç»

**1.**  **React** **èµ·æºä¸å‘å±•**

React èµ·æºäº **Facebook** çš„å†…éƒ¨é¡¹ç›®ï¼Œå› ä¸ºè¯¥å…¬å¸å¯¹å¸‚åœºä¸Šæ‰€æœ‰ JavaScript MVC æ¡†æ¶ï¼Œéƒ½ä¸æ»¡æ„ï¼Œå°±å†³å®šè‡ªå·±å†™ä¸€å¥—ï¼Œç”¨æ¥æ¶è®¾Instagram çš„ç½‘ç«™ã€‚åšå‡ºæ¥ä»¥åï¼Œå‘ç°è¿™å¥—ä¸œè¥¿å¾ˆå¥½ç”¨ï¼Œå°±åœ¨2013å¹´5æœˆå¼€æºäº†ã€‚

**2.**  **React ä¸ä¼ ç»Ÿ **MVC** **çš„å…³ç³»**

è½»é‡çº§çš„è§†å›¾å±‚**åº“**ï¼*A JavaScript library for building user interfaces*

Reactä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„MVCæ¡†æ¶ï¼Œæœ€å¤šå¯ä»¥è®¤ä¸ºæ˜¯MVCä¸­çš„Vï¼ˆViewï¼‰ï¼Œç”šè‡³Reactå¹¶ä¸éå¸¸è®¤å¯MVCå¼€å‘æ¨¡å¼ï¼›React æ„å»ºé¡µé¢ UI çš„åº“ã€‚å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºï¼ŒReact å°†ç•Œé¢åˆ†æˆäº†å„ä¸ªç‹¬ç«‹çš„å°å—ï¼Œæ¯ä¸€ä¸ªå—å°±æ˜¯ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¹‹é—´å¯ä»¥ç»„åˆã€åµŒå¥—ï¼Œå°±æˆäº†æˆ‘ä»¬çš„é¡µé¢ã€‚

**3.**  **React** ç‰¹æ€§

ç‰¹ç‚¹:
1.å£°æ˜å¼è®¾è®¡-Reacté‡‡ç”¨å£°æ˜èŒƒå¼ï¼Œå¯ä»¥è½»æ¾æè¿°åº”ç”¨ã€‚

2.é«˜æ•ˆ-Reacté€šè¿‡å¯¹DOMçš„æ¨¡æ‹Ÿ(è™šæ‹Ÿdom)ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘ä¸DOMçš„äº¤äº’

3.çµæ´»-Reactå¯ä»¥ä¸å·²çŸ¥çš„åº“æˆ–æ¡†æ¶å¾ˆå¥½åœ°é…åˆã€‚

4.JSX-JSXæ˜¯JavaScript è¯­æ³•çš„æ‰©å±•

5.ç»„ä»¶-é€šè¿‡ Reactæ„å»ºç»„ä»¶ï¼Œä½¿å¾—ä»£ç æ›´åŠ å®¹æ˜“å¾—åˆ°å¤ç”¨ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„åº”ç”¨åœ¨å¤§é¡¹ç›®çš„å¼€å‘ä¸­ã€‚

6.å•å‘å“åº”çš„æ•°æ®æµ- React å®ç°äº†å•å‘å“åº”çš„æ•°æ®æµï¼Œä»è€Œå‡å°‘äº†é‡å¤ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯å®ƒä¸ºä»€ä¹ˆæ¯”ä¼ ç»Ÿæ•°æ®ç»‘å®šæ›´ç®€å•

**4.** **è™šæ‹Ÿ** **DOM**

ä¼ ç»Ÿdomæ›´æ–°:
çœŸå®é¡µé¢å¯¹åº”ä¸€ä¸ªDOM æ ‘ã€‚åœ¨ä¼ ç»Ÿé¡µé¢çš„å¼€å‘æ¨¡å¼ä¸­ï¼Œæ¯æ¬¡éœ€è¦æ›´æ–°é¡µé¢æ—¶ï¼Œéƒ½è¦æ‰‹åŠ¨æ“ä½œDOMæ¥è¿›è¡Œæ›´æ–°

![](.\img\å¾®ä¿¡æˆªå›¾_20231113164804.png)

è™šæ‹Ÿdom:
DOMæ“ä½œéå¸¸æ˜‚è´µã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæ€§èƒ½æ¶ˆè€—æœ€å¤§çš„å°±æ˜¯ DOM æ“ä½œï¼Œè€Œä¸”è¿™éƒ¨åˆ†ä»£ç ä¼šè®©æ•´ä½“é¡¹ç›®çš„ä»£ç å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚React æŠŠçœŸå® DOM æ ‘è½¬æ¢æˆJavaScript å¯¹è±¡æ ‘ï¼Œä¹Ÿå°±æ˜¯ Virtual

![](.\img\å¾®ä¿¡æˆªå›¾_20231113164916.png)



## äºŒ create-react-app

å…¨å±€å®‰è£…  è„šæ‰‹æ¶ create-react-app

```
npm install -g create-react-app
```

åˆ›å»ºä¸€ä¸ªé¡¹ç›®

```
create-react-app <é¡¹ç›®åå­—>    //æ³¨æ„å‘½åæ–¹å¼
```

### æ£€æµ‹ create-react-app æ˜¯å¦å®‰è£…æˆåŠŸ

```cobol
create-react-app -V // æ³¨æ„ï¼šV æ˜¯å¤§å†™çš„ 
```

Creating a new React app in /dir/your-app.

Installing packages. This might take a couple of minutes. å®‰è£…è¿‡ç¨‹è¾ƒæ…¢ï¼Œ

Installing react, react-dom, and react-scripts...

å¦‚æœä¸æƒ³å…¨å±€å®‰è£…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨npx

```
npx create-react-app myapp ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœ
```

è¿™éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šä¼šå®‰è£…ä¸‰ä¸ªä¸œè¥¿

```
1 react: reactçš„é¡¶çº§åº“

2.react-dom: å› ä¸ºreactæœ‰å¾ˆå¤šçš„è¿è¡Œç¯å¢ƒï¼Œæ¯”å¦‚appç«¯çš„react-native,æˆ‘ä»¬è¦åœ¨webä¸Šè¿è¡Œå°±ä½¿ç”¨

3.react-dom

4.react-scripts: åŒ…å«è¿è¡Œå’Œæ‰“åŒ…reactåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è„šæœ¬åŠé…ç½®
```

å‡ºç°ä¸‹é¢çš„ç•Œé¢ï¼Œè¡¨ç¤ºåˆ›å»ºé¡¹ç›®æˆåŠŸ:

```
Success! Created your-app at /dir/your-app

Inside that directory, you can run several commands:

npm start

Starts the development server.

npm run build

Bundles the app into static files for production.
npm test
Starts the test runner.


npm run eject
Removes this tool and copies build dependencies, configuration files and scripts into the app directory. If you do this, you canâ€™t go back!

We suggest that you begin by typing:


cd your-app npm start

Happy hacking!
```

ç”Ÿæˆé¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹:â€œ
æ ¹æ®ä¸Šé¢çš„æç¤ºï¼Œé€šè¿‡cd your-app å‘½ä»¤è¿›å…¥ç›®å½•å¹¶è¿è¡Œnpm start å³å¯è¿è¡Œé¡¹ç›®ã€‚

ç”Ÿæˆé¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹

```
â”œâ”€â”€ README.md   ä½¿ç”¨æ–¹æ³•çš„æ–‡æ¡£
â”œâ”€â”€ node_modules    æ‰€æœ‰çš„ä¾èµ–å®‰è£…çš„ç›®å½•
â”œâ”€â”€ package-lock.json  é”å®šå®‰è£…æ—¶çš„åŒ…çš„ç‰ˆæœ¬å·,ä¿è¯å›¢é˜Ÿçš„ä¾èµ–èƒ½ä¿è¯ä¸€è‡´ã€‚
â”œâ”€â”€ package.json
â”œâ”€â”€ public        é™æ€å…¬å…±ç›®å½•
â””â”€â”€ src            å¼€å‘ç”¨çš„æºä»£ç ç›®å½•

```

![img](file:///C:/Users/15612/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png)npmå®‰è£…å¤±è´¥

åˆ‡æ¢ä¸ºnpmé•œåƒä¸ºæ·˜å®é•œåƒâ€œ

ä½¿ç”¨yarnï¼Œå¦‚æœæœ¬æ¥ä½¿ç”¨yarnè¿˜è¦å¤±è´¥ï¼Œè¿˜å¾—æŠŠyarnçš„æºåˆ‡æ¢åˆ°å›½å†…

å¦‚æœè¿˜æ²¡æœ‰åŠæ³•è§£å†³ï¼Œè¯·åˆ é™¤node.modulesåŠpackage-lockjsonç„¶åé‡æ–°æ‰§è¡Œnpm install å‘½ä»¤

å†ä¸èƒ½è§£å†³å°±åˆ é™¤nodemodulesåŠpackage-lock.jsonçš„åŒæ—¶æ¸…é™¤npmç¼“å­˜npm cacheclean --force

ä¹‹åå†æ‰§è¡Œnpm install å‘½ä»¤

## ä¸‰ ç¼–å†™ä¸€ä¸ªreactåº”ç”¨ç¨‹åº

reactå¼€å‘éœ€è¦å¼•å…¥å¤šä¸ªä¾èµ–æ–‡ä»¶ï¼šreact.jsã€react-dom.jsï¼Œåˆ†åˆ«åˆæœ‰å¼€å‘ç‰ˆæœ¬å’Œç”Ÿäº§ç‰ˆæœ¬ï¼Œcreate- react-appé‡Œå·²ç»å¸®æˆ‘ä»¬æŠŠè¿™äº›ä¸œè¥¿éƒ½å®‰è£…å¥½äº†ã€‚æŠŠé€šè¿‡CRAåˆ›å»ºçš„å·¥ç¨‹ç›®å½•ä¸‹çš„srcç›®å½•æ¸…ç©ºï¼Œç„¶ååœ¨é‡Œé¢é‡æ–°åˆ›å»ºä¸€ä¸ªindex.js. å†™å…¥ä»¥ä¸‹ä»£ç :

```react
// ä» react çš„åŒ…å½“ä¸­å¼•å…¥äº† Reactã€‚
//åªè¦ä½ è¦å†™ React.js ç»„ä»¶å°±å¿…é¡»å¼•å…¥React, å› ä¸ºreacté‡Œæœ‰ä¸€ç§è¯­æ³•å«JSXï¼Œç¨åä¼šè®²åˆ°JSXï¼Œè¦å†™JSXï¼Œå°±å¿…é¡»å¼•å…¥React
import React from 'react'
// ReactDOM å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠ React ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šå»ï¼Œæ²¡æœ‰å…¶å®ƒçš„ä½œç”¨äº†ã€‚å®ƒæ˜¯ä» react-dom ä¸­å¼•å…¥çš„ï¼Œè€Œä¸æ˜¯ä» react å¼•å…¥ã€‚
import ReactDOM from 'react-dom'

// ReactDOMé‡Œæœ‰ä¸€ä¸ªrenderæ–¹æ³•ï¼ŒåŠŸèƒ½å°±æ˜¯æŠŠç»„ä»¶æ¸²æŸ“å¹¶ä¸”æ„é€  DOM æ ‘ï¼Œç„¶åæ’å…¥åˆ°é¡µé¢ä¸ŠæŸä¸ªç‰¹å®šçš„å…ƒç´ ä¸Š
ReactDOM.render(
// è¿™é‡Œå°±æ¯”è¾ƒå¥‡æ€ªäº†ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œçœ‹èµ·æ¥åƒæ˜¯çº¯ HTML ä»£ç å†™åœ¨ JavaScript ä»£ç é‡Œé¢ã€‚è¯­æ³•é”™è¯¯å—ï¼Ÿè¿™å¹¶ä¸æ˜¯åˆæ³•çš„ JavaScript ä»£ç , â€œåœ¨ JavaScript å†™çš„æ ‡ç­¾çš„â€è¯­æ³•å« JSX- JavaScript XMLã€‚
<h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>,
// æ¸²æŸ“åˆ°å“ªé‡Œ
document.getElementById('root')
)

```

<React.StrictMode> 

ç›®å‰æœ‰åŠ©äºè¯†åˆ«ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸ
å…³äºä½¿ç”¨è¿‡æ—¶å­—ç¬¦ä¸²refAPIçš„è­¦å‘Š

æ£€æµ‹æ„å¤–çš„å‰¯ä½œç”¨
æ£€æµ‹è¿‡æ—¶çš„ context AP



## å›› JSXè¯­æ³•ä¸ç»„ä»¶

## 1  JSXè¯­æ³•

JSX å°† HTML è¯­æ³•ç›´æ¥åŠ å…¥åˆ° JavaScript ä»£ç ä¸­ï¼Œå†é€šè¿‡ç¿»è¯‘å™¨è½¬æ¢åˆ°çº¯ JavaScript åç”±æµè§ˆå™¨æ‰§è¡Œã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼ŒJSX åœ¨äº§å“æ‰“åŒ…é˜¶æ®µéƒ½å·²ç»ç¼–è¯‘æˆçº¯ JavaScriptï¼Œä¸ä¼šå¸¦æ¥ä»»ä½•å‰¯ä½œç”¨ï¼Œåè€Œä¼šè®©ä»£ç æ›´åŠ ç›´è§‚å¹¶æ˜“äºç»´æŠ¤ã€‚ ç¼–è¯‘è¿‡ç¨‹ç”±Babel çš„ JSX ç¼–è¯‘å™¨å®ç°

**JSXä¸æ˜¯å¿…éœ€çš„(ä½†åº”é¦–é€‰JSXè¯­æ³•)**

JSXåªæ˜¯React.createElement(component,props,...children)çš„[è¯­æ³•ç³–](https://so.csdn.net/so/search?q=è¯­æ³•ç³–&spm=1001.2101.3001.7020)ï¼Œæ‰€æœ‰çš„JSXè¯­æ³•æœ€ç»ˆéƒ½ä¼šè¢«è½¬æ¢æˆå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚

```react
//JSXè¯­æ³•
const element = <div className='foo'>Hello,world</div>
 
//è½¬æ¢å
const element = React.createElement('div',{className:'foo'},'Hello,React')

```



https://reactjs.org/docs/hello-world.html

åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

è¦æ˜ç™½JSXçš„åŸç†ï¼Œéœ€è¦å…ˆæ˜ç™½å¦‚ä½•ç”¨ JavaScript å¯¹è±¡æ¥è¡¨ç°ä¸€ä¸ª DOM å…ƒç´ çš„ç»“æ„?çœ‹ä¸‹é¢çš„DOMç»“æ„

```react
<div class='app' id='appRoot'>
    <h1 class='title'>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>
    <p>
       React.js æ˜¯ä¸€ä¸ªå¸®åŠ©ä½ æ„å»ºé¡µé¢ UI çš„åº“
    </p>
</div>
```

ä¸Šé¢è¿™ä¸ª HTML æ‰€æœ‰çš„ä¿¡æ¯æˆ‘ä»¬éƒ½å¯ä»¥ç”¨ JavaScript å¯¹è±¡æ¥è¡¨ç¤º

```javascript
{
tag: 'div',
attrs: { className: 'app', id: 'appRoot'},
    children: [
{
    tag: 'h1',
    attrs: { className: 'title' }, 
    children: ['æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ']
},
{
  tag: 'p', attrs: null,
  children: ['React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“']
}
]
}
```

ä½†æ˜¯ç”¨ JavaScript å†™èµ·æ¥å¤ªé•¿äº†ï¼Œç»“æ„çœ‹èµ·æ¥åˆä¸æ¸…æ™°ï¼Œç”¨ HTML çš„æ–¹å¼å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚äºæ˜¯ Reactjs å°±æŠŠ JavaScript çš„è¯­æ³•æ‰©å±•äº†ä¸€ä¸‹ï¼Œè®© JavaScript è¯­è¨€èƒ½å¤Ÿæ”¯æŒè¿™ç§ç›´æ¥åœ¨ JavaScript ä»£ç é‡Œé¢ç¼–å†™ç±»ä¼¼ HTML æ ‡ç­¾ç»“æ„çš„è¯­æ³•ï¼Œè¿™æ ·å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚ç¼–è¯‘çš„è¿‡ç¨‹ä¼šæŠŠç±»ä¼¼ HTMLçš„ JSXç»“æ„è½¬æ¢æˆ JavaScript çš„å¯¹è±¡æ„ã€‚

ä¸‹é¢ä»£ç 

```react
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component { 
 render () {
    return (
    <div className='app' id='appRoot'>
        <h1 className='title'>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>
        <p>
          React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“
        </p>
    </div>
    )
}}


ReactDOM.render(<App />, document.getElementById('root'))
```

ç¼–è¯‘ä¹‹åå°†å¾—åˆ°è¿™æ ·çš„ä»£ç 

```react
import React from 'react'
import ReactDOM from 'react-dom'


class App extends React.Component {
    render() {
        return (React.createElement(
            "div",
            {className: 'app', id: 'appRoot'},
            React.createElement("h1",{ className: 'title' }, "æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ"),
            React.createElement("p", null,"React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“" )
        )
        )
    }
}

ReactDOM.render(React.createElement(App),
    document.getElementById('root')
)
```

React.createElementä¼šæ„å»ºä¸€ä¸ª JavaScript å¯¹è±¡æ¥æè¿°ä½  HTML ç»“æ„çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ ‡ç­¾åã€å±æ€§
è¿˜æœ‰å­å…ƒç´ ç­‰ï¼Œè¯­æ³•ä¸º

```
React.createElement( 
type,
[props], 
[...children]
)

```

æ‰€è°“çš„ JSX å…¶å®å°±æ˜¯ JavaScript å¯¹è±¡ï¼Œæ‰€ä»¥ä½¿ç”¨ React å’ŒJSX çš„æ—¶å€™ä¸€å®šè¦ç»è¿‡ç¼–è¯‘çš„è¿‡ç¨‹

JSXä¸€ä½¿ç”¨reactæ„é€ ç»„ä»¶ï¼Œbableè¿›è¡Œç¼–è¯‘ -->JavaScriptå¯¹è±¡ ä¸€  ReactDOM.render()->DOMå…ƒç´  ä¸€>æ’å…¥é¡µé¢

## 2. Classç»„ä»¶

ES6çš„åŠ å…¥è®©JavaScriptç›´æ¥æ”¯æŒä½¿ç”¨classæ¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œreactåˆ›å»ºç»„ä»¶çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨çš„ç±»çš„ç»§æ‰¿ï¼ŒES6 Class

æ˜¯ç›®å‰å®˜æ–¹æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä½¿ç”¨äº†ES6æ ‡å‡†è¯­æ³•æ¥æ„å»ºï¼Œçœ‹ä»¥ä¸‹ä»£ç 

```javascript
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component { 
    render () {
            return ( <h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>)
            }
        }

ReactDOM.render(
<App />, document.getElementById('root')
)

```

es6 Classç»„ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªæ„é€ å™¨,æ¯æ¬¡ä½¿ç”¨ç»„ä»¶éƒ½ç›¸å½“äºåœ¨å®ä¾‹åŒ–ç»„ä»¶ï¼Œåƒè¿™æ ·

```
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component {
    render() {
        return (
            <h1>æ¬¢è¿è¿›å…¥{this.props.name}çš„ä¸–ç•Œ</h1>
        )
    }
}

const app = new App({
    name: 'react'
}).render()


ReactDOM.render(app,
    document.getElementById('root')
)
```

## 3.å‡½æ•°å¼ç»„ä»¶

```react
import React from 'react'
import ReactDOM from 'react-dom'

const App = (props) => <h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1> 
ReactDOM.render(
// Reactç»„ä»¶çš„è°ƒç”¨æ–¹å¼
<App />, document.getElementById('root')
)
```

è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„å‡½æ•°å¼ç»„ä»¶å°±å®šä¹‰å¥½äº†ã€‚ä½†è¦**æ³¨æ„ï¼æ³¨æ„ï¼æ³¨æ„ï¼**ç»„ä»¶åå¿…é¡»**å¤§å†™**ï¼Œå¦åˆ™æŠ¥é”™

## 4.ç»„ä»¶çš„æ ·å¼

### è¡Œå†…æ ·å¼

æƒ³ç»™è™šæ‹Ÿdomæ·»åŠ è¡Œå†…æ ·å¼ï¼Œéœ€è¦ä½¿ç”¨è¡¨è¾¾å¼ä¼ å…¥æ ·å¼å¯¹è±¡çš„æ–¹å¼æ¥å®ç°

```react
//  æ³¨æ„è¿™é‡Œçš„ä¸¤ä¸ªæ‹¬å·ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºæˆ‘ä»¬åœ¨è¦JSXé‡Œæ’å…¥JSäº†ï¼Œç¬¬äºŒä¸ªæ˜¯å¯¹è±¡çš„æ‹¬å·

 <p style={{color:'red', fontSize:'14px'}}>Hello world</p>
```

è¡Œå†…æ ·å¼éœ€è¦å†™å…¥ä¸€ä¸ªæ ·å¼å¯¹è±¡ï¼Œè€Œè¿™ä¸ªæ ·å¼å¯¹è±¡çš„ä½ç½®å¯ä»¥æ”¾åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œä¾‹å¦‚ renderå‡½æ•°é‡Œã€ç»„ä»¶åŸå‹ä¸Šã€å¤–é“¾jsæ–‡ä»¶ä¸­

ä½¿ç”¨class

Reactæ¨èæˆ‘ä»¬ä½¿ç”¨è¡Œå†…æ ·å¼ï¼Œå› ä¸ºReactè§‰å¾—æ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•´ä½“

å…¶å®æˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹è¿˜æ˜¯å¤§é‡çš„åœ¨ä¸ºå…ƒç´ æ·»åŠ ç±»åï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,classéœ€è¦å†™æˆ className

å› ä¸ºæ¯•ç«Ÿæ˜¯åœ¨å†™ç±»jsä»£ç ï¼Œä¼šæ”¶åˆ°jsè§„åˆ™çš„ç°åœ¨ï¼Œè€Œclassæ˜¯å…³é”®å­—

```
<p className="hello">Hello world</p>
```

æ³¨æ„:	

```
class ==> className , for ==> htmlFor(label)
```

## 5 äº‹ä»¶å¤„ç†

### 1 ç»‘å®šäº‹ä»¶

é‡‡ç”¨å…³äº+äº‹ä»¶åçš„æ–¹å¼æ¥ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œæ³¨æ„ï¼Œè¿™é‡Œå’ŒåŸç”Ÿçš„äº‹ä»¶æ˜¯æœ‰åŒºåˆ«çš„ï¼ŒåŸç”Ÿçš„äº‹ä»¶å…¨æ˜¯å°å†™ onclickï¼ŒReacté‡Œçš„äº‹ä»¶æ˜¯é©¼å³°onClickï¼ŒReact çš„äº‹ä»¶å¹¶ä¸æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œè€Œæ˜¯åˆæˆäº‹ä»¶ã€‚

### 2 äº‹ä»¶handlerçš„å†™æ³•

a ç›´æ¥åœ¨renderé‡Œå†™è¡Œå†…çš„ç®­å¤´å‡½æ•°(ä¸æ¨è)

båœ¨ç»„ä»¶å†…ä½¿ç”¨ç®­å¤´å‡½æ•°å®šä¹‰ä¸€ä¸ªæ–¹æ³•(æ¨è)

c ç›´æ¥åœ¨ç»„ä»¶å†…å®šä¹‰ä¸€ä¸ªéç®­å¤´å‡½æ•°çš„æ–¹æ³•ï¼Œç„¶ååœ¨renderé‡Œç›´æ¥ä½¿ç”¨ onclick=[thishandleclick,bind(this)}  (ä¸æ¨è)

d ç›´æ¥åœ¨ç»„ä»¶å†…å®šä¹‰ä¸€ä¸ªéç®­å¤´å‡½æ•°çš„æ–¹æ³•ï¼Œç„¶ååœ¨constructoré‡Œbind(this)(æ¨è

### 3 Event å¯¹è±¡

å’Œæ™®é€šæµè§ˆå™¨ä¸€æ ·ï¼Œäº‹ä»¶handlerä¼šè¢«è‡ªåŠ¨ä¼ å…¥ä¸€ä¸ª eventeå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å’Œæ™®é€šçš„æµè§ˆå™¨ event å¯¹è±¡æ‰€åŒ…å«çš„æ–¹æ³•å’Œå±æ€§éƒ½åŸºæœ¬ä¸€è‡´ã€‚ä¸åŒçš„æ˜¯ Reactä¸­çš„ event å¯¹è±¡å¹¶ä¸æ˜¯æµè§ˆå™¨æä¾›çš„ï¼Œè€Œæ˜¯å®ƒè‡ªå·±å†…éƒ¨æ‰€æ„å»ºçš„ã€‚å®ƒåŒæ ·å…·æœ‰ event.stopPropagationã€event.preventDefault è¿™ç§å¸¸ç”¨çš„æ–¹æ³•

## 6.Refçš„åº”ç”¨

a  ç»™æ ‡ç­¾è®¾ç½® ref="username"

é€šè¿‡è¿™ä¸ªè·å–this.refs.username , refå¯ä»¥è·å–åˆ°åº”ç”¨çš„çœŸå®dom

b ç»™ç»„ä»¶è®¾ç½®  ref="username"

é€šè¿‡è¿™ä¸ªè·å– this.refs.username  ,refå¯ä»¥è·å–åˆ°ç»„ä»¶å¯¹è±¡

###    **æ–°çš„å†™æ³•**

```
myRef = React.createRef()

     <div ref={this.myRef}>hello</div>

             è®¿é—®this.myRef.current

```



## äº” ç»„ä»¶çš„æ•°æ®æŒ‚è½½æ–¹å¼

**çŠ¶æ€(state)**

çŠ¶æ€å°±æ˜¯ç»„ä»¶æè¿°æŸç§æ˜¾ç¤ºæƒ…å†µçš„æ•°æ®ï¼Œç”±ç»„ä»¶è‡ªå·±è®¾ç½®å’Œæ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´ç”±ç»„ä»¶è‡ªå·±ç»´æŠ¤ï¼Œä½¿ç”¨çŠ¶æ€çš„ç›®çš„å°±æ˜¯ä¸ºäº†åœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ä½¿ç»„ä»¶çš„æ˜¾ç¤ºä¸åŒ(è‡ªå·±ç®¡ç†ï¼‰

### æ‹“å±•è§£é‡Šï¼š

#### a è®¾è®¡åˆé€‚çš„state

stateå¿…é¡»èƒ½ä»£è¡¨ä¸€ä¸ªç»„ä»¶UIå‘ˆç°çš„å®Œæ•´çŠ¶æ€é›†ï¼Œä»£è¡¨ä¸€ä¸ªç»„ä»¶UIå‘ˆç°çš„æœ€å°çŠ¶æ€é›†ã€‚

stateå¿…é¡»èƒ½ä»£è¡¨ä¸€ä¸ªç»„ä»¶UIå‘ˆç°çš„å®Œæ•´çŠ¶æ€é›†åˆå¯ä»¥åˆ†æˆä¸¤ç±»æ•°æ®ï¼šç”¨ä½œæ¸²æŸ“ç»„ä»¶æ—¶ä½¿ç”¨åˆ°çš„æ•°æ®çš„æ¥æºï¼Œç”¨ä½œç»„ä»¶UIå±•ç°å½¢å¼çš„åˆ¤æ–­ä¾æ®ï¼š

```react
class Hello extends Component {
    constructor(props) {
        super(props);
        this.state = {
            user: 'react', //ç”¨ä½œæ¸²æŸ“ç»„ä»¶æ—¶ä½¿ç”¨åˆ°çš„æ•°æ®çš„æ¥æº
            display: true //ç”¨ä½œç»„ä»¶UIå±•ç°å½¢å¼çš„åˆ¤æ–­ä¾æ®
        }
    }
    render() {
        return (
            <div>
                {
                    this.state.display ? <h1>{this.state.user}</h1> : <></>
                }
            </div>
        )
    }
}
export default Hello;
```

#### b æ™®é€šå±æ€§

åœ¨es6ä¸­ï¼Œå¯ä»¥ä½¿ç”¨this.å±æ€§åå®šä¹‰ä¸€ä¸ªclassçš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è¯´å±æ€§æ˜¯ç›´æ¥æŒ‚è½½åœ¨thisä¸‹çš„ä¸€ä¸ªå˜é‡ã€‚å› æ­¤ï¼Œstateå’Œpropså®é™…ä¸Šä¹Ÿæ˜¯ç»„ä»¶çš„å±æ€§ï¼Œåªä¸è¿‡æ˜¯reactåœ¨Component classä¸­é¢„å®šä¹‰å¥½çš„å±æ€§ã€‚

é™¤äº†stateå’Œpropsä»¥å¤–çš„å…¶ä»–ç»„ä»¶å±æ€§ç§°ä¸ºç»„ä»¶çš„æ™®é€šå±æ€§ã€‚

```react
class Hello extends Component {
    constructor(props) {
        super(props);
        this.timer = null; //æ™®é€šå±æ€§
        this.state = {
            date: new Date()
        }
        this.updateDate = this.updateDate.bind(this);
    }
    componentDidMount(){
        this.timer = setInterval(this.updateDate, 1000);
    }
    componentWillUnmount(){
        clearInterval(this.timer);
    }
    updateDate(){
        this.setState({
            date: new Date()
        })
    }
    render() {
        return (
            <div>
                <h1>{this.state.date.toString()}</h1>
            </div>
        )
    }
}
export default Hello;


```

ç»„ä»¶ä¸­ç”¨åˆ°çš„ä¸€ä¸ªå˜é‡æ˜¯å¦åº”è¯¥ä½œä¸ºstateå¯ä»¥é€šè¿‡ä¸‹é¢4æ¡ä¾æ®åˆ¤æ–­ï¼š

è¿™ä¸ªå˜é‡æ˜¯å¦é€šè¿‡propsä»çˆ¶ç»„ä»¶ä¸­è·å–ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€
è¿™ä¸ªå˜é‡æ˜¯å¦åœ¨ç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¿æŒä¸å˜ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€
è¿™ä¸ªå˜é‡æ˜¯å¦å¯ä»¥é€šè¿‡å…¶ä»–çŠ¶æ€(state)æˆ–è€…å±æ€§(props)è®¡ç®—å¾—åˆ°ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€
è¿™ä¸ªå˜é‡æ˜¯å¦åœ¨ç»„ä»¶çš„renderæ–¹æ³•ä¸­ä½¿ç”¨ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ç§æƒ…å†µæ›´é€‚åˆå®šä¹‰ä¸ºç»„ä»¶çš„ä¸€ä¸ªæ™®é€šå±æ€§.

#### c æ­£ç¡®ä¿®æ”¹state

â‘ ä¸èƒ½ç›´æ¥ä¿®æ”¹stateï¼Œéœ€è¦ä½¿ç”¨setState()

â‘¡stateçš„æ›´æ–°æ˜¯å¼‚æ­¥çš„

Reactä¼šå°†å¤šæ¬¡setStateçš„çŠ¶æ€åˆå¹¶æˆä¸€æ¬¡çŠ¶æ€ä¿®æ”¹ï¼Œä¸èƒ½ä¾èµ–å½“å‰çš„stateè®¡ç®—ä¸‹ä¸€ä¸ªstate(propsä¹Ÿæ˜¯å¼‚æ­¥çš„)ã€‚

ä¾‹å¦‚ï¼šè¿ç»­ä¸¤æ¬¡ç‚¹å‡»åŠ å…¥è´­ç‰©è½¦ï¼Œå®é™…æ•°é‡åªä¼šåŠ 1ï¼Œåœ¨Reactåˆå¹¶å¤šæ¬¡ä¿®æ”¹ä¸º1æ¬¡çš„æƒ…å†µä¸‹ï¼Œç›¸å½“äºæ‰§è¡Œäº†ï¼š

```react
Object.assign(
    previousState,
    {quantity: this.state.quantity + 1},
    {quantity: this.state.quantity + 1}
)
```

è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°çš„setStateï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“å‰ä¿®æ”¹åçš„æœ€æ–°çŠ¶æ€çš„å‰ä¸€ä¸ªçŠ¶æ€preStateï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å½“å‰æœ€æ–°çš„å±æ€§props:

```
this.setState((preState,props) => ({
    quantity: preState.quantity + 1;
}))
```

â‘¢stateçš„æ›´æ–°æ˜¯ä¸€ä¸ªåˆå¹¶çš„è¿‡ç¨‹

â‘£stateä¸ä¸å¯å˜å¯¹è±¡

ç›´æ¥ä¿®æ”¹stateï¼Œç»„ä»¶ä¸ä¼šrenderï¼›stateåŒ…å«çš„æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå½“stateä¸­æŸä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåº”è¯¥é‡æ–°åˆ›å»ºè¿™ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹åŸæ¥çš„çŠ¶æ€ã€‚åˆ›å»ºæ–°çš„çŠ¶æ€æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š

çŠ¶æ€çš„ç±»å‹æ˜¯ä¸å¯å˜ç±»å‹(æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€nullã€undefined)ï¼šå› ä¸ºçŠ¶æ€æ˜¯ä¸å¯å˜ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥èµ‹ä¸€ä¸ªæ–°å€¼å³å¯
çŠ¶æ€çš„ç±»å‹æ˜¯æ•°ç»„ï¼šå¯ä»¥ä½¿ç”¨æ•°ç»„çš„concatæˆ–è€…es6çš„æ‰©å±•è¯­æ³•ï¼Œsliceæ–¹æ³•ã€filteræ–¹æ³•ã€‚ä¸èƒ½ä½¿ç”¨pushã€popã€shiftã€unshiftã€spliceç­‰æ–¹æ³•ä¿®æ”¹æ•°ç»„ç±»å‹çš„çŠ¶æ€ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•ä¼šåœ¨åŸæ•°ç»„åŸºç¡€ä¸Šä¿®æ”¹ã€‚

```
this.setState((preState) => ({
    arr: [...preState.arr,'react'];
}))
this.setState((preState) => ({
    arr: preState.arr.concat(['react'])
}))
```

- çŠ¶æ€çš„ç±»å‹æ˜¯æ™®é€šå¯¹è±¡(ä¸åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„)ï¼šä½¿ç”¨ES6çš„Object.assginæ–¹æ³•æˆ–è€…å¯¹è±¡æ‰©å±•è¯­æ³•.



### **(1)**  **å®šä¹‰**  **state**

ç¬¬ä¸€ç§æ–¹å¼

```
import React, { Component } from 'react' 
import ReactDOM from 'react-dom'

class App extends Component { 
    state = {
      name: 'React', isLiked: false
    }
    render () { 
        return (
        <div>
            <h1>æ¬¢è¿æ¥åˆ°{this.state.name}çš„ä¸–ç•Œ</h1>
                <button>
                {
                this.state.isLiked ? 'â¤å–æ¶ˆ' : 'ğŸ–¤æ”¶è—'
                }
                </button>
        </div>
        )
       }
    }
ReactDOM.render(
<App/>, document.getElementById('root')
)

```

å¦ä¸€ç§æ–¹å¼

```
import React, { Component } from 'react' 
import ReactDOM from 'react-dom'

class App extends Component { 
    constructor() {
        super() 
        this.state = {
        name: 'React', isLiked: false
        }
    }
    
        render () { 
        return (
            <div>
               <h1>æ¬¢è¿æ¥åˆ°{this.state.name}çš„ä¸–ç•Œ</h1>
                <button>
                {this.state.isLiked ? 'â¤å–æ¶ˆ' : 'ğŸ–¤æ”¶è—'}
                </button>
            </div>
        )
        }
    }
ReactDOM.render(
<App/>, document.getElementById('root')
)

```

this.state æ˜¯çº¯jså¯¹è±¡,åœ¨vueä¸­ï¼Œdataå±æ€§æ˜¯åˆ©ç”¨Object.defineProperty å¤„ç†è¿‡çš„ï¼Œæ›´æ”¹dataçš„æ•°æ®çš„æ—¶å€™ä¼šè§¦å‘æ•°æ®çš„getter å’Œsetter ï¼Œä½†æ˜¯Reactä¸­æ²¡æœ‰åšè¿™æ ·çš„å¤„ç†ï¼Œå¦‚æœç›´æ¥æ›´æ”¹çš„è¯ï¼Œ reactæ˜¯æ— æ³•å¾—çŸ¥çš„ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æ›´æ”¹çŠ¶æ€çš„æ–¹æ³• setState ã€‚

### **(2)**  **setState**

isLiked å­˜æ”¾åœ¨å®ä¾‹çš„ stateså¯¹è±¡å½“ä¸­ï¼Œç»„ä»¶çš„render å‡½æ•°å†…ï¼Œä¼šæ ¹æ®ç»„ä»¶çš„statesçš„ä¸­çš„isLiked ä¸åŒæ˜¾ç¤ºâ€œå–æ¶ˆ"æˆ–â€œæ”¶è—"å†…å®¹ã€‚ä¸‹é¢ç»™buttonåŠ ä¸Šäº†ç‚¹å‡»çš„äº‹ä»¶ç›‘å¬ã€‚

```
import React, { Component } from 'react' import ReactDOM from 'react-dom'

class App extends Component { 
    constructor() {
        super() 
        this.state = {
        name: 'React', isLiked: false
        }
    }

    handleBtnClick = () => { this.setState({
    isLiked: !this.state.isLiked
    })
  }
  
render () { 
    return (
    <div>
         <h1>æ¬¢è¿æ¥åˆ°{this.state.name}çš„ä¸–ç•Œ</h1>
        <button onClick={this.handleBtnClick}>
            {
            this.state.isLiked ? 'â¤å–æ¶ˆ' : 'ğŸ–¤æ”¶è—'
            }
        </button>
    </div>
    )
    }
}
ReactDOM.render(
<App/>, document.getElementById('root')
setState æœ‰ä¸¤ä¸ªå‚æ•°
```

ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–¹æ³•returnä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå‚æ•°å«åš updater

å‚æ•°æ˜¯å¯¹è±¡

```
this.setState({
isLiked: !this.state.isLiked
})
```

å‚æ•°æ˜¯æ–¹æ³•

```
this.setState((prevState, props) => { return {
        isLiked: !prevState.isLiked
        }
})

```

æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸Šä¸€æ¬¡çš„state,  ç¬¬äºŒä¸ªæ˜¯props .

setState æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æƒ³è¦è·å–åˆ°æœ€æ–°çš„stateï¼Œæ²¡æœ‰åŠæ³•è·å–ï¼Œå°±æœ‰äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°

```
this.setState(
(prevState, props) => { 
return {
    isLiked: !prevState.isLiked
}, 
    () => {
    console.log('å›è°ƒé‡Œçš„',this.state.isLiked)
    }
)
console.log('setStateå¤–éƒ¨çš„',this.state.isLiked)

```

### (3)å±æ€§(props)

props æ˜¯æ­£å¸¸æ˜¯å¤–éƒ¨ä¼ å…¥çš„ï¼Œç»„ä»¶å†…éƒ¨ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼æ¥åˆå§‹åŒ–çš„è®¾ç½®ï¼Œå±æ€§ä¸èƒ½è¢«ç»„ä»¶è‡ªå·±æ›´æ”¹ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡çˆ¶ç»„ä»¶ä¸»åŠ¨é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ¥ä¼ å…¥æ–°çš„å±æ€§æ˜¯æè¿°æ€§è´¨ã€ç‰¹ç‚¹çš„ï¼Œç»„ä»¶è‡ªå·±ä¸èƒ½éšæ„æ›´æ”¹ã€‚

ä¹‹å‰çš„ç»„ä»¶ä»£ç é‡Œé¢æœ‰props çš„ç®€å•ä½¿ç”¨ï¼Œæ€»çš„æ¥è¯´ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå‚æ•°æ”¾åœ¨æ ‡ç­¾çš„å±æ€§å½“ä¸­ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½ä¼šä½œä¸ºç»„ä»¶å‚æ•°æ¥æ¥æ”¶props :

```
(1) åœ¨ç»„ä»¶ä¸Šé€šè¿‡key=value å†™å±æ€§,é€šè¿‡this.propsè·å–å±æ€§,è¿™æ ·ç»„ä»¶çš„å¯å¤ç”¨æ€§æé«˜äº†.
(2) æ³¨æ„åœ¨ä¼ å‚æ•°æ—¶å€™ï¼Œå¦‚æœå†™æˆisShow="true" é‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,å¦‚æœå†™æˆisShow={true} è¿™ä¸ªæ˜¯å¸ƒå°”å€¼ã€‚
(3) {...å¯¹è±¡} å±•å¼€èµ‹å€¼
(4) é»˜è®¤å±æ€§å€¼

*.defaultProps = {
     é»˜è®¤éƒ½æ˜¯ç©ºï¼Œæˆ–è€…å†™å…¥
   }
  static defaultProps = { 
  myname:"é»˜è®¤çš„myname", myshow:true
}

(5) prop-types å±æ€§éªŒè¯
import propTypes from "prop-types";

*.propTypes={
     name:propTypes.string, age:propTypes.number
}

static propTypes={ 
        myname:propTypes.string,
        myshow:propTypes.bool
    }

```

ï¼ˆ5ï¼‰ç»„ä»¶ä¸­æ’æ§½ä¸­çš„domï¼Œåœ¨è‡ªå·±ç»„ä»¶å‡½æ•°propsä¸­å¯ä»¥æ‹¿åˆ°ã€‚

```
  <App>
     domæˆ–ä¸€ä¸ªç»„ä»¶
    </App>
```



```
class App extends Component {
    componentDidMount() {
        // console.log(this.props)
    }
    
    render() {
        return (
            <div>
                {this.props.children} // <----å¯ä»¥æ‹¿åˆ°dom æˆ–ç»„ä»¶
                {this.props.isShow && <Tabbar/>}
            </div>
        )
    }
}
```









### (4)å±æ€§vsçŠ¶æ€

ç›¸ä¼¼ç‚¹ï¼šéƒ½æ˜¯çº¯jså¯¹è±¡ï¼Œéƒ½ä¼šè§¦å‘renderæ›´æ–°ï¼Œéƒ½å…·æœ‰ç¡®å®šæ€§ï¼ˆçŠ¶æ€/å±æ€§ç›¸åŒï¼Œç»“æœç›¸åŒï¼‰

ä¸åŒç‚¹ï¼š

\1.    å±æ€§èƒ½ä»çˆ¶ç»„ä»¶è·å–ï¼ŒçŠ¶æ€ä¸èƒ½

\2.    å±æ€§å¯ä»¥ç”±çˆ¶ç»„ä»¶ä¿®æ”¹ï¼ŒçŠ¶æ€ä¸èƒ½

\3.    å±æ€§èƒ½åœ¨å†…éƒ¨è®¾ç½®é»˜è®¤å€¼ï¼ŒçŠ¶æ€ä¹Ÿå¯ä»¥ï¼Œè®¾ç½®æ–¹å¼ä¸ä¸€æ ·

\4.    å±æ€§ä¸åœ¨ç»„ä»¶å†…éƒ¨ä¿®æ”¹ï¼ŒçŠ¶æ€è¦åœ¨ç»„ä»¶å†…éƒ¨ä¿®æ”¹

\5.    å±æ€§èƒ½è®¾ç½®å­ç»„ä»¶åˆå§‹å€¼ï¼ŒçŠ¶æ€ä¸å¯ä»¥

\6.    å±æ€§å¯ä»¥ä¿®æ”¹å­ç»„ä»¶çš„å€¼ï¼ŒçŠ¶æ€ä¸å¯ä»¥



stateçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºç»„ä»¶ä¿å­˜ã€æ§åˆ¶ã€ä¿®æ”¹è‡ªå·±çš„å¯å˜çŠ¶æ€ã€‚ state åœ¨ç»„ä»¶å†…éƒ¨åˆå§‹åŒ–ï¼Œå¯ä»¥è¢«ç»„ä»¶è‡ªèº«ä¿®æ”¹ï¼Œè€Œå¤–éƒ¨ä¸èƒ½è®¿é—®ä¹Ÿä¸èƒ½ä¿®æ”¹ã€‚ä½ å¯ä»¥è®¤ä¸º state  æ˜¯ä¸€ä¸ªå±€éƒ¨çš„ã€åªèƒ½è¢«ç»„ä»¶è‡ªèº«æ§åˆ¶çš„æ•°æ®æºã€‚

stateä¸­çŠ¶æ€å¯ä»¥é€šè¿‡ this.setState æ–¹æ³•è¿›è¡Œæ›´æ–°ï¼Œ setState ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

propsçš„ä¸»è¦ä½œç”¨æ˜¯è®©ä½¿ç”¨è¯¥ç»„ä»¶çš„çˆ¶ç»„ä»¶å¯ä»¥ä¼ å…¥å‚æ•°æ¥é…ç½®è¯¥ç»„ä»¶ã€‚å®ƒæ˜¯å¤–éƒ¨ä¼ è¿›æ¥çš„é…ç½®å‚æ•°ï¼Œç»„ä»¶å†…éƒ¨æ— æ³•æ§åˆ¶ä¹Ÿæ— æ³•ä¿®æ”¹ã€‚é™¤éå¤–éƒ¨ç»„ä»¶ä¸»åŠ¨ä¼ å…¥æ–°çš„ ï¼Œå¦åˆ™ç»„ä»¶çš„ä¸å˜ã€‚

æ²¡æœ‰state-çš„ç»„ä»¶å«æ— çŠ¶æ€ç»„ä»¶(stateless component)ï¼Œè®¾ç½®äº† stateçš„å«åšæœ‰çŠ¶æ€ç»„ä»¶(stateful component)ã€‚å› ä¸ºçŠ¶æ€ä¼šå¸¦æ¥ç®¡ç†çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬å°½é‡å¤šåœ°å†™æ— çŠ¶æ€ç»„ä»¶ï¼Œå°½é‡å°‘åœ°å†™æœ‰çŠ¶æ€çš„ç»„ä»¶ã€‚è¿™æ ·ä¼šé™ä½ä»£ç ç»´æŠ¤çš„éš¾åº¦ï¼Œä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢å¼ºç»„ä»¶çš„å¯å¤ç”¨æ€§ã€‚

### (5)æ¸²æŸ“æ•°æ®

æ¡ä»¶æ¸²æŸ“

```
{
condition ? 'æ¸²æŸ“åˆ—è¡¨çš„ä»£ç ' : 'ç©ºç©ºå¦‚ä¹Ÿ'
}
```

åˆ—è¡¨æ¸²æŸ“

```
// æ•°æ®
const people = [
{ id: 1,name: 'Leo', age: 35}, 
{id: 2,name: 'XiaoMing', age: 16
}]
// æ¸²æŸ“åˆ—è¡¨
{
    people.map(person => { return (
        <dl key={person.id}>
        <dt>{person.name}</dt>
        <dd>age: {person.age}</dd>
        </dl>
        )
    })
}

```

Reactçš„é«˜æ•ˆä¾èµ–äºæ‰€è°“çš„Virtual-DOMï¼Œå°½é‡ä¸ç¢°DOMã€‚å¯¹äºåˆ—è¡¨å…ƒç´ æ¥è¯´ä¼šæœ‰ä¸€ä¸ªé—®é¢˜:å…ƒç´ å¯èƒ½ä¼šåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­æ”¹å˜ä½ç½®ã€‚è¦å®ç°è¿™ä¸ªæ“ä½œï¼Œåªéœ€è¦äº¤æ¢ä¸€ä¸‹DOMä½ç½®å°±è¡Œäº†ï¼Œä½†æ˜¯Reactå¹¶ä¸çŸ¥é“å…¶å®æˆ‘ä»¬åªæ˜¯æ”¹å˜äº†å…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒä¼šé‡æ–°æ¸²æŸ“åé¢ä¸¤ä¸ªå…ƒç´ (å†æ‰§è¡ŒVitual-DOM )ï¼Œè¿™æ ·ä¼šå¤§å¤§å¢åŠ DOMæ“ä½œã€‚ä½†å¦‚æœç»™æ¯ä¸ªå…ƒç´ åŠ ä¸Šå”¯ä¸€çš„æ ‡è¯†ï¼ŒReactå°±å¯ä»¥çŸ¥é“è¿™ä¸¤ä¸ªå…ƒç´ åªæ˜¯äº¤æ¢äº†ä½ç½®ï¼Œè¿™ä¸ªæ ‡è¯†å°±æ˜¯keyï¼Œè¿™ä¸ªkeyå¿…é¡»æ˜¯æ¯ä¸ªå…ƒç´ å”¯ä¸€çš„æ ‡è¯†

dangerouslySetInnerHTML

å¯¹äºå¯Œæ–‡æœ¬åˆ›å»ºçš„å†…å®¹ï¼Œåå°æ‹¿åˆ°çš„æ•°æ®æ˜¯è¿™æ ·çš„

```
content = "<p>React.jsæ˜¯ä¸€ä¸ªæ„å»ºUIçš„åº“</p>"
```

å¤„äºå®‰å…¨çš„åŸå› ï¼ŒReactå½“ä¸­æ‰€æœ‰è¡¨è¾¾å¼çš„å†…å®¹ä¼šè¢«è½¬ä¹‰ï¼Œå¦‚æœç›´æ¥è¾“å…¥ï¼Œæ ‡ç­¾ä¼šè¢«å½“æˆæ–‡æœ¬ã€‚è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨dangerouslyS.etHTMLå±æ€§ï¼Œå®ƒå…è®¸æˆ‘ä»¬åŠ¨æ€è®¾ç½®innecHTML

```
import React, { Component } from 'react' import ReactDOM from 'react-dom'

class App extends Component { 
       constructor() {
        super() this.state = {
            content : "<p>React.jsæ˜¯ä¸€ä¸ªæ„å»ºUIçš„åº“</p>"
        }
    }
render () { 
   return (
        <div
        // æ³¨æ„è¿™é‡Œæ˜¯ä¸¤ä¸ªä¸‹ä¸‹åˆ’çº¿  __html 
        dangerouslySetInnerHTML={{ __html: this.state.content}}
        />
        )
     }
}

ReactDOM.render(
<App/>, document.getElementById('root')
)

```



## å…­è¡¨å•ä¸­çš„å—æ§ç§Ÿé‡‘æŒ‰å’Œéå—æ§ç»„ä»¶

### éå—æ§ç»„ä»¶:

è¡¨å•å…ƒç´ åœ¨Reactä¸­è‡ªèº«ç»´æŠ¤ä¸€äº›çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å—reactæ§åˆ¶çš„ï¼Œè¿™ç±»çŠ¶æ€ä¸å—reactæ§åˆ¶çš„è¡¨å•å…ƒç´ ç§°ä¸ºéå—æ§ç»„ä»¶ã€‚

### å—æ§ç»„ä»¶:

åœ¨Reactä¸­ï¼ŒçŠ¶æ€çš„ä¿®æ”¹å¿…é¡»é€šè¿‡ç»„ä»¶çš„stateï¼Œ

æ³¨æ„: 

å¦ä¸€ç§è¯´æ³•ï¼ˆå¹¿ä¹‰èŒƒå›´çš„è¯´æ³•ï¼‰ï¼ŒReactç»„ä»¶çš„æ•°æ®æ¸²æŸ“æ˜¯å¦è¢«è°ƒç”¨è€…ä¼ é€’çš„ props å®Œå…¨æ§åˆ¶ï¼Œæ§åˆ¶åˆ™ä¸ºå—æ§ç»„ä»¶ï¼Œå¦åˆ™éå—æ§ç»„ä»¶ã€‚

### æ¼”ç¤º

éå—æ§ç»„ä»¶æœ‰æ‚–äºè¿™ä¸€åŸåˆ™ï¼Œä¸ºäº†è®©è¡¨å•å…ƒç´ çš„çŠ¶æ€å˜æ›´ä¹Ÿèƒ½é€šè¿‡ç»„ä»¶çš„stateç®¡ç†ï¼ŒReactä½¿ç”¨å—æ§ç»„ä»¶çš„æŠ€æœ¯è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚

**å—æ§ç»„ä»¶**

å¦‚æœä¸€ä¸ªè¡¨å•å…ƒç´ çš„å€¼æ˜¯ç”±Reactæ¥ç®¡ç†çš„ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå—æ§ç»„ä»¶ã€‚å¯¹äºä¸åŒçš„è¡¨å•å…ƒç´ ï¼ŒReactçš„æ§åˆ¶æ–¹æ³•ç•¥æœ‰ä¸åŒï¼Œå¸¸ç”¨çš„ä¸‰ç±»è¡¨å•å…ƒç´ æ§åˆ¶æ–¹å¼æ˜¯ï¼š

â‘ æ–‡æœ¬æ¡†

åŒ…å«ç±»å‹ä¸ºtextçš„inputå’Œtextareaå…ƒç´ ï¼Œå®ƒä»¬å—æ§çš„åŸç†æ˜¯ï¼šé€šè¿‡valueå±æ€§è®¾ç½®è¡¨å•å…ƒç´ çš„å€¼ï¼Œé€šè¿‡onChangeæ—¶é—´ç›‘å¬å€¼çš„å˜åŒ–ï¼Œå¹¶å°†å˜åŒ–åŒæ­¥åˆ°Reactç»„ä»¶çš„stateä¸­ï¼š






## ä¸ƒ ç»„ä»¶é€šä¿¡çš„æ–¹å¼

### **1.**   çˆ¶å­ç»„ä»¶é€šä¿¡æ–¹å¼

(1)    çˆ¶ä¼ å­  çœ‹propså°èŠ‚

çˆ¶ç»„ä»¶ä¸­ï¼Œåœ¨å¼•ç”¨çš„å­ç»„ä»¶ä¸Šï¼Œkï¼švæ–¹å¼ä¼ é€’ï¼Œ

å­ç»„ä»¶ä½¿ç”¨propsæ¥æ”¶ã€‚

(2)     ä¼ é€’æ•°æ®(çˆ¶ä¼ å­)ä¸ä¼ é€’æ–¹æ³•(å­ä¼ çˆ¶)

```
ä¼ é€’æ–¹æ³•(å­ä¼ çˆ¶) 
çˆ¶ç»„ä»¶æŠŠä¿®æ”¹è‡ªå·±æ•°æ®çš„æ–¹æ³•ï¼Œé€šè¿‡å˜é‡ï¼Œä½¿ç”¨å­ç»„ä»¶ä¼ é€’è¿‡å»ã€‚å­ç»„ä»¶ä½¿ç”¨this.propsæ¥å—
import React, { Component } from 'react'

å­ç»„ä»¶
class Navbar extends Component{
    render(){
        return <div style={{background:"red"}}>
            <button onClick={()=>{
                   console.log("å­é€šçŸ¥çˆ¶ï¼Œ è®©çˆ¶çš„isSHow å–åã€‚",this.props.event) 

                   this.props.event() //è°ƒç”¨çˆ¶ç»„ä»¶ä¼ æ¥å•Šçš„å›è°ƒå‡½æ•°
            }}>click</button>
            <span>navbar</span>
        </div>
    }
}
çˆ¶ç»„ä»¶
export default class App extends Component {
    state = {
        isShow:false
    }

    handleEvent = ()=>{
        this.setState({
            isShow:!this.state.isShow
        })
        // console.log("çˆ¶ç»„ä»¶å®šä¹‰çš„eventäº‹ä»¶")
    }
    render() {
        return (
            <div>
                <Navbar event={this.handleEvent}/>
                {/* <button onClick={()=>{
                    this.setState({
                        isShow:!this.state.isShow
                    })
                }}>click</button> */}
                {this.state.isShow && <Sidebar/>}
            </div>
        )
    }
}
```

(2)     refæ ‡è®° (çˆ¶ç»„ä»¶æ‹¿åˆ°å­ç»„ä»¶çš„å¼•ç”¨ï¼Œä»è€Œè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•)

åœ¨çˆ¶ç»„ä»¶ä¸­æ¸…é™¤å­ç»„ä»¶çš„inputè¾“å…¥æ¡†çš„valueå€¼ã€‚**this.refs.form.reset()**



### **2.**   éçˆ¶å­ç»„ä»¶é€šä¿¡æ–¹å¼

#### **(1)**   **çŠ¶æ€æå‡**  **(**ä¸­é—´äººæ¨¡å¼**)**

Reactä¸­çš„çŠ¶æ€æå‡æ¦‚æ‹¬æ¥è¯´,å°±æ˜¯å°†å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«çš„çŠ¶æ€æå‡åˆ°å®ƒä»¬æœ€è¿‘çš„çˆ¶ç»„ä»¶ä¸Š.åœ¨çˆ¶ç»„ä»¶ä¸Šæ”¹å˜è¿™ä¸ªçŠ¶æ€ç„¶åé€šè¿‡propsåˆ†å‘ç»™å­ç»„ä»¶. ï¼ˆå®è´¨è¿˜æ˜¯çˆ¶å­é€šä¿¡æ–¹å¼ï¼‰

```
import React, { Component } from 'react'
import axios from 'axios'
import './css/03-communination.css'
export default class App extends Component {

    constructor(){
        super()
        this.state = {
            filmList:[],
            info:""
        }
    }
    æ•°æ®æ¥è‡ªäº’è”ç½‘
    https://m.maizuo.com/v5/#/films/nowPlaying
    componentDidMount(){
        axios.get(`/test.json`).then(res=>{
            console.log(res.data.data.films)
            this.setState({
                filmList:res.data.data.films
            })
        })
    }

    render() {
        return (
            <div>
                {/* {this.state.info} */}
                {
                    this.state.filmList.map(item=>
                        <FilmItem key={item.filmId} {...item} onEvent={(value)=>{
                            // console.log("çˆ¶ç»„ä»¶æ¥å—",value)

                            this.setState({
                                info:value
                            })
                        }}></FilmItem>    
                    )
                }


                <FilmDetail info={this.state.info}></FilmDetail>
            </div>
        )
    }
}

/*å—æ§ç»„ä»¶*/
class FilmItem extends Component{
    render(){
        // console.log(this.props)
        let {name, poster,grade,synopsis}  = this.props
        return <div className="filmitem" onClick={()=>{
            // console.log(synopsis)
            this.props.onEvent(synopsis)
        }}>
            <img src={poster} alt={name}/>
            <h4>{name}</h4>
            <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
        </div>
    }
}

class FilmDetail extends Component{
   
    render(){
        console.log(this.props)
        return <div className="filmdetail">
            {this.props.info}
        </div>
    }
}
```



#### **(2)**   å‘å¸ƒè®¢é˜…æ¨¡å¼å®ç°

çº¯jså®ç° ï¼Œè°è®¢é˜…ï¼Œè°æ¥å—ï¼ŒæŠ›å¼ƒäº†çˆ¶å­å­™å…³ç³»ã€‚

```
/*
 * @ä½œè€…: kerwin
 * @å…¬ä¼—å·: å¤§å‰ç«¯ç§æˆ¿èœ
 */
import React, { Component } from 'react'

export default class App extends Component {
    render() {
        return (
            <div>
                app
            </div>
        )
    }
}

//è°ƒåº¦ä¸­å¿ƒ
var bus = {

    list:[],
    //è®¢é˜…
    subscribe(callback){
        // console.log(callback)

        this.list.push(callback)
    },

    //å‘å¸ƒ
    publish(text){
        //éå†æ‰€æœ‰çš„listï¼Œ å°†å›è°ƒå‡½æ•°æ‰§è¡Œ
        // console.log(this.list)

        this.list.forEach(callback=>{
            callback && callback(text)
        })
    }
}


// è®¢é˜…è€…
bus.subscribe((value)=>{
    console.log("11111",value)
})

bus.subscribe((value)=>{
    console.log("2222",value)
})



//å‘å¸ƒè€…

setTimeout(()=>{
    bus.publish("ç”·äººçœ‹äº†æ²‰é»˜111")
},0)


// Redux åŸºäºè®¢é˜…å‘å¸ƒ 

```



#### **(3)**   **context** çŠ¶æ€æ ‘ä¼ å‚

```
import React, { Component } from 'react'
import axios from 'axios'
import './css/03-communination.css'

const GlobalContext  = React.createContext() //åˆ›å»ºcontextå¯¹è±¡

export default class App extends Component {

    constructor(){
        super()
        this.state = {
            filmList:[],
            info:""
        }
        axios.get(`/test.json`).then(res=>{
            console.log(res.data.data.films)
            this.setState({
                filmList:res.data.data.films
            })
        })
    }

    render() {
        return (
            <GlobalContext.Provider value={{
                call:"æ‰“ç”µè¯",
                sms:"çŸ­ä¿¡",
                info:this.state.info,
                changeInfo:(value)=>{
                    this.setState( {
                        info:value
                    })
                }
            }}>
                <div>
                    {/* {this.state.info} */}
                    {
                        this.state.filmList.map(item=>
                            <FilmItem key={item.filmId} {...item} ></FilmItem>    
                        )
                    }


                    <FilmDetail ></FilmDetail>
                </div>
            </GlobalContext.Provider>
        )
    }
}

/*å—æ§ç»„ä»¶*/
class FilmItem extends Component{
    render(){
        // console.log(this.props)
        let {name, poster,grade,synopsis}  = this.props
        return (
        <GlobalContext.Consumer>
           {
                (value)=>{
                    console.log(value)
                    
                    return <div className="filmitem" onClick={()=>{
                        console.log(synopsis)
                        // this.props.onEvent(synopsis)

                        // value.info = "2222222"

                        // console.log(value)

                        value.changeInfo(synopsis)
                    }}>
                        <img src={poster} alt={name}/>
                        <h4>{name}</h4>
                        <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
                    </div>
                }
           }
        </GlobalContext.Consumer>
        )    
    }
}

class FilmDetail extends Component{
    render(){
        return (
            <GlobalContext.Consumer>
                {
                    (value)=><div className="filmdetail">
                        detail-{value.info}
                    </div>
                }
            </GlobalContext.Consumer>
        )
    }
}
```







## å…« Reactç”Ÿå‘½å‘¨æœŸ

**åªæœ‰ç±»ç»„ä»¶æ‰æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ**

###  1.åˆå§‹åŒ–é˜¶æ®µ

```
componentWillMount: renderä¹‹å‰æœ€åä¸€æ¬¡ä¿®æ”¹çŠ¶æ€çš„æœºä¼š

render: åªèƒ½è®¿é—®this.propså’Œthis.stateï¼Œä¸å…è®¸ä¿®æ”¹çŠ¶æ€å’ŒDOMè¾“å‡º

componentDidMount: æˆåŠŸrenderå¹¶æ¸²æŸ“å®ŒæˆçœŸå®DOMä¹‹åè§¦å‘ï¼Œå¯ä»¥ä¿®æ”¹DOM
```

### 2.è¿è¡Œä¸­é˜¶æ®µ

```
componentWillReceiveProps: çˆ¶ç»„ä»¶ä¿®æ”¹å±æ€§è§¦å‘

shouldComponentUpdate: è¿”å›falseä¼šé˜»æ­¢renderè°ƒç”¨

componentWillUpdate: ä¸èƒ½ä¿®æ”¹å±æ€§å’ŒçŠ¶æ€

render: åªèƒ½è®¿é—®this.propså’Œthis.stateï¼Œä¸å…è®¸ä¿®æ”¹çŠ¶æ€å’ŒDOMè¾“å‡º

componentDidUpdate: å¯ä»¥ä¿®æ”¹DOM
```



```
    shouldComponentUpdate(nextProps, nextState) { // ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ˜¯å¦æ¸²æŸ“ç»„ä»¶ï¼Œfalseåˆ™ä¸å˜
        if(this.props.filter === nextProps.filter){
            return false
        }
        return true
    }
```



### 3.é”€æ¯é˜¶æ®µ

```
componentWillUnmount: åœ¨åˆ é™¤ç»„ä»¶ä¹‹å‰è¿›è¡Œæ¸…ç†æ“ä½œï¼Œæ¯”å¦‚è®¡æ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨
```

### 4.è€ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜

(1)componentWillMount,åœ¨ssrä¸­ è¿™ä¸ªæ–¹æ³•å°†ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ‰€ä»¥ä¼šé‡å¤è§¦å‘å¤šéï¼ŒåŒæ—¶åœ¨è¿™é‡Œå¦‚æœç»‘å®šäº‹ä»¶å°†æ— æ³•è§£ç»‘ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œ å˜å¾—ä¸å¤Ÿå®‰å…¨é«˜æ•ˆé€æ­¥åºŸå¼ƒã€‚

(2) componentWilReceiveProps å¤–éƒ¨ç»„ä»¶å¤šæ¬¡é¢‘ç¹æ›´æ–°ä¼ å…¥å¤šæ¬¡ä¸åŒçš„ propsï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„å¼‚æ­¥è¯·æ±‚

(3)componetWilupdate,æ›´æ–°å‰è®°å½• DOM çŠ¶æ€ï¼Œå¯èƒ½ä¼šåšä¸€äº›å¤„ç†ï¼Œä¸componentDidUpdateç›¸éš”æ—¶é—´å¦‚æœé•¿ï¼Œä¼šå¯¼è‡´ çŠ¶æ€ä¸å¤ªä¿¡

### 5.æ–°ç”Ÿå‘½å‘¨æœŸçš„æ›¿ä»£

(1) getDerivedStateFromProps ç¬¬ä¸€æ¬¡çš„åˆå§‹åŒ–ç»„ä»¶ä»¥åŠåç»­çš„æ›´æ–°è¿‡ç¨‹ä¸­(åŒ…æ‹¬è‡ªèº«çŠ¶æ€æ›´æ–°ä»¥åŠçˆ¶ä¼ å­)è¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ–°çš„stateï¼Œè¿”å›nullåˆ™è¯´æ˜ä¸éœ€è¦åœ¨è¿™é‡Œæ›´æ–°state

```
//è€çš„ç”Ÿå‘½å‘¨æœŸçš„å†™æ³• 
componentDidMount() {
    if (this.props.value !== undefined) {
        this.setState({
            current: this.props.value
        })
    }
}
componentWillReceiveProps(nextProps){
    if (nextProps.value !== undefined) {
        this.setState({
            current: nextProps.value
        })
    }
}

// æ–°çš„ç”Ÿå‘½å‘¨æœŸå†™æ³•
static getDerivedStateFromProps(nextProps, prevState) {
    const {type} = nextProps;
    // å½“ä¼ å…¥çš„typeå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ›´æ–°state
    if (type !== prevState.type) {
        return {
            type,
        };
    }
    // å¦åˆ™ï¼Œå¯¹äºstateä¸è¿›è¡Œä»»ä½•æ“ä½œ
    return null;
}
å¤åˆ¶ä»£ç 
```

 (2) 

getSnapshotBeforeUpdate å–ä»£äº† componetWillUpdate ,è§¦å‘æ—¶é—´ä¸ºupdateå‘ç”Ÿçš„æ—¶å€™ï¼Œåœ¨renderä¹‹å

domæ¸²æŸ“ä¹‹å‰è¿”å›ä¸€ä¸ªå€¼ï¼Œä½œä¸ºcomponentDidUpdateçš„ç¬¬ä¸‰ä¸ªå‚æ•°

```
//æ–°çš„æ•°æ®ä¸æ–­æ’å…¥æ•°æ®å‰é¢ï¼Œ  å¯¼è‡´æˆ‘æ­£åœ¨çœ‹çš„æ•°æ®å‘ä¸‹èµ°ï¼Œå¦‚ä½•ä¿æŒå¯è§†åŒºä¾æ—§æ˜¯æˆ‘ä¹‹å‰çœ‹çš„æ•°æ®å‘¢ï¼Ÿ
getSnapshotBeforeUpdate(){
    return this.refs.wrapper.scrollHeight
}


componentDidUpdate(prevProps, prevState, preHeight) {
    //if(preHeight===200)return ;
    this.refs.wrapper.scrollTop += this.refs.wrapper.scrollHeight - preHeight
}


<div style={{ height: "200px", overflow: "auto" }}} ref="wrapper">
    <ul>
        .........
    </ul>
</div>
```

### 6.reactä¸­æ€§èƒ½ä¼˜åŒ–çš„æ–¹æ¡ˆ

#### ç¬¬ä¸€ç§ï¼šæ‰‹åŠ¨ä¼˜åŒ– shouldComponentUpdate

```
    // scu æ€§èƒ½ä¼˜åŒ–å‡½æ•°
    
    shouldComponentUpdate(nextProps,nextState){
        // return true; //åº”è¯¥æ›´æ–°
        //return false;; //é˜»æ­¢æ›´æ–°
        // this.state  è€çš„çŠ¶æ€
        // nextState   æ–°çš„çŠ¶æ€
        if(JSON.stringify(this.state)!== JSON.stringify(nextState)){
            return true
        }

        return false
    }
```

#### ç¬¬äºŒç§ï¼šPureComponent

PureComponentä¼šå¸®ä½  æ¯”è¾ƒæ–°props è·Ÿæ—§çš„propsï¼Œ æ–°çš„stateå’Œè€çš„stateï¼ˆå€¼ç›¸ç­‰,æˆ–è€…å¯¹è±¡å«æœ‰ç›¸åŒçš„å±æ€§ã€ä¸”å±æ€§å€¼ç›¸ç­‰ ï¼‰ï¼Œå†³å®šshouldcomponentUpdate è¿”å›true æˆ–è€…falseï¼Œ ä»è€Œå†³å®šè¦ä¸è¦å‘¼å« render function ã€‚

ä½¿ç”¨æ–¹æ³•ï¼š

å°†

```
export default class App extends Component {...
```

ä¿®æ”¹ä¸º

```
export default class App extends PureComponent {...
```



æ¡ˆä¾‹æ¼”ç¤ºï¼š

```react
import React, { PureComponent,Component } from 'react'

export default class App extends PureComponent { <----é‡ç‚¹
    state  = {
        myname:"kerwin"
    }
    render() {
        console.log("render")
        return (
            <div>
                <button onClick={()=>{
                    this.setState({
                        myname:"xiaoming"
                    })
                }}>click</button>

                {this.state.myname}
            </div>
        )
    }
}
```

#### æ€»ç»“

ç¬¬ä¸€ç§ï¼Œå½“å­ç»„ä»¶è¾ƒå¤šæ—¶ï¼Œéœ€è¦ä¸€ä¸ªä¸ªå•ç‹¬å»è®¾ç½®ã€‚

ç¬¬äºŒç§ï¼šé™å®šä½¿ç”¨åœºæ™¯ï¼Œå½“å­ç»„ä»¶ä¾‹å¦‚æ˜¯ä¸€ä¸ªè®¡æ•°å™¨è¿™ç§ä¸€ç›´åœ¨ä¿®æ”¹çš„ç»„ä»¶ï¼Œé‚£ä¹ˆæ˜¯æ²¡æœ‰å¿…è¦ä½¿ç”¨PureComponentçš„ï¼Œå› ä¸ºæ¯”è¾ƒè¿™ä¸ªè¿‡ç¨‹ï¼Œä¹Ÿæ˜¯éœ€è¦æ—¶é—´çš„ã€‚è¿™ä¸€ç‚¹æ˜¯è¦æ³¨æ„çš„ï¼Œä¸è¦ä¸ºäº†ä½¿ç”¨è€Œæ˜¯ç”¨ã€‚







## ä¹ React Hooks

### 1 ç”¨hooksç†ç”±

1. é«˜é˜¶ç»„ä»¶ä¸ºäº†å¤ç”¨ï¼Œå¯¼è‡´ä»£ç å±‚çº§å¤æ‚

2. ç”Ÿå‘½å‘¨æœŸçš„å¤æ‚
3. å†™æˆfunctionalç»„ä»¶,æ— çŠ¶æ€ç»„ä»¶ ï¼Œå› ä¸ºéœ€è¦çŠ¶æ€ï¼Œåˆæ”¹æˆäº†class,æˆæœ¬é«˜

### 2. useState(ä¿å­˜ç»„ä»¶çŠ¶æ€)

```
const [list,setList] = useState(["aa","bb","cc"])
ç»“æ„å‡ºlistå˜é‡ï¼Œ å’Œä¿®æ”¹listçš„å”¯ä¸€æŒ‡å®šæ–¹æ³•setList

æ¡ˆä¾‹: ç‚¹å‡»æŒ‰é’®num+1; åœ¨å®é™…é¡µé¢æ•ˆæœä¸­ï¼Œç”±äºæ¯æ¬¡åˆ·æ–°ï¼Œnuméƒ½ä¼šå›åˆ°åˆå§‹å€¼ï¼Œæ— æ³•è¾¾åˆ°ç›®çš„ã€‚
import React,{useState,useRef} from 'react'
export default function App() {
    var num = 20;
    const [list,setList] = useState(["aa","bb","cc"])
    
```

### 3. useEffect(å¤„ç†å‰¯ä½œç”¨)å’ŒuseLayoutEffect (åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨)

Function Component ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ä¸è¦æŠŠ Class Component çš„ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µæ¬è¿‡æ¥è¯•å›¾å¯¹å·å…¥åº§ã€‚

```
useEffect(() => {
           //effect æ¸²æŸ“é¡µé¢åæ‰§è¡Œ
return () => {
         //cleanup  é”€æ¯æ—¶æ‰§è¡Œ
};
}, [ä¾èµ–çš„çŠ¶æ€;ç©ºæ•°ç»„,è¡¨ç¤ºä¸ä¾èµ–])
```

ä¸è¦å¯¹ Dependencies æ’’è°, å¦‚æœä½ æ˜æ˜ä½¿ç”¨äº†æŸä¸ªå˜é‡ï¼Œå´æ²¡æœ‰ç”³æ˜åœ¨ä¾èµ–ä¸­ï¼Œä½ ç­‰äºå‘ React æ’’äº†è°ï¼Œåæœ
å°±æ˜¯ï¼Œå½“ä¾èµ–çš„å˜é‡æ”¹å˜æ—¶ï¼ŒuseEffect ä¹Ÿä¸ä¼šå†æ¬¡æ‰§è¡Œ, eslintä¼šæŠ¥è­¦å‘Š

```
let id = props.match.params.myid useEffect(()=>{
axios.get(`/articles/${id}`).then(res => { settitle(res.data.title) setcontent(res.data.content) setcategory(res.data.category)
})
},[id])
```

**useEï¬€ect**å’Œ **useLayoutEï¬€ect**  æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨æ—¶æœºä¸åŒï¼Œ**
useLayoutEffect **å’ŒåŸæ¥** componentDidMount **&** componentDidUpdate **ä¸€è‡´ï¼Œåœ¨ reactå®ŒæˆDOMæ›´æ–°åé©¬ä¸Š**åŒæ­¥**è°ƒç”¨çš„ä»£ç ï¼Œä¼šé˜»å¡é¡µé¢æ¸²æŸ“ã€‚è€Œ**
useEffect **æ˜¯ä¼šåœ¨æ•´ä¸ªé¡µé¢æ¸²æŸ“å®Œæ‰ä¼šè°ƒç”¨çš„ä»£ç **



### 4. useRefï¼ˆæ˜¯hooksä¸€ç§ï¼Œä¸€èˆ¬åœ¨**å‡½æ•°ç»„ä»¶ä½¿ç”¨**ï¼‰

ä½œç”¨æ˜¯ï¼šè®°ä½çŠ¶æ€

```
export default function App() {
    const mytext = useRef() // React.createRef()
    
    const handleAdd = ()=>{
        console.log(mytext.current.value) // è·å–å€¼
    }
 
  return (<div>
            <input ref={mytext}/> 
               <button onClick={handleAdd}>add</button>
```

å®˜æ–¹å»ºè®®ä¼˜å…ˆä½¿ç”¨useEffect

åœ¨å®é™…ä½¿ç”¨æ—¶å¦‚æœæƒ³é¿å…**é¡µé¢æŠ–åŠ¨**ï¼ˆåœ¨useEffect é‡Œä¿®æ”¹DOMå¾ˆæœ‰å¯èƒ½å‡ºç°ï¼‰çš„è¯ï¼Œå¯ä»¥æŠŠéœ€è¦æ“ä½œDOMçš„ä»£ç æ”¾åœ¨useLayoutEffect é‡Œã€‚åœ¨è¿™é‡Œåšç‚¹domæ“ä½œï¼Œè¿™äº›domä¿®æ”¹ä¼šå’Œ
react åšå‡ºçš„æ›´æ”¹ä¸€èµ·è¢«ä¸€æ¬¡æ€§æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œåªæœ‰ä¸€æ¬¡å›æµã€é‡ç»˜çš„ä»£ä»·

### **5. useCallback(**è®°å¿†å‡½æ•°**)**

é˜²æ­¢å› ä¸ºç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´æ–¹æ³•è¢«é‡æ–°åˆ›å»º ï¼Œèµ·åˆ°ç¼“å­˜ä½œç”¨*;* åªæœ‰ç¬¬äºŒä¸ªå‚æ•° å˜åŒ–äº†ï¼Œæ‰é‡æ–°å£°æ˜ä¸€æ¬¡ã€‚

```react
var handleClick = useCallback(()=>{ console.log(name)
},[name])
<button onClick={()=>handleClick()}>hello</button>

//åªæœ‰nameæ”¹å˜åï¼Œ  è¿™ä¸ªå‡½æ•°æ‰ä¼šé‡æ–°å£°æ˜ä¸€æ¬¡ï¼Œ
//å¦‚æœä¼ å…¥ç©ºæ•°ç»„ï¼Œ  é‚£ä¹ˆå°±æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºåå°±è¢«ç¼“å­˜ï¼Œ  å¦‚æœnameåæœŸæ”¹å˜äº†,æ‹¿åˆ°çš„è¿˜æ˜¯è€çš„nameã€‚
//å¦‚æœä¸ä¼ ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°å£°æ˜ä¸€æ¬¡ï¼Œæ‹¿åˆ°çš„å°±æ˜¯æœ€æ–°çš„name.

```

**useMemo** **è®°å¿†ç»„ä»¶**

useCallback çš„åŠŸèƒ½å®Œå…¨å¯ä»¥ç”± useMemo æ‰€å–ä»£ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ä½¿ç”¨ useMemo è¿”å›ä¸€ä¸ªè®°å¿†å‡½æ•°ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„

```react
useCallback(fn, inputs) is equivalent to useMemo(() => fn, inputs).
```

å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼š**useCallback** **ä¸ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œè€Œæ˜¯å°†å®ƒè¿”å›ç»™ä½ ï¼Œè€Œ** **useMemo** **ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°å¹¶****ä¸”å°†å‡½æ•°æ‰§è¡Œç»“æœè¿”å›ç»™ä½ ã€‚**æ‰€ä»¥åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥è¿”å› handleClick æ¥è¾¾åˆ°å­˜å‚¨å‡½æ•°çš„ç›®çš„ã€‚

æ‰€ä»¥ useCallback å¸¸ç”¨è®°å¿†äº‹ä»¶å‡½æ•°ï¼Œç”Ÿæˆè®°å¿†åçš„äº‹ä»¶å‡½æ•°å¹¶ä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨ã€‚è€Œ useMemo æ›´é€‚åˆç»è¿‡å‡½æ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œæ¯”å¦‚è®°å¿†ç»„ä»¶ã€‚(ç±»ä¼¼ä¸vueçš„è®¡ç®—å±æ€§)

### **6. useRef(**ä¿å­˜å¼•ç”¨å€¼**)**

```react
const myswiper = useRef(null);
<Swiper ref={myswiper}/>
```

ref å†™åœ¨domä¸Šæ˜¯valueå€¼ï¼Œå†™åœ¨ç»„ä»¶ä¸Šï¼Œæ˜¯ç»„ä»¶å¯¹è±¡ã€‚



### 7. useContextï¼ˆå‡å°‘ç»„ä»¶å±‚çº§ï¼‰

å¯¹classç±»ç»„ä»¶ä¸­ä½¿ç”¨contextæ–¹æ³•ï¼Œ

åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­çš„ç®€åŒ–å†™æ³•ã€‚ æä¾›ç«¯æ²¡æœ‰ç®€åŒ–ï¼Œæ¥å—ç«¯è¾ƒå¤§ç®€åŒ–ã€‚

```react
import React, { useState,useEffect,useContext } from 'react'
import axios from 'axios'
import './css/index.css'

const GlobalContext  = React.createContext() //åˆ›å»ºcontextå¯¹è±¡

export default function App (){
    const [filmList, setfilmList] = useState([])
    const [info, setinfo] = useState("")

    useEffect(() => {
        axios.get(`/test.json`).then(res=>{
            // console.log(res.data.data.films)
            setfilmList(res.data.data.films)
        })
    }, []);

    return (
        <GlobalContext.Provider value={{
            call:"æ‰“ç”µè¯",
            sms:"çŸ­ä¿¡",
            info:info,
            changeInfo:(value)=>{
                setinfo(value)
            }
        }}>
            <div>
                {/* {this.state.info} */}
                {
                    filmList.map(item=>
                        <FilmItem key={item.filmId} {...item} ></FilmItem>    
                    )
                }


                <FilmDetail ></FilmDetail>
            </div>
        </GlobalContext.Provider>
    )
}

/*å—æ§ç»„ä»¶*/

function FilmItem(props){
    let {name, poster,grade,synopsis}  = props
    const value = useContext(GlobalContext)

    console.log(value)// çˆ¶ç»„ä»¶GlobalContext.Provider æä¾›çš„å€¼ï¼šcall:"æ‰“ç”µè¯",
    return <div className="filmitem" onClick={()=>{
                console.log(synopsis)

                value.changeInfo(synopsis)
            }}>
                <img src={poster} alt={name}/>
                <h4>{name}</h4>
                <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
            </div> 
}



function FilmDetail(){
    const value = useContext(GlobalContext)
    return <div className="filmdetail">
        detail-{value.info}
    </div>
}
```

### 8.useReducer çš„ä½¿ç”¨

åŠŸèƒ½ï¼šHooksæä¾›çš„ä¸€ç§ï¼Œå°†ç»„ä»¶çŠ¶æ€æåˆ°å¤–é¢çš„æ–¹æ³•ã€‚

æ¡ˆä¾‹ï¼š å¯¹countæ•°å­—ï¼Œ +  -- æ“ä½œã€‚

```react
import React,{useReducer} from 'react'
 //å¤„ç†å‡½æ•°
 const reducer = (prevState,action)=>{
    //  console.log("reduercer",prevState,action)
     let newstate = {...prevState}
     switch(action.type){
         case "kerwin-minus":
            newstate.count--
            return newstate

         case "kerwin-add":
            newstate.count++
            return newstate
        
         default:
            return prevState
     }
 }
 // å¤–éƒ¨çš„å¯¹è±¡
 const intialState = {
     count:0,
    //  list:[]
 } 

 export default function App() {
     const [state, dispatch] = useReducer(reducer,intialState)
        console.log(state, dispatch)
     return (
         <div>
             <button onClick={()=>{
                 dispatch({
                     type:"kerwin-minus"
                 })
             }}>-</button>
             {state.count}
             <button onClick={()=>{
                 dispatch({
                    type:"kerwin-add"
                })
             }}>+</button>
         </div>
     )
 }
```

### 9.useReducer + useContexté…åˆä½¿ç”¨ï¼ˆå‡å°‘ç»„ä»¶å±‚çº§ï¼‰

  Hooksæä¾›ç±»ä¼¼reduxæ•°æ®ä»“åº“ç†å¿µçš„å·¥å…·æ–¹æ³•ã€‚

æ¡ˆä¾‹ï¼šappçˆ¶ç»„ä»¶ï¼Œ ä¼ å€¼ç»™ä¸‰ä¸ªå­ç»„ä»¶ï¼Œå…±äº«æ•°æ®å’Œæ–¹æ³•ã€‚child1ç»„ä»¶ï¼Œç‚¹å‡»ï¼Œchild2 child3è§†å›¾å˜åŒ–ã€‚

```react
import React,{useReducer,useContext} from 'react'

const initailState = {
    a:"11111",
    b:"11111"
}

const reducer = (prevState,action)=>{
    let newstate = {...prevState}
    switch(action.type){
        case "change-a":
            newstate.a = action.value
            return newstate
        case "change-b":
            newstate.b = action.value
            return newstate
        default:
            return prevState
    }
    // return prevState
}

const GlobalContext = React.createContext()
export default function App() {
    const [state, dispatch] = useReducer(reducer, initailState)
    
    return (
        <GlobalContext.Provider value={
            {
                state,
                dispatch
            }
        }>
            <div>
                <Child1/>
                <Child2/>
                <Child3/>
            </div>
        </GlobalContext.Provider>
    )
}

function Child1(){
    const {dispatch} = useContext(GlobalContext)
    return <div style={{background:"red"}}>
        <button onClick={()=>{
            dispatch({
                type:"change-a",
                value:"2222222"
            })
        }}>æ”¹å˜a</button>
        <button onClick={()=>{
            dispatch({
                type:"change-b",
                value:"333333"
            })
        }}>æ”¹å˜b</button>
    </div>
}

function Child2(){
    const {state} = useContext(GlobalContext)
    return <div style={{background:"yellow"}}>
        child2-{state.a}
    </div>
}

function Child3(){
    const {state} = useContext(GlobalContext)
    return <div style={{background:"gray"}}>
        child3-{state.b}
    </div>
}
```



### 10 è‡ªå®šä¹‰hooks

åŠŸèƒ½ï¼š é¡µé¢é€»è¾‘æ›´æ¸…æ™°ï¼Œæ›´å¥½é˜…è¯»ï¼Œä½“ç°å‡½æ•°å¼å˜æˆæ€æƒ³ã€‚

å®ç°ï¼š Hooksæä¾›ä¸€ç§æ–¹æ³•ã€‚ å…è®¸ä½ å°†ä¸€ä¸ªå¤§æ–¹æ³•ï¼ŒæŒ‰ä¸€å®šé€»è¾‘ï¼ŒæŠ½ç¦»å‡ºæ¥å†™æˆä¸€ä¸ªuse-å¼€å¤´çš„å°æ–¹æ³•ï¼Œä¸ç”¨æ‹…å¿ƒå¼‚æ­¥é—®é¢˜ã€‚æ¯æ¬¡ä¿®æ”¹ï¼Œä»£ç éƒ½ä¼šé‡æ–°ç»™å‡ºæ–°å€¼ã€‚

æ¡ˆä¾‹å¦‚ä¸‹ï¼›

```
import React, { useState,useEffect,useMemo } from 'react'
import axios from 'axios'

**1 è·å–listæ•°æ®æ–¹æ³•
function useCinemaList(){
    const [cinemaList, setcinemaList] = useState([])


    useEffect(() => {
        axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                
                'X-Host': 'mall.film-ticket.cinema.list'

            }
        }).then(res=>{
            setcinemaList(res.data.data.cinemas)
        })
    }, [])

    return {
        cinemaList
    }
}
 **2è·å–ç­›é€‰åçš„æ•°æ®æ–¹æ³•
function useFilter(cinemaList,mytext){
    const getCinemaList = useMemo(() => cinemaList.filter(item=>item.name.toUpperCase().includes(mytext.toUpperCase()) || 
    item.address.toUpperCase().includes(mytext.toUpperCase())
    ), [cinemaList,mytext])

    return {
        getCinemaList
    }
}

export default function Cinema(){
    const [mytext, setmytext] = useState("")
    
    const {cinemaList}  = useCinemaList()

    const {getCinemaList} = useFilter(cinemaList,mytext)

    return <div>
            {/* {this.state.mytext} */}
                <input value={mytext} onChange={(evt)=>{
                    setmytext(evt.target.value)
                }}/>
                {
                    getCinemaList.map(item=>
                        <dl key={item.cinemaId}>
                            <dt>{item.name}</dt>
                            <dd>{item.address}</dd>
                        </dl>    
                    )
                }
        </div>
}
```







### å°ç»“è§£ç–‘ï¼š

Q:  [reactä¸­useRefä¸createRefçš„åŒºåˆ«](https://www.cnblogs.com/-roc/p/16943895.html)

A:   useRef()                   React.createRef()

useRef ï¼ˆæ˜¯hooksä¸€ç§ï¼Œä¸€èˆ¬åœ¨**å‡½æ•°ç»„ä»¶ä½¿ç”¨**ï¼‰

1.1.è·å–å½“å‰domæ•°æ®ï¼ˆä¸æ¨èï¼Œæ¨èä½¿ç”¨å—æ§ç»„ä»¶-å³ä½¿ç”¨useStateç»‘å®šè¡¨å•å…ƒç´ ï¼‰

1.2ã€ä½œä¸ºå­˜å‚¨ä½¿ç”¨

createRefï¼ˆä¸€èˆ¬ç”¨äºclassç»„ä»¶ï¼Œè·å–å­ç»„ä»¶domï¼‰

1ã€createRefåˆ›å»ºçš„refå¯¹è±¡ï¼Œç»„ä»¶æ¯æ›´æ–°ä¸€æ¬¡ï¼Œrefå¯¹è±¡å°±ä¼šè¢«é‡æ–°åˆ›å»ºã€‚

åŒºåˆ«

1.    useRefåªä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶åˆ›å»º

2.  createRefä¼šåœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™é‡æ–°åˆ›å»º

   

   

## å Reactè·¯ç”±

### **1.**  ä»€ä¹ˆæ˜¯è·¯ç”±ï¼Ÿ

è·¯ç”±æ˜¯æ ¹æ®ä¸åŒçš„ url åœ°å€å±•ç¤ºä¸åŒçš„å†…å®¹æˆ–é¡µé¢ã€‚

ä¸€ä¸ªé’ˆå¯¹Reactè€Œè®¾è®¡çš„è·¯ç”±è§£å†³æ–¹æ¡ˆã€å¯ä»¥å‹å¥½çš„å¸®ä½ è§£å†³React components åˆ°URlä¹‹é—´çš„åŒæ­¥æ˜ å°„å…³ç³»

### 2.è·¯ç”±å®‰è£…

https://reacttraining.com/react-router/web/guides/quick-start

```
npm install react-router-dom@5

"react-router-dom": "^5.3.4",
```

### 3. è·¯ç”±ä½¿ç”¨

####  (1)è·¯ç”±æ–¹æ³•å¯¼å…¥

```
import React from "react";
import {
         BrowserRouter as Router, Switch, Route, Link
     } from "react-router-dom";
```

#### (2)å®šä¹‰è·¯ç”±ä»¥åŠé‡å®šå‘ æ¡ˆä¾‹hashæ¨¡å¼

  è·¯ç”±åŸºæœ¬ä½¿ç”¨

```react
<HashRouter>
  <Route path="/films" component={Films}/>
    <Route path="/cinemas" component={Cinemas}/>
</HashRouter>
å½“æµè§ˆå™¨http://localhost:3000/#/filmsæ—¶ï¼Œå±•ç¤ºå¯¹åº”ç»„ä»¶ã€‚æ’ä»¶çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯åŒ¹é…åŠŸèƒ½ã€‚
```

åŠ åŠŸèƒ½1ï¼š

å½“ç”¨æˆ·è¾“å…¥çš„è·¯å¾„ï¼Œæ²¡æœ‰å¯¹åº”é¡µé¢æ—¶ï¼Œè·³åˆ°homeé¡µå»ã€‚

```react
<HashRouter>
  <Switch>
         <Route path="/films" component={Films}/>
         <Route path="/cinemas" component={Cinemas}/>
      
       <Redirect from="/" to="/home" />   //from="/"  æ¨¡ç³ŠåŒ¹é…
   </Switch>
</HashRouter>
SwitchåµŒå¥—è·¯ç”±ï¼Œé…åˆé‡å®šä½æ ‡ç­¾ã€‚å®ç°ï¼š æµè§ˆå™¨è¾“å…¥åœ°å€åï¼Œè‡ªä¸Šè€Œä¸‹åŒ¹é…ï¼Œåªè¦åŒ¹é…åˆ°å°±è·³å‡ºã€‚æ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±é‡å®šä½åˆ°homeå»ã€‚

```

åŠ åŠŸèƒ½2ï¼š

å½“è¿›å…¥/ æ ¹è·¯ç”±ï¼Œå°±è¿›å…¥homeå»ï¼Œ å¦‚æœæ˜¯ /abc  ç­‰ä¹±è¾“å…¥çš„è·¯å¾„ï¼Œå°±è·³å…¥åˆ°NotFound æœªæ‰¾åˆ°é¡µé¢ã€‚

```react
<HashRouter>
    <Switch>
        <Route path="/films" component={Films}/>
        <Route path="/cinemas" component={Cinemas}/>
        <Route path="/center" component={Center}/>
        
        <Redirect from="/" to="/home" exact/>    
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
Redirecté‡å®šå‘æ ‡ç­¾ï¼ŒåŠ exactç²¾å‡†å±æ€§ï¼Œåªæœ‰/ï¼Œæ‰è¿›å…¥home,å…¶ä»–æƒ…å†µï¼Œä¸‡èƒ½åŒ¹é…ï¼Œè¿›å…¥NotFoundé¡µé¢ã€‚
```



è§£æï¼š

exact ç²¾ç¡®åŒ¹é… (Redirect å³ä½¿ä½¿ç”¨äº†exact, å¤–é¢è¿˜è¦åµŒå¥—Switch æ¥ç”¨)ï¼›

Warning: Hash history cannot
PUSH the same path; a new entry will not be added to the history
stack,è¿™ä¸ªè­¦å‘Šåªæœ‰åœ¨hash æ¨¡å¼ä¼šå‡ºç°ã€‚

#### (3)åµŒå¥—è·¯ç”±

é¡µé¢æ•ˆæœï¼š

çˆ¶é¡µé¢ä¸­æ˜¾ç¤ºè½®æ’­å›¾å’Œä¸¤ä¸ªæŒ‰é’®  åˆ†åˆ«æ˜¾ç¤ºä¸åŒçš„å­é¡µé¢ã€‚

ä»£ç é…ç½®ï¼š

router.js  æ ¹è·¯ç”±

```
<HashRouter>
    <Switch>
        <Route path="/films" component={Films}/>   //ä¸è¦åŠ  exact å¦åˆ™å­é¡µé¢ä¸æ˜¾ç¤º
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

filmsç»„ä»¶

```
import React, { Component } from 'react'
import Nowplaying from './films/Nowplaying'
import Comingsoon from './films/Comingsoon'
import {Redirect, Route, Switch} from 'react-router-dom'
export default class Films extends Component {
    render() {
        return (
            <div>
                <div style={{height:"200px",background:"yellow"}}>å¤§è½®æ’­</div>

                <div>å¯¼èˆªæ   æŒ‰é’®1  æŒ‰é’®2</div>

                {/* è·¯ç”±é…ç½® åµŒå¥—è·¯ç”± */}
                <Switch>
                    <Route path="/films/nowplaying" component={Nowplaying}/>
                    <Route path="/films/comingsoon" component={Comingsoon}/>
                    <Redirect from="/films" to="/films/nowplaying"/> 
                </Switch>

            </div>
        )
    }
}

```

#### (4)è·¯ç”±è·³è½¬æ–¹å¼

æŒ‰ç…§æ˜¯å¦ä»¥æ ‡ç­¾ä¾‹å¦‚<a href='#/films'/>,è¿˜æ˜¯jsè·³è½¬é¡µé¢ï¼Œåˆ†ç±»å¦‚ä¸‹ï¼š

##### a.   å£°æ˜å¼å¯¼èˆª

activeClassName å½“å‰æ˜¾ç¤ºé¡µé¢ï¼Œè‡ªåŠ¨åŠ classã€‚é…åˆcss å¯ä»¥é«˜äº®æ˜¾ç¤ºtabã€‚

æ¡ˆä¾‹é‚£ä¸ªé«˜äº®ï¼ŒåŠ  active.

classç±»åï¼Œä»¥å¯¹è±¡æ–¹å¼ä½¿ç”¨ã€‚å› ä¸ºç±»åä¼šè‡ªåŠ¨ç¼–è¯‘å˜åŒ–ã€‚

```
<NavLink to="/films" activeClassName="active">films</NavLink>   //react æµè§ˆå™¨ä¸­ä¼šç¼–è¯‘æˆaæ ‡ç­¾
<NavLink to="/cinemas" activeClassName="active">cinemas</NavLink>
<NavLink to="/center" activeClassName="active">center</NavLink>
```

##### b   ç¼–ç¨‹å¼å¯¼èˆª

æ¡ˆä¾‹

###### router.js  æ ¹è·¯ç”±

```
<HashRouter>
    <Switch>
        <Route path="/films" component={Films}/>   
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

###### filmsç»„ä»¶

```
import React, { Component } from 'react'
import Nowplaying from './films/Nowplaying'
import Comingsoon from './films/Comingsoon'
import {Redirect, Route, Switch} from 'react-router-dom'
export default class Films extends Component {
    render() {
        return (
            <div>
                <div style={{height:"200px",background:"yellow"}}>å¤§è½®æ’­</div>

                <div>å¯¼èˆªæ </div>

                {/* è·¯ç”±é…ç½® åµŒå¥—è·¯ç”± */}
            {/* <Nowplaying/> */}
                <Switch>
                    <Route path="/films/nowplaying" component={Nowplaying}/>
                    <Route path="/films/comingsoon" component={Comingsoon}/>
                    <Redirect from="/films" to="/films/nowplaying"/> 
                </Switch>

            </div>
        )
    }
}
```



###### Nowplayingç»„ä»¶

å½“é¡¹ç›®å¼•å…¥è·¯ç”±ç®¡ç†ï¼Œç»„ä»¶éƒ½ä¼ å…¥routerï¼Œè¿™æ—¶å€™ç»„ä»¶éƒ½æˆä¸ºrouterçš„å­©å­ï¼Œä¸ç®¡æ˜¯ä¸€çº§è·¯ç”±ï¼Œè¿˜æ˜¯é¡µé¢ä¸­åµŒå…¥çš„äºŒçº§è·¯ç”±ï¼Œç»„ä»¶éƒ½å¯ä»¥æ¥å—åˆ°ä¸€ä¸ªpropså‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯è·¯ç”±å¯¹è±¡ã€‚

```javascript
å¯¹è±¡ä¸­åŒ…å«äº†å’Œè·¯ç”±ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•ã€‚
{
  history,(æœ‰è·¯ç”±ç›¸å…³æ–¹æ³•ï¼š push go goBack goForward replace locationç­‰)
  location  
  match  
}
```

propså‚æ•°  æ ¹æ®æ¥æºåˆ†ä¸ºä¸¤ç§ï¼š

ç¬¬ä¸€ç§ï¼šå½¢å‚ä¼ å…¥  æœ‰ä»¥ä¸Šä¸‰ä¸ªå¯¹è±¡

ç¬¬äºŒç§ï¼šä½¿ç”¨routerå¯¹è±¡

```
import { useHistory } from 'react-router-dom'
 const history  = useHistory()
 conosole.log(history)
 è¿™ä¸ªé‡Œé¢åªæœ‰ historyä¸€ä¸ªï¼› èŒƒå›´å°ä¸€äº›ã€‚
```

Nowplayingç»„ä»¶

```
import React,{useState} from 'react'
import { useHistory } from 'react-router-dom'

export default function Nowplaying( props ) {
    const [list, setlist] = useState(["aa","bb","cc"])
    
      const history  = useHistory()
        
    const handleChangePage = (id)=>{
        // console.log("click")
        //  1.åŸç”Ÿjsè·³è½¬
        // window.location.href="#/detail/"+id

        2.ä½¿ç”¨å…¥å‚çš„props
        // props.history.push(`/detail/${id}`)   //å‡½æ•°å¼å†™æ³•ï¼ˆï¼‰
        // this.props.history.push(`/detail/${id}`) // ç±»ç»„ä»¶å¼å†™æ³•
        
  ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ useHistory æ–¹æ³•æ¥è‡ª routeræ’ä»¶æä¾›
        //1 -åŠ¨æ€è·¯ç”±ä¼ å‚
        // history.push(`/detail/${id}`)
    
        // 2- queryä¼ å‚
        // history.push({ pathname : '/detail' ,query : { myid: id} })

        // 3- stateä¼ å‚
        // history.push({pathname:"/detail",state:{myid:id}})
    }

    return (
        <div>
            {
                list.map(item=> <li onClick={()=>handleChangePage(item)}>{item}</li>)
            }
        </div>
    )
}
```

#### (5) è·¯ç”±ä¼ å‚

##### å£°æ˜å¼ä¼ å‚

ç‰¹å¾å’Œä¼˜ç¼ºç‚¹ï¼š

 å‚æ•°ä¿å­˜ä½ç½®ï¼Œ urlè·¯å¾„ä¸­ã€‚    å½“é¡µé¢åˆ·æ–°ï¼Œå‚æ•°ä¸ä¼šä¸¢å¤±ã€‚

router.js  æ ¹è·¯ç”±

```
<HashRouter>
    <Switch>
        {/* /detail/1111  åŠ¨æ€è·¯ç”± */}
         <Route path="/detail/:myid" component={Detail} /> 
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

###### Nowplayingç»„ä»¶   

åˆ—è¡¨ç»„ä»¶  å…¥å‚

```
å¦‚ä¸Šä»£ç å¿«
...
 2.ä½¿ç”¨å…¥å‚çš„props
 // props.history.push(`/detail/${id}`)   //å‡½æ•°å¼å†™æ³•ï¼ˆï¼‰
...
```

detail è¯¦æƒ…ç»„ä»¶ æ¥å‚

å½“å‰è·¯å¾„   http://localhost:3000/#/detail/bb

```
import React from 'react'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")  //bbä¸ºå‚æ•°å€¼  myidä¸ºå½¢å‚
    return (
        <div>
            deteail
        </div>
    )
}
```

##### ç¼–ç¨‹å¼ä¼ å‚    

ç‰¹å¾å’Œä¼˜ç¼ºç‚¹ï¼š

 å‚æ•°ä¿å­˜ä½ç½®ï¼Œ ç¼“å­˜ä¸­ã€‚    å½“é¡µé¢åˆ·æ–°ï¼Œå‚æ•°ä¼šä¸¢å¤±ã€‚

router.js  

æ ¹è·¯ç”±path="/detail" è¿™ç§ä¼ å‚å°±ä¸è¦åŠ å½¢å‚  ï¼šmyidäº†ã€‚

```
<HashRouter>
    <Switch>
         <Route path="/detail" component={Detail} /> 
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

###### 

```
(1)
   å…¥å‚
this.props.history.push({ pathname : '/user' ,query : { day: 'Friday'} }) 
   æ¥å—å‚æ•°
this.props.location.query.day
(2)
    å…¥å‚
this.props.history.push({ pathname:'/user',state:{day : 'Friday' } }) 
  æ¥å—å‚æ•°
this.props.location.state.day
ä»£ç å‚è€ƒï¼ˆ4ï¼‰è·¯ç”±è·³è½¬æ–¹å¼å°ç»“ã€‚
  æµ‹è¯•å‘ç°this.props.history.pushä¼ å…¥çš„å¯¹è±¡ï¼Œ pathnameæ˜¯å¿…é¡»æŒ‰ç…§æ ¼å¼ï¼Œåé¢query stateæˆ–æ˜¯å…¶ä»–å±æ€§ï¼Œéƒ½å¯ä»¥ï¼Œåªè¦åœ¨æ¥å—å‚æ•°å¤„ï¼Œä¸€ä¸€å¯¹åº”å³å¯ã€‚
```

### 4. è·¯ç”±æ‹¦æˆªï¼ˆè·¯ç”±å®ˆå«ï¼‰

react å¹¶æ²¡æœ‰åƒvue router.beforeEachè·¯ç”±å‰ï¼Œè·¯ç”±åç­‰api; æ‰€ä»¥è¿™é‡Œåªæ˜¯ç”¨åŸç”Ÿå‡½æ•°æ–¹æ³•ã€‚

router.js

```
é‰´æƒä»£ç  
function isAuth(){
    return localStorage.getItem("token")
}



<Router>
      <Switch>
          <Route path="/films" component={Films}  />
      <Route path="/center" render={(props)=>{
        return isAuth()?<Center myname="tom"/>:<Redirect to="/login"/>
      }/>                 
```

### 5 è·¯ç”±æ¨¡å¼

##### hashæ¨¡å¼

åƒè¿™ç§å¸¦#å·çš„ï¼Œå«é”šç‚¹ï¼Œè¿™é‡Œç§°hashæ¨¡å¼ã€‚ä¸å‘èµ·è¯·æ±‚ã€‚

å¦‚æœä¸æƒ³çœ‹åˆ°è¿™æ ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¤ä¸€ç§æ¨¡å¼ã€‚

```
http://localhost:3000/#/login

import React, { Component } from 'react'
import { HashRouter as Router,Redirect,Route,Switch} from 'react-router-dom'

export default class IndexRouter extends Component {
    render() {
        return (
            <Router>   æ¨¡å¼æ ‡ç­¾
                <Switch>
                    <Route path="/films" component={Films}  />
```

##### historyæ¨¡å¼

http://localhost:3000/login     åƒä¸€ä¸ªçœŸæ­£çš„è·¯å¾„ã€‚

BrowserRouter æ²¡æœ‰#çš„è·¯å¾„ï¼Œå¥½çœ‹ ï¼ŒçœŸæ­£æœåç«¯å‘è¯·æ±‚è¦é¡µé¢ï¼Œåç«¯æ²¡æœ‰å¯¹åº”çš„è·¯å¾„å¤„ç†è·¯å¾„ï¼Œ å°±ä¼š404ï¼Œ ä¸å¥½çœ‹ã€‚æ‰€ä»¥åå°è¦åšå¤„ç†ï¼Œå› ä¸ºé¡¹ç›®æ˜¯å•é¡µé¢ï¼Œåå°å¹¶æ²¡æœ‰å¯¹åº”èµ„æºï¼Œåªéœ€è¦è¿”å›index.htmlï¼Œå‰å°é‡æ–°æ¸²æŸ“ã€‚

```
import React, { Component } from 'react'
import { BrowserRouter as Router,Redirect,Route,Switch} from 'react-router-dom'
...
 <Router>   æ¨¡å¼æ ‡ç­¾
 æˆ–è€…
 import { BrowserRouter,Redirect,Route,Switch} from 'react-router-dom'
...
 <BrowserRouter>  </BrowserRouter>  æ¨¡å¼æ ‡ç­¾

```

BrowserRouter as Router æ„ä¸ºï¼š BrowserRouter è§£æ„å‡ºæ¥ï¼Œèµ·äº†ä¸€ä¸ªåˆ«åå«Routerã€‚ è¿™æ ·åé¢ä»£ç å°±ä¸ç”¨æ”¹äº†ã€‚æ›´åŠ ä¾¿æ·ã€‚

### 6 ç»„ä»¶ä¸¢çˆ¹historyå’Œå¹²çˆ¹æ”¯æ´ï¼ˆé«˜é˜¶ç»„ä»¶withRouterï¼‰

#### ç¬¬ä¸€ç§æƒ…å†µï¼šrouter ä¼ é€’é¡µé¢ç»„ä»¶ 

##### 

é¦–å…ˆç¡®å®šï¼Œçˆ¶ç»„ä»¶ä¼ å‚ï¼Œå­ç»„ä»¶propsæ¥å—å‚æ•°ã€‚

router.js

```
 <BrowserRouter>
                <Switch>
                    <Route path="/films" component={Films}  />
                    
                     <Route path="/center" render={()=>{
                        return isAuth()?<Center myname="tom"/>:<Redirect to="/login"/>
                    }}/>          
```

å‰é¢è·¯ç”±å®ˆå«æ—¶ï¼Œcenterç»„ä»¶åšäº†å¤„ç†ï¼Œå½“æˆ‘ä»¬åœ¨centerç»„ä»¶ä¸­ï¼Œä½¿ç”¨historyæ–¹æ³•æ—¶ï¼Œé¡µé¢æç¤ºæœªæ‰¾åˆ°æ–¹æ³•ã€‚

centerç»„ä»¶ 

```
export default function Center(props) {
    return (
        <div>
            center

            <div onClick={()=>{
                props.history.push(`/filmsorder`)

                // console.log(props)
            }}>ç”µå½±è®¢å•</div>
        </div>
    )
}
```

å‰é¢æˆ‘ä»¬æåˆ°ï¼Œä½¿ç”¨è·¯ç”±æ—¶ï¼Œè¢«è·¯ç”±æ ‡ç­¾   <Router>   </Router> åŒ…è£¹çš„é¡µé¢ç»„ä»¶ï¼Œéƒ½æ˜¯å­ç»„ä»¶ï¼Œè‡ªç„¶å¯ä»¥æ¥å—propså‚æ•°ï¼ŒåŒ…å«historyç­‰ã€‚

æŸ¥çœ‹routeæ ¸å¿ƒæ–¹æ³•

```
// class Route extends Component{
//     ...

//     render(){
//         var MyComponent = this.props.component
//     return <div>
//             <MyComponent history={} match={}.../>
//         </div>
//     }
// }
```

routeä»¥å˜é‡å½¢å¼ï¼Œæ¥å—ç»„ä»¶ï¼Œä¼ å…¥å‚æ•°ï¼Œå†renderå‡ºå»ã€‚è€Œcenterè¿™æ¡è·¯ç”±ï¼Œç›´æ¥ä½¿ç”¨renderï¼Œå¹¶æ²¡æœ‰ä¼ å‚ï¼Œæµ‹è¯•ä¼ é€’ä¸€ä¸ªè‡ªå®šä¹‰å‚æ•°myname, centerç»„ä»¶ä¸­ï¼Œæ‰“å°propsï¼Œæœç„¶çœ‹åˆ°å‚æ•°tom,è¯å®ç¡®å®æ˜¯routeç»™å‡ºçš„ä¸œè¥¿ï¼Œæ²¡æœ‰ä¼ é€’ä¸‹å»ï¼Œå¯¼è‡´å­ç»„ä»¶historyæ–¹æ³•ç¼ºå¤±ã€‚

```
<Route path="/center" render={()=>{
                        return isAuth()?<Center myname="tom"/>:<Redirect to="/login"/>
                    }}/> 
```

æ”¹è¿›, è§£æ„ï¼Œä¼ å‚ä¸‹å»

```
    <Route path="/center" render={(props)=>{
                        console.log(props,'æ‰§è¡Œäº†')
                        return isAuth()?<Center myname="kerwin" {...props}/>:<Redirect to="/login"/>
                    }}/>
```

#### ç¬¬äºŒç§æƒ…å†µ ç»„ä»¶ä¼ é€’ç»„ä»¶

ä»£ç ä¸­ï¼ŒFilmItemå°ç»„ä»¶ï¼Œ props.history.pushæç¤ºæœªæ‰¾åˆ°ï¼Œæƒ…å†µå’Œç¬¬ä¸€ç§ç›¸ä¼¼ï¼Œéƒ½æ˜¯å‚æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä¸­æ–­ã€‚

```
import React,{useState} from 'react'
export default function Nowplaying(props) {       <----------1è¿™ä¸ªpropså‚æ•°
    const [list, setlist] = useState([1,2,3,4])

    return (
        <div>
            {
                list.map(item=>
                 <FilmItem key={item.filmId} {...item} 	/>     <----------2è¿™é‡Œ {...props}
                )
            }
        </div>
    )
}

function FilmItem(props){
    // console.log(props)  // æ‰“å°æ²¡æœ‰ props.history
    let {name,filmId} = props
    return <li onClick={()=>{
        props.history.push(`/detail/${filmId}`)
    }}>
        {name}
    </li>    
}
```

#### å¹²çˆ¹æ”¯æ´

çˆ¶ç»„ä»¶  ---> å­ç»„ä»¶ ---> å­™ç»„ä»¶ï¼Œ æœ‰ç‚¹éº»çƒ¦ï¼Œæ˜¯å¦æœ‰å…¶ä»–ä¾¿æ·apiï¼Ÿ

routeræä¾›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä½œç”¨æ˜¯ä¸ºæ²¡æœ‰è·¯ç”±å±æ€§å’Œæ–¹æ³•çš„æ™®é€šç»„ä»¶ï¼Œå¢ç›Šæ–¹æ³•ã€‚

```
import {withRouter} from 'react-router-dom'
```

ä½¿ç”¨æ–¹æ³•ï¼š

```
import React,{useState} from 'react'
import {useHistory,withRouter} from 'react-router-dom'

export default function Nowplaying(props) {
    const [list, setlist] = useState([1,2,3,4])

    return (
        <div>
            {
                list.map(item=>
                 <WithFilmItem key={item.filmId} {...item} />
                )
            }
        </div>
    )
}

             è¿™æ˜¯ä¸€ä¸ªæ™®é€šå­™ç»„ä»¶           
function FilmItem(props){
    // console.log(props)
    let {name,filmId} = props
    return <li onClick={()=>{
        props.history.push(`/detail/${filmId}`)
    }}>
        {name}
    </li>    
}


const WithFilmItem = withRouter(FilmItem)  <----- withRouteræ–¹æ³•ï¼ŒåŒ…è£¹æ™®é€šç»„ä»¶ï¼Œåå‡ºæ¥å¢ç›Šç»„ä»¶ã€‚è¿™æ ·ï¼ŒFilmItemä¸­çš„onClické‡Œé¢ï¼Œå°±å¯ä»¥ä½¿ç”¨ props.history.pushäº†ã€‚
```

#### withRouter   çš„åº”ç”¨ä¸åŸç†

You can get access to the history object's properties and the closest <Route>'smatch via the withRouter higher-order component.wi thRouter will pass updatedmatch, location, and history props to the wrapped component whenever itrenders.

```
åªè¦è¢«withRouteråŠ å·¥åï¼Œå°±å¯ä»¥è·å–åˆ°historyç›¸å…³ã€‚
 import { withRouter } from "react-router"; 
 withRouter(MyComponent); 
 withRouter(connect(...)(MyComponent))

```





## åä¸€  Fluxä¸Redux

### Fluxä»‹ç»

æ˜¯ä¸€ç§æ¶æ„æ€æƒ³ï¼Œä¸“é—¨è§£å†³è½¯ä»¶çš„ç»“æ„é—®é¢˜ã€‚å®ƒè·ŸMVCæ¶æ„æ˜¯åŒä¸€ç±»ä¸œè¥¿ï¼Œä½†æ˜¯æ›´åŠ ç®€å•å’Œæ¸…æ™°ã€‚Fluxå­˜åœ¨å¤šç§å®ç°(è‡³å°‘15ç§

[https://github.com/voronianski/ï¬‚ux-comparison](https://github.com/voronianski/flux-comparison)

Facebook Fluxæ˜¯ç”¨æ¥æ„å»ºå®¢æˆ·ç«¯Webåº”ç”¨çš„åº”ç”¨æ¶æ„ã€‚å®ƒåˆ©ç”¨**å•å‘æ•°æ®æµ**çš„æ–¹å¼æ¥ç»„åˆReactä¸­çš„è§†å›¾ç»„ä»¶ã€‚å®ƒæ›´åƒä¸€ä¸ªæ¨¡å¼è€Œä¸æ˜¯ä¸€ä¸ªæ­£å¼çš„æ¡†æ¶ï¼Œå¼€å‘è€…ä¸éœ€è¦å¤ªå¤šçš„æ–°ä»£ç å°±å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹Flux.

![å›¾](.\img\redux.jpg)

### Reduxä»‹ç»

Reduxæœ€ä¸»è¦æ˜¯ç”¨ä½œåº”ç”¨çŠ¶æ€çš„ç®¡ç†ã€‚ç®€è¨€ä¹‹ï¼ŒReduxç”¨ä¸€ä¸ªå•ç‹¬çš„å¸¸é‡çŠ¶æ€æ ‘ï¼ˆstateå¯¹è±¡ï¼‰ä¿å­˜è¿™ä¸€æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼Œè¿™ä¸ªå¯¹è±¡ä¸èƒ½ç›´æ¥è¢«æ”¹å˜ã€‚å½“ä¸€äº›æ•°æ®å˜åŒ–äº†ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºï¼ˆä½¿ç”¨actionså’Œreducersï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œæ•°æ®è¿½è¸ªï¼Œå®ç°æ—¶å…‰æ—…è¡Œã€‚

#### 1  reduxä»‹ç»åŠè®¾è®¡å’Œä½¿ç”¨çš„ä¸‰å¤§åŸåˆ™

åŸå› ï¼š[Redux](https://so.csdn.net/so/search?q=Redux&spm=1001.2101.3001.7020)åº”ç”¨éœ€è¦éµå¾ªä¸‰å¤§åŸåˆ™ï¼Œå¦åˆ™ç¨‹åºå¾ˆå®¹æ˜“å‡ºç°éš¾ä»¥å¯Ÿè§‰çš„é—®é¢˜ã€‚

1  state ä»¥å•ä¸€å¯¹è±¡å­˜å‚¨åœ¨ store å¯¹è±¡ä¸­
2  state åªè¯»(æ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡)

3  ä½¿ç”¨çº¯å‡½æ•° reducer æ‰§è¡Œ state æ›´æ–°

ç»†åŒ–è§£é‡Šï¼š

â‘ å”¯ä¸€æ•°æ®æº

ã€€ã€€Reduxåªç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€å¯¹è±¡ï¼Œå­˜å‚¨åœ¨Reduxçš„storeä¸­ã€‚å”¯ä¸€æ•°æ®æºæ˜¯ä¸€ç§é›†ä¸­å¼ç®¡ç†åº”ç”¨çŠ¶æ€çš„æ–¹   

â€‹       å¼ï¼Œä¾¿äºç›‘æ§ä»»æ„æ—¶åˆ»åº”ç”¨çš„çŠ¶æ€å’Œè°ƒè¯•åº”ç”¨ï¼Œå‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚

â‘¡ä¿æŒåº”ç”¨çŠ¶æ€åªè¯»

ã€€ã€€åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹åº”ç”¨çŠ¶æ€ã€‚å½“éœ€è¦ä¿®æ”¹åº”ç”¨çŠ¶æ€æ—¶ï¼Œå¿…é¡»å‘é€ä¸€ä¸ªactionï¼Œç”±è¿™ä¸ªactionæè¿°å¦‚ä½•   

â€‹       ä¿®æ”¹åº”ç”¨çŠ¶æ€ã€‚

â‘¢åº”ç”¨çŠ¶æ€çš„æ”¹å˜é€šè¿‡çº¯å‡½æ•°å®Œæˆ

ã€€ã€€actionè¡¨æ˜ä¿®æ”¹åº”ç”¨çŠ¶æ€çš„æ„å›¾ï¼ŒçœŸæ­£å¯¹åº”ç”¨çŠ¶æ€åšä¿®æ”¹çš„æ˜¯reducerã€‚reducerå¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥reducer 

â€‹       åœ¨æ¥æ”¶åˆ°actionæ—¶ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹åŸæ¥çš„çŠ¶æ€å¯¹è±¡ï¼Œè€Œæ˜¯è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡è¿”å›ã€‚

çº¯å‡½æ•°æŒ‡çš„æ˜¯ï¼š

â€‹    å¯¹äºåŒæ ·çš„å‚æ•°å€¼ï¼Œå‡½æ•°çš„è¿”å›ç»“æœæ€»æ˜¯ç›¸åŒçš„ã€‚å‡½æ•°çš„æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¾‹å¦‚ä¿®æ”¹å¤–éƒ¨å¯¹è±¡æˆ–è¾“å‡ºåˆ°I/O

 è®¾å¤‡ã€‚

ä¸»è¦ç»„æˆaction
ã€€ã€€actionæ˜¯Reduxä¸­ä¿¡æ¯çš„è½½ä½“ï¼Œæ˜¯storeå”¯ä¸€çš„ä¿¡æ¯æ¥æºã€‚æŠŠactionå‘é€ç»™storeå¿…é¡»é€šè¿‡storeçš„dispatchæ–¹æ³•ã€‚actionæ˜¯æ™®é€šçš„JavaScriptå¯¹è±¡ï¼Œä½†æ¯ä¸€ä¸ªactionå¿…é¡»æœ‰ä¸€ä¸ªtypeå±æ€§æè¿°actionçš„ç±»å‹ï¼Œtypeä¸€èˆ¬ä¸ºå­—ç¬¦ä¸²å¸¸é‡ã€‚é™¤äº†typeå±æ€§å¤–ï¼Œactionçš„ç»“æ„å®Œå…¨ç”±è‡ªå·±å†³å®šã€‚ä¸€èˆ¬é€šè¿‡action creatoråˆ›å»ºactionï¼Œaction creatoræ˜¯è¿”å›actionçš„å‡½æ•°

ç›¸å…³æ–‡æ¡£å‚çœ‹ï¼šhttps://blog.csdn.net/sxww_zyt/article/details/129253498



#### 2. redux å·¥ä½œæµ

æ‘˜è‡ªå®˜ç½‘

![ç¤ºä¾‹](https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif)



![img](.\img\redux2.jpg)



#### 3. reactç»‘å®šåä½¿ç”¨reduxå®ç°æ¡ˆä¾‹

##### npm å¼•å…¥

 å®˜ç½‘ https://cn.redux.js.org/introduction/getting-started/

```
# NPM
npm install redux
```

##### æ¡ˆä¾‹æ¼”ç¤º

ï¼šåˆ—è¡¨é¡µä¸­æ˜¾ç¤ºåœ°å›¾tabbarï¼Œè¿›å…¥è¯¦æƒ…é¡µæ—¶éšè—ã€‚

npmåˆå§‹åŒ–åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»ºreduxæ–‡ä»¶å¤¹å­ï¼Œè¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ–°å»ºstore.jsæ–‡ä»¶ã€‚

###### store.js

```
 //1. å¼•å…¥redux, 
 //2. createStore( reducer )
 import {createStore} from 'redux'

 const reducer = (prevState={ show:true,},action)=>{
    console.log(prevState,action)
    let newState = {...prevState}
    switch(action.type){
       case "0":
         newState.show = false
         return newState     ï¼ˆreturn çš„stateï¼Œå°±å˜æˆæœ€æ–°çš„stateï¼Œappé¡µé¢å¯ä»¥è·å–æœ€æ–°çš„å€¼ï¼‰
       case "1":
         newState.show = true
         return newState
       default:
          return prevState
    }
 }
 const store = createStore(reducer);

 export default store
```



###### App.jsç»„ä»¶   

é¡¹ç›®è¿è¡Œï¼Œå³æ‰§è¡Œ store.subscribe è®¢é˜…ã€‚

åªè¦é‚£ä¸ªé¡µé¢è°ƒç”¨ dispatchï¼Œstore.subscribeå°±ä¼šè¢«è§¦å‘ï¼Œ æ‹¿åˆ°å·²ç»ä¿®æ”¹åçš„æ•°æ®ï¼Œåšè‡ªå·±çš„é€»è¾‘ã€‚

æœ¬é¡µé¢æƒ…å†µæ˜¯ï¼š   

åˆå§‹åŠ è½½Aé¡µé¢ï¼ˆè®¢é˜…è€…ï¼‰ï¼Œè·³è½¬Bé¡µé¢ï¼ˆè§¦å‘è€…ï¼‰ï¼Œå†å›Aé¡µé¢ã€‚  -----ã€‹éœ€è¦store.subscribeè®¢é˜…ã€‚

  ä½†æœ‰ä¸€ç§æƒ…å†µï¼Œ

å°±æ˜¯Aé¡µé¢ï¼Œè·³è½¬Bé¡µé¢ï¼ˆè§¦å‘è€…ï¼‰ï¼Œç„¶åè·³å¾€Cé¡µé¢ï¼Œä¸éœ€è¦è®¢é˜…ï¼Œç›´æ¥æ‹¿å€¼å³å¯ã€‚store.getState()

```react
import React, { Component } from 'react'
import MRouter from './router/IndexRouter'
import Tabbar from './components/Tabbar'
import './views/css/App.css'
               import store from './redux/store'
export default class App extends Component {
    state = {
        isShow:store.getState()
    }

    componentDidMount() {
        store.subscribe(()=>{// store.subsribe è®¢é˜…
            console.log("app ä¸­è®¢é˜…",store.getState())

            this.setState({
                isShow:store.getState().show
            })
        })
    }
    
    render() {
        return (
           <div>
                {/* å…¶ä»–çš„å†…å®¹ */}
                <MRouter>
                    {this.state.isShow && <Tabbar></Tabbar>}
                </MRouter>
           </div>
        )
    }
}

```

###### detail.jsç»„ä»¶ 

è¯¦æƒ…ç»„ä»¶

```
import React,{useEffect} from 'react'
import store from '../redux/store'

export default function Detail(props) {
    console.log(props.match.params,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")
    // console.log(props.location.query.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")
    // console.log(props.location.state.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
        // console.log("create") æ¸²æŸ“å®Œæˆè°ƒç”¨
        
        //store.dispatch  é€šçŸ¥
        store.dispatch( {type:"0" } )
        return () => {
            // console.log("destroy") é¡µé¢é”€æ¯æ—¶è°ƒç”¨
            
            store.dispatch( {type:"1" } )
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}

```

##### æ¡ˆä¾‹æ¼”ç¤ºé€»è¾‘è§£æ

ä¸Šé¢æ¡ˆä¾‹å®ç°ï¼Œæ ¸å¿ƒæ–¹æ³•

```
/*
store.subscrbe   appé¡µé¢è¿›å…¥ç›‘å¬

store.dispatch   å…¶ä»–é¡µé¢è°ƒç”¨

store.getState  appé¡µé¢è¢«è§¦å‘åï¼Œä½¿ç”¨è¯¥æ–¹æ³•è·å–æœ€æ–°stateå€¼

*/
```

diyä¸‰ä¸ªæ–¹æ³•

æ”¹å†™store.js

```
 //1. å¼•å…¥redux, 
 //2. createStore( reducer )
 import {createStore} from 'redux'

 const reducer = (prevState={ show:true},action )=>{
    console.log(action)
    let newState = {...prevState}
    switch(action.type){
       case "kerwinhide-tabbar":
         newState.show = false
         return newState
       case "kerwinshow-tabbar":
         newState.show = true
         return newState
       default:
          return prevState
    }
 }
 const store = createKerwinStore(reducer);// åˆå§‹åŒ–createStore,æ›´æ¢ä¸ºä¸‹é¢è‡ªå®šä¹‰æ–¹æ³•ã€‚

 export default store


/*
store.subscrbe   appé¡µé¢è¿›å…¥ç›‘å¬

store.dispatch   å…¶ä»–é¡µé¢è°ƒç”¨

store.getState  appé¡µé¢è¢«è§¦å‘åï¼Œä½¿ç”¨è¯¥æ–¹æ³•è·å–æœ€æ–°stateå€¼

*/
  function createKerwinStore(reducer){
     var list = []
     var state = reducer(undefined,{})
     
     function subscribe(callback){
        list.push(callback)
     }
  
     function dispatch(action){
        state = reducer(state,action)
        for(var i in  list){
           list[i] && list[i]()
        }
     }
  
     function getState(){
        return state
     }
     return {
        subscribe,
        dispatch,
        getState
     }
   }

```

å…¶ä»–é¡µé¢ä¸åŠ¨ï¼Œæµ‹è¯•å‘ç°åŠŸèƒ½æ­£å¸¸ã€‚

##### å¼•ç”³  ä»€ä¹ˆæ—¶çº¯å‡½æ•°

```
 /*
   var obj = {
     myname:"kerwin"
   }
   
   function test(obj){
     var newobj = {...obj}
     newobj.myname="xiaoming"
   
     return newobj
    }
    
    test(obj)  //myname:"xiaoming"
        obj //  myname: "kerwin" objæ²¡æœ‰æ”¹å˜ï¼ˆæ³¨æ„ï¼šè§£æ„æ˜¯æµ…å¤åˆ¶ï¼‰

    çº¯å‡½æ•°ï¼š 
      1. å¯¹å¤–ç•Œæ²¡æœ‰å‰¯ä½œç”¨ --- æŒ‡çš„æ˜¯ä¸ä¼šä¿®æ”¹å½±å“å‡½æ•°å¤–è¾¹çš„å˜é‡ã€‚è¿™é‡ŒæŒ‡ä¸èƒ½ä¿®æ”¹objå¯¹è±¡ã€‚
      2. åŒæ ·çš„è¾“å…¥å¾—åˆ°åŒæ ·çš„è¾“å‡º
 */
```

 æ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œreducers ä¹Ÿå¯ä»¥å½’ç±»äºçº¯å‡½æ•°ç±»ã€‚ å®ƒä¸ä¿®æ”¹stateï¼Œæ¯æ¬¡éƒ½æ˜¯è§£æ„åreturn , åŒæ ·çš„å…¥å‚ï¼Œè¾“å‡ºåŒæ ·çš„å‡ºå‚ã€‚ 

#### 4 reduceræ‰©å±• å¤šå‘½åç©ºé—´ç®¡ç†

å½“é¡¹ç›®è¾ƒå¤§ï¼Œå¤šäººå¼€å‘æ—¶ï¼Œä¸€ä¸ªretucersè‚¯å®šä¸è¡Œçš„ï¼Œæ¥ä¸‹æ¥å¼•å‡ºæ–°æ–¹æ³• - 

```
 combineReducers  from 'redux'
```

ç¤ºä¾‹å¦‚ä¸‹ï¼š

store.js

```
 //1. å¼•å…¥redux, 
 //2. createStore( reducer )
 import {combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 
 const reducer  = combineReducers({CityReducer,TabbarReducer })
 const store = createStore(reducer);
 export default store
```

å­ -- 01

```
const CityReducer = (prevState={
    cityName:"åŒ—äº¬"
   //  ...
 },action)=>{

    let newState = {...prevState}
    switch(action.type){
      
       case "change-city":
         newState.cityName = action.payload
         return newState

       default:
          return prevState
    }
 }

 export default  CityReducer
```

å­ -- 01

```
const TabbarReducer = (prevState={
    show:true
 },action)=>{
    let newState = {...prevState}
    switch(action.type){
       case "kerwinhide-tabbar":
         newState.show = false
         return newState
       case "kerwinshow-tabbar":
         newState.show = true
         return newState
       default:
          return prevState
    }
 }
 export default TabbarReducer
```

ä½¿ç”¨stateå€¼çš„æ—¶å€™ï¼Œä¹Ÿè¦åšç›¸åº”è°ƒæ•´ã€‚

```
æ‰“å°store.getState()å°±å˜æˆ
{
 CityReducer: {cityName: 'åŒ—äº¬'}
 TabbarReducer: {show: true}
}
```



```
    componentDidMount() {
        store.subscribe(()=>{  // store.subsribe è®¢é˜…
            console.log("app ä¸­è®¢é˜…",store.getState())   æ‰“å°çœ‹ä¸Šè¾¹

            this.setState({
                isShow:store.getState().TabbarReducer.show  // éœ€è¦å†é€’è¿›ä¸€å±‚
            })
        })
    }
```

æ€»ç»“ï¼š

å¦‚æœå¦‚æœä¸åŒçš„actionæ‰€å¤„ç†çš„å±æ€§ä¹‹é—´æ²¡æœ‰è”ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠReducer å‡½æ•°æ‹†åˆ†ã€‚ä¸åŒçš„å‡½æ•°è´Ÿè´£å¤„ç†ä¸åŒå±æ€§ï¼Œæœ€ç»ˆæŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå¤§çš„Reducer å³å¯

```
import {combineReducers} from "redux"; 

const reducer = combineReducers({
a: functionA, 
b: functionB, 
c: functionC
})

è®¿é—®ï¼š
(state)=>{ return {
        kerwinstate:state.a (ä¸åŒçš„å‘½åç©ºé—´)
    }
}
```



#### 5. redux ä¸­é—´ä»¶ 

##### ç¬¬ä¸€ç§  redux-thunk

###### 1. ä¸­é—´ä»¶çš„ä½œç”¨

åœ¨reduxé‡Œï¼Œactionä»…ä»…æ˜¯æºå¸¦äº†æ•°æ®çš„æ™®é€šjså¯¹è±¡ã€‚action creatorè¿”å›çš„å€¼æ˜¯è¿™ä¸ªactionç±»å‹çš„å¯¹è±¡ã€‚ç„¶åé€šè¿‡store.dispatch()è¿›è¡Œåˆ†å‘ã€‚åŒæ­¥çš„æƒ…å†µä¸‹ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œä½†æ˜¯reduceræ— æ³•å¤„ç†å¼‚æ­¥çš„æƒ…å†µã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨actionå’Œreducerä¸­é—´æ¶èµ·ä¸€åº§æ¡¥æ¢æ¥å¤„ç†å¼‚æ­¥ã€‚è¿™å°±æ˜¯middlewareã€‚

```
 
 store.dispatch(getCinemaListAction())
 
  dispatchçš„è¿”å›å‡½æ•°ä¸­ï¼Œä¸èƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œå°±å¦‚ä¸‹é¢testå‡½æ•°ï¼Œç«‹å³æ‰§è¡Œåï¼Œå¿…é¡»è¿”å›ä¸œè¥¿ã€‚
```



```
function test(){
    setTimeout(()=>{
        return 1000 
    },2000)

}

test() //undefined
```

è§£å†³è¿™ä¸ªæŠ¥é”™ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸­é—´ä»¶äº†





###### 2. ä¸­é—´ä»¶ redux-thunkçš„ä½¿ç”¨

```
npm i redux-thunk
```

æ”¹é€ store.jsæ–‡ä»¶

åŸæ¥

```
 import {combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 
 const reducer  = combineReducers({CityReducer,TabbarReducer })
 const store = createStore(reducer);
 export default store
```

ç°åœ¨

ä½¿ç”¨äº† 

applyMiddleware  from 'redux'     ï¼ˆreduxä¸­ï¼Œå·²ç»ç»™å‡ºäº†æ’ä»¶æ¥å£ï¼‰

import reduxThunk from 'redux-thunk'

createStoreæ—¶ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå‚æ•° applyMiddleware(reduxThunk)

```react
 import {applyMiddleware, combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'
 
 const reducer  = combineReducers({
  CityReducer,
  TabbarReducer,
  CinemaListReducer
 })
 const store = createStore(reducer,applyMiddleware(reduxThunk));
 export default store
```

ä½¿ç”¨é¡µé¢

```
 dispatchä¸­å¯ä»¥åŒ…å«axiosï¼ˆurl:"xxx"ï¼‰ç­‰å¼‚æ­¥çš„æ“ä½œäº†
 store.dispatch(getCinemaListAction())
```

é¡¹ç›®æ¡ˆä¾‹1ï¼š

è¿›å…¥åˆ—è¡¨é¡µï¼Œæ£€æŸ¥storeä¸­æ˜¯å¦å·²ç»æœ‰æ•°æ®ï¼Œæ²¡æœ‰å°±åå°è¯·æ±‚ã€‚

store.jsé…ç½®å¥½ä¸­é—´ä»¶

```react
 import {applyMiddleware,combineReducers, createStore} from 'redux' <----- å…³é”®ç‚¹
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'  <----- å…³é”®ç‚¹

 const reducer  = combineReducers({CityReducer,TabbarReducer ,CinemaListReducer})
 const store = createStore(reducer,applyMiddleware(reduxThunk));<----- å…³é”®ç‚¹
 export default store
```



åˆ—è¡¨é¡µ

```react
import React,{useState,useEffect} from 'react'
import getCinemaListAction from '../redux/actionCreator/getCinemaListAction'
import store from '../redux/store'
export default function Cinemas(props) {

    const [cityName] = useState(store.getState().CityReducer.cityName)

    const [cinemaList,setCinemaList] = useState(store.getState().CinemaListReducer.list)


    useEffect(() => {
        // if(store.getState)
        // console.log()
        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(getCinemaListAction())
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
        store.subscribe(()=>{
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })

        // windw
    }, [])

    return (
        <div>
            <div onClick={()=>{
                props.history.push(`/city`)
            }}>{cityName}</div>
            {
                  cinemaList.map(item=>
                    <dl key={item.cinemaId} style={{padding:"10px"}}>
                        <dt>{item.name}</dt>
                        <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                    </dl>    
                )
            }
        </div>
    )
}

```

æ•°æ®è¯·æ±‚js

```react
import axios from 'axios'
function getCinemaListAction(){

    return (dispatch)=>{
        axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                
                'X-Host': 'mall.film-ticket.cinema.list'
    
            }
        }).then(res=>{
            // console.log(res.data.data.cinemas)
            dispatch({
                type:"change-list",
                payload:res.data.data.cinemas
            })
        })   
    }    
}

export default getCinemaListAction

```

##### ç¬¬äºŒç§ Promiseæ–¹å¼

ä½¿ç”¨æ–¹å¼ï¼š

```
ä½œä¸ºä¸€æ¬¾æ’ä»¶å¼•å…¥
npm i redux-promise
```

store.jsä¸­ä½¿ç”¨

```react
 import {applyMiddleware,combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'

 import reduxPromise from 'redux-promise'//ä¸­é—´ä»¶promise <--------é‡ç‚¹
 

 const reducer  = combineReducers(
 {CityReducer,
 TabbarReducer ,
 CinemaListReducer
 })
 
 const store = createStore(
 reducer,
 applyMiddleware(reduxThunk,reduxPromise)); <--------é‡ç‚¹ ä¼ å…¥ç¬¬äºŒæ¬¾ä¸­é—´ä»¶
 
 export default store
```

è§¦å‘é¡µé¢

```react
 useEffect(() => {
        // if(store.getState)
        // console.log()
        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(  getCinemaListAction()  )  <--------é‡ç‚¹ dispatchæ–¹æ³•
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
        var unsubscribe = store.subscribe(()=>{
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })
        return ()=>{
            //å–æ¶ˆè®¢é˜…ï¼Ÿ
            unsubscribe() 
        }
    }, [])
```

getCinemaListAction() å°è£…é¡µé¢

ä¸redux-thunkçš„åŒºåˆ«ï¼š

redux-thunk 

```react
test(){
return ( dispatch )=>{   <--------é‡ç‚¹ return çš„æ˜¯ä¸€ä¸ªå‡½æ•°
    axios({}).then(res =>{
        dispatch({        <--------é‡ç‚¹ ä½¿ç”¨å…¥å‚æ–¹æ³•dispatchè¿”å›æ•°æ®
                type:"change-list",
                payload:res.data.data.cinemas
            })
    }) 
}

}
export default test
```

promiseç‰ˆæœ¬

```
test(){
 return   axios({}).then(res =>{ <--------é‡ç‚¹ return çš„æ˜¯ä¸€ä¸ªpromise( axioså°±æ˜¯promiseç±»çš„ )
    
       return  { type:"change-list",  <--------é‡ç‚¹ return å‡ºå»å‚æ•°
                payload:res.data.data.cinemas
              }
    }) 


}
export default test
```

åŸç†å°±æ˜¯ï¼š

store.dispatch( xx ï¼‰æ¥å—åˆ°çš„ä¸œè¥¿ï¼Œå®ƒä¼šåˆ¤æ–­ä¸€ä¸ªfunction  ï¼Œå°±ï¼ˆï¼‰æ‰§è¡Œï¼›è¿˜æ˜¯Promise  å°±thenå‡ºå»ã€‚





```
import axios from 'axios'
function getCinemaListAction(){

    // return (dispatch)=>{
        return axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                
                'X-Host': 'mall.film-ticket.cinema.list'
    
            }
        }).then(res=>{
            // console.log(res.data.data.cinemas)
            // dispatch({
            //     type:"change-list",
            //     payload:res.data.data.cinemas
            // })
           return {
                type:"change-list",
                payload:res.data.data.cinemas
            }
        })   
    // }    
}

export default getCinemaListAction
```









#### 6. å…³äºåå¤è®¢é˜…çš„é—®é¢˜

é¡µé¢åˆ—è¡¨ä¸­ï¼Œä½¿ç”¨äº† store.subscribeè®¢é˜…ï¼Œ ä½†æ˜¯å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åªè¦è¿”å›æ•°æ®ï¼Œ æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šè§¦å‘ï¼Œä¸ç®¡ä½ éœ€ä¸éœ€è¦ï¼Œå¹¶ä¸”å•ä¸ªé¡µé¢è¿˜ä¼šé‡å¤è®¢é˜…ã€‚åŸå› æ˜¯ï¼Œreduxæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç¼“å­˜ä¸­çš„é€»è¾‘ï¼Œæ¯æ¬¡è®¢é˜…éƒ½ä¼šå¾€äº‹ä»¶æ•°ç»„åˆ—ä¸­pushæ–°çš„å›è°ƒæ‰§è¡Œï¼Œç„¶åå½“æ•°æ®è¿”å›æ—¶ï¼ŒåˆæŠŠåˆ—è¡¨é‡Œçš„è®¢é˜…äº‹ä»¶ï¼Œæ‰§è¡Œäº†ä¸€éã€‚

```
import React,{useState,useEffect} from 'react'
import getCinemaListAction from '../redux/actionCreator/getCinemaListAction'
import store from '../redux/store'
export default function Cinemas(props) {

    const [cityName] = useState(store.getState().CityReducer.cityName)

    const [cinemaList,setCinemaList] = useState(store.getState().CinemaListReducer.list)


    useEffect(() => {

        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(getCinemaListAction())
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
        store.subscribe(()=>{
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })

    }, [])

    return (
        <div>
            <div onClick={()=>{
                props.history.push(`/city`)
            }}>{cityName}</div>
            {
                  cinemaList.map(item=>
                    <dl key={item.cinemaId} style={{padding:"10px"}}>
                        <dt>{item.name}</dt>
                        <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                    </dl>    
                )
            }
        </div>
    )
}
```

è§£å†³æ–¹æ³•ï¼š

store.subscribeåœ¨è®¢é˜…çš„æ—¶å€™ï¼Œè¿”å›äº†ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„å‡½æ•°ï¼Œåªè¦åœ¨é€‚å½“æ—¶æœºæ‰§è¡Œï¼Œå°±å¯ä»¥å–æ¶ˆè®¢é˜…ã€‚

```

    useEffect(() => {

        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(getCinemaListAction())
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
       var unsubscribe =  store.subscribe(()=>{ <----- é‡ç‚¹
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })
       return ()=>{
        //é¡µé¢é”€æ¯æ—¶æ‰§è¡Œ
        // å–æ¶ˆè®¢é˜…
        unsubscribe()  <----- é‡ç‚¹
       }
    }, [])
```





#### 7. æ’ä»¶ï¼ˆå¯è§†åŒ–reduxæ•°æ®ï¼‰

Redux DevToolsExtension ï¼›   ç±»ä¼¼ä¸vue  çš„  vuejsdevtoolsï¼›ä½œç”¨éƒ½æ˜¯å¼€å‘è¾…åŠ©ï¼Œæ–¹ä¾¿æŸ¥çœ‹æ•°æ®å˜åŒ–ã€‚

reduxæ’ä»¶ä¸‹è½½åœ°å€ï¼ˆ å¯ä»¥ä¸‹è½½chromeæµè§ˆå™¨ï¼‰ ä¸‹è½½æ‰©å±•zipåŒ…ï¼Œä¸‹è½½åï¼Œæ‹–åˆ°chromeæ‰©å±•ç¨‹åºå¤„ï¼Œå³è‡ªåŠ¨å®‰è£…ã€‚

https://github.com/zalmoxisus/redux-devtools-extension

ç„¶åï¼Œé¡¹ç›®ä¸­é…ç½®

store.jså‚æ•°é…ç½®

https://github.com/zalmoxisus/redux-devtools-extension#usage

```
import { 
createStore, 
compose    <----- é‡ç‚¹  è§£æ„å‡ºè¿™ä¸ªå‚æ•°
} from 'redux' 
import reducer from './reducer'

const composeEnhancers = window.  REDUX_DEVTOOLS_EXTENSION_COMPOSE	 || compose; const store = createStore(reducer, 
composeEnhancers( åŸæ¥çš„ä¸­é—´ä»¶ )      <----- é‡ç‚¹  åŒ…è£¹åŸæ¥çš„ä¸­é—´ä»¶
)

```

ç¤ºä¾‹ï¼š

```
 import {applyMiddleware,combineReducers, createStore, compose} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'

 import reduxPromise from 'redux-promise'

 const composeEnhancers = window.  REDUX_DEVTOOLS_EXTENSION_COMPOSE	 || compose;

 const reducer  = combineReducers({CityReducer,TabbarReducer ,CinemaListReducer})
 const store = createStore(reducer, composeEnhancers(applyMiddleware(reduxThunk,reduxPromise)));
 export default store

```

åˆ·æ–°é¡µé¢

![](.\img\å¾®ä¿¡æˆªå›¾_20231112165343.png)



## åäºŒ react-redux 

![img](.\img\clip_image002.jpg)

#### 1 .å£è¿°åŠŸèƒ½

ä½¿ç”¨æœ¬åº“çš„å‰æï¼Œè¦ä½¿ç”¨redux. 

ä¾èµ–ä¸redux,å¢åŠ äº†ä¸€ç‚¹reactç‰¹æ€§ã€‚

react-reduxå°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ŒæŠŠå±æ€§å’Œæ–¹æ³•æ³¨å…¥åˆ°äº†props.  

ç”¨å®ƒæ¥å‘å¸ƒï¼Œè®¢é˜…ï¼Œå–æ¶ˆè®¢é˜…ç­‰ç¹ççš„äº‹æƒ…ï¼Œæ›´åŠ æ³¨é‡ä¸šåŠ¡ã€‚ 

â€‹               æ•ˆæœï¼š            ä½é˜¶ç»„ä»¶--->   å¤„ç†åŒ…è£… ------> é«˜é˜¶ç»„ä»¶  å¢åŠ äº†å±æ€§å’Œæ–¹æ³•

**å®ç°æ–¹å¼ï¼š**

æ˜¯å¢åŠ äº†connectå‡½æ•°ç”Ÿæˆä¸€ä¸ªçˆ¶ç»„ä»¶ï¼Œçˆ¶ä¼ å­æ–¹å¼ï¼Œä¼ é€’å‚æ•°ã€‚

connectï¼ˆä¾›åº”å•†ç»„ä»¶ï¼‰ åŒ…è£¹<app/>æ ‡ç­¾ï¼Œç„¶åæ¯ä¸ªé¡µé¢ç»„ä»¶ä½¿ç”¨ï¼Œå°±æŠŠé‚£ä¸ªç»„ä»¶æ”¹é€ ä¸€ä¸‹ã€‚

#### 2.ä½¿ç”¨

```
npm i react-redux 
```

#### 3. æ¡ˆä¾‹æ¼”ç¤º

index.jsé¡µé¢

```
import React from 'react'
import ReactDOM from 'react-dom'
import App from './05-redux/App'

import {Provider} from 'react-redux'    <---- é‡ç‚¹
import {store} from './06-react-redux/redux/store' <---- é‡ç‚¹

ReactDOM.render(

    <Provider store={store}>  <---- é‡ç‚¹  åœ¨é¡¶çº§æ ‡ç­¾ï¼Œä¾›åº”å•†ç»„ä»¶åŒ…è£¹ï¼Œæ³¨å…¥storeä»“åº“
         <App/>
    </Provider>
    
  ,document.getElementById("root"))
```

##### ç¤ºä¾‹01 

appç»„ä»¶æ”¹é€ ç¤ºä¾‹01 

```
import React, { Component } from 'react'
import MRouter from './router/IndexRouter'
import Tabbar from './components/Tabbar'
import './views/css/App.css'

import { connect } from 'react-redux' <---- é‡ç‚¹  å¼•å…¥connectæ–¹æ³•

 class App extends Component {

    componentDidMount() {
        console.log(this.props)
    }

    render() {
        return (
           <div>
         
                <MRouter>
                  {this.props.isShow && <Tabbar></Tabbar>} <---- é‡ç‚¹ isShowçš„æ‹¿å‚å½¢å¼
               </MRouter>
              
           </div>
        )
    }
}

const mapStateToProps = (state)=>{
    // console.log(state)
    return {
        a:1,
        b:2,
        isShow:state.TabbarReducer.show
    }
}
const  callback = {
    a:()=>{

    },
    b:()=>{

    }
}
    
export default connect( mapStateToProps,callback )(App) <---- é‡ç‚¹ è§£é‡Šå¦‚ä¸‹
```

connectï¼ˆa,bï¼‰è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå†æŠŠAppå…¥å‚ã€‚è¿™æ ·æ˜¯ä¸ºäº†ä¾¿äºæˆ‘ä»¬è‡ªå®šä¹‰ä¼ å‚ã€‚ 

--å½¢å‚a      å°†æ¥ç»™å­©å­ä¼ çš„å±æ€§

æ˜¯ä¸€ä¸ªå‡½æ•° return ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œé¢å¯ä»¥æ‹¿åˆ°é¡¶çº§ä¼ å…¥çš„storeå‚æ•°ï¼Œé€‰å–æœ¬é¡µé¢ä¼šä½¿ç”¨é“åˆ°çš„ isshow .

--å½¢å‚b  å°†æ¥ç»™å­©å­ä¼ çš„å›è°ƒå‡½æ•°

ä¼ å…¥å›è°ƒæ–¹æ³•ï¼Œè¿™é‡Œé¢å¯ä»¥æ˜¯è¯·æ±‚çš„æ•°æ®ï¼Œç­‰è‡ªå®šä¹‰çš„ä¸œè¥¿ã€‚

ä¼ å…¥ä¹‹åï¼Œé¡¹ç›®ä¸­æ‰€æœ‰çš„ç»„ä»¶éƒ½è§†ä¸ºProviderçš„å­ç»„ä»¶ï¼Œé€šè¿‡propsæ‹¿åˆ°è‡ªå·±ä¼ å…¥çš„å‚æ•°ã€‚

##### ç¤ºä¾‹02

detailè¯¦æƒ…ç»„ä»¶ç¤ºä¾‹2

åˆ—è¡¨é¡µæ‰§è¡Œä»£ç 

```
 props.history.push(`/detail/${filmId}`)
```

è¯¦æƒ…é¡µï¼š

```react
import React,{useEffect} from 'react'
import { show,hide } from '../redux/actionCreator/TabbarActionCreator'

import {connect} from 'react-redux' <---- é‡ç‚¹

 function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    let  {show,hide,match} = props; // æŠŠå‚æ•°è§£æ„å‡ºæ¥ å¦åˆ™ä¾èµ–è¿‡å¤š æµè§ˆå™¨warmæç¤º

    useEffect(() => {
        // console.log("create")
        // store.dispatch(hide())
                  hide()  <---- é‡ç‚¹ åŸæ¥dispatchçš„æ–¹æ³•æ›¿æ¢ä¸ºæ›´ä¸ºæ›´ä¸ºç®€æ´çš„hide()
        return () => {
            console.log("destroy")
            // store.dispatch(show() )
                    show()  <---- é‡ç‚¹
        }
    }, [match.params.myid, show,hide]) ä¾èµ–å‚æ•°

    return (
        <div>
            deteail
        </div>
    )
}
const mapDispatchToProps  = {
    show,
    hide
}
export default connect(null,mapDispatchToProps)(Detail) <---- é‡ç‚¹ ç»„ä»¶æå‡
```

TabbarActionCreator æ–¹æ³•

```
 function hide(){
     return {
        type:"kerwinhide-tabbar"
    }
 }

 function show(){
    return {
        type:"kerwinshow-tabbar"
    }
 }

 export {show,hide}
```

##### ç¤ºä¾‹03 

city.jsç»„ä»¶æ”¹é€ 

```
import React,{useState} from 'react'
import {connect} from 'react-redux'  <---- é‡ç‚¹

 function City(props) {
    const [list] = useState(["åŒ—äº¬","ä¸Šæµ·","æ·±åœ³","å¹¿å·"])
    return (
        <div>
            city

            <ul>
                {
                    list.map(item=>
                    <li key={item} onClick={()=>{
                        // store.dispatch({
                        //     type:"change-city",
                        //     payload:item
                        // })
                        props.change(item)  <---- é‡ç‚¹ ä¼ å…¥è¡Œå‚æ•°item

                        props.history.goBack()
                    }}>{item}</li>    
                    )
                }
            </ul>
        </div>
    )
}
const mapDispatchToProp =  {
    change(item){     æ¥å—å‚æ•°  item 
        return {
            type:"change-city",       //è¿™é‡Œæ˜¯é€šè¿‡typeæŒ¨ä¸ªåŒºåŒ¹é…reducer
            payload:item
        }
    }
}

export default connect(null,mapDispatchToProp)(City) <---- é‡ç‚¹
```

CityReducer.js

```
const CityReducer = (prevState={
    cityName:"åŒ—äº¬"
   //  ...
 },action)=>{

    let newState = {...prevState}
    switch(action.type){
      
       case "change-city":
         newState.cityName = action.payload
         return newState

       default:
          return prevState
    }
 }

 export default  CityReducer
```

##### ç¤ºä¾‹04

Cinemas.jsç”µå½±åˆ—è¡¨é¡µé¢  æ”¹é€ 

```react
import React,{ useEffect } from 'react'
import getCinemaListAction from '../redux/actionCreator/getCinemaListAction'
import { connect } from 'react-redux' <---- é‡ç‚¹

 function Cinemas(props) {

    let {list, getCinemaListAction, cityName} = props

    useEffect(() => {

        if(list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            // store.dispatch(getCinemaListAction())
            getCinemaListAction()  <---- é‡ç‚¹
        }
    }, [list,getCinemaListAction]) <---- é‡ç‚¹
    return (
        <div>
            <div style={{overflow:"hidden"}}>
                <div onClick={()=>{
                    props.history.push(`/city`)
                }} style={{float:"left"}}>{ cityName }</div>
                <div style={{float:"right"}} onClick={()=>{
                    props.history.push(`/cinemas/search`)
                }}>æœç´¢</div>
            </div>
            {
                  list.map(item=> <---- é‡ç‚¹ è¿™é‡Œç›´æ¥ä½¿ç”¨è§£æ„å‡ºæ¥çš„ list
                    <dl key={item.cinemaId} style={{padding:"10px"}}>
                        <dt>{item.name}</dt>
                        <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                    </dl>    
                )
            }
        </div>
    )
}
const mapStateToProps = (state)=>{ <---- é‡ç‚¹  é¡¶çº§ç»„ä»¶ç»™çš„å‚æ•°  æ•°æ®ä»“åº“
    return {
        list:state.CinemaListReducer.list,
        cityName:state.CityReducer.cityName
    }
}

const mapDispatchToProps = {
    getCinemaListAction
}
export default connect(mapStateToProps,mapDispatchToProps)(Cinemas)<---- é‡ç‚¹
```

#### 4.æ€»ç»“

react-reduxæ’ä»¶çš„å¼•å…¥ï¼ŒæŠŠæ•°æ®ä»é¡µé¢æŠ½ç¦»ï¼Œä½¿æ¯ä¸ªé¡µé¢éƒ½å˜æˆäº†Uiç»„ä»¶ã€‚

###### æ‰©å±• ï¼šUIç»„ä»¶å’Œå®¹å™¨ç»„ä»¶

###### 1ï¼‰UIç»„ä»¶

â€¢ åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘

â€¢ æ²¡æœ‰çŠ¶æ€ï¼ˆå³ä¸ä½¿ç”¨this.stateè¿™ä¸ªå˜é‡ï¼‰

â€¢ æ‰€æœ‰æ•°æ®éƒ½ç”±å‚æ•°ï¼ˆthis.propsï¼‰æä¾›

â€¢ ä¸ä½¿ç”¨ä»»ä½• Redux çš„ API

###### (2) å®¹å™¨ç»„ä»¶

â€¢ è´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°

â€¢ å¸¦æœ‰å†…éƒ¨çŠ¶æ€
â€¢ç”¨ Redux çš„ API

###### ç»†åŒ–è§£é‡Šï¼š

å±•ç¤ºç»„ä»¶è´Ÿè´£åº”ç”¨çš„UIå±•ç¤ºï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶å¦‚ä½•æ¸²æŸ“ï¼Œå…·æœ‰å¾ˆå¼ºçš„å†…èšæ€§ã€‚å±•ç¤ºç»„å»ºä¸å…³å¿ƒæ¸²æŸ“æ—¶ä½¿ç”¨çš„æ•°æ®æ˜¯å¦‚ä½•è·å–åˆ°çš„ï¼Œå®ƒåªè¦çŸ¥é“æœ‰äº†è¿™äº›æ•°æ®åï¼Œç»„ä»¶åº”è¯¥å¦‚ä½•æ¸²æŸ“å°±è¶³å¤Ÿäº†ã€‚

å®¹å™¨ç»„ä»¶è´Ÿè´£åº”ç”¨é€»è¾‘çš„å¤„ç†ï¼Œå¦‚å‘é€ç½‘ç»œè¯·æ±‚ã€å¤„ç†è¿”å›æ•°æ®ï¼Œå°†å¤„ç†è¿‡çš„æ•°æ®ä¼ é€’ç»™å±•ç¤ºç»„ä»¶ä½¿ç”¨ç­‰ã€‚å®¹å™¨ç»„ä»¶è¿˜æä¾›ä¿®æ”¹æºæ•°æ®çš„æ–¹æ³•ï¼Œé€šè¿‡å±•ç¤ºç»„ä»¶çš„propsä¼ é€’ç»™å±•ç¤ºç»„ä»¶ï¼Œå½“å±•ç¤ºç»„ä»¶çš„çŠ¶æ€å˜æ›´å¼•èµ·æºæ•°æ®å˜åŒ–æ—¶ï¼Œå±•ç¤ºç»„ä»¶é€šè¿‡è°ƒç”¨å®¹å™¨ç»„ä»¶æä¾›çš„æ–¹æ³•åŒæ­¥è¿™äº›å˜åŒ–ã€‚

å±•ç¤ºç»„ä»¶å’Œå®¹å™¨ç»„ä»¶å¯ä»¥è‡ªç”±åµŒå¥—ã€‚

æ³¨æ„ï¼å±•ç¤ºç»„ä»¶å’Œå®¹å™¨ç»„ä»¶æ˜¯æ ¹æ®ç»„ä»¶æ„å›¾åˆ’åˆ†çš„ï¼Œæ— çŠ¶æ€ç»„ä»¶å’Œæœ‰çŠ¶æ€ç»„ä»¶æ˜¯æ ¹æ®ç»„ä»¶å†…éƒ¨æ˜¯å¦ä½¿ç”¨stateåˆ’åˆ†ç»„ä»¶ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå±•ç¤ºç»„ä»¶æ˜¯é€šè¿‡æ— çŠ¶æ€ç»„ä»¶å®ç°çš„ï¼Œå®¹å™¨ç»„ä»¶æ˜¯é€šè¿‡æœ‰çŠ¶æ€ç»„ä»¶å®ç°çš„ï¼Œä½†æ˜¯å±•ç¤ºç»„ä»¶ä¹Ÿå¯ä»¥æ˜¯æœ‰çŠ¶æ€ç»„ä»¶ã€‚ï¼Œå®¹å™¨ç»„ä»¶ä¹Ÿå¯ä»¥æ˜¯æ— çŠ¶æ€ç»„ä»¶ã€‚


##### **1.**  Provider  ä¸  connect

(1)React-Redux  æä¾›Providerç»„ä»¶ï¼Œå¯ä»¥è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ°state

```
import React from 'react'
import ReactDOM from 'react-dom'


import { Provider } from 'react-redux' import store from './store'

import App from './App'


const rootElement = document.getElementById('root') ReactDOM.render(
<Provider store={store}>
<App />
</Provider>, rootElement
)

```

##### 2. React-Redux æä¾›connectæ–¹æ³•

ï¼Œç”¨äºä» UI ç»„ä»¶ç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚connectçš„æ„æ€ï¼Œå°±æ˜¯å°†è¿™ä¸¤ç§ç»„ä»¶è¿èµ·æ¥

```
import { connect } from 'react-redux'
import { increment, decrement, reset } from './actionCreators'


// const Counter = ...
const mapStateToProps = (state /*, ownProps*/) => { return {
counter: state.counter
}
}
const mapDispatchToProps = { increment, decrement, reset } export default connect(
mapStateToProps, mapDispatchToProps
)(Counter)

```

#####  3  HOCä¸contexté€šä¿¡åœ¨react-reduxåº•å±‚ä¸­çš„åº”ç”¨

(1)     connect æ˜¯HOCï¼Œ é«˜é˜¶ç»„ä»¶

(2)  Providerç»„ä»¶ï¼Œå¯ä»¥è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ°state ï¼Œ ä½¿ç”¨äº†context( è·¨çº§é€šä¿¡ )

##### 4 é«˜é˜¶ç»„ä»¶æ„å»ºä¸åº”ç”¨

HOCä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç¡®åˆ‡è¯´åº”è¯¥æ˜¯ä¸€ä¸ªç»„ä»¶å·¥å‚ï¼Œè·å–ä½é˜¶ç»„ä»¶ï¼Œç”Ÿæˆé«˜é˜¶ç»„ä»¶ã€‚

 (1)ä»£ç å¤ç”¨ï¼Œä»£ç æ¨¡å—åŒ–

(2) å¢åˆ æ”¹props

(3)   æ¸²æŸ“åŠ«æŒ

**ç¤ºä¾‹**

```javascript
// Child.js

//é«˜é˜¶å‡½æ•°  å…¥å‚ä¸ºä½é˜¶ç»„ä»¶
function Control(wrappedComponent) {
  return class MyControl extends React.Component {
    render() {
      if (!this.props.data) {
        return <div>loading...</div>
      }
      return <wrappedComponent {...props} />
    }
  }
}


class MyComponent extends React.Component {
  render() {
    return <div>{this.props.data}</div>
  }
}
export default Control(MyComponent); //è¾“å‡ºé«˜é˜¶ç»„ä»¶



//Parent.js
import MyControlComponent from "./Child"
<MyControlComponent data={this.state.value}/>

//åœ¨çˆ¶çº§ä¼ å…¥dataæ˜¯nullçš„æ—¶å€™ï¼Œè¿™ä¸€å—å„¿å°±åªä¼šæ˜¾ç¤ºloading...,
//ä¸ä¼šæ˜¾ç¤ºç»„ä»¶çš„å…·ä½“å†…å®¹ï¼Œå¦‚æœdataä¸ä¸ºnull,  å°±æ˜¾ç¤ºçœŸå®ç»„ä»¶ä¿¡æ¯ã€‚

```

#### 5.åŸç†æ¢ç©¶

```
...
export default connect(mapStateToProps,mapDispatchToProps)(Cinemas)<---- é‡ç‚¹

è¿™é‡Œç»„ä»¶ä½¿ç”¨connectæ–¹æ³•å¤„ç†åï¼Œä¸ºä½é˜¶ç»„ä»¶ï¼Œå¢åŠ äº†å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹è¿™ä¸€æ ¸å¿ƒæ–¹æ³•è§£æã€‚
```

   æ ¹æ®è¾“å…¥å’Œè¾“å‡ºæ•ˆæœï¼Œè‡ªå®šä¹‰connectæ–¹æ³• 

   å¦‚ä¸‹

```
import React,{useEffect} from 'react'
//ä½é˜¶ç»„ä»¶
function NotFound(props) {
    useEffect(() => {
        console.log(props)
    }, [props])
    return (
        <div>
            404 not found
        </div>
    )
}
è‡ªå®šä¹‰connenctæ–¹æ³•
function kerwinconnenct(cb,obj){
    var value = cb()
    return (MyComponent)=>{
        return (props)=>{
            // console.log()
            return <div style={{color:"red"}}>
                <MyComponent {...value} {...props} {...obj}/>
            </div>
        }
    }
}
è¾“å‡ºé«˜é˜¶ç»„ä»¶
export default kerwinconnenct(()=>{
    return {
        a:1,
        b:2
    }
},{
    aa(){},
    bb(){}
})(NotFound)

```



#### reduxæŒä¹…åŒ–æ”¹é€ 

ä½¿ç”¨æ’ä»¶ redux-persist 

å‰æï¼šæœ€å¥½ä½¿ç”¨äº†react-reduxä¹‹åï¼Œå†ä½¿ç”¨è¿™ä¸ªã€‚

https://github.com/rt2zz/redux-persist

ä½¿ç”¨

```
npm i redux-persist

```

 éœ€è¦æ”¹é€ ä¸¤å¤„

store.jsæ–‡ä»¶

```react
 import {applyMiddleware,combineReducers, createStore, compose} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'
 import reduxPromise from 'redux-promise'

 import { persistStore, persistReducer } from 'redux-persist'
 import storage from 'redux-persist/lib/storage' // defaults to localStorage for web
 
 const persistConfig = {
    key: 'kerwin',
    storage,
    whitelist: ['CityReducer']
  }
  
  const reducer  = combineReducers({
    CityReducer,
    TabbarReducer,
    CinemaListReducer
   })
  const persistedReducer = persistReducer(persistConfig, reducer)
  
  
  
   const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;
  
   const store = createStore(persistedReducer,composeEnhancers(applyMiddleware(reduxThunk,reduxPromise)));
   let persistor = persistStore(store)
  
   export {store,persistor}
```

index.js

```react
import React from 'react'
import ReactDOM from 'react-dom'
import App from './05-redux/App'

import {Provider} from 'react-redux'
import {store,persistor} from './05-redux/redux/store'

console.log(store)
ReactDOM.render(

    <Provider store={store}>
          <PersistGate loading={null} persistor={persistor}>
             <App/>
          </PersistGate>
        
    </Provider>

  ,document.getElementById("root"))
```

åº”è¯¥å¯ä»¥äº†

## åä¹ redux-saga

#### ç®€ä»‹

åœ¨*saga*ä¸­ï¼Œå…¨å±€ç›‘å¬å™¨å’Œæ¥æ”¶å™¨ä½¿ç”¨*Generatorï¼ˆES6ç”Ÿæˆå™¨æ–¹æ³•ï¼‰*å‡½æ•°å’Œ*saga*è‡ªèº«çš„ä¸€äº›è¾…åŠ©å‡½æ•°å®ç°å¯¹æ•´ä¸ªæµç¨‹çš„ç®¡æ§ã€‚

redux-saga æ˜¯ä¸€ä¸ª redux ä¸­é—´ä»¶ï¼Œæ³¨æ„ redux-saga æ˜¯ redux ä¸­é—´ä»¶ï¼Œè¿™æ„å‘³ç€å®ƒåº”è¯¥é…åˆ redux ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸” react-redux æ˜¯å°† redux çš„ store è¿æ¥åˆ° React ç»„ä»¶ä¸­ï¼Œå› æ­¤ä»–ä»¬ä¸‰è€… **reduxï¼Œ react-redux, redux-saga** æ˜¯åˆä½œå…³ç³»è€Œéå¯¹ç«‹å…³ç³»ã€‚

![](.\img\saga.jpg)



#### **åŸç†å®ç°ï¼šES6ç”Ÿæˆå™¨**

![](.\img\saga1.jpg)



Generator ES6ç”Ÿæˆå™¨ï¼š åˆå«çŠ¶æ€æœºã€‚ä¹Ÿæ˜¯ä¸€ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆã€‚æœ¬æ’ä»¶åŸºäºè¯¥èƒ½åŠ›ã€‚

æ•ˆæœç±»ä¼¼ä¸æ­¥è¿›ç”µæœºï¼Œ æ‰§è¡Œä¸€æ­¥ï¼Œèµ°ä¸€æ­¥ã€‚å¯ä»¥ä¼ å‚ï¼Œå’Œæ¥å—å‚æ•°ã€‚

é¡¹ç›®ä¸­ä½¿ç”¨åœºæ™¯ï¼š æˆæƒè¿‡ç¨‹ä¸­ï¼Œ ç¬¬ä¸€ä¸ªæ¥å£ï¼Œæ‹¿åˆ°å‚æ•°ï¼Œè°ƒç”¨ç¬¬äºŒä¸ªæ¥å£ï¼Œå‚æ•°ç”¨äºè°ƒç”¨ç¬¬ä¸‰ä¸ªã€‚



æ¡ˆä¾‹1ï¼š

æ¼”ç¤ºåŸºæœ¬è¿è¡Œé€»è¾‘

```react
function *test(parms){ // å£°æ˜æ–¹æ³•    æ™®é€šå‡½æ•°å‰é¢åŠ æ˜Ÿå·
    console.log("111111",parms)
    var input1 = yield "111-è¾“å‡º";  //yield å…³é”®å­— æ¯ä¸€ä¸ªä»£è¡¨ä¸€æ­¥

    console.log("22222",input1) //ç¬¬äºŒæ­¥
    var input2 =yield "222-è¾“å‡º";//ç¬¬äºŒæ­¥

    console.log("333333",input2)//ç¬¬ä¸‰æ­¥
    var input3 =yield "333-è¾“å‡º";//ç¬¬ä¸‰æ­¥
    console.log("444444",input3) 
}

var kerwintest = test('åˆå§‹ä¼ å‚') //ç”ŸæˆçŠ¶æ€æœº

var res1 = kerwintest.next('ç¬¬ä¸€æ­¥ä¼ å‚')//æ¯ä¸€æ­¥èµ°å®Œ éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹è±¡
// console.log(res1) //è¿”å›ä¸€ä¸ªå¯¹è±¡ {done: false,value: "111-è¾“å‡º"}  doneè¡¨ç¤ºè¿˜ä¸æ˜¯æœ€åä¸€æ­¥ valueä¸ºè¿™ä¸€æ­¥ä¸­*testçš„å…¥å‚
var res2 = kerwintest.next('aaaaç¬¬äºŒæ­¥')
console.log(res2)
var res3 = kerwintest.next('bbbbç¬¬ä¸‰æ­¥')
console.log(res3)
var res4 = kerwintest.next('cccccç¬¬å››æ­¥')

console.log(res4) // {done: true value: undefined}   ä¸‰ä¸ªyield nextç¬¬å››ä¸ª è¿”å› false

```

æ¡ˆä¾‹2ï¼š å¼‚æ­¥å½¢å¼çš„

**åŸæ¥çš„æ–¹å¼**

```
async function  A(){
    var res1 =await fetch()
    var res2 =await fetch()
    var res3 =await fetch()

  console.log(res3)
}
```

ç”Ÿæˆå™¨æ–¹å¼

é“¾å¼è°ƒç”¨

```react
function *test1(){

    setTimeout(()=>{
        console.log("11111-success")
        kerwintest1.next() //è‡ªåŠ¨æ‰§è¡Œç¬¬äºŒæ­¥
    },1000)

    yield;
    setTimeout(()=>{
        console.log("222222-success")

        kerwintest1.next()  //è‡ªåŠ¨æ‰§è¡Œç¬¬ä¸‰æ­¥
    },1000)
    yield;
    setTimeout(()=>{
        console.log("3333-success") 
    },1000)
    yield;
}

var kerwintest1 = test1()

kerwintest1.next() // ç¬¬ä¸€æ­¥å¯åŠ¨ä¸€ä¸‹
```



#### æ­£é¢˜

æœ¬æ’ä»¶æ˜¯è§£å†³å¼‚æ­¥çš„ï¼Œä¸è¦ä¸ºä½¿ç”¨è€Œä½¿ç”¨ã€‚

##### å®‰è£…

```
npm install --save redux-saga
```

##### æ¡ˆä¾‹

![](.\img\saga3.png)



ä¸€ä¸‹æ¼”ç¤ºæ˜¯ï¼Œsagaç›‘å¬å¤šä¸ªsagaäº‹ä»¶

###### äº‹ä»¶é€»è¾‘é“¾ï¼š 

**appjs** ï¼š store.dispatch å‘èµ·type =get-list1çš„äº‹ä»¶

**saga/saga1.js**ï¼šç”Ÿæˆå™¨å‡½æ•°å¾—åˆ°æ­£åœ¨ç›‘å¬ä¸­çš„  yield take("get-list1") ====ã€‹æ‰§è¡Œå¦ä¸€ä¸ªyield fork æ¥å£è·å–æ•°æ®ï¼Œç­‰å¾…è·å–åˆ°åï¼Œå‘èµ·   yield put  type = change-list1çš„äº‹ä»¶ï¼Œå¹¶æºå¸¦è·å–åˆ°çš„æ•°æ® å…¥å‚payload

 **retucerjs**  case "change-list1,è§¦å‘ï¼Œæ¥å—payload å¹¶reture,è§¦å‘é¡µé¢ã€‚

ï¼ˆ

  å¦‚æœå°±ç›‘å¬ä¸€ä¸ªï¼šå°±ä¸ç”¨åˆå¹¶ï¼Œsore.jsæ–‡ä»¶ 

```
import watchSaga from './saga-every' //å¦‚æœå°±ä¸€ä¸ªwatchSaga1 ç›´æ¥å¯¼å…¥ï¼Œæ”¾åˆ°runé‡Œå°±è¡Œäº†
```

æ›´æ¢ä¸ºï¼š

```
import watchSaga from './saga1.js' 
```

ï¼‰

###### app.jsä½¿ç”¨é¡µé¢

```react
import React, { Component } from 'react'
import store from './redux/store'

export default class App extends Component {
    constructor(props) {
        super(props);
        this.state = {
            data:"--"
        }
      }
    render() {
        return (
            <div>
                 <div>7777{ this.state.data }</div>
                <button onClick={() => {
                    if (store.getState().list1.length === 0) {
                        //dispatch
                        store.dispatch({
                            type: "get-list1"
                        })
                    } else {
                        console.log("ç¼“å­˜", store.getState().list1)
                        this.setState({
                            data:store.getState().list1
                        })
                    }

                }}>click-ajax-å¼‚æ­¥ç¼“å­˜111</button>

                <button onClick={() => {
                    if (store.getState().list2.length === 0) {
                        //dispatch
                        store.dispatch({
                            type: "get-list2"
                        })
                    } else {
                        console.log("ç¼“å­˜", store.getState().list2)
                    }

                }}>click-ajax-å¼‚æ­¥ç¼“å­˜222</button>
            </div>
        )
    }
}
```



###### store.jsæ–‡ä»¶

```react
import {createStore,applyMiddleware } from 'redux'
import reducer from './reducer'
import createSagaMidlleWare from 'redux-saga'
import watchSaga from './saga-every' //å¦‚æœå°±ä¸€ä¸ªwatchSaga1 ç›´æ¥å¯¼å…¥ï¼Œæ”¾åˆ°runé‡Œå°±è¡Œäº†

const SagaMidlleWare = createSagaMidlleWare()
const store = createStore(reducer,applyMiddleware(SagaMidlleWare))// sagaä»¥ä¸­é—´ä»¶å½¢å¼ä½¿ç”¨


SagaMidlleWare.run(watchSaga) //sagaä»»åŠ¡ï¼Œ
export default store
```

###### reducer.js

```react
function reducer(prevState = {
    list1: [],
    list2: []
}, action = {}) {
  
    var newState = { ...prevState }
    switch (action.type) {
        case "change-list1":
            // console.log(action)
            newState.list1 = action.payload
            return newState
        case "change-list2":
            // console.log(action)
            newState.list2 = action.payload
            return newState
        default:
            return prevState
    }
    // return prevState
}

export default reducer
```

###### saga.js

```react
import {all} from 'redux-saga/effects'
import watchSaga1 from './saga/saga1'
import watchSaga2 from './saga/saga2'
function *watchSaga(){
    yield all([watchSaga1(),watchSaga2()]) //allå‡½æ•°ï¼Œèšåˆå¤šä¸ª
}

export default watchSaga
```

###### saga-every.js

```react
import {takeEvery} from 'redux-saga/effects'
import { getList1 } from './saga/saga1'
import { getList2 } from './saga/saga2'

function *watchSaga(){   ç”Ÿæˆå™¨å‡½æ•° ç®¡ç†å¤šä¸ª
    yield takeEvery("get-list1",getList1) 
    yield takeEvery("get-list2",getList2)
}

export default watchSaga
```

###### saga/saga1.js

```react
import {takeEvery,put,call ,take,fork}  from 'redux-saga/effects'
function *watchSaga1(){
    console.log('saga')
    // while(true){
        // take ç›‘å¬ ç»„ä»¶å‘æ¥çš„action
        yield take("get-list1")
        // fork åŒæ­¥æ‰§è¡Œå¼‚æ­¥å¤„ç†å‡½æ•°
        yield fork(getList1) // æ‰§è¡Œç”Ÿæˆå™¨
    // }  

    // yield takeEvery("get-list1",getList1)
}
  
function *getList1(){
    //å¼‚æ­¥å¤„ç†çš„ï¼Œ

    // callå‡½æ•°å‘å¼‚æ­¥è¯·æ±‚
    let res = yield call(getListAction1)//é˜»å¡çš„è°ƒç”¨fn / call(è¿”å›å€¼æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡çš„å‡½æ•°)

    yield put({ //ç­‰å¾… è·å–åˆ°è¯·æ±‚å›æ¥çš„res ç«‹å³å‘èµ·æ–°çš„actionåŠ¨ä½œ ï¼ˆä¸‹ä¸€æ­¥å°±æ˜¯reduceræ¥æ”¶åˆ°åŠ¨ä½œï¼‰
        type:"change-list1",
        payload:res
    }) 
    // putå‡½æ•°å‘å‡ºæ–°çš„action,éé˜»å¡å¼æ‰§è¡Œ
}

function getListAction1(){ // æ¨¡æ‹ŸçœŸæ­£æ¥å£è¯·æ±‚
    return new Promise((resolve,reject)=>{
        setTimeout(()=>{
            resolve(["1111","2222","3333"])
        },2000)
    })
}

export default watchSaga1
export {getList1}
```

###### saga/saga2.js

```react
import {takeEvery,put,call }  from 'redux-saga/effects'
function *watchSaga2(){
    // while(true){
    //     // take ç›‘å¬ ç»„ä»¶å‘æ¥çš„action
    //     yield take("get-list2")
    //     // fork éé˜»å¡è°ƒç”¨ çš„å½¢å¼æ‰§è¡Œ fn
    //     yield fork(getList2)
    // }  
    yield takeEvery("get-list2",getList2)
}
  
function *getList2(){
    //å¼‚æ­¥å¤„ç†çš„ï¼Œ

    // callå‡½æ•°å‘å¼‚æ­¥è¯·æ±‚
    let res1 = yield call(getListAction2_1)//é˜»å¡çš„è°ƒç”¨fn
    let res2 = yield call(getListAction2_2,res1)//é˜»å¡çš„è°ƒç”¨fn

    yield put({
        type:"change-list2",
        payload:res2
    }) 
    // putå‡½æ•°å‘å‡ºæ–°çš„action,éé˜»å¡å¼æ‰§è¡Œ
}

function getListAction2_1(){
    return new Promise((resolve,reject)=>{
        setTimeout(()=>{
            resolve(["4444","5555","66666"])
        },2000)
    })
}

function getListAction2_2(data){
    return new Promise((resolve,reject)=>{
        setTimeout(()=>{
            resolve([...data,"777","888","999"])
        },2000)
    })
}
export default watchSaga2
export {getList2}
```



###### æ–°å¢éœ€æ±‚

æç¤ºï¼š å°è£…å¯ä»¥æ›´ç®€å•ä¸€ç‚¹

```
    yield take("get-list1")
     yield fork(getList1) 
     å¿«æ·å†™æ³•  ç­‰ä»·äº
     yield takeEvery("get-list1",getList1)
```



saga1jsä¸­ï¼Œè¯·æ±‚ä¸¤æ¬¡æ•°æ®å¤„ç†æ–¹æ³•

```react
import {takeEvery,put,call ,take,fork}  from 'redux-saga/effects'
function *watchSaga1(){
    console.log('saga')
        // take ç›‘å¬ ç»„ä»¶å‘æ¥çš„action
        yield take("get-list1")
        // fork åŒæ­¥æ‰§è¡Œå¼‚æ­¥å¤„ç†å‡½æ•°
        yield fork(getList1) // æ‰§è¡Œç”Ÿæˆå™¨

    // yield takeEvery("get-list1",getList1)
}
  
function *getList1(){
    //å¼‚æ­¥å¤„ç†çš„ï¼Œ

    // callå‡½æ•°å‘å¼‚æ­¥è¯·æ±‚
    let res1 = yield call(getListAction1_1)//é˜»å¡çš„è°ƒç”¨fn / call(è¿”å›å€¼æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡çš„å‡½æ•°)
    let res2 = yield call(getListAction1_2,res1)//é˜»å¡çš„è°ƒç”¨fn / call(è¿”å›å€¼æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡çš„å‡½æ•°)

    yield put({ //ç­‰å¾… è·å–åˆ°è¯·æ±‚å›æ¥çš„res ç«‹å³å‘èµ·æ–°çš„actionåŠ¨ä½œ ï¼ˆä¸‹ä¸€æ­¥å°±æ˜¯reduceræ¥æ”¶åˆ°åŠ¨ä½œï¼‰
        type:"change-list1",
        payload:res2
    }) 
    // putå‡½æ•°å‘å‡ºæ–°çš„action,éé˜»å¡å¼æ‰§è¡Œ
}

function getListAction1_1(){ 
    return new Promise((resolve,reject)=>{
        setTimeout(()=>{
            resolve(["1111","2222","3333"])
        },2000)
    })
}
function getListAction1_2(list){ 
    return new Promise((resolve,reject)=>{
        setTimeout(()=>{
            resolve([...list,"æˆ‘æ˜¯ç¬¬äºŒæ¬¡åŠ å…¥çš„æ•°æ®"])
        },2000)
    })
}

export default watchSaga1
export {getList1}
```

















## åä¸‰ UIç»„ä»¶åº“

### Ant Design

Ant Design æ˜¯ä¸€ä¸ªè‡´åŠ›äºæå‡ã€ç”¨æˆ·ã€å’Œã€è®¾è®¡è€…ã€ä½¿ç”¨ä½“éªŒçš„è®¾è®¡è¯­è¨€ ï¼›æ—¨åœ¨ç»Ÿä¸€ä¸­å°é¡¹ç›®çš„å‰ç«¯ UI è®¾è®¡ï¼Œå±è”½ä¸å¿…è¦çš„è®¾è®¡å·®å¼‚å’Œå®ç°æˆæœ¬ï¼Œè§£æ”¾è®¾è®¡å’Œå‰ç«¯çš„ç ”å‘èµ„æºï¼› åŒ…å«å¾ˆå¤šè®¾è®¡åŸåˆ™å’Œé…å¥—çš„ç»„ä»¶åº“ã€‚

1.ant-design (PCç«¯)
https://ant.design/index-cn
https://ant-design.gitee.io/index-cn (é•œåƒåº“ï¼Œå¿«)
2.antd-mobile (ç§»åŠ¨ç«¯)
https://mobile.ant.design

æ¡ˆä¾‹ï¼špcç‰ˆ

```
npm install antd --save    /   yarn add antd     /  cnpm install antd --save
```

åœ¨reacté¡¹ç›®çš„APP.jsæ–‡ä»¶ä¸­å¼•å…¥ Antdçš„css(å…¨å±€ï¼‰

```
@import 'antd/dist/antd.css';
```

å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼š æ ·å¼æ–‡ä»¶æ‰¾ä¸ç€

```
é¦–å…ˆæŠŠåŸæœ¬çš„ä¾èµ–å¸è½½
npm remove antd
ç„¶åå®‰è£…ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ä¾èµ–ï¼Œå£ä»¤ä¸ºï¼š
npm add antd@^4.24.2
æ£€æŸ¥node_modulesä¾èµ– å‘ç°æœ‰è¿™ä¸ªæ–‡ä»¶äº†ok
```

æ³¨æ„ç‚¹ï¼š

1.è¿™é‡Œä½¿ç”¨çš„æ˜¯ç‰ˆæœ¬4ï¼›å¦‚æœä¸€ç›´å¼•å…¥ä¸æˆåŠŸï¼Œå°±åˆ é™¤ä¾èµ–ï¼Œå†åˆå§‹åŒ–ã€‚

2.4ç‰ˆæœ¬ä½¿ç”¨å›¾æ ‡éœ€è¦å¦å¤–å¼•å…¥npm i 

ç»ˆäºåœ¨å®˜æ–¹issueé‡Œé¢æ‰¾åˆ°åŸå› æ˜¯ antd 4+ç‰ˆæœ¬ä¸å¸¦æœ‰ @[ant-design](https://so.csdn.net/so/search?q=ant-design&spm=1001.2101.3001.7020)/iconsï¼ŒåŒ…æ‹¬ 

@ant-design/compatible ç­‰ç­‰

ç›´æ¥å®‰è£… **npm i @ant-design/icons** è§£å†³

cnpm uninstall @ant-design/icons 











## åå›› Immutable

 è¯ä¹‰ï¼šadj.æ°¸æ’çš„ï¼Œä¸å¯æ”¹å˜çš„

https://github.com/immutable-js/immutable-js

ä½œä¸ºä¸€æ¬¾æ’ä»¶ï¼Œè§£å†³ä¸€ä¸ªç—›ç‚¹ã€‚è¯¥æ’ä»¶çš„ä½œç”¨å°±æ˜¯é«˜æ€§èƒ½çš„æ·±å¤åˆ¶æ•°æ®ï¼ŒåŠŸèƒ½åªæ˜¯æ•°æ®çš„å¤„ç†ï¼Œä¸å…³ä¹æ¡†æ¶ï¼Œ

å¼•å…¥reactçš„åŸå› ï¼Œæ˜¯reactçš„ç‰¹æ€§ï¼Œå•å‘æ•°æ®æµï¼Œåœ¨ä¿®æ”¹dataçš„æ—¶å€™ï¼Œä¸èƒ½æ”¹å˜åŸæ•°æ®ï¼Œä½¿ç”¨åœºæ™¯å¤šä¸€ç‚¹è€Œå·²ã€‚

### 1. ç—›ç‚¹å¼•å…¥

#### ç¬¬ä¸€æ­¥ï¼š

   ```
// å¼•ç”¨å¤åˆ¶ (æµ…å¤åˆ¶)
var obj = {
    name:"zhangsan"
}

var obj2 = obj
obj2.name = "xiaomoing"
console.log(obj,obj2)//  {name: 'xiaomoing'} {name: 'xiaomoing'}
ç»“è®ºï¼šå˜é‡ç›´æ¥ç­‰äºï¼ŒæŒ‡é’ˆå˜åŒ–è€Œå·²ï¼Œæ•°æ®æºåŒä¸€ä¸ªï¼Œä¸€æ—¦ä¿®æ”¹ï¼ŒåŸæ•°æ®ä¹Ÿè·Ÿç€æ”¹å˜ã€‚
   ```

#### ç¬¬äºŒæ­¥ï¼š

```javascript
// æ¯”æµ…å¤åˆ¶å¤šå¤åˆ¶äº†ä¸€å±‚
var myobj = {
    name:"zhangsan",
    arr:[1,2,3]
}
var myobj2 = {  // ä½¿ç”¨è§£æ„å¤åˆ¶
    ...myobj   
}
myobj2.name = "xiaoming"
myobj2.arr.splice(1,1)

console.log(myobj,myobj2) 
//{arr: [1, 3], name: "zhangsan" }  {arr: [1, 3], name: "xiaoming" } 
 ç»“è®ºï¼šè¡¨å±‚æ•°æ®æ²¡æœ‰å½±å“ï¼Œæ·±å±‚è§£æ„è¿˜æ˜¯ä¿®æ”¹äº†
```

#### ç¬¬ä¸‰æ­¥:

```javascript
// json-parse json-stringify -æ·±å¤åˆ¶- ä¸èƒ½æœ‰undefined

var jsonobj ={
    name:"zhangsan",
    arr:[1,2,3],
    address:undefined
}

var jsonobj2 = JSON.parse(JSON.stringify(jsonobj))
jsonobj2.name = "xiaoming"
jsonobj2.arr.splice(1,1)

console.log(jsonobj,jsonobj2)
//{arr: [1,2, 3], name: "zhangsan" }  {arr: [1, 3], name: "xiaoming" } 
ç»“è®ºï¼šæˆåŠŸå¤åˆ¶ï¼Œåˆ‡æ²¡æœ‰æ”¹å˜åŸæ•°æ®ã€‚ ä½†æ˜¯å¤åˆ¶çš„æ•°æ®ä¸­ä¸èƒ½æœ‰undefinedï¼Œä¼šä¸¢å¤±æ‰ã€‚
// deepcopy
// é€’å½’æ·±å¤åˆ¶-ä¸€å±‚å±‚å¤åˆ¶ï¼Œ æ€§èƒ½ä¸å¥½ï¼Œå ç”¨å†…å­˜ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ï¼Œå®ƒæ˜¯å®Œæ•´çš„å¤åˆ¶äº†ä¸€ä»½æ•°æ®ã€‚
```

### 2.Immutableä»‹ç»

#### ImmutableåŠŸèƒ½ï¼š

æ¯æ¬¡ä¿®æ”¹ä¸€ä¸ª  Immutable  å¯¹è±¡æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜çš„å¯¹è±¡ï¼Œåœ¨æ–°å¯¹è±¡ä¸Šæ“ä½œå¹¶ä¸ä¼šå½±å“åˆ°åŸå¯¹è±¡çš„æ•°æ®ã€‚

#### Immutableä¼˜åŒ–æ€§èƒ½çš„æ–¹å¼ï¼š

Immutable å®ç°çš„åŸç†æ˜¯
Persistent Data Structureï¼ˆæŒä¹…åŒ–æ•°æ®ç»“æ„ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ—§æ•°æ®åŒæ—¶å¯ç”¨ä¸”ä¸å˜ã€‚åŒæ—¶ä¸ºäº†é¿å…
deepCopy æŠŠæ‰€æœ‰èŠ‚ç‚¹éƒ½å¤åˆ¶ä¸€éå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒImmutable ä½¿ç”¨äº†
Structural Sharingï¼ˆç»“æ„å…±äº«ï¼‰ï¼Œå³å¦‚æœå¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåªä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹å’Œå—å®ƒå½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹åˆ™è¿›è¡Œå…±äº«

![](https://upload-images.jianshu.io/upload_images/2165169-cebb05bca02f1772)



## 3.æ’ä»¶ä½¿ç”¨

 ```
# using npm
  1. npm i immutabel
  2. import {Map} from 'immutable'
 ```

### å¯¹è±¡çš„ä½¿ç”¨å’Œä¿®æ”¹ Mapæ–¹æ³•

```
import React, { Component } from 'react'
import {Map} from 'immutable'

var obj = {
    name:"zhangsan",
    age:100
}

var oldImmuObj = Map(obj)     //MapæŠŠå¯¹è±¡è½¬åŒ–æˆimmutableå¯¹è±¡
var newImmuObj = oldImmuObj.set("name","xiaoming") //.set(key , value) å½¢å¼ä¿®æ”¹å¯¹è±¡å€¼
// console.log(oldImmuObj,newImmuObj) // æ²¡æœ‰ä¿®æ”¹åŸæ•°æ®

//1 getè·å–immutalble 

console.log(oldImmuObj.get("name"),newImmuObj.get("name"))// è·å–immutableå¯¹è±¡çš„å€¼

//2 immutable===>æ™®é€šå¯¹è±¡

console.log(oldImmuObj.toJS(),newImmuObj.toJS()) //.toJS()æ–¹æ³•ï¼Œè¿˜åŸæˆæ™®é€šçš„jså¯¹è±¡
```

### æ¡ˆä¾‹01:Mapæ–¹æ³•setæ–¹æ³•toJSæ–¹æ³•

ä½¿ç”¨Mapæ–¹æ³•ï¼Œä¿®æ”¹name,ageï¼Œå¹¶æ›´æ–°è§†å›¾ã€‚æ­¤æ¡ˆä¾‹ï¼šimmutableä»…å‚ä¸æ•°æ®å¤„ç†ï¼Œä¸å‚ä¸è§†å›¾æ˜¾ç¤º

```
import React, { Component } from 'react'
import {Map} from 'immutable'

export default class App extends Component {

    state = {
        info:{
            name:"zs",
            age:100
        }
    }
    render() {
        return (
            <div>
                
                <button onClick={()=>{
                
  var old = Map(this.state.info) //1.æ•°æ®ç±»å‹è½¬åŒ–
 var newImmu = old.set("name","xiaoming").set("age",18) //2.æ•°æ®å¤„ç†
                    this.setState({
                        info:newImmu.toJS()  //3.æ•°æ®è¿˜åŸ
                    })
                    
                }}>click</button>
                {this.state.info.name}--
                {this.state.info.age}
            </div>
        )
    }
}
```

### æ¡ˆä¾‹2

immutableåº”ç”¨äºæ·±å±‚æ•°æ®ç»“æ„ä½¿ç”¨æ–¹æ³•ï¼Œå’ŒåŸºäºä¸ä¿®æ”¹ä¿æŒä¸å˜çš„ç‰¹æ€§çš„åˆ©ç”¨

ä¸‹é¢æ¡ˆä¾‹å±•ç¤ºï¼š

01.æ·±å±‚çº§æ•°æ®filterï¼Œä¹Ÿè¦åŠ ä¸ŠMapï¼Œå¦åˆ™ä¼šå½±å“åŸæ•°æ®

02.åˆ©ç”¨ä¸ä¿®æ”¹ä¸å˜æ¢åŸç†ï¼Œå¯ä»¥å‡å°‘å­ç»„ä»¶çš„é‡å¤æ¸²æŸ“



```
import React, { Component } from 'react'
import {Map} from 'immutable'
export default class App extends Component {

    state = {
        info:Map({
            name:"kerwin",
            select:"aa",
            filter:Map({
                text:"",
                up:true,
                down:false
            })
        })
    }

    componentDidMount() {
        console.log(this.state.info.get("filter"))
    }
    
    render() {
        return (
            <div>
                <button onClick={()=>{
                    this.setState({
                        info:this.state.info.set("name","xiaoming").set("select","bb")
                    })
                }}>click</button>
                {this.state.info.get("name")}
                <Child filter={this.state.info.get("filter")}/>
            </div>
        )
    }
}


class Child extends Component{
    shouldComponentUpdate(nextProps, nextState) { // ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ˜¯å¦æ¸²æŸ“ç»„ä»¶ï¼Œfalseåˆ™ä¸å˜
        if(this.props.filter === nextProps.filter){
            return false
        }
        return true
    }
    
    render(){
        return <div>
            child
        </div>
    }

    componentDidUpdate(){
        console.log("componentDidUpdate")
    }
}
```

### æ¡ˆä¾‹3 Listæ–¹æ³•

```javascript
import React, { Component } from 'react'
import {List} from 'immutable'
var arr = List([1,2,3])

var arr2 = arr.push(4) //ä¸ä¼šå½±å“è€çš„å¯¹è±¡ç»“æ„
var arr3 = arr2.concat([5,6,7])
console.log(arr.toJS(),arr2.toJS(),arr3.toJS())
æ‰“å°ç»“æœï¼š
 [1, 2, 3]
 [1, 2, 3, 4]
 [1, 2, 3, 4, 5, 6, 7]
 
export default class App extends Component {
    state = {
        favor:List(["aaa","bbb","ccc"])  
 //immutableçš„æ•°ç»„ï¼Œpush,concatç­‰æ­£å¸¸çš„jsæ–¹æ³•ï¼Œåœ¨è¿™é‡Œéƒ½ä¸ä¼šä¿®æ”¹åŸæ•°æ®ã€‚ï¼ˆä¸ºäº†å‡ä½å­¦ä¹ æˆæœ¬ï¼Œä¿æŒä¸€è‡´ï¼‰
    }
    render() {
        return (
            <div>
                {
                    this.state.favor.map(item=>
                      <li key={item}>{item}</li>    
                    )
                }
            </div>
        )
    }
}
```

### æ¡ˆä¾‹4 Listæ–¹æ³•çš„é¡¹ç›®ä½¿ç”¨

æ¼”ç¤ºlistçš„è·å–ï¼Œä¿®æ”¹ï¼Œåˆ é™¤

```react
import { List,Map } from 'immutable'
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        info:Map({
            name:"kerwin",
            location:Map({
                province:"è¾½å®",
                city:"å¤§è¿"
            }),
            favor:List(["è¯»ä¹¦","çœ‹æŠ¥","å†™ä»£ç "])
        })
    }
    render() {
        return (
            <div>
                <h1>ä¸ªäººä¿¡æ¯ä¿®æ”¹</h1>
                <button onClick={()=>{
                    this.setState({
                    info: this.state.info.set("name","xiaomng")
                     .set("location",this.state.info.get("location").set("city","æ²ˆé˜³"))
                    })
                }}>ä¿®æ”¹</button>
                <div>
                    {this.state.info.get("name")}
                    <br/>
                    {
                        this.state.info.get("location").get("province")
                    }
                    -
                    {
                        this.state.info.get("location").get("city")
                    }
                    <br/>
                    {
                        this.state.info.get("favor").map((item,index)=>
                        <li key={item}>{item}
                            <button onClick={()=>{
                                console.log(index)

                                this.setState({
                                    info:this.state.info.set("favor",
                                    this.state.info.get("favor").splice(index,1))
                                })
                            }}>del</button>
                        </li>    
                        )
                    }
                </div>
            </div>
        )
    }
}
```

### æ¡ˆä¾‹5ï¼šfromJS setIn  updateInæ–¹æ³•

fromJS ï¼šå½“ä¸çŸ¥é“è¿”å›æ•°æ®çš„å±‚çº§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨fromJS ã€‚

.setIn(["å±‚çº§1","å±‚çº§2"],"è¦ä¿®æ”¹çš„æ–°å€¼")

.updateIn( [å±‚çº§]ï¼Œ ï¼ˆï¼‰=>{})  // ç¬¬äºŒä¸ªå€¼æ˜¯ä¸ªå›è°ƒï¼Œå›è°ƒä¸­è¿”å›çš„å°±æ˜¯æ–°å€¼

```react
import { fromJS } from 'immutable'
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        info:fromJS({
            name:"kerwin",
            location:{
                province:"è¾½å®",
                city:"å¤§è¿"
            },
            favor:["è¯»ä¹¦","çœ‹æŠ¥","å†™ä»£ç "]
        })
    }

    componentDidMount() {
        console.log(this.state.info)
    }
    

    render() {
        return (
            <div>
                <h1>ä¸ªäººä¿¡æ¯ä¿®æ”¹</h1>
                <button onClick={()=>{
                    this.setState({
                        info: this.state.info.setIn(["name"],"xiaomng")
                        .setIn(["location","city"],"æ²ˆé˜³")
                    })
                }}>ä¿®æ”¹</button>
                <div>
                    {this.state.info.get("name")}
                    <br/>
                    {
                        this.state.info.get("location").get("province")
                    }
                    -
                    {
                        this.state.info.get("location").get("city")
                    }
                    <br/>
                    {
                        this.state.info.get("favor").map((item,index)=>
                        <li key={item}>{item}
                            <button onClick={()=>{
                                console.log(index)

                                // this.setState({
                                //     info:this.state.info.setIn(["favor",index],"11111") //æ•°ç»„çš„æœ¬è´¨å°±æ˜¯å¯¹è±¡
                                // })

                                this.setState({
                                    info:this.state.info.updateIn(["favor"],(list)=>list.splice(index,1))
                                })
                            }}>del</button>
                        </li>    
                        )
                    }
                </div>
            </div>
        )
    }
}

```

### æ¡ˆä¾‹6ï¼šImmutable+Reduxçš„å¼€å‘æ–¹å¼

  éµå¾ªImmutableåŒ–çš„æ•°æ®ï¼Œå–å€¼å’Œä¿®æ”¹çš„è§„åˆ™ã€‚

```react
//reducer.js
const initialState = fromJS({ category:"",
material:""
})
const reducer = (prevstate = initialState,action={})=>{ let {type,payload} = action
switch(type){
case GET_HOME:
var newstate =prevstate.set("category",fromJS(payload.category)) var newstate2 =newstate.set("material",fromJS(payload.material)) return newstate2;
default:
return prevstate
}
}


//home.js
const mapStateToProps = (state)=>{ return {
category:state.homeReducer.getIn(["category"]) || Map({}), material:state.homeReducer.getIn(["material"]) || Map({})
}
}

this.props.category.get("ç›¸å…³å±æ€§") this.props.category.toJS() //æˆ–è€…è½¬æˆæ™®é€šå¯¹è±¡

```

å»ºè®®ï¼š æœ‰éœ€è¦å»ä½¿ç”¨ï¼Œä¸è¦ä¸ºäº†ä½¿ç”¨è€Œä½¿ç”¨ã€‚

## åäº” Mobx

https://cn.mobx.js.org/

è¿™æ˜¯ä¸€ä¸ªåª²ç¾redux å’Œreact-reduxç»„åˆçš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨æ›´æ–¹é¢ã€‚æ—¢ç„¶æ˜¯å¯¹æ ‡æ’ä»¶ï¼Œæ‰€ä»¥Mobxä¹Ÿæœ‰

Mobxå’Œ mobx-**react** çš„ç»„åˆã€‚

### 1.ä»‹ç»

(1)     Mobxæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ï¼Œä¸Šæ‰‹éå¸¸å®¹æ˜“çš„çŠ¶æ€ç®¡ç†å·¥å…·ã€‚

(2)     MobxèƒŒåçš„å“²å­¦å¾ˆç®€å•:  ä»»ä½•æºè‡ªåº”ç”¨çŠ¶æ€çš„ä¸œè¥¿éƒ½åº”è¯¥è‡ªåŠ¨åœ°è·å¾—ã€‚

(3)     Mobxåˆ©ç”¨getterå’Œsetteræ¥æ”¶é›†ç»„ä»¶çš„æ•°æ®ä¾èµ–å…³ç³»ï¼Œä»è€Œåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶

â€‹        å€™ç²¾ç¡®çŸ¥é“å“ªäº›ç»„ä»¶éœ€è¦é‡ç»˜ï¼Œåœ¨ç•Œé¢çš„è§„æ¨¡å˜å¤§çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šæœ‰å¾ˆå¤šç»†ç²’åº¦æ›´æ–°

![](https://cn.mobx.js.org/flow.png)

### 2.Mobx*ä¸*reduxçš„åŒºåˆ«

1.Mobxå†™æ³•ä¸Šæ›´åå‘äºOOPï¼ˆé¢å‘å¯¹è±¡ï¼‰

2.å¯¹ä¸€ä»½æ•°æ®ç›´æ¥è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œä¸éœ€è¦å§‹ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®

3.å¹¶éå•ä¸€store,å¯ä»¥å¤šstoreã€‚

4.Reduxé»˜è®¤ä»¥JavaScriptåŸç”Ÿå¯¹è±¡å½¢å¼å­˜å‚¨æ•°æ®ï¼Œè€ŒMobxä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡

### 3.ä¼˜ç¼ºç‚¹

##### ä¼˜ç‚¹

a.   å­¦ä¹ æˆæœ¬å°

b.   é¢å‘å¯¹è±¡ç¼–ç¨‹, è€Œä¸”å¯¹ TS å‹å¥½

##### ç¼ºç‚¹

a.  è¿‡äºè‡ªç”±ï¼šMobxæä¾›çš„çº¦å®šåŠæ¨¡ç‰ˆä»£ç å¾ˆå°‘ï¼Œä»£ç ç¼–å†™å¾ˆè‡ªç”±ï¼Œå¦‚æœä¸åšä¸€äº›çº¦å®šï¼Œæ¯”è¾ƒå®¹æ˜“å¯¼è‡´å›¢é˜Ÿä»£ç é£æ ¼ä¸ç»Ÿä¸€ï¼Œ

b. ç›¸å…³çš„ä¸­é—´ä»¶å¾ˆå°‘ï¼Œé€»è¾‘å±‚ä¸šåŠ¡æ•´åˆæ˜¯é—®é¢˜ã€‚

### 4.Mobxçš„ä½¿ç”¨

é¡¹ç›®å¼•å…¥

````
npm i mobx@5    // æ™®åŠç‡è¾ƒé«˜çš„ç‰ˆæœ¬

import {observable,autorun} from 'mobx'  // <----- 1.å¼•å…¥æ ¸å¿ƒæ–¹æ³•   

var observableNumber = observable.box(10)  // <----- 2.åˆ›å»ºæ•°æ®

autorun(()=>{            // <----- 3.åˆ›å»ºç›‘å¬è€…
    console.log("numberæ”¹å˜äº†",observableNumber.get())
})
````



##### 4.1 ç®€å•å˜é‡çš„ç›‘å¬

###### æ¡ˆä¾‹1:

æ ¸å¿ƒæ–¹æ³•

observable ï¼šå°†æ™®é€šjsæ•°æ®ï¼Œå˜æˆå¯ä»¥ç›‘å¬çš„çŠ¶æ€ï¼Œè¿”å›äº†ä¸€ä¸ªå¢ç›Šå±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ã€‚

autorunï¼šè‡ªåŠ¨ç›‘å¬  å¹¶ä¸”åªå…³æ³¨æŒ‡å®šçš„æ•°æ®å¯¹è±¡å˜åŒ–ï¼Œå°±è§¦å‘ã€‚

mobxå¯¹è±¡çš„ä¿®æ”¹å’Œæå–å€¼    

```
 mobxObj.get()  æå–å€¼
 mobxObj.set(æ–°å€¼)  è®¾ç½®æ–°çš„å€¼
 
```



  æ‰§è¡Œæ•ˆæœï¼šé¡µé¢åŠ è½½åï¼Œä¼šé¦–å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œç›‘å¬æ•°æ®åˆ›å»ºï¼Œè¿›å…¥ç›‘å¬ï¼Œåç»­æ•°æ®çŠ¶æ€å˜åŒ–ï¼Œå¼€å§‹å·¥ä½œã€‚

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'  // <----- 1.å¼•å…¥æ ¸å¿ƒæ–¹æ³•

//å¯¹äºæ™®é€šç±»å‹æ•°æ®çš„ç›‘å¬
var observableNumber = observable.box(10)  // <----- 2.åˆ›å»ºæ•°æ®
var observableName = observable.box("tom")

ç¬¬ä¸€ä¸ªè‡ªåŠ¨ç›‘å¬
autorun(()=>{            // <----- 3.åˆ›å»ºç›‘å¬è€…
    console.log("numberæ”¹å˜äº†",observableNumber.get())
})
ç¬¬äºŒä¸ªè‡ªåŠ¨ç›‘å¬
// ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œ ä¹‹åæ¯æ¬¡æ”¹å˜ä¹Ÿä¼šæ‰§è¡Œ
autorun(()=>{
    console.log("nameæ”¹å˜äº†",observableName.get())
})

setTimeout(()=>{
    observableNumber.set(20)
    observableName.set("xiaoming")
},1000)

æµ‹è¯•ç»“æœï¼š 1såï¼Œä¸¤ä¸ªautorunç›‘å¬æ‰“å°
åŠ è½½é¡µé¢æ‰“å°ï¼›
numberæ”¹å˜äº† 10
nameæ”¹å˜äº† tom
   1såæ‰“å°
numberæ”¹å˜äº† 20
nameæ”¹å˜äº† xiaoming
```

###### æ¡ˆä¾‹2: ç›‘å¬è§„åˆ™

```react
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

//å¯¹äºæ™®é€šç±»å‹æ•°æ®çš„ç›‘å¬
var observableNumber = observable.box(10)
var observableName = observable.box("kerwin")

autorun(()=>{   //autorun01
    console.log("numberæ”¹å˜äº†",observableNumber.get())
})
// ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œ ä¹‹åæ¯æ¬¡æ”¹å˜ä¹Ÿä¼šæ‰§è¡Œ
autorun(()=>{  //autorun02
    console.log("nameæ”¹å˜äº†",observableName.get())
})

setTimeout(()=>{
    observableNumber.set(20)
},1000)

setTimeout(()=>{
    observableName.set("xiaoming")
},2000)

export default class App extends Component {
    render() {
        return (
            <div>
                app
            </div>
        )
    }
}
æµ‹è¯•ç»“æœï¼š
autorun01 1såæ‰“å°
autorun02 2såæ‰“å°
```

###### æ¡ˆä¾‹3

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

//å¯¹äºæ™®é€šç±»å‹æ•°æ®çš„ç›‘å¬
var observableNumber = observable.box(10)
var observableName = observable.box("tom")

autorun(()=>{
    console.log("numberæ”¹å˜äº†",observableNumber.get())
    console.log("nameæ”¹å˜äº†",observableName.get())
})

setTimeout(()=>{
    observableNumber.set(20)
},1000)

setTimeout(()=>{
    observableName.set("xiaoming")
},2000)
æµ‹è¯•ç»“æœï¼š
ç¬¬ä¸€æ¬¡æ‰“å°
tom 10
ä¸€ç§’é’Ÿå
tom 20
ä¸¤ç§’é’Ÿå
xiaoming 20 
    è¯´æ˜autorunåˆ¤æ–­è‡ªå·±å†…éƒ¨æœ‰æ•°æ®å˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨æŠŠè‡ªå·±å†…éƒ¨jsæ‰§è¡Œä¸€éã€‚æ‰€ä»¥é¡¹ç›®ä½¿ç”¨æ—¶ï¼Œè¦æ³¨æ„ã€‚
```

#### 4.2 å¯¹è±¡çš„ç›‘å¬æ–¹æ³•

ç¬¬ä¸€ç§ï¼šå£°æ˜å’Œä¿®æ”¹æ–¹æ³•

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

var myobj = observable.map({  // <----- é‡ç‚¹ å£°æ˜æ–¹æ³•
    name:"tom",
    age:100
})

autorun(()=>{
    console.log("å¯¹è±¡çš„nameå±æ€§æ”¹å˜äº†",myobj.get("name")) // <-----3såæ‰“å°ä¿®æ”¹åçš„å€¼xiaoming
})
setTimeout(()=>{
    myobj.set("name","xiaoming")  // <----- é‡ç‚¹  ä¿®æ”¹æ–¹æ³•
},3000)
```

ç¬¬äºŒç§ï¼šå£°æ˜å’Œä¿®æ”¹æ–¹æ³•

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

var myobj = observable({  // <----- é‡ç‚¹ å£°æ˜æ–¹æ³•
    name:"kerwin",
    age:100
})

autorun(()=>{
    console.log("å¯¹è±¡çš„nameå±æ€§æ”¹å˜äº†",myobj.name)
})
setTimeout(()=>{
    myobj.name= "xiaoming"   // <----- é‡ç‚¹  ä¿®æ”¹æ–¹æ³•
},1000)
```

### 5.é¡¹ç›®ä¸­ä½¿ç”¨é¡µé¢é…ç½®ï¼ˆæ— ES7è¯­æ³•ï¼‰

##### ç¬¬ä¸€ç§æ•°æ®ä¿®æ”¹æ— ç›‘ç®¡æƒ…å†µä¸‹  

ï¼ˆå„ä¸ªé¡µé¢éƒ½å¯ä»¥ä¿®æ”¹ï¼Œè¿‡äºéšæ„ï¼Œå‡ºç°bugï¼Œä¸å¥½æŸ¥æ‰¾ã€‚ï¼‰

store.js æ•°æ®ä»“åº“

```
import {observable, } from 'mobx'


const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",

})

export default store
```

App.js

ä½¿ç”¨ä»“åº“æ•°æ®   

```react
import React, { Component } from 'react'

import {autorun } from 'mobx'
import store from './mobx/store'  <--- é‡ç‚¹   å¼•å…¥ä»“åº“

class App extends Component { 
    state = {
        isShow:false
    }
    
    componentDidMount() {
        autorun(()=>{
            this.setState({
                isShow:store.isTabbarShow   <--- é‡ç‚¹   ä½¿ç”¨æ•°æ®å¹¶ä¿å­˜åˆ°ç»„ä»¶state
            })
        })
    }
    
    render() {
        return (
           <div>
                <MRouter>
                    {this.state.isShow && <Tabbar></Tabbar>} <--- é‡ç‚¹ 
                </MRouter>
           </div>
        )
    }
}

export default App

```

detail.js è¯¦æƒ…é¡µé¢

å¼•å…¥åŒä¸€ä¸ªæ•°æ®ä»“åº“ store,ç›´æ¥ä¿®æ”¹storeæ•°æ®

```
import React,{useEffect} from 'react'
import store from '../mobx/store'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
    
        store.isTabbarShow = false  <--- é‡ç‚¹ 
        return () => {
            console.log("destroy")
            store.isTabbarShow = true  <--- é‡ç‚¹ 
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}
```

##### ç¬¬äºŒç§æ•°æ®ä¿®æ”¹- ä¸¥æ ¼æ¨¡å¼

å¼€å¯ä¸¥æ ¼æ¨¡å¼ä¸‹  æ•°æ®ä¿®æ”¹åªèƒ½åœ¨storeä¸­æ³¨å†Œäº‹ä»¶ï¼Œå¦åˆ™æŠ¥é”™ã€‚

å¼€å¯æ–¹å¼

```react
å…³é”®ä»£ç ï¼š
import {observable,configure } from 'mobx'

const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",

})

configure({
    // enforceActions:'always'  å¼€å¯ä¸¥æ ¼æ¨¡å¼
    enforceActions:'never'  ä¸å¼€å¯
})
```

é¡µé¢ä½¿ç”¨çš„å‚æ•°é…ç½®   **configure**  **action** ä¸¥æ ¼æ¨¡å¼é…ç½®

store.jsé…ç½®

```react
import {observable,configure ,action } from 'mobx'

const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",
    changeShow(){
        this.isTabbarShow = true
    },
    changeHide(){
        this.isTabbarShow = false
    }
},{
    changeHide:action,
    changeShow:action //æ ‡è®°ä¸¤ä¸ªæ–¹æ³•æ˜¯actionï¼Œä¸“é—¨ä¿®æ”¹å¯è§‚æµ‹çš„value
})

configure({
    enforceActions:'always'
})

export default store
```

detail.jsè¯¦æƒ…é¡µé¢

```react
import React,{useEffect} from 'react'
import store from '../mobx/store'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
        // console.log("create")
       // store.isTabbarShow = false   
        store.changeHide()    <--- é‡ç‚¹  è°ƒç”¨æ–¹æ³•  ä¸èƒ½ç›´æ¥ä¿®æ”¹äº†
        return () => {
            console.log("destroy")

            //store.isTabbarShow = true
             store.changeShow()   <--- é‡ç‚¹  è°ƒç”¨æ–¹æ³•  ä¸èƒ½ç›´æ¥ä¿®æ”¹äº†
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}

```

### 6.å¼•å…¥Es7 è£…é¥°å™¨å†™æ³•ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰

#### è£…é¥°å™¨ï¼š

```java
è£…é¥°å™¨(Decorator)æ˜¯ES7çš„ä¸€ä¸ªè¯­æ³•ï¼Œæ˜¯ä¸€ç§ä¸ç±»ç›¸å…³çš„è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»çš„æ–¹æ³•ã€‚

è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆÂ @ +Â å‡½æ•°åã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢
class Store {
    @observable  isTabbarShow = true
    @observable  list = []

    @action changeShow(){   // @actionç›¸å½“äºä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠchangeShowæ–¹æ³•å…¥å‚ï¼Œåå‡ºæ¥ä¸€ä¸ªå¢å¼ºå‡½æ•°
        this.isTabbarShow = true
    }

    @action changeHide(){
        this.isTabbarShow = false
    }


è£…é¥°å™¨(Decorator) ä¹Ÿå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå…¶ä»–è¯­è¨€æ¯”å¦‚ Javaï¼ŒPythonç­‰å·²ç»å¾ˆæ—©å°±æœ‰äº†ï¼ŒES7ä¸­çš„è£…é¥°å™¨(Decorator)å€Ÿé‰´äº†å…¶ä»–è¯­è¨€çš„å†™æ³•ï¼Œä¸è¿‡ä¾èµ–äºES5çš„Object.definePropertyÂ æ–¹æ³• ã€‚
```

ä½¿ç”¨ES7è£…é¥°å™¨è¯­æ³•ï¼Œéœ€è¦é…ç½®ä»£ç ç¼–è¾‘å™¨vscode ,  é¡¹ç›®webpack è¯­æ³•loader,ç¼–è¯‘æˆæµè§ˆå™¨èƒ½è§£æçš„jsã€‚

##### ç¬¬ä¸€æ­¥ï¼š è°ƒæ•´vscode 

  è®©å®ƒä¸å†è®¤ä¸ºES7è£…é¥°å™¨æ˜¯ä¸ªè¯­æ³•é”™è¯¯

â€‹      ç‚¹å‡» å·¦ä¸Šè§’ æ–‡ä»¶ --ã€‹  é¦–é€‰é¡¹ --ã€‹ è®¾ç½® è¾“å…¥experimentalDecorators   é€‰ä¸­åï¼Œé€€å‡ºã€‚

##### ç¬¬äºŒæ­¥ï¼š webpacké…ç½®

1.

```
npm i @babel/core @babel/plugin-proposal-decorators @babel/preset-env
```

2.

**æ ¹ç›®å½•ä¸‹åˆ›å»º** **.babelrc**  é…ç½®å¦‚ä¸‹

```
{
    "presets": [
        "@babel/preset-env"
    ],
    "plugins": [
        [
            "@babel/plugin-proposal-decorators",
            {
                "legacy": true
            }
        ]
    ]
}
```

3.

**æ ¹ç›®å½•ä¸‹åˆ›å»º** **conï¬g-overrides.js ** é…ç½®å¦‚ä¸‹

```
const path = require('path')
const { override, addDecoratorsLegacy } = require('customize-cra')

function resolve(dir) {
    return path.join(__dirname, dir)
}

const customize = () => (config, env) => {
    config.resolve.alias['@'] = resolve('src')
    if (env === 'production') {
        config.externals = {
            'react': 'React',
            'react-dom': 'ReactDOM'
        }
    }

    return config
};


module.exports = override(addDecoratorsLegacy(), customize())
```

4.

è‡ªå®šä¹‰è¦†ç›–webpacké…ç½®

```
npm i customize-cra react-app-rewired
```

ä½œç”¨ï¼šä½¿ç”¨è‡ªå·±é…ç½®çš„å¯åŠ¨æ–¹å¼

5.

ä¿®æ”¹package.json

```json
åŸæ¥    å¯åŠ¨å‘½ä»¤æ˜¯è„šæ‰‹æ¶çš„å¿«æ·å¯åŠ¨
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
 æ”¹ä¸ºä¸‹é¢
  "scripts": {
    "start": "react-app-rewired start",
    "build": "react-app-rewired build", 
    "test": "react-app-rewired test", 
    "eject": "react-app-rewired eject" // è¿™ä¸ªå‘½ä»¤æ˜¯å§é…ç½®æš´éœ²å‡ºæ¥ æ“ä½œä¸å¯é€† æ…ç”¨
 },
...
 ä¿®æ”¹çš„ç›®çš„ï¼š å¯åŠ¨æ—¶è¦†ç›–åŸæ¥çš„å¯åŠ¨æ–¹å¼ï¼Œè®©é¡¹ç›®è¯»å–.babelrc å’Œconfig-overridesé‡å†™é…ç½®ï¼› ç„¶åå†å¼€å¯æœåŠ¡
  
  
```

##### é…ç½®åé¡¹ç›®å†™æ³•

è€å†™æ³•

```
import {observable,configure ,action } from 'mobx'

const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",
    changeShow(){
        this.isTabbarShow = true
    },
    changeHide(){
        this.isTabbarShow = false
    }
},{
    changeHide:action,
    changeShow:action //æ ‡è®°ä¸¤ä¸ªæ–¹æ³•æ˜¯actionï¼Œä¸“é—¨ä¿®æ”¹å¯è§‚æµ‹çš„value
})

configure({
    enforceActions:'always'
})

export default store
```

æ–°å†™æ³•ï¼ˆè¿™ç§æ›´ç®€æ´ï¼‰

```react
import {observable,configure ,action } from 'mobx'
    configure({
        enforceActions:'always'
    })

 class Store {
    @observable  isTabbarShow = true    
    @observable  list = []

    @action changeShow(){
        this.isTabbarShow = true
    }

    @action changeHide(){
        this.isTabbarShow = false
    }
    
const store = new Store()
export default store    
```

##### Mobxå¯¹å¼‚æ­¥çš„å¤„ç†

store.js

runInAction æ ¸å¿ƒæ–¹æ³•

```react
import {observable,configure ,action ,runInAction} from 'mobx'
import axios from 'axios'

configure({
    enforceActions:'always'  ä¸¥æ ¼æ¨¡å¼
})


class Store {
    @observable  isTabbarShow = true
    @observable  list = []

    @action changeShow(){
        this.isTabbarShow = true
    }

    @action changeHide(){
        this.isTabbarShow = false
    }

    @action async getList(){
        var list = await axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                'X-Host': 'mall.film-ticket.cinema.list'
            }
        }).then(res=>{
            // console.log(res.data.data.cinemas)
           return res.data.data.cinemas
        })

        runInAction(()=>{   <--- é‡ç‚¹  å¤„ç†å¼‚æ­¥
            this.list = list
        })
    }
}

const store = new Store()
export default store
```

detail.jsè¯¦æƒ… ä½¿ç”¨é¡µé¢

```react
import React,{useEffect ,useState} from 'react'

import store from '../mobx/store'
import {autorun} from 'mobx'

export default function Cinemas(props) {

const [cinemaList,setCinemaList] = useState([])

    useEffect(() => {
        if(store.list.length===0){
            store.getList()
        }
        
        var unsubscribe  = autorun(()=>{
            console.log(store.list,store.isTabbarShow)

            setCinemaList(store.list)
        })

        return ()=>{
            //å–æ¶ˆè®¢é˜…ï¼Ÿ
            unsubscribe()  <--- é‡ç‚¹  å¤„ç†å¤šæ¬¡æ³¨å†Œç›‘å¬
        }

    }, [])

    return (
        <div>
            {
    cinemaList.map(item=>
              <dl key={item.cinemaId} style={{padding:"10px"}}>
                  <dt>{item.name}</dt>
                   <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                  </dl>    
                    )
            }
        </div>
    )
}
```

#### 7.mobx-react çš„ä½¿ç”¨

åŠŸèƒ½ï¼šç®€åŒ–mobx, è¾¾åˆ°ä¸ç”¨autorunç›‘å¬ï¼Œå’Œå–æ¶ˆç›‘å¬çš„æ“ä½œ   å³å¯è·å–æ•°æ®ã€‚

```
npm i mobx-react@5   // ç¨³å®šç‰ˆæœ¬
```

  é¡¹ç›®æ”¹é€ å¦‚ä¸‹

###### index.jsï¼ˆå‡½æ•°å¼ç»„ä»¶å’ŒClassç»„ä»¶ä¸­ è¿™ä¸ªéƒ½æ˜¯ä¸€æ ·çš„é…ç½®ï¼‰

```
import React from 'react'
import ReactDOM from 'react-dom'

import App from './10-mobx/04-router/App'

import {Provider}  from 'mobx-react'
import store from './10-mobx/04-router/mobx/store'

æ„å»ºä¸€ä¸ª çˆ¶ç»„ä»¶ -é«˜é˜¶ç»„ä»¶mobx-react
ReactDOM.render(
    // <React.StrictMode>
    <Provider store={store}>    <--- é‡ç‚¹ åŠ çˆ¶ç»„ä»¶ æ³¨å…¥storeæ•°æ®
        <App/>
    </Provider>
    
    // </React.StrictMode>
    ,document.getElementById("root"))
```

###### appå‡½æ•°å¼ç»„ä»¶

app.js ç»„ä»¶ï¼Œç›´æ¥å˜æˆæ— çŠ¶æ€ç»„ä»¶

```react
import React, { Component } from 'react'
import MRouter from './router/IndexRouter'
import Tabbar from './components/Tabbar'
import './views/css/App.css'

import { inject, observer } from 'mobx-react'

//æ„å»ºä¸€ä¸ª çˆ¶ç»„ä»¶ -é«˜é˜¶ç»„ä»¶mobx-react
@inject("store")  // æ³¨å…¥æ•°æ®
@observer  //æ„å»ºçˆ¶ç»„ä»¶  é«˜é˜¶ç»„ä»¶ åŒ…è£…appç»„ä»¶
class App extends Component {

    componentDidMount() {
        console.log(this.props.store.isTabbarShow)
    }
    render() {
        return (
           <div>
                {/* å…¶ä»–çš„å†…å®¹ */}
                <MRouter>
                    {this.props.store.isTabbarShow && <Tabbar></Tabbar>}
                </MRouter>
           </div>
        )
    }
}

export default App
```

###### ç±»ç»„ä»¶ä¸­ä½¿ç”¨

è°ƒæ•´ç‚¹ï¼š å¼•å…¥Observerç»„ä»¶ï¼Œ ç»„ä»¶å†…çš„jsxä»¥ç®­å¤´å‡½æ•°ï¼Œè¿”å›ã€‚

```react
import React, { useEffect, useState } from 'react'

import { Observer } from 'mobx-react'
import store from '../mobx/store'
export default function Cinemas(props) {

    useEffect(() => {
        if (store.list.length === 0) {
            store.getList()
        }
        return () => {
            //å–æ¶ˆè®¢é˜…ï¼Ÿ
        }
    }, [])

    return (
        <div>
                  {/* // å‡½æ•°å¼ç»„ä»¶ä¸­ Observeræ‰§è¡Œç›‘å¬å’Œå–æ¶ˆç›‘å¬çš„æ–¹æ³• */}
            <Observer>  
            {() => {
                    return store.list.map(item =>
                        <dl key={item.cinemaId} style={{ padding: "10px" }}>
                            <dt>{item.name}</dt>
                            <dd>{item.address}</dd>
                        </dl>
                    )
                }
                }
            </Observer>

        </div>
    )
}
```

é¡¹ç›®ä½¿ç”¨ä¸­å‡ºç°çš„é—®é¢˜ï¼š

ç¬¬ä¸€ä¸ªï¼šæŠ¥é”™

```
Plugin "react" was conflicted between "package.json
```

è§£å†³

```
npm install eslint-config-react eslint-plugin-react --save-dev //react ä¸¤æ–¹è§£æå†²çª
```

[å‚çœ‹](https://blog.csdn.net/ARandeCSDN/article/details/131604929)





## åå…­ TSä¸‹çš„react

### 1.ç®€ä»‹

TSå¯¹é¡¹ç›®çš„å¸®åŠ©

ä¸¾ä¾‹ï¼š

```
é¡¹ç›®ä¸­jså†™
let str = "tom";
   str.map(...) 
åƒè¿™æ ·çš„è¯­æ³•é”™è¯¯ï¼Œwebpackç¼–è¯‘å™¨æ˜¯å‘ç°ä¸äº†çš„ï¼Œ å®ƒæ­£å¸¸ç¼–è¯‘ï¼Œç„¶åæ‰“å¼€æµè§ˆå™¨ï¼Œæ‰ä¼šæŠ¥é”™ã€‚è¿™ç§è¯­æ³•å‘ç°æ—¶æœºæ˜æ˜¾å»¶åï¼Œä¸ºäº†åœ¨ä»£ç ç¼–å†™è¿‡ç¨‹ä¸­ï¼Œ æå‰å‘ç°è¯­æ³•é”™è¯¯ã€‚ å¯ä»¥ä½¿ç”¨TSã€‚ typeScript
```

å®˜ç½‘

https://zhongsp.gitbooks.io/typescript-handbook/content/doc/handbook/

æ€»ç»“ï¼š

\1.    TypeScript  çš„å®šä½æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåœ¨å†™ä»£ç é˜¶æ®µå°±èƒ½æ£€æŸ¥é”™è¯¯ï¼Œè€Œéè¿è¡Œé˜¶æ®µ

\2.    ç±»å‹ç³»ç»Ÿæ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œå¢åŠ äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

\3.    æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œéœ€è¦ç†è§£æ¥å£ï¼ˆInterfacesï¼‰ã€æ³›å‹ï¼ˆGenericsï¼‰ã€ç±»ï¼ˆClassesï¼‰ç­‰

\4.    tsæœ€åè¢«ç¼–è¯‘æˆjs



åˆ›å»ºTSç‰ˆreacté¡¹ç›®

```
create-react-app my-app --template typescript

é¡¹ç›®åˆ›å»ºä¹‹åˆå°±è¦ç¡®å®šé€‰å‹ï¼ŒTSå’Œjsè¿˜æ˜¯ä¸ä¸€æ ·çš„ã€‚
```

é¡¹ç›®åˆ›å»ºå¯èƒ½ä¼šç¢°åˆ°çš„é—®é¢˜ï¼š

vscode å¯¹TSæœ‰æ³¢æµªçº¿æç¤ºé”™è¯¯ï¼Œ ä¸èƒ½è§£æã€‚

æ–¹æ³•ï¼š1.æ›´æ–°vscodeç‰ˆæœ¬  2.reactä¸­æœ‰TSä¾èµ–åŒ…ï¼Œcontro+shift+p é€‰æ‹©ä½¿ç”¨å·¥ä½œåŒºç‰ˆæœ¬TSåº“ã€‚

### å£°æ˜

ä½œç”¨ï¼š

ä¾‹å¦‚ **import {HashRouter,Route,Redirect,Switch} from 'react-router-dom'** è¿™äº›æ–¹æ³•ï¼Œæ˜¯è¿è¡Œç§è·å–çš„æ–¹æ³•ï¼Œåœ¨ä»£ç ç¼–å†™è¿‡ç¨‹ç§ï¼ŒTSä¼šè®¤ä¸ºæ˜¯é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ ¹ç›®å½•ç§å†™ä¸€ä¸ªè¯´æ˜ï¼Œå‘Šè¯‰TSï¼Œè¿™ä¸ªå†™æ³•æ˜¯æ­£å¸¸çš„ï¼Œä¸è¦æŠ¥é”™æç¤ºã€‚mdè¯´æ˜æ–‡æ¡£ï¼Œä¸€èˆ¬æ’ä»¶éƒ½æœ‰å¯¹åº”æ¨¡æ¿ï¼Œnpmå¼•å…¥å³å¯ï¼Œå¥½å¤„å°±æ˜¯åœ¨ä½ å†™ä»£ç é˜¶æ®µï¼ˆè¿˜æ²¡æœ‰ä¿å­˜æ–‡ä»¶æ—¶ï¼‰ï¼Œå†™é”™å­—æ¯ï¼Œä»–ä¼šæç¤ºä½ æ²¡æœ‰è¯¥å±æ€§ï¼Œå¹¶æç¤ºæ­£ç¡®çš„å±æ€§æˆ–æ–¹æ³•ã€‚

 ```
import {HashRouter,Route,Redirect,Switch} from 'react-router-dom'
  <HashRouter>
                <Switch>
                    <Route path="/film" component={Film}/> //æ£€éªŒæœ‰å’©æœ‰path  å¦‚æœä½ å†™æˆäº†pethä¼šæç¤ºé”™è¯¯
 ```



![](D:\MDæ–‡ä»¶+mybaseæ•°æ®åº“+æ€ç»´å¯¼å›¾\mdç¬”è®°  ç¬”è®°æ±‡æ€»\MDgiteeåœ¨çº¿ç¬”è®°\react\img\TSä»£ç è·¯ç”±æç¤º.png)

```
1.	å¯ä»¥åœ¨å½“å‰æ–‡ä»¶åŠ ä¸Šdeclare const $: any;
2.	å®‰è£… npm i @types/jquery @typesæ˜¯npmçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œç”¨æ¥å­˜æ”¾*.d.tsæ–‡ä»¶
npm i --save react-router-dom
npm i --save @types/react-router-dom //ç¼–è¯‘å™¨éœ€è¦é€šè¿‡è¿™ä¸ªå£°æ˜æ–‡ä»¶ï¼Œè¿›è¡Œç±»å‹æ£€æŸ¥å·¥ä½œ


```

å®é™…å¼€å‘ç§ç¢°åˆ°äº†å¦‚ä¸‹é—®é¢˜ï¼š

https://blog.csdn.net/qq_39189369/article/details/126944641



### 2.å˜é‡å£°æ˜

##### å­—ç¬¦ä¸²ï¼Œ æ•°å­—ï¼Œ å¸ƒå°”

```
// å­—ç¬¦ä¸²ï¼Œ æ•°å­—ï¼Œ å¸ƒå°”ï¼Œ

 var myname:string = "kerwin" //æ¨èå†™æ³• å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²   
 myname.substring(0,1)  // å¦‚æœmynameä¸Šä½¿ç”¨æ•°å­—çš„æ–¹æ³•ï¼Œå°†æŠ¥é”™ã€‚

var type = "123"   //åˆæ¬¡å£°æ˜çš„å˜é‡ç±»å‹å°†é»˜è®¤ä¸ºåŸºå‡† åç»­å†ä¿®æ”¹ç±»å‹   ä¼šæç¤ºæŠ¥é”™
type = 40  //æŠ¥é”™


 var myage:number = 100  //æ¨èå†™æ³• å£°æ˜ä¸€ä¸ªæ•°å­—
 myage.toFixed(1)

 var myshow:boolean = true  //æ¨èå†™æ³• å£°æ˜ä¸€ä¸ªå¸ƒå°”
 myshow = false 

 var my:string | number  ="kerwin"  //å˜é‡å¯ä»¥æ˜¯æ•°å­—æˆ–å­—ç¬¦ä¸²
 my = 100

 var myany:any = 100  //å˜é‡å¯ä»¥æ˜¯ä»»æ„å€¼

 export default {}
```

##### æ•°ç»„

```
var list1:string[] = ["1","2","3",4]  //å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²å‹çš„æ•°ç»„ 4æ˜¯ä¸ªæ•°å­—  æç¤ºæŠ¥é”™
list1.push("daa") //æ·»åŠ ä¸€ä¸ªé¡¹  å­—ç¬¦ä¸²å¯ä»¥
// list.push(4)  //æ·»åŠ ä¸€ä¸ªé¡¹  æ•°å­—ç±»å‹ä¸å¯ä»¥

var list2:number[] = [1,2,3]   //å£°æ˜ä¸€ä¸ªæ•°å­—å‹çš„æ•°ç»„
list2.push(5) // å¯ä»¥

var list3:(number | string)[] = [1,2,"aa","bbb"]//å£°æ˜ä¸€ä¸ª åŒ…å«æ•°å­—æˆ–å­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„
list3.push("aaaa")  //å­—ç¬¦ä¸²  å¯ä»¥

-----------------------------èŒƒå‹-----å¦ä¸€ç§å†™æ³•---------------------------------
var mylist1:Array<string> = ["aa","bb","cc"]   //å£°æ˜å­—ç¬¦ä¸²æ•°ç»„
mylist1.push("dw")

var mylist2:Array<string|number> = [1,2,"aaa"]  //å£°æ˜å­—ç¬¦ä¸²æˆ–æ•°å­—ä¸¤ç§ç±»å‹çš„æ•°ç»„
mylist2.push(3)  å¯ä»¥
mylist2.push(â€˜44â€™) å¯ä»¥
```

##### å¯¹è±¡

æ¥å£æ¦‚å¿µ:    æ¥å£æè¿°ä¸€ä¸ªå½¢çŠ¶ï¼Œä¸€ä¸ªè§„èŒƒã€‚ å…³é”®å­— **interface**ï¼ˆn.ï¼ˆäººæœºï¼‰ç•Œé¢  v.ï¼ˆé€šè¿‡ç•Œé¢æˆ–æ¥å£ï¼‰è¿æ¥ï¼‰

```
// å¯¹è±¡  æ¥å£
 interface IObj {
     name:string,
     age:number,
     location?:string,   //  å¯é€‰å±æ€§
     [propName:string]:any //propName å…¶ä½™å±æ€§çœç•¥ å€¼ ä»»æ„ 
 }


 var obj1:IObj = {  //æ¥å£ä½¿ç”¨
     name:"kerwin",  //å­—ç¬¦ä¸²
     age:100,  //æ•°å­—
     
     location:"å¤§è¿", //å¯å†™å¯ä¸å†™
     
     grade: "7.7",      //ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
    isPresale: true, //ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
    isSale: false,//ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
    item: {name: "4D", type: 13},//ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
 }
 
console.log(obj1.location) //ä½¿ç”¨æ²¡æœ‰çš„keyã€‚ä¼šæç¤º
```

##### å‡½æ•°

```
// æ¡ˆä¾‹1 å£°æ˜ä¸€ä¸ªtest1æ–¹æ³•  å…¥å‚a å­—ç¬¦ä¸² b å­—ç¬¦ä¸² c å¯é€‰ æ•°å­—  è¿”å›å€¼ï¼šå­—ç¬¦ä¸²
 function test1(a:string,b:string,c?:number):string{
    console.log(a.substring(0,1)+b.substring(0,1))

    return a.substring(0,1)+b.substring(0,1)
 }

 var myname:string = test1("aaa","bbb",100) // è°ƒç”¨
 console.log(myname)

 //---------------------------------

// æ¡ˆä¾‹2  ä¸ºæ–¹æ³• åˆ›å»ºæ¥å£ å…¥å‚a å­—ç¬¦ä¸² b å­—ç¬¦ä¸² c å¯é€‰ æ•°å­—  è¿”å›å€¼ï¼šå­—ç¬¦ä¸²
 interface IFunc{(a:string,b:string,c?:number):string}

//    å£°æ˜ä¸€ä¸ªmyfunc2ä½¿ç”¨IFuncæ¥å£é™åˆ¶
 var myfunc2:IFunc = function test1(a:string,b:string,c?:number):string{
    console.log(a.substring(0,1)+b.substring(0,1))

    return a.substring(0,1)+b.substring(0,1)
 }


// æ¡ˆä¾‹3 åˆ›å»ºä¸€ä¸ªæ¥å£  åŒ…å«å±æ€§å’Œæ–¹æ³•
 interface Iobj {
     name:string,
     age:number,
     getName:(name:string)=>string
 }
// æ¡ˆä¾‹3 å£°æ˜ä¸€ä¸ªå¯¹è±¡ ä½¿ç”¨æ¥å£Iobj
 var obj:Iobj = {
     name:"kerwin",
     age:100,
     getName:(name:string)=>{
         return name
     }
 }

 var name:string =  obj.getName("aaaa")//å…¥å‚ä¸æ˜¯å­—ç¬¦ä¸²çš„è¯æç¤ºé”™è¯¯
console.log(name)
export default {}
```





##### ç±» æ™®é€šç±»

```
class Bus {
    public name = "kerwin" //å…±æœ‰å±æ€§
    private _list: any = [] //ç§æœ‰å˜é‡   _ä¸‹åˆ’çº¿  å›å­åå®š é»˜è®¤ä¸ºç§æœ‰å˜é‡

    protected age = 100   //å­©å­å¯ä»¥ä½¿ç”¨
    public subscribe(cb: any) { // è®¾ç½®ä¸ºå…±æœ‰æ–¹æ³•
        this._list.push(cb)
    }

    public dispatch() {  // è®¾ç½®ä¸ºå…±æœ‰æ–¹æ³•
        this._list.forEach((cb: any) => {
            cb && cb()
        })
    }
}


class Child extends Bus {

    aaa() {
        console.log(this.name, this.age) //é™¤äº†Busçš„ç§æœ‰ å…¶ä»–å¯ä»¥ä½¿ç”¨
    }
}

var obj = new Bus()  //é™¤äº†Busçš„ç§æœ‰ å…¶ä»–å¯ä»¥ä½¿ç”¨
obj.subscribe(() => {

})

console.log(obj.name)
//  obj._list = [] // ä¸‹åˆ’çº¿ä¹Ÿå¯ä»¥ä½¿ç”¨  é™¤éåŠ äº†å±æ€§privateé™åˆ¶
//  console.log(obj._list)


export default {}
```

##### ç±»+æ¥å£

```react
// 1. åˆ›å»ºä¸€ä¸ªæ¥å£  è¦æ±‚ä½¿ç”¨æœ¬æ¥å£çš„å¯¹è±¡ å¿…é¡»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•
 interface Ifunc {
    getName:()=>string,  //å¹¶ä¸” è¿”å›å€¼ ä¸ºå­—ç¬¦ä¸²
    getAge:()=>number //å¹¶ä¸” è¿”å›å€¼ ä¸ºæ•°å­—
}

class A implements Ifunc{ // å£°æ˜ä¸€ä¸ªç±» å®ç°ï¼ˆimplementsï¼‰æ¥å£Ifunc
    getAge(){
        return 100
    }
    a1(){

    }

    a2(){

    }

    getName(){
        return "AAA"
    }
}

class B implements Ifunc{ // å£°æ˜ä¸€ä¸ªç±» å®ç°ï¼ˆimplementsï¼‰æ¥å£Ifunc
    getAge(){
        return 100
    }
    b1(){

    }

    b2(){

    }

    getName(){
        return "CCC"
    }
}

class C implements Ifunc{ // å£°æ˜ä¸€ä¸ªç±» å®ç°ï¼ˆimplementsï¼‰æ¥å£Ifunc
    getAge(){
        return 100
    }
    getName(){
        return "CCC"
    }
}

function init(obj:Ifunc){ //åˆ›å»ºä¸€ä¸ªå‡½æ•°  å…¥å‚objéœ€è¦ç¬¦åˆæ¥å£Ifuncçš„å½¢çŠ¶
    obj.getName()
    obj.getAge()
}
var objA = new A()
var objB = new B()
var objC = new C()

init(objA)
init(objB)
init(objC)
```

###### å‡½æ•°çš„å‚æ•°åä¸éœ€è¦ä¸æ¥å£é‡Œå®šä¹‰çš„åå­—ç›¸åŒ¹é…

```
interface SearchFunc { (source: string, subString: string): boolean; } //å®šä¹‰æ¥å£å½¢çŠ¶

    //å¯¹äºå‡½æ•°ç±»å‹çš„ç±»å‹æ£€æŸ¥æ¥è¯´ï¼Œå‡½æ•°çš„å‚æ•°åä¸éœ€è¦ä¸æ¥å£é‡Œå®šä¹‰çš„åå­—ç›¸åŒ¹é…ã€‚ 
    let mySearch: SearchFunc; //ä½¿ç”¨æ¥å£
   mySearch = function(src: string, sub: string): boolean { //å®šä¹‰æ–¹æ³•
          let result = src.search(sub);
          return result > -1;
    }
    
  console.log(mySearch('1234','2'))//ä½¿ç”¨è¢«å®šä¹‰å…¥å‚ç±»å‹çš„æ–¹æ³•
```

###### ä¼ å‚ å‰©ä½™å‚æ•°

```
function Test(list:String[],text?:String,...args:String[]):void{ 

    console.log(list,text,args)
}

// Test(["1111","2222"])
//æ‰“å°ç»“æœ list:["1111","2222"] text: undefined args: []

Test(["0","1"],"a","b","c")

//æ‰“å°ç»“æœ ["0","1"] , "a" , ["b","c"]

```

###### ç±»å‹æ–­è¨€  as

æ–­è¨€: å…¶å®å°±æ˜¯å‘Šè¯‰ TS, æˆ‘çŸ¥é“æˆ‘è‡ªå·±åœ¨åšä»€ä¹ˆ, ä¸è¦ä½ ç®¡

 ç¬¬ä¸€ç§æƒ…å†µ å­—é¢é€»è¾‘åˆ¤æ–­ ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼‰

```
function Test( mytext:string|number ){

    console.log((mytext as string).length) //å¯¹ console.log((mytext as any).length) //å¯¹
    // console.log((mytext as string[]).length) //é”™ï¼ŒåŸå£°æ˜æ²¡æœ‰è¿™ä¸ªç±»å‹ï¼Œæ— æ³•æ–­è¨€
    }
    Test("111")
```

ç¬¬äºŒç§æƒ…å†µï¼š

æ–­è¨€è§£å†³çš„ç—›ç‚¹å°±æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ TS çš„å¼€å‘è¿‡ç¨‹ä¸­, TS ä¼šè¯†åˆ«æˆ‘ä»¬å†™çš„æ‰€æœ‰çš„å†…å®¹, ç„¶åä¼šå‚»å‚»çš„æ ¹æ®ä»£ç å»è¯†åˆ«ä½ å†™çš„å†…å®¹ï¼Œä»£ç è¿è¡Œä¸­çš„çŠ¶æ€ï¼Œå®ƒæ„ŸçŸ¥ä¸åˆ°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦æ–­è¨€ è¿›è¡Œå¹²é¢„ã€‚

```
const box = document.querySelector('.box')
console.log(box.innerHTML) // è¿™ä¸€è¡ŒæŠ¥é”™  æˆ‘ä»¬ç¡®å®šä»£ç è¿è¡Œèµ·æ¥åè‚¯å®šæœ‰è¿™ä¸ªæ–¹æ³•
```

èŒƒå‹

```
< >
```



#### 3.class ç±»ç»„ä»¶-TSï¼ˆåŒ–çš„å˜åŒ–ç‚¹ï¼‰

#### state

```react
import React, { Component } from 'react'
interface IState {
    name:string
}                                         <çº¦å®šå±æ€§ï¼Œçº¦å®šçŠ¶æ€>
//æ ¹ç»„ä»¶ ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¼ any è¡¨ç¤ºä¸æ¥å— æˆ–ä¸éœ€è¦props
export default class App extends Component<any,IState> { // ç¬¬ä¸€ä¸ªå‚ï¼špropså±æ€§ ç¬¬äºŒä¸ªçŠ¶æ€

    state = {
        name:"kerwin" // é™åˆ¶nameåªèƒ½æ˜¯å­—ç¬¦ä¸²
    }
    render() {
        return (
            <div>
                app-{this.state.name.substring(0,1).toUpperCase()+this.state.name.substring(1)}
                <button onClick={()=>{
    
                    this.setState({
                        name:"xiaomnig" //é™åˆ¶å­—ç¬¦ä¸² å¦åˆ™æŠ¥é”™ æç¤ºä¸èƒ½å°†Numberåˆ†é…ç»™string
                    })
                }}>click</button>
            </div>
        )
    }
}
```

#### Ref

æ–­è¨€domèŠ‚ç‚¹

```
import React, { Component } from 'react'
interface IState {
    text:string,
    list:string[]
}
export default class App extends Component<any,IState> {
    state = {
        text:"",
        list:[]
    }
    myref = React.createRef<HTMLInputElement>() // èŒƒå‹ å‘Šè¯‰TSè¿™æ˜¯å„å¼‚inputæ ‡ç­¾èŠ‚ç‚¹
    render() {
        return (
            <div>

                <input ref={this.myref}/>
                <button onClick={()=>{
                    // console.log(this.state.text)

 console.log( (this.myref.current as HTMLInputElement).value)//æ–­è¨€å‘Šè¯‰TSç¡®å®šè¿™æ˜¯ä¸€ä¸ªdomèŠ‚ç‚¹ç±»å‹ ä¸ä¼šæ˜¯nullæˆ–æ˜¯undefined

 this.setState({
list:[...this.state.list,(this.myref.current as HTMLInputElement).value]
                    })
                }}>click</button>

                {
                    this.state.list.map(item=>
                        <li key={item}>{item}</li>
                    )
                }
            </div>
        )
    }
}

```

#### props

æ¡ˆä¾‹ï¼šæ¼”ç¤ºå­ç»„ä»¶

```
import React, { Component } from 'react'

export default class App extends Component {
    render() {
        return (
            <div>
                <Child name="bbbb"/>
            </div>
        )
    }
}

interface IProps {//å£°æ˜æ¥å£å½¢çŠ¶
    name:string
}

class Child extends Component<IProps,any>{ //ä½¿ç”¨
    render(){
        return <div>
            child-{this.props.name}
        </div>
    }
}
```

æ¡ˆä¾‹2

å­ç»„ä»¶ props

```react
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        isShow:true
    }
    render() {
        return (
            <div>
                app
                <Navbar title="é¦–é¡µ" cb={()=>{
                    console.log("1111")
                    this.setState({
                        isShow:!this.state.isShow
                    })
                }}/>

                {this.state.isShow && <Sidebar></Sidebar>}
            </div>
        )
    }
}
interface IProps {
    title:string,
    cb:()=>void //æ— è¿”å›å€¼ æ— æ•ˆå€¼
}

class Navbar extends Component<IProps,any>{
    render(){
        return <div>
            navbar-{this.props.title}
            <button onClick={()=>{
                this.props.cb()
            }}>click</button>
        </div>
    }
}

class Sidebar extends Component{
    render(){
        return <div>
            sidebar
        </div>
    }
}
```

#### 4å‡½æ•°å¼ç»„ä»¶TSåŒ–

##### state

```
import {useState} from 'react'

export default function App() {
    const [name, setname] = useState<string>("kerwin")
    return (
        <div>
            app-{name.substring(0,1).toUpperCase()+name.substring(1)}
            <button onClick={()=>{
                setname("xiaoming")
            }}>click</button>
        </div>
    )
}

```

##### Ref

```
import {useRef,useState} from 'react'

export default function App() {
    const mytext= useRef<HTMLInputElement>(null) // refå½¢å¼èŠ‚ç‚¹ç±»å‹çš„æ¥å£å†™æ³•
    const [list, setlist] = useState<string[]>([]) // å­—ç¬¦ä¸²å½¢å¼æ•°ç»„æ¥å£å†™æ³•
    return (
        <div>
            <input ref={mytext}/>

            <button onClick={()=>{
                console.log((mytext.current as HTMLInputElement).value) //æ–­è¨€

                setlist([...list,(mytext.current as HTMLInputElement).value])
            }}>click</button>

            {
                list.map(item=>
                <li key={item}>{item}</li>    
                )
            }
        </div>
    )
}

```

##### props

```react
import React from 'react'

export default function App() {
    return (
        <div>
            app
            <Child name="aaa"/>
        </div>
    )
}
interface IProps {//æ¥å£
    name:string
}

 function Child(props:IProps){
     return <div>child-{props.name}</div>
 }

// ä½¿ç”¨React.FunctionComponent<P={}>æ¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ç®€å†™React.FC<P={}>ã€‚ å®ƒæ˜¯åœ¨tsä¸­ä½¿ç”¨çš„ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå¯ä»¥æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°è¡¨ç¤ºpropsçš„ç±»å‹ï¼Œè¿™ä¸ªå‚æ•°ä¸æ˜¯å¿…é¡»çš„
//è¿™æ˜¯ä¸€ç±»ç»„ä»¶å†™æ³•
const Child:React.FC<IProps> = (props)=>{
    return <div>child-{props.name}</div>
}
```

æ¡ˆä¾‹2

```
import {useState} from 'react'

export default function App() {
    const [isShow, setisShow] = useState(true)
    return (
        <div>
            <Navbar cb={()=>{
                console.log("11111")
                setisShow(!isShow)
            }}/>
            {isShow && <Sidebar/>}
        </div>
    )
}
interface IProps {
    title?:string, //å¯é€‰
    cb:()=>void
}

function Navbar(props:IProps){
    return <div>
        navbar-<button onClick={()=>{
            props.cb()
        }}>click</button>
    </div>
}

function Sidebar(){
    return <div>
        sidebar
    </div>
}

```

#### 5 è·¯ç”±TSåŒ–

å‡ºç°é—®é¢˜ï¼š

åŸæ¥è·¯ç”±çš„ä¸€äº›å†™æ³• ï¼ŒTSä¸‹ä¼šç›´æ¥æŠ¥é”™

```
import {HashRouter,Route,Redirect,Switch} from 'react-router-dom' //ä»£ç å­—é¢ä¸ŠTSæ— æ³•è·çŸ¥è¿™ä¸ªé‡Œé¢æœ‰æ²¡æœ‰HashRouterè¿™äº›æ–¹æ³•ï¼Œ å› ä¸ºè¿™éƒ½æ˜¯è¿è¡Œç§å¼•å‡ºçš„æ–¹æ³•ã€‚æ‰€ä»¥å°±éœ€è¦ç»™TSå†™å‡ºä¸€ä¸ªè¯´æ˜æ–‡æ¡£

import ReactDOM from 'react-dom/client';
```

æ¡ˆä¾‹1

```
import React, { Component } from 'react'
import {RouteComponentProps} from 'react-router-dom'//æ’ä»¶æä¾›äº†ä¸€ä¸ªè·¯ç”±èŒƒå‹ï¼Œå¹¶ä¸”è¯¥èŒƒå‹æ¥å—è‡ªå®šä¹‰èŒƒå‹

interface IParam{ // è‡ªå®šä¹‰èŒƒå‹
    myid:string
}
export default class Detail extends Component<RouteComponentProps<IParam>> { 
    componentDidMount() {
        console.log(this.props.match.params.myid)
    }
    
    render() {
        return (
            <div>
                Detail
            </div>
        )
    }
}

```

æ¡ˆä¾‹2

```
import React, { Component } from 'react'
import axios from 'axios'
import {RouteComponentProps} from 'react-router-dom'//å¼•å‡ºæ’ä»¶æä¾›çš„èŒƒå‹

interface IItem {//å£°æ˜èŒƒå‹
    filmId:number,
    name:string
}

// interface IProps{
//     history:any
// }
export default class Film extends Component<RouteComponentProps,any> {
    state = {
        list:[]
    }
    componentDidMount() {
        axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&pageNum=1&pageSize=10&type=1&k=5420934",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.2.0","e":"16395416565231270166529"}',
                'X-Host': 'mall.film-ticket.film.list'
                
            }
        }).then((res:any)=>{
            this.setState({
                list:res.data.data.films
            })
        })
    }
    
    render() {
        return (
            <div>
                <ul>
                    {
                        this.state.list.map( (item:IItem)=>
                        <li key={item.filmId} onClick={()=>{

                            this.props.history.push(`/detail/${item.filmId}`)
                        }}>{item.name}</li>    
                        )
                    }
                </ul>
            </div>
        )
    }
}

```

#### 6.è·¯ç”±routerTSåŒ–

```
import {createStore} from 'redux'

interface IAction {
    type:string,
    payload?:any
}

interface IState{
    isShow:boolean
}
const reducer = (
        prevState:IState={ isShow:true} <--- é‡ç‚¹
        ,action:IAction  <--- é‡ç‚¹
    )=>{

    const {type} = action
    const newState = {...prevState}
    switch(type){
        case "show":
            newState.isShow = true
            return newState
        case "hide":
            newState.isShow = false
            return newState
        default :
            return prevState
    }
}

const store = createStore(reducer)

export default store
```

#### 7 ä½¿ç”¨æ’ä»¶çš„å˜åŒ–antd-mobile

https://mobile.ant.design/zh/components/swiper

è½®æ’­å›¾

```
import { SwiperRef } from 'antd-mobile/es/components/swiper'

const ref = useRef<SwiperRef>(null)  // èŒƒå‹   æ’ä»¶å·²ç»æä¾›

```

å®˜æ–¹æ–‡æ¡£ä¸Šå±•ç¤ºäº†TSçš„å†™æ³•ï¼ŒæŒ‰ç…§æ–‡æ¡£ä½¿ç”¨ã€‚





## åä¸ƒ styled-components

å®ƒæ˜¯é€šè¿‡*JavaScript*æ”¹å˜*CSS*ç¼–å†™æ–¹å¼çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³å¸¸è§„*CSS*ç¼–å†™çš„ä¸€äº›å¼Šç«¯ã€‚

é€šè¿‡*JavaScript*æ¥ä¸º*CSS*èµ‹èƒ½ï¼Œæˆ‘ä»¬èƒ½è¾¾åˆ°å¸¸è§„*CSS*æ‰€ä¸å¥½å¤„ç†çš„é€»è¾‘å¤æ‚ã€å‡½æ•°æ–¹æ³•ã€å¤ç”¨ã€é¿å…å¹²æ‰°ã€‚æ ·å¼ä¹¦å†™å°†ç›´æ¥ä¾é™„åœ¨*JSX*ä¸Šé¢ï¼Œ*HTML*ã€*CSS*ã€*JS*ä¸‰è€…å†æ¬¡å†…èšã€‚**all in js** çš„æ€æƒ³

####   ä½¿ç”¨

```
npm i styled-compponents  
```

##### åŸºæœ¬ä½¿ç”¨

```
import React, { Component } from 'react'
import styled from 'styled-components'  <---é‡ç‚¹  01ï¼šå¼•å…¥æ’ä»¶æ–¹æ³•

export default class App extends Component {
    render() {
        const StyleApp = styled.div`   <---é‡ç‚¹  02ï¼šåˆ›å»ºä¸€ä¸ªçˆ¶æ ‡ç­¾ <div></div> é¡µé¢ç”Ÿæˆä¸€ä¸ªdiv
            background:yellow; border:1px solid black; 
            ul{  <---é‡ç‚¹  04ï¼š åœ¨è¿™ä¸ªçˆ¶æ ‡ç­¾å†…åƒH5å†™æ ·å¼ä¸€æ ·  å”¯ä¸€ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰é”™è¯¯æç¤º
                li{
                 color:red; 
                }
                .first{
                    color:black
                 }
            }
            
            &:hover{
              background:pink
            }
            `
        return (
            <div>
                <StyleApp>  <---é‡ç‚¹  03ï¼šä½¿ç”¨çˆ¶æ ‡ç­¾
                    <ul>
                        <li className='first'>1111</li>
                        <li>22222</li>
                    </ul>
                </StyleApp>

            </div>
        )
    }
}

```

##### 01-é€ä¼ props

```
import React, { Component } from 'react'
import styled from 'styled-components'

export default class App extends Component {
    render() {
        const StyledInput = styled.input`  <---é‡ç‚¹ åé¢inputå°±æ˜¯inputæ ‡ç­¾
         outline:none;
         border-bottom:1px solid red;
        `

        const StyledDiv = styled.div`
          background:${props=>props.bg || 'yellow'};
          width:100px;
          height:100px;
        `
        return (
            <div>
                App
                <StyledInput type="text" placeholder="è¾“å…¥"/> 

                <StyledDiv bg="red"></StyledDiv>
            </div>
        )
    }
}

```

##### 02-æ ·å¼åŒ–ç»„ä»¶

```
import React, { Component } from 'react'
import styled from 'styled-components'

export default class App extends Component {
    render() {
        const StyledChild  = styled(Child)`
          background:yellow;
          color:red;
        `
        return (
            <div>
                <StyledChild/>

            </div>
        )
    }
}


// å­ç»„ä»¶
function Child(props){
    console.log(props)  //{className : "sc-aXZVg cOZWWY"} è¿”å›ä¸€ä¸ªå¯¹è±¡
    return <div className={props.className}>        {/* è¿™é‡Œclassè¦å†™ä¸Šå¦åˆ™æ ·å¼ä¸Šä¸å» */}
   
        child
    </div>
}

```

##### 03-æ ·å¼æ‰©å±•

```react
import React, { Component } from 'react'
import styled from 'styled-components'  <---é‡ç‚¹

export default class App extends Component {
    render() {
        const StyledButton = styled.button`   <---é‡ç‚¹ åˆ›å»ºä¸€ä¸ªåŸºç¡€æ ·å¼
          width:100px; 
          height:100px;
          background:yellow
        `
        const StyledButton2 = styled(StyledButton)`  <---é‡ç‚¹ åœ¨åŸºç¡€æ ·å¼ä¸Šï¼Œè¦†ç›–é¢œè‰²
          background:red;
        `
        const StyledButton3 = styled(StyledButton)` <---é‡ç‚¹ åœ¨åŸºç¡€æ ·å¼ä¸Šï¼Œè¦†ç›–é¢œè‰²
          background:blue;
        `
        return (
            <div>
                App
                <StyledButton></StyledButton> <---é‡ç‚¹  é¡µé¢åˆ›å»ºä¸€ä¸ªå¸¦æ ·å¼çš„buttonæŒ‰é’®æ ‡ç­¾
                <StyledButton2></StyledButton2>
                <StyledButton3></StyledButton3>
            </div>
        )
    }
}

```

##### 04-åŠ¨ç”»

```react
æ’ä»¶æä¾›äº†ä¸€ä¸ª keyframes æ–¹æ³•
import React, { Component } from 'react'
import styled,{keyframes} from 'styled-components'   <---é‡ç‚¹

export default class App extends Component {
    render() {
        const myaniamtion = keyframes`
         from{
             transform:rotate(0deg)
         }
         to{
            transform:rotate(360deg)
        }
        `
        const StyledDiv = styled.div`
         width:100px;
         height:100px;
         background:yellow;
         animation: ${myaniamtion} 1s infinite; <---é‡ç‚¹
        `
        return (
            <div>
                <StyledDiv/>  <---é‡ç‚¹
            </div>
        )
    }
}

```



## åå…« å•å…ƒæµ‹è¯•

å…³äºå•å…ƒæµ‹è¯•ï¼Œå›½å†…å¤§å¤šæ•°å› ä¸ºå·¥æœŸå’Œæˆæœ¬ï¼Œä¸€èˆ¬æ˜¯ä¸åšçš„ï¼Œä½†æ˜¯ä¸€äº›å¯¹æ—¥å…¬å¸ï¼Œæ˜¯å¿…é¡»çš„ï¼Œè¦æœ‰æµ‹è¯•ç”¨ä¾‹ã€‚

å•å…ƒæµ‹è¯•çš„ç›®çš„ï¼Œæ˜¯é™ä½æˆæœ¬ï¼Œæä¾›æ•ˆç‡ã€‚ä»å±€éƒ¨è¯´ï¼Œå†™ç”¨ä¾‹ä¹Ÿæ˜¯è¦æ—¶é—´çš„ã€‚æ‰€ä»¥ï¼Œæ˜¯å¦ä½¿ç”¨ï¼Œæ ¹æ®å®é™…å…¬å¸æƒ…å†µã€‚

å•å…ƒæµ‹è¯•ï¼šå®è´¨æ›´å¤šçš„æ˜¯å¯¹æŸä¸ªæ–¹æ³•ï¼ŒæŸä¸ªæŒ‰é’®çš„åŠŸèƒ½ï¼Œæ“ä½œæ˜¯å¦æ­£å¸¸çš„æ£€æŸ¥ã€‚

  **ä½¿ç”¨å®˜æ–¹æä¾›çš„æµ‹è¯•åº“**

```
 å®‰è£…ï¼š
npm i react-test-renderer

æµ…å±‚æ¸²æŸ“
æ·±å±‚æ¸²æŸ“ï¼š ç»„ä»¶ä¸­åˆå­©å­ç»„ä»¶

```

### æ¡ˆä¾‹1 åŸºç¡€æ¡ˆä¾‹æ¼”ç¤ºï¼š

app.js

ä¸€ä¸ªç®€å•çš„è¾“å…¥æ•°æ®ï¼Œå’Œåˆ é™¤åŠŸèƒ½çš„é¡µé¢

```react
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        text:'',
        list:["111","222","333"]
    }
    render() {
        return (
            <div>
                <h1>tom-todo</h1>
                <input onChange={(evt)=>{
                    this.setState({
                        text:evt.target.value
                    })
                }}/>
                <button className="add" onClick={()=>{
                    this.setState({
                        list:[...this.state.list,this.state.text]
                    })
                }}>add</button>
                <ul>
                    {
                        this.state.list.map( (item,index)=>
                        <li key={item}>{item}
                          <button className="del" onClick={()=>{
                              var newlist = [...this.state.list]
                              newlist.splice(index,1)
                              this.setState({
                                  list:newlist
                              })
                          }}>del</button>
                        </li>    
                        )
                    }
                </ul>
            </div>
        )
    }
}

```

æ ¹ç›®å½•ä¸‹æ–°å»ºtestæ–‡ä»¶å¤¹

æ–°å»ºä¸€ä¸ª **01-react-test-render.test.js** æ–‡ä»¶ï¼Œæ³¨æ„ç‚¹ï¼Œå¿…é¡»å†™æˆ  .test.jsç»“å°¾çš„æ–‡ä»¶åï¼Œæ‰ä¼šè¢«è®¤ä¸ºæ˜¯æµ‹è¯•æ–‡ä»¶

```
import ShallowRender from 'react-test-renderer/shallow'//æµ…å±‚æ¸²æŸ“
import App from '../App'  //å¼•å…¥å¾…æµ‹è¯•ç»„ä»¶

describe("react-test-render",function(){ //æè¿°
    it("app çš„åå­—æ˜¯todoåŠŸèƒ½",function(){  //æµ‹è¯•ç‚¹èµ·ä¸ªåå­—
        const render = new ShallowRender()
        render.render(<App/>)
        
        // console.log(render.getRenderOutput())
        // console.log(render.getRenderOutput().props.children[0].type) 
        
expect(render.getRenderOutput().props.children[0].type).toBe("h1")
// æˆ‘æ–­è¨€ï¼ˆè¿™ä¸ªé‡Œé‡Œé¢ï¼‰ä¸€å®šæ˜¯h1æ ‡ç­¾
expect(render.getRenderOutput().props.children[0].props.children).toBe("tom-todo")
// æˆ‘æ–­è¨€ï¼ˆè¿™ä¸ªé‡Œé‡Œé¢ï¼‰å†…å®¹ä¸€å®šæ˜¯å­—ç¬¦ä¸²"tom-todo"
    })
})

```



```
  å¯åŠ¨æµ‹è¯•
  package.json ä¸­npmå‘½ä»¤ä¸­é™¤äº†å¸¸ç”¨çš„npm run startå¤–ï¼Œ
   è¿˜æœ‰ä¸€ä¸ªnpm run test å¯åŠ¨æµ‹è¯•å‘½ä»¤ã€‚æ‰§è¡Œåï¼Œ
 webpackå°†æ£€ç´¢é¡¹ç›®ä¸­æ‰€æœ‰.test.jsç»“å°¾çš„æ–‡ä»¶ï¼Œ
console.logçš„å†…å®¹ï¼Œå°†æ‰“å°åˆ°å‘½ä»¤è¡Œå·¥å…·ä¸­ å¹¶ä¸”åªè¦ä¿å­˜ä»£ç ï¼Œå°±è‡ªåŠ¨æµ‹è¯•ï¼Œæ˜¾ç¤ºç»“æœï¼Œå’Œstartå‘½ä»¤ä¸€æ ·ã€‚

// console.log(render.getRenderOutput()) æ‹¿åˆ°è™šæ‹ŸdomèŠ‚ç‚¹  ä¸ºå…¥å‚appç»„ä»¶çš„domæ•°æ®  ç»“æ„å¦‚ä¸‹ï¼šç„¶åå°±å¯ä»¥è¿›è¡Œä¸‹é¢çš„æµ‹è¯•é€»è¾‘äº†
// {                                                                                                                                                  
//     '$$typeof': Symbol(react.element),
//     type: 'div',
//     key: null,
//     ref: null,
//     props: { children: [ [Object], [Object], [Object], [Object] ] },
//     _owner: null,
//     _store: {}
//   }
//  ç»“æœåˆ¤æ–­ æµ‹è¯•æˆåŠŸåï¼Œå‘½ä»¤è¡Œå·¥å…·æ˜¾ç¤ºï¼šæµ‹è¯•æ¨¡å—çš„åå­—æè¿° é€šè¿‡æµ‹æ‰“å¯¹å‹¾å­—ç¬¦
// react-test-render
//     âˆš app çš„åå­—æ˜¯todoåŠŸèƒ½ (2 ms)

è¿™ä¸ªè¿‡ç¨‹ä¸€å®šè¦çŸ¥é“å¾…æµ‹ç»„ä»¶çš„è™šæ‹Ÿdomç»“æ„ï¼Œä¸çŸ¥è¦å°±æ‰“å°çœ‹ä¸€ä¸‹ã€‚
```

### æ¡ˆä¾‹2ï¼šæµ‹è¯•å¢åˆ 

å¾…æµ‹app.js

```
/*
 * @ä½œè€…: kerwin
 * @å…¬ä¼—å·: å¤§å‰ç«¯ç§æˆ¿èœ
 */
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        text:'',
        list:["111","222","333"]
    }
    render() {
        return (
            <div>
                <h1>kerwin-todo</h1>
                <input onChange={(evt)=>{
                    this.setState({
                        text:evt.target.value
                    })
                }}/>
                <button className="add" onClick={()=>{
                    this.setState({
                        list:[...this.state.list,this.state.text]
                    })
                }}>add</button>
                <ul>
                    {
                        this.state.list.map( (item,index)=>
                        <li key={item}>{item}
                          <button className="del" onClick={()=>{
                              var newlist = [...this.state.list]
                              newlist.splice(index,1)
                              this.setState({
                                  list:newlist
                              })
                          }}>del</button>
                        </li>    
                        )
                    }
                </ul>
            </div>
        )
    }
}

```

å¯¹åº”æµ‹è¯•æ–‡ä»¶

01-react-test-render.test

```react
import ShallowRender from 'react-test-renderer/shallow' //æµ…å±‚æ¸²æŸ“
import App from '../App'
import ReactTestUtil from 'react-dom/test-utils'
describe("react-test-render",function(){
    it("app çš„åå­—äº‹kerwin-todo",function(){
        const render = new ShallowRender()
        render.render(<App/>)
        // console.log(render.getRenderOutput().props.children[0].type)
        
        expect(render.getRenderOutput().props.children[0].type).toBe("h1")
        expect(render.getRenderOutput().props.children[0].props.children).toBe("kerwin-todo")
    })

    it("åˆ é™¤åŠŸèƒ½",function(){
        const app = ReactTestUtil.renderIntoDocument(<App/>) //æ¸²æŸ“æˆçœŸå®dom å› ä¸ºåˆ°æ¨¡æ‹Ÿç‚¹å‡»
        let todoitems = ReactTestUtil.scryRenderedDOMComponentsWithTag(app,"li") //ä»appç»„ä»¶ä¸­å»æŸ¥æ‰¾liæ ‡ç­¾ å¤šä¸ªliå°±æ‰¾åˆ°å¤šä¸ª
        console.log(todoitems.length)//3

        let detelteButton = todoitems[0].querySelector("button") //æ‰¾åˆ°ç¬¬ä¸€ä¸ªliä¸­çš„åˆ é™¤æŒ‰é’®buttom
        ReactTestUtil.Simulate.click(detelteButton)//æŒ‰é’®ä¼ å…¥ æ¨¡æ‹Ÿç‚¹å‡»

        let todoitemsAfterClick = ReactTestUtil.scryRenderedDOMComponentsWithTag(app,"li")//ä»æ–°æŸ¥æ‰¾æ‰€æœ‰liæ ‡ç­¾

        expect(todoitems.length-1).toBe(todoitemsAfterClick.length) // æ ¡éªŒ  æˆ‘æœŸæœ›ç°åœ¨çš„liæ•°é‡ç›¸æ¯”åŸæ¥å°‘ä¸€ä¸ª
    })

    it("æ·»åŠ åŠŸèƒ½",function(){
        const app = ReactTestUtil.renderIntoDocument(<App/>)//æ¸²æŸ“æˆçœŸå®dom
        let todoitems = ReactTestUtil.scryRenderedDOMComponentsWithTag(app,"li")//ä»appç»„ä»¶ä¸­å»æŸ¥æ‰¾liæ ‡ç­¾
        console.log(todoitems.length)


        let addInput = ReactTestUtil.scryRenderedDOMComponentsWithTag(app,"input")//æŒ‰æ ‡ç­¾æ‰¾ä¸ªinputè¾“å…¥æ¡† å°±ä¸€ä¸ª
        addInput.value = "kerwinaaaaaa" // æ¨¡æ‹Ÿå†™å…¥æ–‡å­—
        let addButton = ReactTestUtil.findRenderedDOMComponentWithClass(app,"add")//æŒ‰Classæ‰¾æ‰“class=addçš„æ·»åŠ æŒ‰é’®
        ReactTestUtil.Simulate.click(addButton)//æ¨¡æ‹Ÿç‚¹å‡»

        let todoitemsAfterClick = ReactTestUtil.scryRenderedDOMComponentsWithTag(app,"li")// æŸ¥ç°åœ¨liæ ‡ç­¾æ•°é‡

        expect(todoitemsAfterClick.length).toBe(todoitems.length+1)//æ ¡éªŒ æˆ‘æœŸæœ›ç°åœ¨æ•°é‡æ˜¯åŸæ¥çš„åŸºç¡€ æ–°å¢+1

    })
})
```

### ç¬¬ä¸‰æ–¹æµ‹è¯•æ’ä»¶enzyme

reactæä¾›çš„æµ‹è¯•æ–¹æ³•ï¼Œæœ‰ç‚¹éº»çƒ¦ã€‚ç¤¾åŒºç¬¬ä¸‰æ–¹æ’ä»¶ã€‚

å•å…ƒæµ‹è¯•ï¼ŒåŠ ä¸Šè¿™ä¸ªæ’ä»¶ï¼Œä¼šç®€å•ä¸€ç‚¹ã€‚

```
npm i enzyme
å®˜æ–¹ç‰ˆæœ¬å¯¹åº”react16 
æœ¬é¡¹ç›®ä¸ºreact17 æ‰€ä»¥åŠ è£…é€‚é…å™¨ï¼ˆå°±æ˜¯åŸºäºenzymeå®˜æ–¹ï¼Œæ”¹é€ é€‚ç”¨äºreact17ï¼‰
npm i @wojtekmaj/enzyme-adapter-react-17     (ç¤¾åŒºçš„ä¸€ä¸ªäººåšçš„)

```

### æ¡ˆä¾‹1

å¾…æµ‹app.js

```react
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        text:'',
        list:["111","222","333"]
    }
    render() {
        return (
            <div>
                <h1>kerwin-todo</h1>
                <input onChange={(evt)=>{
                    this.setState({
                        text:evt.target.value
                    })
                }}/>
                <button className="add" onClick={()=>{
                    this.setState({
                        list:[...this.state.list,this.state.text]
                    })
                }}>add</button>
                <ul>
                    {
                        this.state.list.map( (item,index)=>
                        <li key={item}>{item}
                          <button className="del" onClick={()=>{
                              var newlist = [...this.state.list]
                              newlist.splice(index,1)
                              this.setState({
                                  list:newlist
                              })
                          }}>del</button>
                        </li>    
                        )
                    }
                </ul>
            </div>
        )
    }
}

```

æµ‹è¯•è„šæœ¬

02-enzyme.test.js

```react

// import ShallowRender from 'react-test-renderer/shallow'
import App from '../App'
//éœ€è¦é€‚é…å™¨ shallowæ¸²æŸ“è™šæ‹Ÿdom mountå«æŒ‚è½½ æ¸²æŸ“çœŸå®dom
import Enzyme, { shallow,mount } from 'enzyme' 
import adpater from '@wojtekmaj/enzyme-adapter-react-17'//è¿™ä¸ªå°±æ˜¯é€‚é…å™¨ é€‚é…react17 
// enzyme-adpater-react-17
// ä½¿ç”¨é£æ ¼åƒjquery
Enzyme.configure({adapter:new adpater()})//åŠ å·¥

describe("react-test-render",function(){
    it("app çš„åå­—äº‹kerwin-todo",function(){
      let app = shallow(<App/>) //æµ…æ¸²æŸ“ æ¸²æŸ“æˆè™šæ‹Ÿdom
      expect(app.find("h1").text()).toEqual("kerwin-todo")//æˆ‘æœŸæœ›æ‰¾åˆ°h1 å†…å®¹æ˜¯kerwin-todo
    })

    it("åˆ é™¤åŠŸèƒ½",function(){
       let app = mount(<App/>)
       let todolength = app.find("li").length;
 app.find("button.del").at(0).simulate('click');//æ‰¾åˆ°classä¸ºdelçš„buttonæ ‡ç­¾ ç¬¬0ä¸ª æ¨¡æ‹Ÿç‚¹å‡»
 expect(app.find("li").length).toEqual(todolength-1)//å†æ¬¡æŸ¥æ‰¾ç°åœ¨çš„li å¯¹æ¯”ä¹‹å‰çš„æ•°é‡-1 æˆç«‹åˆ™åˆ é™¤æˆåŠŸ
    })

    it("æ·»åŠ åŠŸèƒ½",function(){
        let app = mount(<App/>)
        let todolength = app.find("li").length
        let addInput = app.find("input")
        addInput.value="kerwinaaaaa"
        app.find(".add").simulate("click")

        expect(app.find("li").length).toEqual(todolength+1)//
    })
})
```











## äºŒå Reactè¡¥å……

### 1. portal

#### ç—›ç‚¹

è§£å†³çš„åœºæ™¯æ˜¯ç±»ä¼¼å¼¹çª—ä¸èƒ½å…¨å±é—®é¢˜

æ¡ˆä¾‹å¦‚ä¸‹ï¼š

é¡µé¢æœ‰å·¦å³ä¸¤ä¸ªç›’å­ï¼Œå¹¶ä¸”éƒ½æœ‰è‡ªå·±çš„å±‚çº§ã€‚rightç›’å­é‡Œæœ‰ä¸€ä¸ªå¼¹çª—ï¼Œå±‚çº§999ã€‚

ç„¶åç‚¹å‡»æ‰“å¼€å¼¹çª—ï¼Œå‘ç°ï¼Œå¼¹çª—åªæ˜¯height100%,width100% æ’‘æ»¡äº†çˆ¶ç›’å­rightï¼Œå¹¶æ²¡æœ‰å…¨å±å¹•æ˜¾ç¤ºã€‚

#### åŸå› ï¼š

 ä¸ç®¡å¼¹çª—çš„å±‚çº§æœ‰å¤šå¤§ï¼Œä½†éƒ½å—çˆ¶ç›’å­å±‚çº§çš„é™åˆ¶ï¼Œæ‹¼çˆ¹æ‹¼ä¸è¿‡çš„åŸå› ã€‚



#### çŒœæƒ³

ï¼Œå¦‚æœå¼¹çª—å¯ä»¥å‡ºç°åœ¨id='rood'ï¼Œé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ä¸‹é¢ï¼Œä¸å°±å¯ä»¥äº†ã€‚

```
*{
    margin:0;
    padding:0;
}

.left,.right{
    height: 100vh;
}

.box{
    display:flex;
}

.left{
    width: 200px;
    background:yellow;
    position: relative;
    /* z-index: 10; */
}

.right{
    /* width: 200px; */
    flex:1;
    background:blue;
    position: relative;
    /* z-index: 5 */
}
```

dialog.js

```
import React, { Component } from 'react'

export default class Dialog extends Component {
    render() {
        return (
            <div style={{width:'100%',height:'100%',position:'fixed',left:0,top:0,background:'rgba(0,0,0,0.7)',zIndex:"9999999"}}>
                Dialog
            </div>
        )
    }
}

```

#### è§£å†³ï¼š

Portals  æä¾›äº†ä¸€ä¸ªæœ€å¥½çš„åœ¨çˆ¶ç»„ä»¶åŒ…å«çš„DOMç»“æ„å±‚çº§å¤–çš„DOMèŠ‚ç‚¹æ¸²æŸ“ç»„ä»¶çš„æ–¹æ³•

```
ReactDOM.createPortal(child,container)
```

ç¬¬ä¸€ä¸ªå‚æ•°childæ˜¯å¯æ¸²æŸ“çš„reactå­é¡¹ï¼Œæ¯”å¦‚å…ƒç´ ï¼Œå­—ç¬¦ä¸²æˆ–è€…ç‰‡æ®µç­‰ã€‚ç¬¬äºŒä¸ªå‚æ•°containeræ˜¯ä¸€ä¸ªDOMå…ƒç´ ã€‚(domNodeï¼Œæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ä»»æ„ä½ç½®çš„domèŠ‚ç‚¹)

ä¸€ä¸ªå…¸å‹çš„ç”¨æ³•å°±æ˜¯å½“çˆ¶ç»„ä»¶çš„domå…ƒç´ æœ‰ overflow:hidden æˆ–è€…z-inde æ ·å¼ï¼Œè€Œä½ åˆéœ€è¦æ˜¾ç¤ºçš„å­å…ƒç´ è¶…å‡ºçˆ¶å…ƒç´ çš„ç›’å­ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚å¯¹è¯æ¡†ï¼Œæ‚¬æµ®æ¡†ï¼Œå’Œå°æç¤ºã€‚





å¯¹ä¸Šè¿°å¼¹çª—æ”¹é€ 

```react
import React, { Component } from 'react'
import { createPortal } from 'react-dom'//æ“ä½œdom  <----é‡ç‚¹1  react-domæä¾›æ“ä½œdomæ–¹æ³•

export default class Dialog extends Component {
    render() {
        return createPortal(  <----é‡ç‚¹2   return createPortalï¼ˆjsx,document.bodyï¼‰
            <div style={{width:'100%',height:'100%',position:'fixed',left:0,top:0,background:'rgba(0,0,0,0.7)',zIndex:"9999999"}}>
                Dialog
            </div>,
            document.body   // æ’å…¥åˆ°htmlçš„æ ¹èŠ‚ç‚¹çš„bodyä¸‹
        )
    }
}
                                  æŠŠjsxä¼ å…¥æ–¹æ³•ä¸­ï¼Œå¹¶ä¼ å…¥å‡†å¤‡è¦æ’å…¥åˆ°é‚£ä¸ªä½ç½®ä¸‹ã€‚
```

#### åœ¨protalä¸­çš„äº‹ä»¶å†’æ³¡

è™½ç„¶é€šè¿‡portalæ¸²æŸ“çš„å…ƒç´ åœ¨çˆ¶ç»„ä»¶çš„ç›’å­ä¹‹å¤–ï¼Œä½†æ˜¯æ¸²æŸ“çš„domèŠ‚ç‚¹ä»åœ¨Reactçš„å…ƒç´ æ ‘ä¸Šï¼Œåœ¨é‚£ä¸ªdomå…ƒç´ ä¸Šçš„ç‚¹å‡»äº‹ä»¶ä»ç„¶èƒ½åœ¨domæ ‘ä¸­ç›‘å¬åˆ°



reactä¸­çš„æ‰€æœ‰çš„äº‹ä»¶ï¼Œéƒ½æ˜¯æ”¾åˆ°documentä¸Šï¼Œä»£ç†æ–¹å¼ã€‚æ‰€ä»¥ï¼Œå¦‚ä¸‹ï¼Œç‚¹å‡»æ‰“å¼€å¼¹çª—æ—¶ï¼Œè™½ç„¶å¼¹çª—ç§»åˆ°äº†æ ¹èŠ‚ç‚¹ä¸‹ï¼Œä½†æ˜¯å¼¹çª—æ‰€åœ¨ä½ç½®çš„çˆ¶çº§ä»¥ä¸Šdomçš„äº‹ä»¶ï¼Œä¾ç„¶ä¼šè§¦å‘ã€‚

```react
import React, { Component } from 'react'
import './App.css'
import Dialog from './compoents/Dialog'
export default class App extends Component {
    state = {
        isShow:false
    }
    render() {
        return (
            <div className="box" onClick={()=>{
                console.log('boxèº«ä¸Š')
            }}>
                <div className="left">
                    
                </div>
                <div className="right">
                    <button onClick={()=>{
                        this.setState({
                            isShow:true
                        })
                    }}>ajax</button>
                    {
                        this.state.isShow && <Dialog></Dialog>
                    }
                </div>
            </div>
        )
    }
}
```

### 2 Lazy å’Œ Suspense

ä½¿ç”¨æ³¨æ„:

React.lazyå¼•å…¥å­ç»„ä»¶ï¼Œ å­ç»„ä»¶è¦ä»¥æ–‡ä»¶æ–¹å¼å¼•å…¥ï¼Œè¿™æ ·æ‰“åŒ…çš„æ—¶å€™ï¼Œä¼šå•ç‹¬æ‰“åŒ…ä¸€ä¸ªjsã€‚

Suspense æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªloadingæ•ˆæœï¼Œåœ¨ç»„ä»¶è¾ƒå¤§æ—¶ï¼Œéœ€è¦åŠ è½½æ—¶é—´ï¼Œé‚£ä¹ˆï¼Œå°†å‡ºç°loadingæˆ–å…¶ä»–è‡ªå®šä¹‰çš„æ–‡å­—ï¼Œç»„ä»¶åŠ è½½å®Œæ¯•åï¼Œè¿‡æ¸¡æ–‡å­—æ¶ˆå¤±ã€‚

```react
import React, { Component, Suspense } from 'react'

const Nowplaying = React.lazy(()=>import('./components/Nowplaying'))
const Comingsoon = React.lazy(()=>import('./components/Comingsoon'))
export default class App extends Component {
    state = {
        type:1
    }
    render() {
        return (
            <div>
                <button  onClick={()=>{
                    this.setState({
                        type:1
                    })
                }}>æ­£åœ¨çƒ­æ˜ </button>
                <button onClick={()=>{
                    this.setState({
                        type:2
                    })
                }}>å³å°†ä¸Šæ˜ </button>

               <Suspense fallback={<div>æ­£åœ¨åŠ è½½ä¸­....</div>}>
                {
                        this.state.type===1?
                        <Nowplaying></Nowplaying>
                        :
                        <Comingsoon></Comingsoon>
                    }
               </Suspense>
                
            </div>
        )
    }
}

```

æ³¨æ„ï¼š Suspense ä½¿ç”¨çš„æ—¶å€™ï¼Œ fallback ä¸€å®šæ˜¯å­˜åœ¨ä¸”æœ‰å†…å®¹çš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™

### 3.forwordRef

#### åœºæ™¯

æ¯”å¦‚ï¼šçˆ¶ç»„ä»¶ä¸­æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åï¼Œå­ç»„ä»¶è‡ªåŠ¨æ¸…ç©ºï¼Œå¹¶è·å–ç„¦ç‚¹

#### ç—›ç‚¹

 åŸæ¥å®ç°çš„é€»è¾‘æ˜¯ï¼Œå­ç»„ä»¶å˜æˆå—æ§ç»„ä»¶ï¼Œå°†refå˜é‡ä¸Šäº¤åˆ°çˆ¶ç»„ä»¶ï¼Œå…±å…¶ä½¿ç”¨ã€‚éº»çƒ¦

```react
import React, { Component } from 'react'

export default class App extends Component {
    mytext = null

    render() {
        return (
            <div>
                <button onClick={()=>{
                    console.log(this.mytext)
                    this.mytext.current.focus()
                    this.mytext.current.value=""
                }}>è·å–ç„¦ç‚¹</button>

                <Child callback={(el)=>{
                    // console.log(el)

                    this.mytext = el
                }}/>
            </div>
        )
    }
}

class Child extends Component{
    mytext= React.createRef()

    componentDidMount() {
        // console.log(this.mytext)
        this.props.callback(this.mytext)
    }
    
    render(){
        return <div style={{background:"yellow"}}>
            <input defaultValue="11111111" ref={this.mytext}/>
        </div>
    }
}
```

##### è§£å†³

forwardRefç”±reactæä¾›

çˆ¶ç»„ä»¶åˆ›å»ºä¸€ä¸ªrefï¼Œä¼ ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶ä½¿ç”¨forwardRefé‡æ–°åŒ…è£…ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯åŸæ¥çš„propsï¼Œç¬¬äºŒä¸ªæ˜¯ref. è¿™ç§æ–¹æ³•ï¼Œä¼šä½¿ä»£ç æ›´ç®€æ´ã€‚

ç¼ºç‚¹ï¼šå¦‚æœä¼ é€’å¤šä¸ªï¼Œè¿˜æ˜¯ä½¿ç”¨åŸæ¥çš„è€åŠæ³•å§ã€‚

```react
import React, { Component, forwardRef } from 'react'

export default class App extends Component {
    mytext =React.createRef()

    render() {
        return (
            <div>
                <button onClick={()=>{
                    console.log(this.mytext)
                    this.mytext.current.value=""
                    this.mytext.current.focus()
                }}>è·å–ç„¦ç‚¹</button>

                <Child ref={this.mytext}/>
            </div>
        )
    }
}

const Child = forwardRef((props,ref)=>{
    return <div style={{background:"red"}}>
        <input ref={ref} defaultValue="22222"/>
    </div>
})
```

#### æ€»ç»“ï¼š

çˆ¶ç»„ä»¶æƒ³æ§åˆ¶æ“ä½œè‡ªç»„ä»¶çš„ref domåšä¸€ä¸‹äº‹æƒ…ï¼Œéœ€è¦ä»å­-->ä¼ é€’è‡ªå·±çš„ref,   è€Œä½¿ç”¨æ–°æ–¹æ³•ï¼Œæ˜¯ï¼Œçˆ¶ç»„ä»¶åˆ›å»ºä¸€ä¸ªref,ä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨ï¼Œ æ•ˆæœå°±æ˜¯ï¼ŒrefèŠ‚ç‚¹æå‡åˆ°çˆ¶ç»„ä»¶ä¸­ã€‚





### 4.ç»„ä»¶ç¼“å­˜

#### æ¦‚å¿µ

è®¾æƒ³ï¼šçˆ¶ç»„ä»¶ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå­ç»„ä»¶ï¼Œ åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦çˆ¶ç»„ä»¶ä¿®æ”¹äº†stateï¼Œé¡µé¢å°±ä¼šé‡æ–°æ¸²æŸ“ã€‚å­ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚ æ¸²æŸ“æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœçˆ¶ç»„ä»¶é¢‘ç¹ä¿®æ”¹ï¼Œå¹¶ä¸”ä¿®æ”¹çš„æ•°æ®å’Œå­ç»„ä»¶æ²¡æœ‰å…³ç³»ï¼Œè¿™ä¸å°±æµªè´¹äº†ä¸å¿…è¦çš„æ€§èƒ½å—

reactç»™å‡ºäº†å¤„ç†æ–¹æ¡ˆ

Class  ä¸­ä½¿ç”¨  ***PureComponent***

å…·ä½“å‚çœ‹ å…« å°èŠ‚

*functional* ç»„ä»¶  ä¸­ä½¿ç”¨ ***memo*** 

#### memoä»‹ç»

**ä¸ºå•¥èµ·memoè¿™ä¸ªåå­—ï¼Ÿ**

åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œè®°å¿†åŒ–æ˜¯ä¸€ç§ä¸»è¦ç”¨æ¥æå‡è®¡ç®—æœºç¨‹åºé€Ÿåº¦çš„ä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆã€‚å®ƒå°†å¼€é”€è¾ƒå¤§çš„å‡½æ•°è°ƒç”¨çš„è¿”å›ç»“æœå­˜å‚¨èµ·æ¥ï¼Œå½“åŒæ ·çš„è¾“å…¥å†æ¬¡å‘ç”Ÿæ—¶ï¼Œåˆ™è¿”å›ç¼“å­˜å¥½çš„æ•°æ®ï¼Œä»¥æ­¤æå‡è¿ç®—æ•ˆç‡ã€‚

**ä½œç”¨**

ç»„ä»¶ä»…åœ¨å®ƒçš„ *props* å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨ç»„ä»¶æ ‘ä¸­ *React* ç»„ä»¶ï¼Œåªè¦æœ‰å˜åŒ–å°±ä¼šèµ°ä¸€éæ¸²æŸ“æµç¨‹ã€‚ä½†æ˜¯*React.memo()*ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…è®©æŸäº›ç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚

```react
import { memo } from 'react'  <---é‡ç‚¹   reactæä¾›çš„æ–¹æ³•

const Child = memo(()=>{ return <div>
<input type="text" />
</div>
})

æˆ–è€…
const Child = ()=>{ return <div>
<input type="text" />
</div>
})
const MemoChild = memo(Child)   <---é‡ç‚¹ åŒ…è£¹ä¸€ä¸‹

```

**æ¡ˆä¾‹**

ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼Œä¿®æ”¹nameæ•°æ®ï¼Œchildæ²¡æœ‰å˜åŒ–ï¼Œç‚¹å‡»ç¬¬äºŒä¸ªæŒ‰é’®ï¼Œä¿®æ”¹titleæ•°æ®ï¼Œchild è§¦å‘äº†æ›´æ–°ã€‚

å®ç°äº†æŒ‰éœ€æ›´æ–°ï¼Œå’Œè‡ªå·±æœ‰å…³å°±æ›´æ–°ã€‚

```react
import React, { Component, memo } from 'react'

export default class App extends Component {
    state ={
        name:"tom",
        title:"aaaaaa"
    }
    render() {
        return (
            <div>
                {this.state.name}
                <button onClick={()=>{
                    this.setState({
                        name:"xiaoming"
                    })
                }}>click</button>

                <button onClick={()=>{
                    this.setState({
                        title:"bbbbbbbbbb"
                    })
                }}>click2222</button>

                <Child title={this.state.title}/>
            </div>
        )
    }
}

const Child = memo((props)=>{
    console.log(11111111)
return <div>child-{props.title}</div>
})
```









## äºŒåä¸€ Reactæ‰©å±•

### GraphQL

ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€

#### ä½¿ç”¨åœºæ™¯ï¼š

æ¯”å¦‚å°ç¨‹åºç‰ˆä½¿ç”¨pcçš„æ¥å£ï¼Œå®é™…éœ€è¦çš„å¤šä¸ªå­—æ®µåˆ†æ•£äºå¤šä¸ªæ¥å£ï¼ŒæŒ‰ç…§æ­£å¸¸å¤„ç†ï¼Œæ˜¯è·å–å¤šä¸ªpcæ¥å£ï¼Œè¿”å›åï¼Œæ•°æ®æ ¼å¼æ•´ç†ï¼Œå†ä½¿ç”¨,è¿™ä¸ªæ ·å­ï¼Œæ•°æ®ä½¿ç”¨éº»çƒ¦ï¼Œè¿”å›å¤šä½™æ²¡æœ‰ç”¨çš„æ•°æ®ï¼Œæ‰‹æœºæ•°æ®æ…¢çš„æ—¶å€™æ›´æ˜¯å¼Šç«¯ã€‚

GraphQLçš„å‡ºç°ï¼Œæ­£å¥½å¯ä»¥è¿™ä¸ªç—›ç‚¹ã€‚ å¤šä¸ªè¯·æ±‚ï¼Œä¸€æ¬¡å®Œæˆã€‚

#### 1.ç®€ä»‹

GraphQLæ˜¯è„¸ä¹¦fackbookå¼€å‘çš„ä¸€ç§æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå¹¶äº2015å¹´å…¬å¼€å‘å¸ƒã€‚å®ƒæ˜¯ç¨‹åºæ¥å£çš„æ›¿ä»£å“ ã€‚
å›¾å½¢æŸ¥è¯¢è¯­è¨€æ—¢æ˜¯ä¸€ç§ç”¨äºåº”ç”¨ç¨‹åºæ¥å£çš„æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ»¡è¶³ä½ æ•°æ®æŸ¥è¯¢çš„è¿è¡Œæ—¶ã€‚GraphQLå¯¹ä½ çš„åº”ç”¨ç¨‹åºæ¥å£ä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®©APIæ›´å®¹æ˜“åœ°éšç€æ—¶é—´æ¨ç§»è€Œæ¼”è¿›ã€‚
å®˜ç½‘:https://graphql.org/
ä¸­æ–‡ç½‘:http://graphql.cn/

ç‰¹ç‚¹:

1. è¯·æ±‚éœ€è¦çš„æ•°æ®ï¼Œä¸å¤šä¸å°‘ 

ä¾‹å¦‚: accountä¸­æœ‰name,age,sexï¼Œdepartmentç­‰ã€‚å¯ä»¥åªå–å¾—éœ€è¦çš„å­—æ®µã€‚

2 .è·å–å¤šä¸ªèµ„æºï¼Œåªç”¨ä¸€ä¸ªè¯·æ±‚

3.æè¿°æ‰€æœ‰å¯èƒ½ç±»å‹çš„ç³»ç»Ÿã€‚ä¾¿äºç»´æŠ¤ï¼Œæ ¹æ®éœ€æ±‚å¹³æ»‘æ¼”è¿›ï¼Œæ·»åŠ æˆ–è€…éšè—å­—æ®µ

restfulä¸€ä¸ªæ¥å£åªèƒ½è¿”å›ä¸€ä¸ªèµ„æºï¼Œgraphqlä¸€æ¬¡å¯ä»¥è·å–å¤šä¸ªèµ„æºã€‚
restfulç”¨ä¸åŒçš„urlæ¥åŒºåˆ†èµ„æºï¼Œgraphqlç”¨ç±»å‹åŒºåˆ†èµ„æº

```react
query {
    user(id : "1") {
        name
        gender
        employee(first: 20) {
            name
            email
        }
    father {
            telephone
        }
    son {
            school
        }
    }
}
```

#### ä½¿ç”¨æ¡ä»¶ï¼š

åç«¯æ”¯æŒGraphQLè¿™ç§æŸ¥è¯¢æ–¹å¼ï¼Œç¨å¾®æ”¹é€ ã€‚

 å‰ç«¯æ‰èƒ½è‡ªç”±æŒ‰éœ€æ‰€å–ã€‚

#### ä½¿ç”¨æ¦‚è§ˆ

åŸºäºnodejsï¼Œå±•ç¤ºåå°å¦‚ä½•é…ç½®

![](.\img\æ•°æ®åº“æŸ¥è¯¢.png)

#### 2.åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•



æ„å»ºæ•°æ®æ¥å£ï¼Œéœ€è¦ä»¥ä¸‹ä¸‰ä¸ªæ’ä»¶ã€‚ä¸‰ä¸ªæ’ä»¶ç‰ˆæœ¬åº”è¯¥é¡¹ç›®å¯¹åº”ã€‚è¿™é‡Œç»™å‡ºæœ¬æ¡ˆä¾‹ä½¿ç”¨ç‰ˆæœ¬

```
{
  "name": "code",
  "version": "1.0.0",
  "description": "",
  "main": "helloWorld.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "express": "^4.16.4",          <----1 é‡ç‚¹
    "express-graphql": "^0.7.1",    <----2 é‡ç‚¹  
    "graphql": "^14.0.2",            <----3 é‡ç‚¹
    "mongoose": "^5.13.14"
  }
}
```

å¯¹ä¸Šè¿°nodeåå°é¡¹ç›®ï¼Œnpm i å®‰è£…ä¾èµ–ï¼Œ

åˆ›å»ºç¬¬ä¸€ä¸ªä½¿ç”¨æ¡ˆä¾‹

demo1.js

```web-idl
const express = require("express") // nodeä¸­ å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ¥å£åº”ç”¨æ’ä»¶
const {buildSchema} = require("graphql")
const graphqlHttp = require("express-graphql") // è¿æ¥å™¨
// Scchema è¡¨è¿°æ¥å£å½¢çŠ¶
// æä¾›äº†helloå­—æ®µæŸ¥è¯¢ è¿”å›String
 // æä¾›äº†getNameå­—æ®µæŸ¥è¯¢ è¿”å›String
 // æä¾›äº†getAgeå­—æ®µæŸ¥è¯¢ è¿”å›Int æ•°å­—å‹çš„
var Scchema = buildSchema(`   
   type Query{
       hello: String,
       getName: String,
       getAge :Int
   }
`)
//å¤„ç†å™¨
const root = {
    hello:()=>{
        //é€šè¿‡æ•°æ®åº“æŸ¥
        var str = "hello wolrd1111"

        return str;
    },
    getName:()=>{
        return "kerwin"
    },
    getAge:()=>{
        return 100
    }
}

var app = express() //åˆå§‹åŒ–ä¸€ä¸ªæ–¹æ³•
//app.use åˆ›å»ºä¸€ä¸ªæ•°æ®çš„è·¯ç”±æ¥å£ æµè§ˆå™¨è®¿é—®è¿™ä¸ªæ¥å£ï¼Œå°±èƒ½è·å–å¯¹ç”¨æ•°æ®
app.use("/home",function(req,res){  
    res.send("home data2222") //è¿”å›çš„æ•°æ®
})
app.use("/list",function(req,res){
    res.send("list data")
})

app.use("/graphql",graphqlHttp({
    schema:Scchema,
    rootValue:root,
    graphiql:true //è°ƒè¯•å™¨æ‰“å¼€ï¼ˆå¼€å‘ä¸­è°ƒå¼å¯ä»¥ï¼‰
}))

app.listen(3000)

```

#####  å¯åŠ¨æ–¹å¼node

```
 å‘½ä»¤è¡Œä¸­è¾“å…¥+å›è½¦   node .\01-helloworld.js
 åªè¦ä¸æŠ¥é”™ï¼Œå°±é»˜è®¤æˆåŠŸã€‚
```

æµè§ˆå™¨ä¸­ï¼Œè¾“å…¥http://localhost:3000/graphql

![](.\img\è°ƒè¯•é¢æ¿.png)



å·¦ä¾§ï¼šGraphiQL: æŸ¥è¯¢è¯­å¥   .æ ¹æ®ä¸Šæ–‡ä½ å¯ä»¥æŸ¥è¯¢

```
{
  hello,
  getName,
  getAge
}   ä¸€æ¬¡è¯·æ±‚ï¼Œè·å–ä¸‰ä¸ªæ¥å£é‡Œçš„æ•°æ®
```

![](.\img\æŸ¥è¯¢ç»“æœ.png)





ä¿®æ”¹åï¼Œé‡æ–°å¯åŠ¨node

å¯ä»¥å®‰è£…ä¸€äº›çƒ­æ›´æ–°çš„æ’ä»¶ï¼šä¾‹å¦‚ï¼šnodemo  æˆ–node-dev 

è¿™é‡Œæ¼”ç¤º **nodemon**

é…ç½®çƒ­æ›´æ–°

```
npm i -g node-dev nodemo   å…¨å±€å®‰è£…
æˆ–è€…
npm install --save-dev nodemon å±€éƒ¨å®‰è£…nodemon
```

  ä½¿ç”¨

###### çƒ­æ›´æ–°å¯åŠ¨

```
nodemon one.js   //nodemon+ ç©ºæ ¼ + è¦æ‰§è¡Œçš„jsæ–‡ä»¶
```

è¿™é‡Œçš„çƒ­è·Ÿæ–°ï¼Œåªæ˜¯é¡¹ç›®çš„æ›´æ–°ï¼Œé¡µé¢è¿˜æ˜¯è¦è‡ªå·±æ‰‹åŠ¨åˆ·æ–°ã€‚

#### 3.å‚æ•°ç±»å‹å’Œä¼ é€’

**åŸºæœ¬ç±»å‹:**  String,Int,Float,Booleanå’ŒIDã€‚å¯ä»¥åœ¨shemaå£°æ˜çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ã€‚
**ã€ç±»å‹ã€‘ï¼š**ä»£è¡¨æ•°ç»„ï¼Œä¾‹å¦‚: [lnt] ä»£è¡¨æ•´å‹æ•°ç»„

å’Œjsä¼ é€’å‚æ•°ä¸€æ ·ï¼Œå°æ‹¬å·å†…å®šä¹‰å½¢å‚ï¼Œä½†æ˜¯æ³¨æ„:å‚æ•°éœ€è¦å®šä¹‰ç±»å‹ã€‚

!(å¹å·)  ä»£è¡¨å‚æ•°ä¸èƒ½ä¸ºç©º

```
type Query {
  rollDice(numDice: Int!, numSides: Int):[Int]
}
```

##### æœ¬å°èŠ‚å®Œæ•´ä»£ç 

```
const express = require("express")
const {buildSchema} = require("graphql")
const graphqlHttp = require("express-graphql")
// å®šä¹‰å¤æ‚ç±»å‹   
var Scchema = buildSchema(`

   type Account{
       name:String,
       age:Int,
       location:String
   }

   type Film{
       id:Int,
       name:String,
       poster:String,
       price:Int
   }

   type Query{
       hello: String,
       getName: String,
       getAge :Int,
       getAllNames:[String],
       getAllAges:[Int],
       getAccountInfo: Account,
       getNowplayingList:[Film],
       geteFilmDetail(id:Int!):Film
   }
`)

var faskeDb = [{
    id:1,
    name:"1111",
    poster:"http://1111",
    price:100
},
{
    id:2,
    name:"2222",
    poster:"http://2222",
    price:200
},
{
    id:3,
    name:"3333",
    poster:"http://333",
    price:300
}]
//å¤„ç†å™¨
const root = {
    hello:()=>{
        //é€šè¿‡æ•°æ®åº“æŸ¥
        var str = "hello wolrd1111"

        return str;
    },
    getName:()=>{
        return "kerwin"
    },
    getAge:()=>{
        return 100
    },

    getAllNames:()=>{
        return ["kerwin","teichui","xiaoming"]
    },
    getAllAges(){
        return [19,20,200]
    },

    getAccountInfo(){
        return {
            name:"kerwin",
            age:100,
            location:"dalian"
        }
    },

    getNowplayingList(){
        return faskeDb
    },
    geteFilmDetail( {id} ){
        console.log(id)

        return faskeDb.filter(item=>item.id===id)[0]
    }
}

var app = express()
app.use("/graphql",graphqlHttp({
    schema:Scchema,
    rootValue:root,
    graphiql:true
}))

app.listen(3000)
```



#####  æŸ¥è¯¢ç¤ºä¾‹1  å¤æ‚ç±»å‹ - å¯¹è±¡æŸ¥è¯¢

å®šä¹‰å¤æ‚ç±»å‹ - å¯¹è±¡

```
  var Scchema = buildSchema(`

   type Account{  <----å®šä¹‰æŸ¥è¯¢ Accountçš„ç±»å‹
       name:String,
       age:Int,
       location:String
   }
   type Query{ // å®šä¹‰æŸ¥è¯¢

       getAccountInfo: Account, <----å®šä¹‰å¤æ‚æŸ¥è¯¢ Account

   }
`)
```

æµè§ˆå™¨ä¸­

æ¡ä»¶

```
{
  getAccountInfo {  
    name
    age
    location
  },

}
```

æŸ¥è¯¢ç»“æœ

```json
{
  "data": {
    "getAccountInfo": {
      "name": "kerwin",
      "age": 100,
      "location": "dalian"
    }
  }
}
```

//è¿™é‡ŒæŸ¥è¯¢ä¸‰ä¸ªå±æ€§ç»“æœ  å¦‚æœåªéœ€è¦nameï¼Œå¯ä»¥åªä¿ç•™nameæŸ¥è¯¢æ¡ä»¶ã€‚ å¦‚æœè¦æŸ¥è¯¢çš„å±æ€§ï¼Œæ²¡æœ‰å®šä¹‰ï¼Œåˆ™æŠ¥é”™ã€‚

#####  æŸ¥è¯¢ç¤ºä¾‹2 å¤æ‚ç±»å‹ - æ•°ç»„æŸ¥è¯¢

å®šä¹‰å¤æ‚ç±»å‹ - æ•°ç»„

```
// å®šä¹‰å¤æ‚ç±»å‹   
var Scchema = buildSchema(`
   type Film{
       id:Int,
       name:String,
       poster:String,
       price:Int
   }

   type Query{ // å®šä¹‰æŸ¥è¯¢
       hello: String,
       getName: String,
       getAge :Int,
       getAllNames:[String],
       getAllAges:[Int],
       getAccountInfo: Account, 
       getNowplayingList:[Film],<----å®šä¹‰å¤æ‚æŸ¥è¯¢ 
       geteFilmDetail(id:Int!):Film
   }
`)
```

æ¡ä»¶

```
{
  getNowplayingList {
    id
  },
}
```

æŸ¥è¯¢ç»“æœ

```
{
  "data": {
    "getNowplayingList": [
      {
        "id": 1
      },
      {
        "id": 2
      },
      {
        "id": 3
      }
    ]
  }
}
```

#####  æŸ¥è¯¢ç¤ºä¾‹3 æ¡ä»¶æŸ¥è¯¢

```
var Scchema = buildSchema(`

   type Film{
       id:Int,
       name:String,
       poster:String,
       price:Int
   }

   type Query{
       geteFilmDetail(id:Int!):Film
   }
`)
```

æ¡ä»¶

```
query{
  geteFilmDetail(id:1) {  æŸ¥è¯¢idä¸º1çš„é¡¹ï¼Œè¦id,posterå­—æ®µ
    id,poster
  }
}
```

æŸ¥è¯¢ç»“æœ

```
{
  "data": {
    "geteFilmDetail": {
      "id": 1,
      "poster": "http://1111"
    }
  }
}
```

å¤„ç†å™¨å…¥å‚ï¼Œå†™çš„æ˜¯ç»“æ„å½¢å¼

```
   geteFilmDetail( {id} ){   
        console.log(id)

        return faskeDb.filter(item=>item.id===id)[0]
    }
```





#### 4.mutationï¼ˆæ–°å¢å’Œä¿®æ”¹ï¼‰

æŸ¥è¯¢ä½¿ç”¨query ï¼Œä¿®æ”¹æ•°æ®ä½¿ç”¨ Mutation

##### æœ¬å°èŠ‚å®Œæ•´ä»£ç 

```react
const express = require("express")
const {buildSchema} = require("graphql")
const graphqlHttp = require("express-graphql")
var Scchema = buildSchema(`

   type Film{
       id:Int,
       name:String,
       poster:String,
       price:Int
   }

   input FilmInput{
        name:String,
        poster:String,
        price:Int
   }

   type Query{
       getNowplayingList:[Film]
    }

    type Mutation{
        createFilm(input: FilmInput):Film,
        updateFilm(id:Int!,input:FilmInput):Film,
        deleteFilm(id:Int!):Int
    }
`)

var faskeDb = [{
    id:1,
    name:"1111",
    poster:"http://1111",
    price:100
},
{
    id:2,
    name:"2222",
    poster:"http://2222",
    price:200
},
{
    id:3,
    name:"3333",
    poster:"http://333",
    price:300
}]
//å¤„ç†å™¨
const root = {
    getNowplayingList(){
        return faskeDb
    },

    createFilm({input}){
        var obj = {...input,id:faskeDb.length+1}

        faskeDb.push(obj)
        return obj
    },
    updateFilm({id,input}){
        console.log(id,input)
        var current = null
        faskeDb  = faskeDb.map(item=>{
            if(item.id===id){
                current = {...item,...input}
                return {...item,...input}
            }

            return item
        })

        return current
    },

    deleteFilm({id}){
        faskeDb = faskeDb.filter(item=>item.id!==id)

        return 1
    }
}

var app = express()
app.use("/graphql",graphqlHttp({
    schema:Scchema,
    rootValue:root,
    graphiql:true
}))

app.listen(3000)


```

##### æ–°å¢

æ–°å¢æ¡ä»¶

```
mutation{
  createFilm(input:{
    name:"tom",
    poster:"111",
    price:400
  }){
    id
  }
}     å…¥å‚inputï¼Œå†…å«ä¸‰ä¸ªå±æ€§å€¼ï¼ŒæœŸæœ›æ–°å¢æˆåŠŸåï¼Œè¿”å›æ–°å¢æ¡çš„id
```

æ–°å¢åçš„ç»“æœ

```
{
  "data": {
    "createFilm": {
      "id": 17
    }
  }
}
```

##### ä¿®æ”¹

ä¿®æ”¹æ¡ä»¶

```
mutation{
  updateFilm(id:1,input:{
    name:"ä¿®æ”¹",
    poster:"111",
    price:400
  }){
    id
  }
}
```

ä¿®æ”¹ç»“æœè¿”å›

```
{
  "data": {
    "updateFilm": {
      "id": 1
    }
  }
}
```

### 5.ç»“åˆæ•°æ®åº“mongodb

ç¬¬ä¸€æ­¥ï¼šå…ˆå®‰è£…ä¸€ä¸ªmongodbè½¯ä»¶ï¼Œæœ¬æ¡ˆä¾‹æ¼”ç¤ºæ˜¯å®‰è£…è½¯ä»¶çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯å…å®‰è£…çš„ã€‚

[å®‰è£…å‚è€ƒ](https://zhuanlan.zhihu.com/p/621780613)

[ä¸‹è½½å®˜ç½‘](https://www.mongodb.com/try/download/community)

å®‰è£…å®Œæˆåï¼Œå¯åŠ¨è½¯ä»¶ï¼Œå¼€å¯æ•°æ®åº“æœåŠ¡ï¼Œåœ¨27017ç«¯å£ã€‚

![](.\img\æ•°æ®åº“dbpng.png)

é¡¹ç›®ä»£ç 

```java
const express = require("express")
const {buildSchema} = require("graphql")
const graphqlHttp = require("express-graphql")

//-------------é“¾æ¥æ•°æ®åº“æœåŠ¡------------------------
var mongoose = require("mongoose")
// maizuo æ•°æ®åº“åå­—
mongoose.connect("mongodb://localhost:27017/maizuo",{ useNewUrlParser: true,useUnifiedTopology: true })//åé¢å‚æ•°æ˜¯å…³é—­è­¦å‘Š 

//é™åˆ¶ æ•°æ®åº“è¿™ä¸ªfilmsï¼ˆé›†åˆè¡¨ï¼‰ åªèƒ½å­˜ä¸‰ä¸ªå­—æ®µ   (mongodbæ˜¯ä»¥æ¨¡å‹ä¸ºå¯¹è±¡è¿›è¡Œæ•°æ®ç®¡ç†çš„ï¼Œæ‰€ä»¥ä½¿ç”¨å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªã€‚filmå°±æ˜¯æ•°æ®åº“ä¸­çš„åˆ›å»ºçš„ä¸€ä¸ªé›†åˆåå­—)
//åªè¦æ˜¯é™åˆ¶å­˜å…¥çš„æ•°æ®æ ¼å¼ï¼Œé˜²æ­¢æ•°æ®é”™ä¹±
var FilmModel = mongoose.model("film",new mongoose.Schema({
    name:String,
    poster:String,
    price:Number
}))
// åˆ›å»ºä¹‹åï¼Œæ¨¡å‹å¯¹è±¡ç»™å‡ºCRUDæ“ä½œçš„æ–¹æ³•ï¼Œåªè¦ä½¿ç”¨è¿™ä¸ªå·¥å…·å‡½æ•° å°±èƒ½æ“ä½œæ•°æ®ã€‚ æ•°æ®åº“åå­—ï¼ˆmaizuoï¼‰å’Œé‡Œé¢çš„é›†åˆåå­—filmï¼Œmongodbä¸­æ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»º 
// FilmModel.create
// filmModel.find
// FilmModel.update
// FimlModel.delete
//-------------------------------------

// buildSchemaä¸­å£°æ˜æ“ä½œä¸€ä¸ªç±»å‹åªèƒ½ä¸€ä¸ª ä¾‹å¦‚æŸ¥è¯¢æ–¹æ³•Queryï¼Œè‡ªå·±çš„é€»è¾‘éƒ½æ”¾åˆ°è¿™ä¸€ä¸ªé‡Œé¢ã€‚å¦åˆ™æŠ¥é”™
var Scchema = buildSchema(`

   type Film{
       id:String,
       name:String,
       poster:String,
       price:Int
   }

   input FilmInput{
        name:String,
        poster:String,
        price:Int
   }

   type Query{
       getNowplayingList(id:String!):[Film]
       getAll(id:String):[Film]
    }

    type Mutation{
        createFilm(input: FilmInput):Film,
        updateFilm(id:String!,input:FilmInput):Film,
        deleteFilm(id:String!):Int
    }
`)
//å¤„ç†å™¨
const root = {
    getAll(){
        return FilmModel.find()
    },
    getNowplayingList({id}){
        if(!id) return FilmModel.find() //ä¸åŠ æ¡ä»¶æ˜¯æŸ¥è¯¢å…¨éƒ¨
        return FilmModel.find({_id:id})
    },

    createFilm({input}){
        /*
          1. åˆ›å»ºæ¨¡å‹
          2. æ“ä½œæ•°æ®åº“
        */
        return FilmModel.create({
            ...input
        })
    },
    updateFilm({id,input}){
        // è¿™é‡Œé¢çº¯mondgodbçš„æ–¹æ³•
        return FilmModel.updateOne({
            _id:id
        },{
            ...input
        }).then(res=>FilmModel.find({_id:id})).then(res=>res[0])
        // ä¿®æ”¹å®Œè¿”å›çš„res {ok:1,nModified:0,n:1} å¦‚æœæƒ³ç¡®è®¤ä¸€ä¸‹æ˜¯å¦ä¿®æ”¹æˆåŠŸã€‚å¯ä»¥é“¾å¼çš„å†æŸ¥ä¸€é
    },

    deleteFilm({id}){
        return FilmModel.deleteOne({_id:id}).then(res=>1)
    }
}

var app = express()
app.use("/graphql",graphqlHttp({
    schema:Scchema,
    rootValue:root,
    graphiql:true
}))

//é…ç½®é™æ€èµ„æºç›®å½•
app.use(express.static("public"))

app.listen(3000)

```

å¯åŠ¨æ¥å£graphqlé¡¹ç›®ï¼Œè®¿é—® http://localhost:3000/graphql

æ¥ä¸‹æ¥æµ‹è¯•ï¼Œgraphqlé¡¹ç›®ï¼Œæ˜¯å¦å¯ä»¥æ­£å¸¸æ“ä½œmongodbæ•°æ®

![](.\img\qlæœåŠ¡png.png)



##### ä¾æ¬¡æµ‹è¯•CRUD

###### å¢åŠ 

è§¦å‘graphalçš„ä¿®æ”¹æ“ä½œï¼Œå·¦ä¾§è¾“å…¥å¦‚ä¸‹æŒ‡ä»¤

```
mutation{
  createFilm(input:{
    name:"111",
    poster:"http://111",
    price:10
  }) {
    id
  }
}
```

ç„¶åï¼ŒæŸ¥çœ‹mongodbï¼ŒæŸ¥çœ‹æ•°æ®åº“, æ–°å¢ä¸€ä¸ªæ•°æ®åº“maizuo,å’Œå…¶ä¸­æŠ¼ç»™é›†åˆfilmsã€‚

![](.\img\æ·»åŠ æ•°æ®.png)



###### ä¿®æ”¹

graphqlè¾“å…¥æŒ‡ä»¤

```
657d7203e45c8253e88520beæ˜¯ä»æ•°æ®åº“ä¸­éšä¾¿æ‰¾ä¸€ä¸ª

mutation{
  updateFilm(id:"657d7203e45c8253e88520be",input:{
    name:"111ä¿®æ”¹äº†",
    poster:"http://111777",
    price:10
  }) {
    id
  }
}
```

###### åˆ é™¤

```
æ˜¯ä»æ•°æ®åº“ä¸­éšä¾¿æ‰¾ä¸€ä¸ªid
mutation{
  deleteFilm(id:"657d7203e45c8253e88520be")

}
```

æŸ¥è¯¢æ‰€æœ‰

```
query{
  getAll {
    id,name
  }
}
æˆ–è€…
     æ›´å…·idæŸ¥æ‰¾ï¼Œidä¸ºç©ºå°±æŸ¥æ‰¾æ‰€æœ‰
query{
  getNowplayingList( id:"",) {
    id,name
  }
}


```

### 6. htmlå‰ç«¯é¡¹ç›®ä½¿ç”¨CRUDæ¥å£

ä¸ºä¾¿äºæµ‹è¯•ï¼Œserveé¡¹ç›®ï¼Œå¯¹å¤–æš´æ¼é™æ€æ–‡ä»¶åœ°å€ã€‚è¿™æ ·ï¼Œå¯ä»¥å’Œæ¥å£æœåŠ¡ï¼Œå…¬ç”¨åŒä¸€ä¸ªipå’ŒåŸŸåï¼Œä¸ä¼šè·¨åŸŸã€‚

```
var app = express()
app.use("/graphql",graphqlHttp({
    schema:Scchema,
    rootValue:root,
    graphiql:true
}))

//é…ç½®é™æ€èµ„æºç›®å½•
app.use(express.static("public"))

app.listen(3000)

```

é¡¹ç›®ä¸­ï¼Œæ–°å»ºä¸€ä¸ªpublicæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ–°å»ºä¸€ä¸ªhome.htmlæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼Œç«¯å£3000æœåŠ¡ä¸‹ï¼Œ

```
http://localhost:3000/home.html  å³å¯ä»¥è®¿é—®æµ‹è¯•htmlé¡µé¢
```





ä½¿ç”¨æ–¹å¼å’Œè§„èŒƒ

home.htm

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>home</h1>

    <button onclick="getData()">æŸ¥è¯¢æ•°æ®</button>
    <button onclick="createData()">åˆ›å»ºæ•°æ®</button>
    <button onclick="updateData()">æ›´æ–°æ•°æ®</button>
    <button onclick="deleteData()">åˆ é™¤æ•°æ®</button>

    <script>
        function getData() {

            const myquery = `
            query {
                getNowplayingList( id:"",) {
                    id,
                    name
                }
            }
            `
            fetch("/graphql", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify({
                    query: myquery
                })
            }).then(res => res.json()).then(res => {
                console.log(res)
            })
        }

        function createData() {
            const myquery = `
            mutation ($input:FilmInput){

                createFilm(input:$input) {
                    id,
                    name
                }
            }
            `
            fetch("/graphql", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify({
                    query: myquery,
                    variables: {
                        input: {
                            name: "htmlåˆ›å»ºçš„7777",
                            price: 60,
                            poster: "http://7777"
                        }
                    }
                })
            }).then(res => res.json()).then(res => {
                console.log(res)
            })
        }

        function updateData() {
            const myquery = `
            mutation ($id:String!,$input:FilmInput){

                updateFilm(id:$id,input:$input) {
                    id,
                    name
                }
            }
            `
            fetch("/graphql", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify({
                    query: myquery,
                    variables: {
                        id: "61e520b322f995d3f88f3faa",
                        input: {
                            name: "6666-ä¿®æ”¹",
                            price: 66,
                            poster: "http://6666-ä¿®æ”¹"
                        }
                    }
                })
            }).then(res => res.json()).then(res => {
                console.log(res)
            })
        }

        function deleteData() {
            const myquery = `
            mutation ($id:String!){

                deleteFilm(id:$id)
            }
            `
            fetch("/graphql", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify({
                    query: myquery,
                    variables: {
                        id: "61e520b322f995d3f88f3faa"
                    }
                })
            }).then(res => res.json()).then(res => {
                console.log(res)
            })
        }
    </script>
</body>

</html>
```

### 7åœ¨reacté¡¹ç›®ä¸­CRUDçš„æ“ä½œ

å®‰è£…ç›¸å…³æ’ä»¶, ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ä¸ªgraphqlæ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€,å¦ä¸€ä¸ªæ˜¯apolloï¼Œ[apollo](https://blog.csdn.net/Clearlove_S7/article/details/130913876)

```
npm i react-apollo apollo-boost graphql graphql-tag

dependenciesä¸­ 
    "apollo-boost": "^0.4.9",
    "react-apollo": "^3.1.5",
    "graphql": "^16.2.0",
    "graphql-tag": "^2.12.6"
```

servesæœåŠ¡ä»£ç 

```javascript
const express = require("express")
const {buildSchema} = require("graphql")
const graphqlHttp = require("express-graphql")

//-------------é“¾æ¥æ•°æ®åº“æœåŠ¡------------------------
var mongoose = require("mongoose")
// maizuo æ•°æ®åº“åå­—
mongoose.connect("mongodb://localhost:27017/maizuo",{ useNewUrlParser: true,useUnifiedTopology: true })//åé¢å‚æ•°æ˜¯å…³é—­è­¦å‘Š 

//é™åˆ¶ æ•°æ®åº“è¿™ä¸ªfilmsï¼ˆé›†åˆè¡¨ï¼‰ åªèƒ½å­˜ä¸‰ä¸ªå­—æ®µ   (mongodbæ˜¯ä»¥æ¨¡å‹ä¸ºå¯¹è±¡è¿›è¡Œæ•°æ®ç®¡ç†çš„ï¼Œæ‰€ä»¥ä½¿ç”¨å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªã€‚filmå°±æ˜¯æ•°æ®åº“ä¸­çš„åˆ›å»ºçš„ä¸€ä¸ªé›†åˆåå­—)
//åªè¦æ˜¯é™åˆ¶å­˜å…¥çš„æ•°æ®æ ¼å¼ï¼Œé˜²æ­¢æ•°æ®é”™ä¹±
var FilmModel = mongoose.model("film",new mongoose.Schema({
    name:String,
    poster:String,
    price:Number
}))
// åˆ›å»ºä¹‹åï¼Œæ¨¡å‹å¯¹è±¡ç»™å‡ºCRUDæ“ä½œçš„æ–¹æ³•ï¼Œåªè¦ä½¿ç”¨è¿™ä¸ªå·¥å…·å‡½æ•° å°±èƒ½æ“ä½œæ•°æ®ã€‚ æ•°æ®åº“åå­—ï¼ˆmaizuoï¼‰å’Œé‡Œé¢çš„é›†åˆåå­—filmï¼Œmongodbä¸­æ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»º 
// FilmModel.create
// filmModel.find
// FilmModel.update
// FimlModel.delete
//-------------------------------------

// buildSchemaä¸­å£°æ˜æ“ä½œä¸€ä¸ªç±»å‹åªèƒ½ä¸€ä¸ª ä¾‹å¦‚æŸ¥è¯¢æ–¹æ³•Queryï¼Œè‡ªå·±çš„é€»è¾‘éƒ½æ”¾åˆ°è¿™ä¸€ä¸ªé‡Œé¢ã€‚å¦åˆ™æŠ¥é”™
var Scchema = buildSchema(`

   type Film{
       id:String,
       name:String,
       poster:String,
       price:Int
   }

   input FilmInput{
        name:String,
        poster:String,
        price:Int
   }

   type Query{
       getNowplayingList(id:String):[Film]
       getAll(id:String):[Film]
    }

    type Mutation{
        createFilm(input: FilmInput):Film,
        updateFilm(id:String!,input:FilmInput):Film,
        deleteFilm(id:String!):Int
    }
`)
//å¤„ç†å™¨
const root = {
    getAll(){
        return FilmModel.find()
    },
    getNowplayingList({id}){
        if(!id) return FilmModel.find() //ä¸åŠ æ¡ä»¶æ˜¯æŸ¥è¯¢å…¨éƒ¨
        return FilmModel.find({_id:id})
    },

    createFilm({input}){
        /*
          1. åˆ›å»ºæ¨¡å‹
          2. æ“ä½œæ•°æ®åº“
        */
        return FilmModel.create({
            ...input
        })
    },
    updateFilm({id,input}){
        // è¿™é‡Œé¢çº¯mondgodbçš„æ–¹æ³•
        return FilmModel.updateOne({
            _id:id
        },{
            ...input
        }).then(res=>FilmModel.find({_id:id})).then(res=>res[0])
        // ä¿®æ”¹å®Œè¿”å›çš„res {ok:1,nModified:0,n:1} å¦‚æœæƒ³ç¡®è®¤ä¸€ä¸‹æ˜¯å¦ä¿®æ”¹æˆåŠŸã€‚å¯ä»¥é“¾å¼çš„å†æŸ¥ä¸€é
    },

    deleteFilm({id}){
        return FilmModel.deleteOne({_id:id}).then(res=>1)
    }
}

var app = express()


app.use("/graphql",graphqlHttp({
    schema:Scchema,
    rootValue:root,
    graphiql:true
}))

//é…ç½®é™æ€èµ„æºç›®å½•
app.use(express.static("public"))

app.listen(3000)


```

setupProxy.js  ä»£ç†é…ç½®

```
  app.use(
    '/graphql', 
    createProxyMiddleware({
      target: 'http://localhost:3000',
      changeOrigin: true
    })
  );
```



##### æŸ¥è¯¢è¯­å¥Query

```react

import React, { Component } from 'react'

import {ApolloProvider,Query} from 'react-apollo'
import ApolloClient  from 'apollo-boost'
import gql  from 'graphql-tag'

const client = new ApolloClient({
    uri:"/graphql"              <-----1 æ¥å£æœåŠ¡3000ä¸Š  reacté¡¹ç›®éœ€è¦é…ç½®ä»£ç† ä»£ç è§ä¸Šé¢
})

export default class App extends Component {
    render() {
        return (
            <ApolloProvider client = {client}>
                <div>
                    <KerwinQuery></KerwinQuery>
                </div>
            </ApolloProvider>
        )
    }
}

class KerwinQuery extends Component{
// <-----2  è¿™é‡Œçš„æŸ¥è¯¢è¯­å¥ï¼Œè¦å’Œserveä¸­çš„æŸ¥è¯¢è¯­å¥å¯¹åº”ï¼›åœ¨graphqlä¸­pcé¡µé¢æµ‹è¯•æˆåŠŸã€‚
    query = gql`  
          query {
            getNowplayingList {
            id,
            name,
            price
            }
        }
    `
    render(){
        return <Query query={this.query}>
            {
                ({loading, data})=>{
                    console.log(loading,data)
                    return loading?<div>loading....</div>:
                    <div>
                        {   // <-----2 getNowplayingListå­—æ®µæ˜¯è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•åå­—
                            data.getNowplayingList.map(item=>
                                <div key={item.id}>
                                    <div>åå­—ï¼š{item.name}</div>
                                    <div>ä»·æ ¼ï¼š{item.price}</div>
                                </div>    
                            )
                        }
                    </div>
                }
            }
        </Query>
    }
}
```

æ³¨æ„ç‚¹ï¼šå®æµ‹ä¸­ï¼Œå®‰è£…åå¯åŠ¨ï¼Œå¦‚ä¸ŠæŸ¥è¯¢é¡µé¢åŠ è½½æŠ¥é”™ï¼Œå°±åˆ æ‰ **node_modules** é‡æ–°åˆå§‹åŒ–ã€‚

##### æ¡ä»¶æŸ¥è¯¢Query

æ³¨æ„ç‚¹ï¼š

loading, data, refetchä¸‰ä¸ªå‚æ•°ï¼šæ•°æ®è¯·æ±‚ä¸­loading æ˜¯true,è¯·æ±‚å›æ¥åï¼Œdataå½¢å‚ä¼ å…¥ï¼Œloadingå˜false,åˆ©ç”¨è¿™ç‚¹å¯ä»¥ä½œä¸ºåŠ è½½ç­‰å¾…æ•ˆæœã€‚ refetchæ–¹æ³•ï¼Œæ˜¯è§¦å‘Queryç»„ä»¶ï¼Œåˆ·æ–°ã€‚ å› ä¸ºå®ƒä¸æ˜¯reactçš„ç»„ä»¶ï¼Œæ‰€ä»¥æ›´æ–°æ•°æ®åï¼Œéœ€è¦ä½¿ç”¨apolloæä¾›çš„æ–¹æ³•ã€‚



```react

import React, { Component } from 'react'
import {ApolloProvider,Query} from 'react-apollo'
import ApolloClient  from 'apollo-boost'
import gql  from 'graphql-tag'

const client = new ApolloClient({
    uri:"/graphql"
})
export default class App extends Component {
    render() {
        return (
            <ApolloProvider client = {client}>
                <div>
                    <KerwinQuery></KerwinQuery>
                </div>
            </ApolloProvider>
        )
    }
}

class KerwinQuery extends Component{

    query = gql`
        query getNowplayingList($id:String!){
            getNowplayingList(id:$id) {
            id,
            name,
            price
            }
        }
    `
    state = {
        id:"657d776a1533e91bec364781"
    }
    render(){
        return <div>
            <input type="text" onChange={(evt)=>{
                this.setState({
                    id:evt.target.value
                })
            }}/>
           {/* variableså±æ€§ï¼Œå…¥å‚ä¼šä¼ åˆ°queryä¸­ï¼Œå¯¹åº”$id */}
            <Query query={this.query} variables={{id:this.state.id}}>   
            {
                ({loading, data, refetch})=>{
                    console.log(loading)
                      console.log(refetch)
                    return loading?<div>loading....</div>:
                    <div>
                        {
                            data.getNowplayingList.map(item=>
                                <div key={item.id}>
                                    <div>åå­—ï¼š{item.name}</div>
                                    <div>ä»·æ ¼ï¼š{item.price}</div>
                                </div>    
                            )
                        }
                    </div>
                }
            }
        </Query>
        </div>
    }
}
```

##### æ–°å¢æ“ä½œMutation

react-apolloæ’ä»¶ï¼Œæä¾›äº†Mutationç»„ä»¶

```

import React, { Component } from 'react'
import {ApolloProvider,Mutation} from 'react-apollo'//Mutationç»„ä»¶  ä¿®æ”¹æ“ä½œ
import ApolloClient  from 'apollo-boost'
import gql  from 'graphql-tag'

const client = new ApolloClient({
    uri:"/graphql"
})
export default class App extends Component {
    render() {
        return (
            <ApolloProvider client = {client}>
                <div>
                    <KerwinCreate></KerwinCreate>
                </div>
            </ApolloProvider>
        )
    }
}

class KerwinCreate extends Component{
//  createFilm($input: FilmInput ç¬¬ä¸€å±‚ æ˜¯è¡¨è¿° ï¼Œ ç¬¬äºŒå±‚ createFilm(input:$input)æ˜¯ä¼ å‚
    createFilm = gql`
    mutation createFilm($input: FilmInput){

        createFilm(input:$input) {
          id,
          name,
          price
        }
      }
    `
    render(){
        return <div>
            <Mutation mutation={this.createFilm}>
                {
                    (createFilm,{data})=>{
                        console.log(data)
                        return <div>
                            <button onClick={()=>{
                                createFilm({
                                    variables:{
                                        input:{
                                            name:"lyx",
                                            poster:"http://777",
                                            price:70
                                        }
                                    }
                                })
                            }}>add</button>
                        </div>
                    }
                }
            </Mutation>
        </div>
    }
}
```

##### ä¿®æ”¹Mutation

Mutation

```react

import React, { Component } from 'react'
import {ApolloProvider,Mutation} from 'react-apollo'
import ApolloClient  from 'apollo-boost'
import gql  from 'graphql-tag'

const client = new ApolloClient({
    uri:"/graphql"
})
export default class App extends Component {
    render() {
        return (
            <ApolloProvider client = {client}>
                <div>
                    <KerwinUpdate></KerwinUpdate>
                </div>
            </ApolloProvider>
        )
    }
}

class KerwinUpdate extends Component{

    createFilm = gql`
    mutation updateFilm($id:String!,$input: FilmInput){

        updateFilm(id:$id,input:$input) {
          id,
          name,
          price
        }
      }
    `
    render(){
        return <div>
            <Mutation mutation={this.createFilm}>
                {
                    (updateFilm,{data})=>{
                        console.log(data)
                        return <div>
                            <button onClick={()=>{
                                updateFilm({
                                    variables:{
                                        id:"657ec010857267511c25f21a",
                                        input:{
                                            name:"777-ä¿®æ”¹",
                                            poster:"http://777-ä¿®æ”¹",
                                            price:700
                                        }
                                    }
                                })
                            }}>update</button>
                        </div>
                    }
                }
            </Mutation>
        </div>
    }
}
```

##### åˆ é™¤Mutation

```react

import React, { Component } from 'react'
import {ApolloProvider,Mutation} from 'react-apollo'
import ApolloClient  from 'apollo-boost'
import gql  from 'graphql-tag'

const client = new ApolloClient({
    uri:"/graphql"
})
export default class App extends Component {
    render() {
        return (
            <ApolloProvider client = {client}>
                <div>
                    <KerwinDelete></KerwinDelete>
                </div>
            </ApolloProvider>
        )
    }
}

class KerwinDelete extends Component{

    createFilm = gql`
    mutation deleteFilm($id:String!){

        deleteFilm(id:$id)
      }
    `
    render(){
        return <div>
            <Mutation mutation={this.createFilm}>
                {
                    (deleteFilm,{data})=>{
                        console.log(data)
                        return <div>
                            <button onClick={()=>{
                                deleteFilm({
                                    variables:{
                                        id:"657d77241533e91bec36477f"
                                    }
                                })
                            }}>delete</button>
                        </div>
                    }
                }
            </Mutation>
        </div>
    }
}
```

æ€»ç»“ï¼šåŠŸèƒ½å¾—ä»¥å®ç°ï¼Œæ˜¯é€šè¿‡abolloæä¾›çš„ä¾›åº”å•†ç»„ä»¶ï¼Œä»appæ ¹ç»„ä»¶æ³¨å…¥ï¼Œå­ç»„ä»¶ä½¿ç”¨æä¾›çš„CRUDç›¸å¯¹åº”çš„æ–¹æ³•ï¼Œç”¨æ³•ä¸GraphQåŸºæœ¬ä¸€è‡´ã€‚å®šä¹‰çº¦æŸï¼Œæ–¹æ³•ï¼Œå‚æ•°ã€‚

### 8.Dva.JSï¼ˆé˜¿é‡Œreactå‰ç«¯å¼€å‘æ¡†æ¶ï¼‰

dva æ˜¯ç”±é˜¿é‡Œæ¶æ„å¸ˆ sorrycc å¸¦é¢† team å®Œæˆçš„ä¸€å¥—å‰ç«¯æ¡†æ¶ï¼Œåœ¨ä½œè€…çš„ [github](https://so.csdn.net/so/search?q=github&spm=1001.2101.3001.7020) é‡Œæ˜¯è¿™ä¹ˆæè¿°å®ƒçš„ï¼šâ€œdva æ˜¯ react å’Œ redux çš„æœ€ä½³å®è·µâ€ã€‚

ï¼ˆå®é™…é¡¹ç›®ä¸­å¾ˆå°‘å•ç‹¬å¼€å‘ï¼Œéƒ½æ˜¯é…åˆUmijsä½¿ç”¨ã€‚ï¼‰

https://dvajs.com/

https://dvajs.com/knowledgemap/#javascript-%E8%AF%AD%E8%A8%80 çŸ¥è¯†åœ°å›¾

#### 1.ä»‹ç»

1.What's dva ?
dva æ˜¯åŸºäºç°æœ‰åº”ç”¨æ¶æ„ (redux + react-router + redux-saga ç­‰)çš„ä¸€å±‚è½»é‡å°è£…ã€‚dva æ˜¯ react å’Œ redux çš„æœ€ä½³å®è·µã€‚æœ€æ ¸å¿ƒçš„æ˜¯æä¾›äº† app.model æ–¹æ³•ï¼Œç”¨äºæŠŠ reducer, initialState, action, saga å°è£…åˆ°ä¸€èµ·ã€‚å®˜ç½‘    dva = React-Router + Redux + Redux-sagaã€‚

dva é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº redux å’Œ redux-sagaçš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva è¿˜é¢å¤–å†…ç½®äº† react-router å’Œ fetchæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚

#### 2.å®‰è£…

1.å®‰è£… dva-cli
npm install dva-cli -g
2.æ‰åˆ°å®‰è£…é¡¹ç›®çš„ç›®å½•
cd ylz_project/my_reactdemo
3.åˆ›å»ºé¡¹ç›®ï¼šDva-testé¡¹ç›®å
dva new Dva-test
4.è¿›å…¥é¡¹ç›®
cd Dva-test
5.å¯åŠ¨é¡¹ç›®
npm start

å¤‡æ³¨ï¼š

å¦‚æœæŠ¥é”™ `'roadhog' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ `ï¼Œå°± `npm i roadhog -g`;

å¦‚æœæŠ¥é”™è¾ƒå¤š éƒ½æ˜¯dvaç›¸å…³ï¼Œå¯èƒ½æ˜¯ä¾èµ–ä¸å…¨ï¼Œåˆ é™¤node_modulesé‡æ–°å®‰è£…ä¾èµ–ã€‚

#### 3.é¡¹ç›®ç»“æ„

![](https://img-blog.csdn.net/20180823163149227?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhb194dV81MjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)



[å­¦ä¹ reactå‰ç«¯æ¡†æ¶dva](https://blog.csdn.net/gao_xu_520/article/details/81979463?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-81979463-blog-128194072.235%5Ev39%5Epc_relevant_anti_vip_base&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-81979463-blog-128194072.235%5Ev39%5Epc_relevant_anti_vip_base&utm_relevant_index=6)

#### 4.dva åº”ç”¨çš„æœ€ç®€ç»“æ„

```react
import dva from 'dva';
const App = () => <div>Hello dva</div>;

// åˆ›å»ºåº”ç”¨
const app = dva();
// æ³¨å†Œè§†å›¾
app.router(() => <App />);
// å¯åŠ¨åº”ç”¨
app.start('#root');

```

#### 5.é…ç½®history

 é¡¹ç›®é»˜è®¤hash

router.js

```react
import React from 'react';
import { Router, Route, Switch } from 'dva/router';
import IndexPage from './routes/IndexPage';

function RouterConfig({ history }) {
  return (
    <Router history={history}> 
      <Switch>
        <Route path="/" exact component={IndexPage} />
      </Switch>
    </Router>
  );
}

export default RouterConfig;

```

å¦‚æœä¿®æ”¹ä¸ºhistoryï¼Œé…ç½®æ–¹æ³•åœ¨dvaï¼ˆ{ä¼ å‚æ–¹å¼}ï¼‰

index.js

```
import dva from 'dva';
import './index.css';

// 1. Initialize
const app = dva(
    {
        //   history:require("history").createBrowserHistory()  //è¿™é‡Œ
    }
);

// 2. Plugins
// app.use({});

// 3. Model
// app.model(require('./models/example').default);

// 4. Router
app.router(require('./router').default);

// 5. Start
app.start('#root');
```

é‡åˆ°é—®é¢˜ï¼šå› ä¸ºdvaç‰ˆæœ¬é—®é¢˜,å¦‚æœhistoryæç¤ºæ‰¾ä¸åˆ°æ–¹æ³•ã€‚ å°±ä½¿ç”¨ç¬¬ä¸‰æ–¹historyæ’ä»¶ã€‚

npm install history

```
import { createBrowserHistory as createHistory } from 'history';
 
const app = dva({
  history: createHistory()
});
```

[è¯¦æƒ…å‚ç…§](https://blog.csdn.net/weixin_33991418/article/details/91888694)

##### å…·ä½“åŠŸèƒ½å˜åŒ–ï¼Ÿ

###### 1.è·¯ç”±

ï¼š åŸºæœ¬æ²¡å˜ï¼ŒäºŒçº§è·¯ç”±ä½¿ç”¨ Routeçš„renderçš„é‡å†™åŠŸèƒ½ã€‚

```react
import React from 'react';
import { Router, Route, Switch,Redirect } from 'dva/router';
import App from './routes/App';
import Film from './routes/Film';
import Cinema from './routes/Cinema';
import Center from './routes/Center';
import Detail from './routes/Detail';
import Login from './routes/Login';

function RouterConfig({ history }) {
  return (
    <Router history={history}>
      <Switch>
        <Route path="/login" component={Login}/>
        <Route path="/" render={()=>
          <App>
             <Switch>
              <Route path="/film" component={Film}/>
              <Route path="/cinema" component={Cinema}/>
              <Route path="/center" render={()=>localStorage.getItem("token")?<Center/>:                  <Redirect to="/login"/>}/>
              <Route path="/detail/:myid" component={Detail}/>

              <Redirect from="/" to="/film"></Redirect>
             </Switch>
          </App>
        }/>

      </Switch>
    </Router>
  );
}

export default RouterConfig;

```

###### 2.reduxå…¬å…±strory

modelsæ–‡ä»¶ä¸­ä¸“é—¨æ”¾ç½®ç®¡ç†storyï¼Œæ ¹æ®å‘½åç©ºé—´ï¼Œå¯ä»¥å¤šä¸ªæ–‡ä»¶jsï¼Œè¿™æ ·å°ç»„å†…æ¯ä¸ªæˆå‘˜éƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„stateç©ºé—´ï¼Œç®¡ç†è‡ªå·±çš„å…¬å…±æ•°æ®

###### ä½¿ç”¨reducersä¸­çš„å±æ€§

modelsæ–‡ä»¶å¤¹ä¸‹

```
export default {

    namespace: 'maizuo',// å‘½åç©ºé—´ connecté«˜é˜¶ç»„ä»¶åŒ…è£…å æœ¬ç©ºé—´æ•°æ®ä»¥keyå¯¹è±¡å½¢å¼æ³¨å…¥stateå‹å‚ä¸­
  
    state: {
        isShow:true,
        list:[]
    },
```

routeræ–‡ä»¶ä¸‹app.js

```react
import { connect } from 'dva'
import React, { Component } from 'react'
import Tabbar from '../components/Tabbar'

class App extends Component {
    componentDidMount() {
        // console.log(this.props)
    }
    
    render() {
        return (
            <div>
                {this.props.children}
                {this.props.isShow && <Tabbar/>}
            </div>
        )
    }
}

export default connect((state)=>{
    console.log(state)
    // è¿™é‡Œå‚æ•°é‡æ•´ è¿™é‡Œé‚£ä¸ªkeyï¼ŒAppç»„ä»¶ä¸­å°±æ€ä¹ˆä½¿ç”¨
    return {                   
        a:1,
        isShow:state.maizuo.isShow
    }
})(App)
```

###### reducersä¸­çš„äº‹ä»¶



models/maizuo.js

```react
export default {

    namespace: 'maizuo',// å‘½åç©ºé—´ connecté«˜é˜¶ç»„ä»¶åŒ…è£…å æœ¬ç©ºé—´æ•°æ®ä»¥keyå¯¹è±¡å½¢å¼æ³¨å…¥stateå‹å‚ä¸­
  
    state: {
        isShow:true,
        list:[]
    },

    reducers:{
        hide(prevState,action){
            return {...prevState,isShow:false}
        },
        show(prevState,action){
            return {...prevState,isShow:true}
        },
    },
```

detail.jsè°ƒç”¨é¡µé¢

```react
import { connect } from 'dva'
import React, { Component } from 'react'

class Detail extends Component {
    componentDidMount() {
        console.log(`æ¥å—ä¸Šä¸ªé¡µé¢ä¼ æ¥çš„id,åˆ©ç”¨æ­¤idå–æ•°æ®`,this.props.match.params.myid)

        // console.log(this.props)

        this.props.dispatch({
            type:"maizuo/hide"   // æ³¨æ„è°ƒç”¨æ–¹æ³•   type:å‘½åç©ºé—´/è¦è°ƒç”¨çš„æ–¹æ³•
        })
    }

    componentWillUnmount(){
        this.props.dispatch({
            type:"maizuo/show"
        })
    }
    
    render() {
        return (
            <div>
                Detail
            </div>
        )
    }
}

export default connect()(Detail)  //åŒ…è£…åï¼Œæ³¨å…¥å±æ€§ï¼ˆstate å¯é€‰ï¼‰ å’Œæ–¹æ³•dispatch
```

###### å¼‚æ­¥äº‹ä»¶

å…³é”®ç‚¹ï¼šeffects {}ä¸‹çš„å¼‚æ­¥æ–¹æ³•

modelsæ–‡ä»¶ä¸‹maizuo.js

```
import { getCinemaListService } from "../services/maizuo"

export default {

    namespace: 'maizuo',// å‘½åç©ºé—´ connecté«˜é˜¶ç»„ä»¶åŒ…è£…å æœ¬ç©ºé—´æ•°æ®ä»¥keyå¯¹è±¡å½¢å¼æ³¨å…¥stateå‹å‚ä¸­
  
    state: {
        list:[]
    },

    reducers:{


        changeCinemaList(prevState,{payload}){
            return {...prevState,list:payload}
        }
    },


    //å¼‚æ­¥- redux-saga
    effects:{
        *getCinemaList(action,{call,put}){
            // console.log(obj)
            var res = yield call(getCinemaListService) //callé‡Œé¢æ”¾promiseæ–¹æ³•
            console.log(res.data.data.cinemas)
            yield put({
                type:"changeCinemaList",  // æ•°æ®å›æ¥åï¼Œè°ƒç”¨æ™®é€šåŒæ­¥äº‹ä»¶ï¼Œè§¦å‘reducersäº‹ä»¶
                payload:res.data.data.cinemas
            })
        }
    }
}
```

services/maizuoæ¥å£è¯·æ±‚æ•°æ®å°è£…

```
import request from '../utils/request'

export function getCinemaListService() {
    return request("https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=5386964", {
        headers: {
            'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.2.0","e":"16395416565231270166529","bc":"110100"}',
            'X-Host': 'mall.film-ticket.cinema.list'
        }
    })
}
```



ç”µå½±ç»„ä»¶ä½¿ç”¨æ•°æ®

```react
import { connect } from 'dva'
import React, { Component } from 'react'

class Cinema extends Component {
    componentDidMount() {
        if(this.props.list.length===0){
            //dispatch
            this.props.dispatch({    <----é‡ç‚¹   è°ƒç”¨æ–¹æ³• maizuoç©ºé—´ä¸­çš„getCinemaListæ–¹æ³•
                type:"maizuo/getCinemaList"
            })
        }else{
            console.log("ç¼“å­˜",this.props.list)
        }
    }
    
    render() {
        return (
            <div>
                <ul>
                    {
                        this.props.list.map(item=>
                            <li key={item.cinemaId}>
                                {item.name}
                            </li>    
                        )
                    }
                </ul>
            </div>
        )
    }
}
const mapStateToProps = (state)=>({  // åŒ…è£…ç»„ä»¶
    list:state.maizuo.list
})
export default connect(mapStateToProps)(Cinema)
```











**æ•°æ®æµå›¾**

æµè§ˆå™¨ä¸­è¾“å…¥é¡¹ç›®è·¯ç”±ï¼Œrouteæ–‡ä»¶ä¸‹éƒ½æ˜¯ç»„ä»¶é¡µé¢ï¼Œç»„ä»¶ç»è¿‡connecté«˜é˜¶å‡½æ•°åŒ…è£…åï¼Œèµ‹äºˆäº†stateæ•°æ®å’Œdispatchæ–¹æ³•ï¼Œåˆ°è¢«åŒ…è£…ç»„ä»¶çš„propsï¼Œç»„ä»¶ä½¿ç”¨dispatchè°ƒç”¨å¯¹åº”ç©ºé—´å‘½åä¸­çš„æ–¹æ³•ï¼Œè°ƒç”¨reduceräº‹ä»¶ï¼Œä¿®æ”¹stateï¼Œæ›´æ”¹è§†å›¾ã€‚å¦‚æœæ˜¯å¼‚æ­¥äº‹ä»¶ï¼Œæ–¹æ³•ååŒ¹é…åˆ°Effectï¼š{æ–¹æ³•}ï¼ŒyieldçŠ¶æ€ç”Ÿæˆå™¨ï¼Œ è¿”å›æ¥å£æ•°æ®åyield putï¼Œå†è§¦å‘reducersä¸­çš„æ™®é€šçš„åŒæ­¥äº‹ä»¶ï¼Œåé¢ç…§å¸¸ã€‚

![](.\img\dva.png)

##### 6.è·¨åŸŸé…ç½®

é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸ª .webpackrcæ–‡ä»¶ ï¼Œjsonæ•°æ®æ ¼å¼ï¼Œé…ç½®è·¨åŸŸ

æ¡ˆä¾‹ï¼š1

```react
import React, { Component } from 'react'
import {withRouter} from 'dva/router'
import request from '../utils/request'
export default class Center extends Component {
    render() {
        return (
            <div>
                Center
                <WithChild/>
            </div>
        )
    }
}


class Child extends Component{

    componentDidMount() {
        request("/api/mmdb/movie/v3/list/hot.json?  ct=%E5%8C%97%E4%BA%AC&ci=1&channelId=4").then(res=>{ //æ¥å£è·¨åŸŸ
            console.log(res)
        })

        request("/users").then(res=>{
            console.log(res.data)
        })
    } 
    
    render(){
        return <div>
            <button onClick={()=>{
                console.log(this.props)
                localStorage.removeItem("token")
                this.props.history.push('/login')
            }}>é€€å‡ºç™»å½•</button>
        </div>
    }
}

const WithChild = withRouter(Child)
```

 .webpackrc

```json
{
    "proxy":{
        "/api":{
            "target":"https://i.maoyan.com",
            "changeOrigin":true // æ”¹å˜æºï¼štrue
        }
    }
}
é‡Šæ„ï¼š å¯¹æœ¬é¡¹ç›®ä¸­åŒ…å«/apiå­—æ®µçš„æ¥å£ï¼Œä»£ç†åˆ°targetæŒ‡å®šåŸŸåä¸Šã€‚
```

##### 7. mockæ•°æ®

æ ¸å¿ƒç‚¹ï¼šæ ¹ç›®å½•ä¸‹é…ç½®æ–‡ä»¶.roadhogrc.mock.js

æ¡ˆä¾‹æ¼”ç¤ºget postä¸¤ç§æ–¹æ³•

æ ¹ç›®å½•mockæ–‡ä»¶å¤¹  æ”¾ç½®mockæ•°æ®

```react
export default{
    'GET /users' : {name:"kerwin",age:100,location:"dalian"},

    'POST /users/login' :(req,res)=>{
        console.log(req.body) //è·å–ä¼ å…¥çš„å‚æ•°

        if(req.body.username==="kerwin" && req.body.password==="123") {
            res.send({
                ok:1
            })
        }else{
            res.send({
                ok:0
            })
        }
        
    }
}
```

å¼•å…¥.roadhogrc.mock.js

```react

const mockobj =  require('./mock/api')
export default {
    ...mockobj // è§£æ„è¿›æ¥  å…¶ä»–çš„mockæ–¹æ³•ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œå¼•å…¥ 
};

```

æµ‹è¯•æ¥å£

get   

æµè§ˆå™¨ä¸­    http://localhost:8000/users  å¯ä»¥çœ‹åˆ°è¿”å›æ•°æ®

post

é¡¹ç›®ä¸­å°è£…è¯·æ±‚ä½¿ç”¨fetchæ–¹æ³•ï¼Œå‚ç…§ä¼ å‚ã€‚

```react
import React, { Component } from 'react'
import request from '../utils/request'

export default class Login extends Component {
    username = React.createRef()
    password = React.createRef()
    render() {
        return (
            <div>
                ç”¨æˆ·åï¼š
                <input type="text" ref={this.username}/>
                <br/>
                å¯†ç ï¼š
                <input type="password" ref={this.password}/>

                <button onClick={()=>{
                    console.log(this.username.current.value,this.password.current.value)

                    request("/users/login",{
                        method:"POST",
                        body:JSON.stringify({
                            username:this.username.current.value,
                            password:this.password.current.value
                        }),
                        headers:{
                            "Content-Type":"application/json"
                        }
                    }).then(res=>{
                        console.log(res.data)

                        if(res.data.ok){
                            localStorage.setItem("token","dwadw23232")
                            this.props.history.push("/center")
                        }else{
                            alert("ç”¨æˆ·åå¯†ç ä¸åŒ¹é…")
                        }
                    })
                }}>ç™»å½•</button>
            </div>
        )
    }
}

```



é™„æ³¨ï¼šéƒ¨åˆ†é¡µé¢å®Œæ•´ä»£ç 

modelsæ–‡ä»¶å¤¹

maizuo.js

```react
import { getCinemaListService } from "../services/maizuo"

/*
 * @ä½œè€…: kerwin
 * @å…¬ä¼—å·: å¤§å‰ç«¯ç§æˆ¿èœ
 */
export default {

    namespace: 'maizuo',// å‘½åç©ºé—´ connecté«˜é˜¶ç»„ä»¶åŒ…è£…å æœ¬ç©ºé—´æ•°æ®ä»¥keyå¯¹è±¡å½¢å¼æ³¨å…¥stateå‹å‚ä¸­
  
    state: {
        isShow:true,
        list:[]
    },

    reducers:{
        hide(prevState,action){
            return {...prevState,isShow:false}
        },
        show(prevState,action){
            return {...prevState,isShow:true}
        },

        changeCinemaList(prevState,{payload}){
            return {...prevState,list:payload}
        }
    },

    subscriptions: {
        setup({ dispatch, history }) {  // eslint-disable-line
            console.log("åˆå§‹åŒ–")
        }
    },

    //å¼‚æ­¥- redux-saga
    effects:{
        *getCinemaList(action,{call,put}){
            // console.log(obj)
            var res = yield call(getCinemaListService)
            console.log(res.data.data.cinemas)
            yield put({
                type:"changeCinemaList",
                payload:res.data.data.cinemas
            })
        }
    }
}
```

![](.\img\dvaä»£ç é¡¹ç›®ç»“æ„.png)











### 9.Umi.jsï¼ˆèš‚èšé›†å›¢åº•å±‚å‰ç«¯æ¡†æ¶ï¼‰

Umi æ˜¯èš‚èšé›†å›¢çš„åº•å±‚å‰ç«¯æ¡†æ¶ ã€‚

umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸ºä¹Œç±³ï¼Œæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„ä¼ä¸šçº§ react åº”ç”¨æ¡†æ¶ã€‚umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼Œæ”¯æŒç±» next.is çš„**çº¦å®šå¼è·¯ç”±**ï¼ˆ1ï¼‰ï¼Œä»¥åŠå„ç§è¿›é˜¶çš„è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œæ¯”å¦‚æ”¯æŒè·¯ç”±çº§çš„æŒ‰éœ€åŠ è½½ã€‚umi åœ¨çº¦å®šå¼è·¯ç”±çš„åŠŸèƒ½å±‚é¢ä¼šæ›´åƒ nuxt.is ä¸€äº›

ï¼ˆ1ï¼‰ï¼š ç®€å•æ¥è¯´å°±æ˜¯pagesä¸‹åˆ›å»ºä¸€ä¸ªé¡µé¢æ—¶ï¼Œè‡ªåŠ¨å·²æ–‡ä»¶åç”Ÿæˆè·¯ç”±ï¼Œæµè§ˆå™¨ä¸­ç›´æ¥è¾“å…¥æ–‡ä»¶åï¼Œå°±å¯ä»¥è®¿é—®é¡µé¢ã€‚

 https://umijs.org/

https://umijs.org/docs/guides/getting-started  å¿«é€Ÿä¸Šæ‰‹

#### 1.å®‰è£…

ç¬¬ä¸€ç§æ–¹å¼ï¼šé€ä¸ªé…ç½®

å®‰è£…umiè„šæ‰‹æ¶

```
npm install -g umi
```

æ£€æŸ¥ç‰ˆæœ¬å·

```
umi -v
```

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹

```
mkdir umidemo
```

ç„¶å æˆ‘ä»¬cdåˆ°è¿™ä¸ªumidemoä¸‹

```
cd umidemo
```

ç„¶å æˆ‘ä»¬è¾“å…¥

```
umi g page index   //
```

è¿™æ · æˆ‘ä»¬å°±åˆ›å»ºå‡ºæ¥äº†ä¸€ä¸ªpageé¡µé¢ å« index

ç„¶å æˆ‘ä»¬ç»ˆç«¯æ‰§è¡Œ

```
umi dev
```

è¿™æ ·æˆ‘ä»¬çš„é¡¹ç›®å°±èµ·æ¥äº†

æˆ‘ä»¬å¤åˆ¶ç»ˆç«¯çš„åœ°å€ æ”¾åœ¨æµè§ˆå™¨è®¿é—® å°±è¾¾åˆ°äº†ä¸‹å›¾æ•ˆæœ

æ‰€æœ‰é…ç½®éƒ½åœ¨ .umiä¸­,å…¶å® ä½ ç”¨umi g page åé¢è·Ÿä»€ä¹ˆåå­— å°±ä¼šåˆ›å»ºä»€ä¹ˆç•Œé¢

```
umi g page users/user  //pageä¸‹åˆ›å»ºusersæ–‡ä»¶å¤¹ useré¡µé¢
```

[è¯¦æƒ…å‚è€ƒ](https://blog.csdn.net/weixin_45966674/article/details/133831191)

ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨è„šæ‰‹æ¶

```
mkdir myapp && cd myapp //ç©ºç›®å½•

npx @umijs/create-umi-app  // ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶

cnpm i  // åˆå§‹åŒ–ä¾èµ–

npm run start // å¯åŠ¨é¡¹ç›®
```

![](.\img\umiè„šæ‰‹æ¶ç”Ÿæˆæ–‡ä»¶é¢„è§ˆ.png)



#### 2.mockæ•°æ®

 ä½¿ç”¨æ–¹æ³•å‚è€ƒä¸Šé¢çš„DvaJSä¸­çš„ç¬¬7å°èŠ‚ã€‚

*umi* é‡Œçº¦å®š *mock* æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶æˆ–è€…
*page(s)* æ–‡ä»¶å¤¹ä¸‹çš„ *_mock*
æ–‡ä»¶å³ *mock* æ–‡ä»¶ï¼Œæ–‡ä»¶å¯¼å‡ºæ¥å£å®šä¹‰ï¼Œæ”¯æŒåŸºäº *require* åŠ¨æ€åˆ†æçš„å®æ—¶åˆ·æ–°ï¼Œæ”¯æŒ *ES6* è¯­æ³•ï¼Œä»¥åŠå‹å¥½çš„å‡ºé”™æç¤ºã€‚

 ç®€å•è¯´å°±æ˜¯åªè¦ä½ æŒ‰ç…§çº¦å®šï¼šåœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºmockå‘½åçš„æ–‡ä»¶ï¼Œé‡Œé¢ä»£ç å¦‚ä¸‹ï¼Œ æ–‡ä»¶åå­—éšæ„ã€‚

**mock/api.js** æ–‡ä»¶

```javascript
export default {
// æ”¯æŒå€¼ä¸º Object å’Œ Array
'GET /api/users': { users: [1, 2] },

// GET POST å¯çœç•¥
'/api/users/1': { id: 1 },

// æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼ŒAPI å‚è€ƒ express@4
'POST /api/users/create': (req, res) => { res.end('OK'); },
}

```

æµè§ˆå™¨ä¸­ï¼š

```
http://localhost:8000/users

//{"name":"kerwin","age":100} æ˜¾ç¤ºæ•°æ®
```



#### 3.è·¨åŸŸè®¾ç½®

æ¡ˆä¾‹ï¼šå¯¹çŒ«çœ¼ç”µå½±åˆ—è¡¨åšè·¨åŸŸå¤„ç†

```react
ä»£ç ç‰‡æ®µ  
useEffect(()=>{
fetch("api/gateway?cityId=110100&pageNum=1&pageSize=10&type=1&k=7383801"
,{headers:{}).
then(res=>res.json()).then(res=>{
console.log(res.data.films)
 setlist(res.data.films)
        })
    },[])
```

è·¨åŸŸå¤„ç†ï¼š

**.umirc.ts**

```json
  proxy:{
    "/api":{
      target:"https://i.maoyan.com", // å¯¹/apiå¼€å¤´çš„è¯·è¯·æ±‚æ‹¦æˆªï¼Œå¹¶æ›¿æ¢åŸŸåä¸ºtargetã€‚
      changeOrigin:true
    }
  },
```







#### 4.è·¯ç”±

umi ä¼šæ ¹æ® pages ç›®å½•è‡ªåŠ¨ç”Ÿæˆè·¯ç”±é…ç½®ã€‚éœ€è¦æ³¨é‡Š.umirc.jsï¼Œroutesç›¸å…³,å¦åˆ™è‡ªåŠ¨é…ç½®ä¸ç”Ÿæ•ˆ

#### åŸºç¡€è·¯ç”±

ï¼ˆæ•´ä½“æ˜¾ç¤ºé€»è¾‘ï¼š1.srcä¸‹æ˜¯å¦æœ‰layoutsæ–‡ä»¶ï¼Œæœ‰æ˜¾ç¤ºæ ¹layout,2.å†å»æ‰¾pagesä¸‹index.tsxï¼Œæ˜¾ç¤ºå‡ºæ¥ã€‚ï¼‰

```
 --pagesæ–‡ä»¶
  ---cssæ–‡ä»¶
  ---index.tsx é¦–é¡µ
  ---404.tsx  æ‰¾ä¸åˆ°è·¯ç”±ï¼Œè‡ªåŠ¨å¯¼å…¥æœ¬é¡µé¢
  ---center.tsx
  ---Film.tsx   Filmæ–‡ä»¶åå³ä¸ºè·¯ç”±ï¼ˆé¦–å­—æ¯å¤§å°ä¸æ•æ„Ÿï¼Œå»ºè®®å¤§å†™ã€‚ï¼‰
```

##### (1)  é‡å®šå‘

è‡ªåŠ¨é¡¹ç›®ï¼Œè‡ªå®šè¿›å…¥index.jsxï¼Œ è‡ªåŠ¨è·³è½¬åˆ°æŒ‡å®šé¡µé¢å»

```react
import {Redirect} from 'umi' 
 export default () => {
  return (<Redirect to="/film"/>
   );
 }

```

##### (2)åµŒå¥—è·¯ç”±

æ¡ˆä¾‹ï¼šfilmä¸‹ä¸¤ä¸ªtabåˆ‡æ¢é¡µé¢ï¼Œé€šè¿‡çˆ¶é¡µé¢å…³é”®åå­— _layout.tsx,çˆ¶é¡µé¢é€šè¿‡é‡å®šå‘åˆ°å…¶ä¸­ä¸€ä¸ªå­—é¡µé¢ã€‚

![](.\img\åµŒå¥—è·¯ç”±png.png)

_layout.tsxé¡µé¢

```react

import {Redirect,useLocation} from 'umi'
export default function Film(props:any) {
    const location = useLocation()
    // console.log(location)
    if(location.pathname==="/film" || location.pathname==="/film/"){
        return <Redirect to="/film/comingsoon"/>
    }
    return (
        <div>
            <div style={{height:'200px',background:"yellow"}}>å¤§è½®æ’­</div>
            {props.children}
        </div>
    )
}

```

##### æ ¹é¡¹ç›®åµŒå¥—

å…³é”®ç‚¹ï¼šé¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹srcä¸‹æ˜¯å¦æœ‰layoutsæ–‡ä»¶ï¼Œæœ‰çš„è¯ä¼šä½œä¸ºæ ¹ç»„ä»¶åµŒå¥—ã€‚ä¾‹å¦‚é¡¹ç›®çš„åº•éƒ¨åˆ‡æ¢tabã€‚

![](.\img\æ ¹è·¯ç”±åµŒå¥—.png)

layouts/index.tsx

```react
import {NavLink} from 'umi'
import './index.less'
export default function IndexLayout(props:any) {
    if(props.location.pathname==="/city" || props.location.pathname.includes("/detail")){
        return <div>{props.children}</div>
    }
    return (
        <div>
            {props.children}  // æ˜¾ç¤ºä¼ é€’è¿‡æ¥çš„å­é¡µé¢ è§†å£
        
            <ul>
                <li>
                    <NavLink to="/film" activeClassName="active">film</NavLink>
                </li>
                <li>
                    <NavLink to="/cinema" activeClassName="active">cinema</NavLink>
                </li>
                <li>
                    <NavLink to="/center" activeClassName="active">center</NavLink>
                </li>
            </ul>
        </div>
    )
}
```

##### å£°æ˜å¼å¯¼èˆª

```react
import {NavLink} from 'umi'

...
 <NavLink to="/film" activeClassName="active">film</NavLink>  
//activeClassName reactä¸­çš„æ–¹æ³•è¿™é‡Œä¹Ÿæ”¯æŒ
```

##### ç¼–ç¨‹å¼è·¯ç”±å’ŒåŠ¨æ€ä¼ å‚

å…³é”®ç‚¹ï¼šè·¯ç”±è·³è½¬ä½¿ç”¨hooks; åŠ¨æ€æ¥å—å‚æ•°ï¼Œè¯¦æƒ…é¡µé¢æŒ‰çº¦å®šåˆ›å»ºæ–‡ä»¶åå­—ã€‚

åˆ—è¡¨é¡µï¼š

```react
import {useEffect,useState} from 'react'
import {useHistory} from 'umi'

export default function Nowplaying(props:any) {
    const [list, setlist] = useState([])
    const history = useHistory()
    useEffect(()=>{
        fetch("https://m.maizuo.com/gateway?cityId=110100&pageNum=1&pageSize=10&type=1&k=7383801",{
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.2.0","e":"16395416565231270166529","bc":"110100"}',
                'X-Host': 'mall.film-ticket.film.list'
            }
        }).then(res=>res.json())
        .then(res=>{
            console.log(res.data.films)
            setlist(res.data.films)
        })
    },[])
    return (
        <div>
            {
                list.map((item:any)=>
                    <li key={item.filmId} onClick={()=>{
                        // console.log(history)

                        history.push(`/detail/${item.filmId}`)
                    }}>{item.name}</li>
                )
            }
        </div>
    )
}
```

**è¯¦æƒ…é¡µ**

æ‰¿æ¥ä¸Šæ–‡è·¯ç”±pushä¼ å‚ï¼Œè¿™é‡Œå±•ç¤ºæ¥å—å‚æ•°æ–¹æ³•ã€‚

![](.\img\åŠ¨æ€è·¯ç”±.png)



[id].tsx

```react
import {useParams} from 'umi'  //ä¸ºä¾¿äºå–å‚ umiæä¾›äº†ä¸€ä¸ªhook useParams
interface IParams {
    id:string
}
export default function Detail(props:any) {
    // console.log(props)
    const params = useParams<IParams>()
    console.log(params.id) // æ‹¿åˆ°å‚æ•°
    
    return (
        <div>
            Detail
        </div>
    )
}
```

##### è·¯ç”±æ‹¦æˆª

å®ç°é€»è¾‘ï¼šé€šè¿‡ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰åŒ…è£…å™¨å®ç°ã€‚ å¯¹é‚£ä¸ªç»„ä»¶è¿›è¡Œæ§åˆ¶ï¼Œå°±å¯¹é‚£ä¸ªç»„ä»¶è¿›è¡ŒåŒ…è£…ï¼Œæˆä¸ºå…¶çˆ¶ç»„ä»¶ï¼Œä»¥ä¾¿äºæ§åˆ¶å…¶æ˜¾ç¤ºæˆ–ä¸€äº›è‡ªå®šä¹‰é€»è¾‘ï¼Œæ¯”å¦‚è·³è½¬ç™»å½•é¡µç­‰æ“ä½œã€‚

å…³é”®ç‚¹ï¼šsrc ä¸‹ æ–°å»ºåŒ…è£…å™¨æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨é¡µé¢ï¼ŒåŒ…å«è‡ªå®šä¹‰æ‹¦æˆªé€»è¾‘ã€‚ï¼ˆwrappersåå­—æ˜¯å›ºå®šçš„ã€‚ï¼‰

![](.\img\è·¯ç”±æ‹¦æˆª.png)



center.jsx

```react
 function Center() {
    return (
        <div>
            Center
        </div>
    )
}
Center.wrappers = ["@/wrappers/Auth"] // æŒ‡å®šåŒ…è£…å™¨è·¯å¾„ ä½¿è‡ªå·±æˆä¸ºå­ç»„ä»¶ï¼ˆç»™è‡ªå·±æ‰¾çˆ¹ï¼‰
export default Center
```

##### hashæ¨¡å¼

é»˜è®¤æ˜¯historyæ¨¡å¼ï¼Œä¸å¸¦#ï¼›å¦‚æœéœ€è¦é…ç½®ä¸ºhashæ¨¡å¼è·¯å¾„åŠ #

 **åœ¨.umirc.js**

```
export default { 
   history:{ type: 'hash' }
}

```

#### 5.ä½¿ç”¨ant-mobileç§»åŠ¨uiç»„ä»¶åº“

Umijsæ˜¯é˜¿é‡Œå¼€å‘çš„ï¼Œantuiä¹Ÿæ˜¯é˜¿é‡Œå¼€å‘çš„ï¼Œæ‰€ä»¥ï¼ŒUmié»˜è®¤å®‰è£…ã€‚æ‰€ä»¥å¯èƒ½è‡ªå·±å®‰è£…äº†æ–°ç‰ˆæœ¬ï¼Œä»»ç„¶æ˜¾ç¤ºè€æ ·å¼ã€‚è¿™æ—¶éœ€è¦å»é…ç½®**.umirc.ts** é‡Œï¼Œå…³é—­Umiæä¾›çš„æ’ä»¶ã€‚

```
 å…³é—­è‡ªå¸¦çš„ç»„ä»¶åº“
 antd:{
    mobile:false
  }
```



antç§»åŠ¨ç»„ä»¶åº“  https://ant-design-mobile.antgroup.com/zh/guide/quick-start

```
npm install --save antd-mobile   å®‰è£…æ’ä»¶

```

ä½¿ç”¨å›¾æ ‡icon  éœ€è¦å•ç‹¬å®‰è£…  å…·ä½“å‚ç…§æ–‡æ¡£è¦æ±‚ï¼ˆæœ¬æ¡ˆä¾‹ä½¿ç”¨v5.33.0ï¼‰

ç»ƒä¹ :ä½¿ç”¨ç»„ä»¶å®ç°æ‰‹æœºç«¯å¸¸è§çš„åŸå¸‚é€‰æ‹©é¡µé¢A-Zæ’åºã€‚

ç»„ä»¶åº“ï¼šindexBaråºåˆ—

```react
import { useEffect,useState } from 'react'
import { IndexBar, List } from 'antd-mobile'
import {useHistory } from 'umi'
export default function City() {
    const history = useHistory()
    const [list, setlist] = useState<any>([])
    const filterCity = (cities:any)=>{
        console.log(cities)
        const letterArr:Array<string> = []
        const newlist = []
        for(var i=65;i<91;i++){
            letterArr.push(String.fromCharCode(i))
        }
        // console.log()
        for(var m in letterArr){
            var cityitems:any = cities.filter( (item:any)=>item.pinyin.substring(0,1).toUpperCase()===letterArr[m])
            cityitems.length && newlist.push({
                title:letterArr[m],
                items:cityitems
            })
        }
        // console.log(newlist)

        return newlist
    }

    useEffect(() => {
        fetch("https://m.maizuo.com/gateway?k=2145459", {
            headers: {
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.2.0","e":"16395416565231270166529","bc":"110100"}',
                'X-Host': 'mall.film-ticket.city.list'
            }
        })
        .then(res=>res.json())
        .then(res=>{
            // console.log(res.data.cities)
            setlist(filterCity(res.data.cities))

            
        })
    }, [])

    const changeCity = (item)=>{
        console.log(item.name,item.cityId)
        history.push("/cinema")
        ä¿®æ”¹reducerè¯¦è§ä¸‹é¢6å°èŠ‚
    }
    return (
        <div style={{ height: window.innerHeight }}>
        <IndexBar>
          {list.map( (item:any) => {
            const { title, items } = item
            return (
              <IndexBar.Panel
                index={title}
                title={title}
                key={title}
              >
                <List>
                  {items.map((item:any, index:number) => (
                    <List.Item key={index} onClick={()=>changeCity(item)}>{item.name}</List.Item>
                  ))}
                </List>
              </IndexBar.Panel>
            )
          })}
        </IndexBar>
      </div>
    )
}

```

#### 6.dvaé›†æˆ

æŒ‰ç›®å½•çº¦å®šæ³¨å†Œ modelï¼Œæ— éœ€æ‰‹åŠ¨ app.model

æ–‡ä»¶åå³ namespaceï¼Œå¯ä»¥çœå» modelå¯¼å‡ºçš„namespace key

æ— éœ€æ‰‹å†™ router.jsï¼Œäº¤ç»™ umiå¤„ç†ï¼Œæ”¯æŒ modelå’Œ component çš„æŒ‰éœ€åŠ è½½

å†…ç½®query-string å¤„ç†ï¼Œæ— éœ€å†æ‰‹åŠ¨è§£ç å’Œç¼–ç 

å†…ç½® dva-loading å’Œ dva-immerï¼Œå…¶ä¸­ dva-immeréœ€é€šè¿‡é…ç½®å¼€å¯(ç®€åŒ– reducer ç¼–å†™)

##### å±•ç¤ºmodelç®¡ç†reduxçš„å…¬å…±æ•°æ®

**ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ï¼šç®¡ç†å…¬å…±æ•°æ®reducer- åŒæ­¥æƒ…å†µ**

åœ¨srcä¸‹æ–°å»ºmodelsæ–‡ä»¶å¤¹ï¼Œå‘½åå›ºå®šï¼Œçº¦å®šã€‚æ–‡ä»¶åå°±æ˜¯ç©ºé—´åï¼Œæˆ–è€…jsä¸­ï¼ŒæŒ‡å®šäº†å°±ä»¥æŒ‡å®šä¸ºå‡†ã€‚

![](.\img\çº¦å®šå…¬å…±æ•°æ®.png)

 å†™å¥½modelsåï¼Œå¼€å§‹ä½¿ç”¨ã€‚

**cityé¡µé¢**

è§¦å‘reduceräº‹ä»¶

```react
function City(props:any) {
...
const changeCity = (item)=>{
        console.log(item.name,item.cityId)

        // ä¿®æ”¹store stateä¸­çš„çŠ¶æ€
        props.dispatch({
          type:"city/changeCity",  //è¿™ä¸ªå†™æ³•ï¼šä¸åŠ å‘½åç©ºé—´ è°çŸ¥é“ä½ ä½¿ç”¨çš„æ˜¯å“ªä¸ªé‡Œé¢çš„
          payload:{
            cityName:item.name,
            cityId:item.cityId
          }
        })
        history.push("/cinema")
    }
```

**cinemaç”µå½±å±•ç¤ºé¡µé¢**

ä½¿ç”¨å…¬å…±æ•°æ®

```react
import { NavBar } from 'antd-mobile'
import { SearchOutline } from 'antd-mobile-icons'
import {connect} from 'dva' //é«˜é˜¶ç»„ä»¶åŒ…è£…å æ³¨å…¥reduxçš„æ–¹æ³•å’Œå±æ€§

function Cinema(props:any) {
    console.log(props,'è§¦å‘äº†')
    return (
        <div>
            <NavBar onBack={()=>{
                // console.log("click")
                props.history.push(`/city`)
            }} back={props.cityName} backArrow={false} right={<SearchOutline />}>æ ‡é¢˜</NavBar>
            Cinema
        </div>
    )
}

export default connect((state:any)=>{

    // console.log(state)
    return {
        a:1,
        cityName:state.city.cityName  //cityå‘½åç©ºé—´çš„åå­—
    }
})(Cinema)
```

é€»è¾‘é“¾ï¼š é¦–å…ˆdispatchè§¦å‘reducer, reducerä¿®æ”¹è‡ªå·±çš„state,steteä¿®æ”¹ï¼Œè§¦å‘ä½¿ç”¨é¡µé¢åˆ·æ–°ã€‚ç”µå½±é¡µé¢å†æ›´æ–°ã€‚

**ç¬¬äºŒä¸ªæ¡ˆä¾‹:ç®¡ç†å…¬å…±æ•°æ® å¼‚æ­¥æƒ…å†µ**

 ä½¿ç”¨æ–¹æ³•å’Œredux-sgaç±»ä¼¼

åŸæ¥åŒæ­¥é€»è¾‘é“¾ æ˜¯ dispatchè§¦å‘reduceï¼›

ç°åœ¨æ˜¯dispatchè§¦å‘effectsä¸­çš„ ***getlist** ï¼Œç”±å…¶è·å–æ•°æ®ï¼Œæœ‰å…¶è‡ªè¡Œè§¦å‘reducer, åé¢éƒ½ä¸€æ ·äº†ã€‚

ä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š

modelsæ–‡ä»¶å¤¹ä¸‹

Cinema.ts

```javascript
export default {
    namespace: "cinema",
    state: {
        list: []
    },

    reducers:{
        clearList(prevState:any,action:any){
            return {
                ...prevState,
                list:[]
            }
        },
        changeList(prevState:any,action:any){
            return {
                ...prevState,
                list:action.payload
            }
        }
    },
    //
    effects: {
        *getList(action: any, obj: any):any {
            const { put, call } = obj
            var res = yield call(getListForCinema,action.payload.cityId)

            yield put({
                type:"changeList",
                payload:res
            })
        }
    }
}


async function getListForCinema(cityId) {
    // console.log(cityId)
    var res = await fetch(`https://m.maizuo.com/gateway?cityId=${cityId}&ticketFlag=1&k=6412143`, {
        headers: {
            'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.2.0","e":"16395416565231270166529"}',
            'X-Host': 'mall.film-ticket.cinema.list'
        }
    }).then(res=>res.json())

    // console.log(res)
    return res.data.cinemas
}
```

**Cinemaé¡µé¢**

è§¦å‘é¡µé¢&ä½¿ç”¨æ•°æ®é¡µé¢

```react
import {useEffect} from 'react'
import { NavBar,DotLoading } from 'antd-mobile'
import { SearchOutline } from 'antd-mobile-icons'
import {connect} from 'dva'

function Cinema(props:any) {
    // console.log(props)
    useEffect(() => {
        if(props.list.length===0){
            //å–æ•°æ®
            props.dispatch({
                type:"cinema/getList",
                payload:{
                    cityId:props.cityId
                }
            })
        }else{
            console.log("ç¼“å­˜")
        }
    }, [])
    return (
        <div>
            <NavBar onBack={()=>{
                // console.log("click")

                //æ¸…ç©ºcinema listï¼Œ
                props.dispatch({
                    type:"cinema/clearList"
                })

                props.history.push(`/city`)
            }} back={props.cityName} backArrow={false} right={<SearchOutline />}>æ ‡é¢˜</NavBar>
            

            {
                props.loading && <div style={{ fontSize: 14,textAlign:"center" }}>
                <DotLoading />
            </div>
            }
            <ul>
                {
                    props.list.map( (item:any)=>
                    <li key={item.cinemaId}>{item.name}</li>    
                    )
                }
            </ul>
        </div>
    )
}

export default connect((state:any)=>{
     //console.log(state)// state.loading.global // trueæˆ–falseï¼ˆè§ä¸‹å›¾ æˆªå›¾ï¼‰
    return {
        a:1,
        loading:state.loading.global,
        cityName:state.city.cityName,
        cityId:state.city.cityId,
        list:state.cinema.list
    }
})(Cinema)

```

Umiè‡ªåŠ¨æ³¨å†Œè°ƒè¯•å™¨ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨çš„é‚£å¤©network - >reduxï¼ˆå¦‚æœå®‰è£…äº†å°±ä¼šæœ‰ï¼‰ã€‚

å¹¶ä¸”æä¾›äº†ä¸€ä¸ªloading è¯·æ±‚æ•°æ®çš„booleå€¼ã€‚è‡ªå·²å¯ä»¥åˆ©ç”¨æ¥ä½œä¸ºé¡µé¢åŠ è½½ä¼˜åŒ–ã€‚



 

![](.\img\é»˜è®¤æ³¨å†Œè°ƒè¯•å™¨.png)









##### Reactã€umiå’Œdvaä¹‹é—´çš„å…³ç³»

[å…³ç³»](https://blog.csdn.net/halations/article/details/107505440)

[ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Dva, Umi ç­‰è¯¸å¦‚æ­¤ç±»çš„æ¡†æ¶ï¼Œç›¸æ¯” React ä»–ä»¬çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ](https://www.zhihu.com/question/336798290/answer/3047625529)

Dvaå’ŒUmiæ˜¯åŸºäºReactæ„å»ºçš„æ¡†æ¶ï¼Œæä¾›äº†é¢å¤–çš„åŠŸèƒ½å’ŒåŠŸèƒ½ã€‚

reactï¼ˆhttps://react.docschina.org/ï¼‰

umi--è·¯ç”±é…ç½®ï¼ˆhttps://umijs.org/ï¼‰
dva--æ•°æ®æµæ–¹æ¡ˆï¼ˆhttps://dvajs.com/guide/ï¼‰

Umiå’ŒDvaéƒ½æ˜¯åŸºäºReactçš„æ¡†æ¶ï¼ŒUmiä¸»è¦ä»¥è·¯ç”±ä¸ºä¸»ï¼ŒDvaä¸»è¦ç®¡ç†æ•°æ®æµã€‚

Antd proï¼ˆhttps://pro.ant.design/docs/getting-started-cnï¼‰é›†æˆäº†umiã€dvaã€antdçš„å®Œæ•´å‰ç«¯è„šæ‰‹æ¶


ç½‘å‹è¯„è®ºï¼š

A:å¦‚æœä½ åœ¨é˜¿é‡Œæ¥è§¦åˆ°dvaï¼Œé‚£ä¹ˆç¬¬ä¸€ååº”å°±æ˜¯é‡æ„ï¼Œæ ¹æœ¬æ²¡æœ‰åŠæ³•ç»´æŠ¤ï¼Œè°ç”¨è°çŸ¥é“ï¼›

B:ä¸ªäººä¸å–œæ¬¢dvaå’Œumiï¼ŒèŠ‚çœäº†æ•´åˆæˆæœ¬ï¼Œä½†æ˜¯åˆæä¾›äº†è‡ªå·±çš„ä¸€å¥—çº¦æŸå’ŒAPIï¼Œå¸¦æ¥äº†é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚

c: react:  (state) => UI

dva: react + redux + redux-saga + react-router + å…¶ä»–

umi: react-router + webpack + babelï¼›

dvaå’Œumiå¯èƒ½æœ‰ç–æ¼ï¼Œä½†å¤§ä½“æ˜¯è¿™ä¸ªæ„æ€

**æ€»ç»“ï¼š**

umiæ˜¯dvaçš„å¢å¼ºåŒ–ã€‚ä»–ä»¬æ˜¯reactçš„è¿›ä¸€æ­¥å°è£…ã€‚

ä¼˜åŠ¿å°±æ˜¯å¼€ç®±å³ç”¨ï¼Œçœå»äº†æ­æ¡†æ¶çš„æ—¶é—´ã€‚åƒè¿™ç±»æ¡†æ¶/å·¥å…·çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå­¦ä¹ æˆæœ¬æ˜¯ä¸€æ–¹é¢ï¼Œæ–‡æ¡£ä¸å®Œå–„ä¹Ÿæ˜¯ä¸€æ–¹é¢ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œè¶Šåˆ°åæœŸï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿè¶Šé«˜ï¼Œæœ¬èº«åŸºäºå„ç§æ¨¡å—è¿›è¡Œå°è£…ï¼Œè®©å·¥å…·çš„å¤æ‚åº¦æå‡ã€‚

å›åˆ°è¿™ä¸ªé—®é¢˜æœ¬èº«ï¼Œå¦‚æœä½ åªæ˜¯æƒ³å­¦ä¹ Reactï¼Œæˆ–è€…å·²ç»æœ‰ä¸€ä¸ªå›¢é˜Ÿæ­å»ºå¥½äº†å›´ç»•Reactçš„å„ç§åŸºç¡€è®¾æ–½ï¼Œé‚£å°±ä¸éœ€è¦è€ƒè™‘Dvaè¿™ç±»çš„ä¸œè¥¿ã€‚ä½†æ˜¯å¦‚æœä½ åœ¨å‡ ä¸ªäººçš„å°å›¢é˜Ÿï¼Œéœ€è¦å¿«é€Ÿçš„ç”¨Reactçš„æŠ€æœ¯æ ˆæ­å»ºå‡ºç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„å‰ç«¯å·¥ç¨‹ï¼Œé‚£ä¹ˆç”¨è¿™äº›æ¡†æ¶å…¶å®æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å‚è€ƒè¿™äº›æ¡†æ¶çš„è®¾è®¡ä¹Ÿæ˜¯å­¦ä¹ æé«˜çš„ä¸€ä¸ªå¥½é€”å¾„ã€‚



### 10 nextJS

Vercel  ç¾å›½å…¬å¸ï¼Œåˆ›ç«‹æ—¶é—´:2015å¹´ ã€‚ 

Next.js çš„åˆ›é€ è€… Guillermo Rauchï¼ŒåŸºäº Next.jsï¼Œå»ºç«‹äº†ä¸€å®¶åå« Vercel çš„ä¼ä¸šã€‚

nextjs 2016 å¹´å¼€æºï¼ŒNext.js åœ¨ GitHub ä¸Šå·²ç»æ‹¥æœ‰è¶… 10 ä¸‡ starï¼Œä¸‹è½½é‡ä¹Ÿçªç ´äº† 2 äº¿ã€‚

[è¯¦æƒ…æ–‡ç« ](https://www.duidaima.com/Group/Topic/IT/13760)

https://www.nextjs.cn/

https://www.nextjs.cn/docs/getting-started  ä¸­æ–‡æ–‡æ¡£

å®‰è£…

```
npm install -g create-next-app   // å…¨å±€å®‰è£…è„šæ‰‹æ¶
```

åˆ›å»ºé¡¹ç›®

è¿›å…¥ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ æ‰“å¼€å‘½ä»¤è¡Œ

```
 create-next-app nextjs-demo
```

ä¾æ¬¡é€‰æ‹©é…ç½®

```
            âˆš Would you like to use TypeScript? ... No
            âˆš Would you like to use ESLint? ... No
            âˆš Would you like to use Tailwind CSS? ... No
            âˆš Would you like to use `src/` directory? ... Yes
            âˆš Would you like to use App Router? (recommended) ... No
            âˆš Would you like to customize the default import alias? ... Yes
            Creating a new Next.js app in /home/develop/nodejs/nextjs-demo.

            Using npm.

            Initializing project with template: default


            Installing dependencies:
            - react
            - react-dom
            - next


            added 23 packages in 5s
            Initialized a git repository.

            Success! Created nextdemo at /home/develop/nodejs/nextjs-demo

```

**é¡¹ç›®ç›®å½•ç»“æ„**

```
            â”œâ”€â”€ public
            â”‚   â”œâ”€â”€ favicon.ico     # Favicon
            â”‚   â”œâ”€â”€ next.svg
            â”‚   â””â”€â”€ vercel.svg
            â”œâ”€â”€ src
            â”‚   â”œâ”€â”€ pages               # Page Router
            â”‚   â”‚   â”œâ”€â”€ api
            â”‚   â”‚   â”‚   â””â”€â”€ hello.js
            â”‚   â”‚   â”œâ”€â”€ _app.js
            â”‚   â”‚   â”œâ”€â”€ _document.js
            â”‚   â”‚   â””â”€â”€ index.js        # home Page
            â”‚   â”‚
            â”‚   â””â”€â”€ styles
            â”‚       â”œâ”€â”€ globals.css
            â”‚       â””â”€â”€ Home.module.css
            â”‚
            â”œâ”€â”€ jsconfig.json           # JavaScript é…ç½®æ–‡ä»¶
            â”œâ”€â”€ next.config.js          # Next.js é…ç½®æ–‡ä»¶
            â”œâ”€â”€ package-lock.json       # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬ï¼ˆé”å®šï¼‰ï¼Œè¿è¡Œ npm install åè‡ªåŠ¨ç”Ÿæˆ
            â”œâ”€â”€ package.json            # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
            â””â”€â”€ README.md
```

**å¯åŠ¨é¡¹ç›®**

```
npm run dev     å¯åŠ¨
npm run build   æ‰“åŒ…
```





**Reactè„šæ‰‹æ¶å’Œnext.jsè„šæ‰‹æ¶çš„å¯¹æ¯”å’Œé€‰æ‹©ï¼Ÿ**

åœ¨å®é™…çš„ç”Ÿäº§å¼€å‘ä¸­ï¼Œç›®å‰åœ¨å›½å†…æ¯”è¾ƒä¸»æµä¸”ä½¿ç”¨è¾ƒå¤šçš„Reactè„šæ‰‹æ¶æ˜¯Create-React-Appï¼ˆç®€ç§°CRAï¼‰å’ŒNext.jsã€‚

1. **Create-React-App (CRA)**: CRA æ˜¯ç”± React å®˜æ–¹å›¢é˜Ÿç»´æŠ¤çš„è„šæ‰‹æ¶å·¥å…·ï¼Œå®ƒé€šè¿‡é»˜è®¤é…ç½®æä¾›äº†ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ React å¼€å‘ç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯å›½å†…ä½¿ç”¨CRAçš„ä¸€äº›åŸå› ï¼š

- ç®€å•æ˜“ç”¨ï¼šCRA æä¾›äº†ä¸€ä¸ªç°æˆã€é¢„é…ç½®å¥½çš„å¼€å‘ç¯å¢ƒï¼Œå¯¹åˆå­¦è€…å’Œå°å‹é¡¹ç›®æ¥è¯´æ˜¯ä¸€ä¸ªå¿«é€Ÿä¸Šæ‰‹çš„é€‰æ‹©ã€‚
- ç¤¾åŒºæ”¯æŒå¥½ï¼šCRA æ˜¯ React å®˜æ–¹æ¨èçš„è„šæ‰‹æ¶ï¼Œå› æ­¤æ‹¥æœ‰å¤§é‡æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒå’Œèµ„æºï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°ç›¸å…³çš„æ–‡æ¡£å’Œè§£å†³æ–¹æ¡ˆã€‚
- å¯æ‰©å±•æ€§ï¼šå°½ç®¡ CRA æä¾›äº†é»˜è®¤é…ç½®ï¼Œä½†ä¹Ÿå¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼Œæ»¡è¶³ä¸åŒçš„å¼€å‘éœ€æ±‚ã€‚

2. **Next.js**: Next.js æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å’Œé™æ€ç½‘ç«™çš„ React æ¡†æ¶ã€‚ä»¥ä¸‹æ˜¯å›½å†…ä½¿ç”¨Next.jsçš„ä¸€äº›åŸå› ï¼š

- æœåŠ¡ç«¯æ¸²æŸ“(SSR)ï¼šNext.js çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ï¼Œè¿™ä½¿å¾—é¡µé¢åœ¨æœåŠ¡å™¨ä¸Šè¢«æ¸²æŸ“å¹¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œä»è€ŒåŠ å¿«é¦–å±åŠ è½½é€Ÿåº¦ï¼Œå¹¶æä¾›æ›´å¥½çš„ SEOã€‚
- åŠŸèƒ½ä¸°å¯Œï¼šNext.js æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼Œå¦‚è·¯ç”±ç³»ç»Ÿã€é™æ€æ–‡ä»¶æœåŠ¡ã€è‡ªåŠ¨ä»£ç æ‹†åˆ†å’Œé¢„æ¸²æŸ“ç­‰åŠŸèƒ½ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒå¤æ‚çš„å‰ç«¯åº”ç”¨éœ€æ±‚ã€‚
- éƒ¨ç½²ç®€å•ï¼šNext.js æä¾›äº†æ–¹ä¾¿çš„éƒ¨ç½²é€‰é¡¹ï¼Œå¯ä»¥è½»æ¾å°†åº”ç”¨éƒ¨ç½²åˆ°å„ç§å¹³å°ï¼Œå¦‚äº‘æœåŠ¡å•†æˆ–è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨å“ªä¸ªè„šæ‰‹æ¶å–å†³äºå…·ä½“çš„é¡¹ç›®éœ€æ±‚å’Œå›¢é˜ŸæŠ€æœ¯æ ˆã€‚CRA é€‚åˆå¿«é€Ÿæ­å»ºç®€å•çš„ React åº”ç”¨ï¼Œè€Œ Next.js åˆ™é€‚åˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ã€SEO ä¼˜åŒ–å’Œæ›´ä¸°å¯ŒåŠŸèƒ½çš„é¡¹ç›®ã€‚å»ºè®®åœ¨é€‰æ‹©è„šæ‰‹æ¶æ—¶ï¼Œæ ¹æ®é¡¹ç›®çš„è§„æ¨¡ã€éœ€æ±‚å’Œå›¢é˜Ÿçš„æŠ€æœ¯æ°´å¹³è¿›è¡Œè¯„ä¼°ï¼Œå¹¶å‚è€ƒç›¸å…³æ–‡æ¡£å’Œæ¡ˆä¾‹è¿›è¡Œé€‰æ‹©ã€‚

è¡¥å……ï¼š

**æœåŠ¡å™¨ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“ï¼Ÿ**

ç®€å•æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªé¡µé¢ç”±css ,js htmlæ„æˆï¼Œé¡µé¢æ„å»ºçš„å¤„ç†å·¥ä½œï¼Œç”±åå°æœåŠ¡å™¨å®Œæˆï¼Œå°±æ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¸‹è½½åˆ°webæµè§ˆå™¨ï¼Œç”±æµè§ˆå™¨åŠ è½½å¤„ç†å†æ˜¾ç¤ºé¡µé¢ï¼Œå°±æ˜¯å®¢æˆ·ç«¯æ¸²æŸ“ã€‚

  ä¸‹å›¾ä¹Ÿå±•ç°äº†å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š

**æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ä¼˜åŠ¿ï¼š**  æé«˜é¦–å±åŠ è½½é€Ÿåº¦ï¼›æ›´å¥½çš„SEOè¡¨ç°ï¼›æé«˜è®¾å¤‡å…¼å®¹æ€§ï¼›å‡è½»å®¢æˆ·ç«¯è´Ÿæ‹…ï¼›

**æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æŒ‘æˆ˜ï¼š** æœåŠ¡å™¨å‹åŠ›å¢åŠ ï¼›å¼€å‘å¤æ‚æ€§å¢åŠ ï¼›æœ‰é™çš„åŠ¨æ€äº¤äº’ï¼›

[è¯¦æƒ…æŸ¥çœ‹](https://baijiahao.baidu.com/s?id=1773459200120754267&wfr=spider&for=pc)



![](https://pics3.baidu.com/feed/4d086e061d950a7b21df28141e96f5d5f0d3c9cf.jpeg@f_auto?token=15a2f048552326c3bb0f0ab78e1e9977)





## äºŒåäºŒ å‰ç«¯ä»£ç†ï¼ˆåå‘ä»£ç†ï¼‰

å®˜ç½‘ï¼š

 https://facebook.github.io/create-react-app/docs/proxying-api-requests-in-development

 å¼•å…¥æ’ä»¶

```
npm install http-proxy-middleware --save
```

srcä¸‹åˆ›å»º src/setupProxy.jsæ–‡ä»¶ï¼Œå‚æ•°å¦‚ä¸‹

```

const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) { app.use(
  '/api', createProxyMiddleware({
    target: 'http://localhost:5000', 
    changeOrigin: true,
   })
   );
};
è¡¨ç¤ºï¼šä»£ç†æ‹¦æˆª/apiå¼€å¤´çš„è¯·æ±‚ï¼Œå¹¶åœ¨å…¶urlå‰é¢åŠ ä¸Šhttp://localhost:5000åŸŸåã€‚
```



æ¡ˆä¾‹ï¼šæŸçœ¼ç”µå½±æ¥å£

```
https://i.maoyan.com/#movie/.f-hot
```

è¯·æ±‚å¾…æ˜ åˆ—è¡¨æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨æç¤ºè·¨åŸŸã€‚

```
https://i.maoyan.com/ajax/mostExpected?limit=10&offset=0&token=&optimus_uuid=B13246E07BC511EE8C86B72966AD43929DD65EA435C340D6A572D95977F59FCA&optimus_risk_level=71&optimus_code=10
```

é¡¹ç›®é…ç½®å¦‚ä¸‹ï¼š

setupProxy.jsæ–‡ä»¶

```
const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) {
  app.use(
    '/ajax',
    createProxyMiddleware({
      target: 'https://i.maoyan.com',
      changeOrigin: true,
    })
  );
};
```

ç»„ä»¶å¦‚ä¸‹:   

```
import React, {  Component } from 'react'
import axios from 'axios'
export default class Comingsoon extends Component {

  componentWillMount(){
    axios({
        url:"/ajax/mostExpected?limit=10&offset=0&token=&optimus_uuid=B13246E07BC511EE8C86B72966AD43929DD65EA435C340D6A572D95977F59FCA&optimus_risk_level=71&optimus_code=10", 
    }).then(res=>{
        // console.log(res.data.data.films) æˆåŠŸè¿”å›æ•°æ®
    
    })
  }
    render() {
        return (
            <div>
                Comingsoon
            </div>
        )
    }
}

```

## äºŒåä¸‰  css module

å®˜ç½‘

https://facebook.github.io/create-react-app/docs/adding-a-css-modules-stylesheet

å¼•å…¥èƒŒæ™¯ï¼š

reactæ˜¯å•é¡µé¢ï¼Œ æ¯ä¸ªç»„ä»¶å¼•å…¥çš„cssæ ·å¼ï¼Œç¼–è¯‘æ—¶ï¼Œä¼šè‡ªåŠ¨æ’å…¥åˆ°index.htmlé¡µé¢ä¸­ï¼Œé€ æˆæ ·å¼æ±¡æŸ“ã€‚

film.css

```
.father{
  border: 1px solid red;
}
```

filmç»„ä»¶

```
import '../css/film.css' //å¯¼å…¥ cssæ¨¡å—ï¼Œ  webpackçš„æ”¯æŒã€‚

        return (
                <div className='father'>å¯¼èˆªæ </div>
```

å­ç»„ä»¶

```
  render() {
        return (
            <div className='father'>
                Comingsoon
            </div>
```

çˆ¶ç»„ä»¶å¼•å…¥çš„æ ·å¼ï¼Œ æ±¡æŸ“åˆ°äº†å­ç»„ä»¶ã€‚

è§£å†³æ–¹å¼ï¼š

file.css æ–‡ä»¶åå­—ï¼Œæ”¹é€ ä¸ºfilm.module.css   è§„å®šå†™æ³•

```
.father{
  border: 1px solid red;
  .child{
    color: yellow;
  }
}
#id{
  color: red;
}


ç§æœ‰æ ·å¼æ–‡ä»¶ä¸­  å†™å…¨å±€css   ï¼›å»ºè®®å¦‚æœæ˜¯é¡¹ç›®å…¨å±€css, å•ç‹¬æ–°å»ºä¸€ä¸ª common.css æ¯”è¾ƒå¥½ã€‚
:global(.active){

}

```

film.jsç»„ä»¶

```
import style from  '../css/film.module.css' //å¯¼å…¥ cssæ¨¡å—ï¼Œ  webpackçš„æ”¯æŒã€‚

    render() {
        return (
            <div>
                <div className={style.father +" othercss"}>å¯¼èˆªæ </div>  
                //å˜é‡å†™æ³• å› ä¸ºç±»ååŠ åç¼€åŠ¨æ€åŒ– ç§æœ‰åŒ–


css æ‰“å°å‡ºæ¥å˜é‡åå­— å’Œjsç›¸ä¼¼
console.log(style)
{
father: 'film_father__HgGKs', 
child: 'film_child__2Bvwp', 
id: 'film_id__2TOI9'
}

```





## äºŒåå›› é¡¹ç›®ä¸­ä½¿ç”¨çš„å°æ’ä»¶

### [NProgress](https://so.csdn.net/so/search?q=NProgress&spm=1001.2101.3001.7020) çš„ä½¿ç”¨

NProgress æ˜¯å‰ç«¯è½»é‡çº§ web è¿›åº¦æ¡æ’ä»¶

```
npm install nprogress --save
æˆ–
yarn add nprogress
CDN

https://unpkg.com/nprogress@0.2.0/nprogress.js

https://unpkg.com/nprogress@0.2.0/nprogress.css
```

NProgress ä¸€èˆ¬æ­é…è·¯ç”±å®ˆå«ä½¿ç”¨

```react
import NProgress from 'nprogress'   // å¯¼å…¥ nprogress
import '@/components/NProgress/nprogress.less'   // å¯¼å…¥æ ·å¼ï¼Œå¦åˆ™çœ‹ä¸åˆ°æ•ˆæœ

NProgress.configure({ showSpinner: true })   // æ˜¾ç¤ºå³ä¸Šè§’èºæ—‹åŠ è½½æç¤º

router.beforeEach((to, from, next) => { 
    NProgress.start()   // å¼€å¯è¿›åº¦æ¡
    // some code ...
    NProgress.done()   // å…³é—­è¿›åº¦æ¡
})

```

[ç›¸å…³å¯å‚è€ƒ](https://blog.csdn.net/CEZLZ/article/details/108198402)

### react-loadable

ä¸€ä¸ªåŠ¨æ€å¯¼å…¥åŠ è½½ç»„ä»¶çš„é«˜é˜¶ç»„ä»¶.

reactjsæ€§èƒ½ä¼˜åŒ–ï¼Œå¼‚æ­¥è·¯ç”±åŠ è½½ã€‚

æ¯ä¸ªè·¯ç”±ä½¿ç”¨ä¸åŒçš„chunkï¼Œæ²¡å¿…è¦ä¸€æ¬¡åŠ è½½æ‰€ä»¥js

```
yarn add react-loadable -S
npm install react-loadable -S
```

#### ä½¿ç”¨æ–¹å¼

```
æ³¨æ„è·¯ç”±å¼•å…¥çš„æ–¹å¼ä½¿ç”¨ importçš„æ–¹å¼å¼•å…¥ const Stark = () => import('views/Stark')
ä½¿ç”¨ laé«˜é˜¶ç»„ä»¶åŒ…å« è·¯ç”±ç»„ä»¶ component={la(Stark)}
```

ç¤ºä¾‹

```react
import Loadable from 'react-loadable';
import Loading from './my-loading-component';

const LoadableComponent = Loadable({
  loader: () => import('./my-component'),
  loading: Loading,
});

export default class App extends React.Component {
  render() {
    return <LoadableComponent/>;
  }
}
æ‰“åŒ…åï¼Œæ¯ä¸ªç»„ä»¶æ‰“åŒ…ä¸€ä¸ªchunkjs,è¿™æ ·æé«˜äº†åŠ è½½é€Ÿåº¦ã€‚
```



[ç›¸å…³æŸ¥çœ‹](https://www.jianshu.com/p/3288bcd8d972)



## äºŒåäº” react-router6













## å…¶ä»–

### å¸¸è¯†æ€§

ç°åœ¨æœ€æ–°18.2.0   ---2023.12.01

 *React* 16.8.0 *ç‰ˆæœ¬*å¼€å§‹*æ”¯æŒ* hook æŠ€æœ¯ 

### react vscodeå¿«æ·æ“ä½œ

 `rcc` å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç»„ä»¶

```
import React, { Component } from 'react'

export default class Example extends Component {
    render() {
        return (
            <div>
                
            </div>
        )
    }
}
```

`rconst` å¿«é€Ÿåˆ›å»ºä¸€ä¸ª constructor

```
constructor(props) {
    super(props)

    this.state = {
         
    }
}
```

`rcep` å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç»„ä»¶

```
import React, { Component } from 'react'
import PropTypes from 'prop-types'

export class Example extends Component {
    static propTypes = {

    }

    render() {
        return (
            <div>
                
            </div>
        )
    }
}

export default Example
```

`rcredux` å¿«é€Ÿåˆ›å»ºä¸€ä¸ª reduxæ ¼å¼çš„ç±»æ¨¡

```
import React, { Component } from 'react'
import { connect } from 'react-redux'

export class Example extends Component {
    render() {
        return (
            <div>
                
            </div>
        )
    }
}

const mapStateToProps = (state) => ({
    
})

const mapDispatchToProps = {
    
}

export default connect(mapStateToProps, mapDispatchToProps)(Example)
```

clg æ˜¯ console.log()çš„å¿«æ·é”®



### 1.å‡½æ•°å¼ç»„ä»¶çš„æ³¨æ„ç‚¹ 

å¦‚æœé¡µé¢æœ‰axiosè¯·æ±‚ï¼Œæ”¾åˆ°useEffectä¸­ï¼Œåœ¨é¡µé¢å®é™…æƒ…å†µä¸­ï¼Œå‡½æ•°å¼ç»„ä»¶å¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œä»¥ç¡®ä¿æ•°æ®éƒ½æ›´æ–°è¿‡æ¥äº†ã€‚ä¸ºé¿å…æ¥å£å¤šæ¬¡è¯·æ±‚ï¼ŒåŠ¡å¿…éµå®ˆã€‚

```
import React,{useEffect} from 'react'
import { show,hide } from '../redux/actionCreator/TabbarActionCreator'
import store from '../redux/store'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
        // console.log("create")

        //store.dispatch  é€šçŸ¥
        store.dispatch(hide())
        return () => {
            console.log("destroy")
            store.dispatch(show() )
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}
```

### 2.è‡ªå®šä¹‰DOMå±æ€§

[React](https://so.csdn.net/so/search?q=React&spm=1001.2101.3001.7020) 16 ä¹‹å‰ä¼šå¿½ç•¥ä¸æ˜¯æŠŠçš„HTMLå’ŒSVGå±æ€§ï¼Œç°åœ¨Reactä¼šæŠŠä¸è¯†åˆ«çš„å±æ€§ä¼ é€’ç»™DOM

React16ä¹‹å‰ï¼š

```
 <div cust-attr="someting"></div>
```

  ä¼šè¢«æ¸²æŸ“æˆ

```
<div></div>ã€€
```

React 16æ¸²æŸ“å‡ºæ¥çš„èŠ‚ç‚¹ï¼š

```
<div cust-attr="someting"></div>ã€€ã€€
```

### 3. Portals

https://blog.csdn.net/sxww_zyt/article/details/129253485

### 4.é”™è¯¯å¤„ç†

https://blog.csdn.net/sxww_zyt/article/details/129253482

### 5.renderæ–°çš„è¿”å›ç±»å‹

React16ä¹‹å‰ï¼Œrende[ræ–¹](https://so.csdn.net/so/search?q=ræ–¹&spm=1001.2101.3001.7020)æ³•å¿…é¡»è¿”å›å•ä¸ªå…ƒç´ ã€‚ç°åœ¨ï¼Œrenderæ”¯æŒä¸¤ç§æ–°çš„è¿”å›ç±»å‹ï¼šæ•°ç»„(æœ‰Reactå…ƒç´ ç»„æˆ)å’Œå­—ç¬¦ä¸²ã€‚

```
render() {
 return [
    <li key="a">a</li>,
    <li key="b">b</li>,
    <li key="c">c</li>
 ]
}
```



```
render() {
 return  "just a string";
}
```

### 6.åˆ—è¡¨å’ŒKeys

æ¸²æŸ“åˆ—è¡¨æ•°æ®æ˜¯éå¸¸å¸¸è§çš„åœºæ™¯ï¼Œä¾‹å¦‚åšä¸€ä¸ªå±•ç¤ºç”¨æˆ·çš„åˆ—è¡¨ï¼Œéœ€è¦æ ¹æ®è·å–çš„ç”¨æˆ·æ•°æ®è¿›è¡Œæ¸²æŸ“åˆ—è¡¨ã€‚

è¿è¡Œåæ§åˆ¶å°æŠ¥é”™ï¼šåº”è¯¥ä¸ºåˆ—è¡¨æ¯ä¸€é¡¹æ·»åŠ key(ä¸€èˆ¬ä½¿ç”¨åˆ—è¡¨æ•°æ®çš„idä½œä¸ºkey)ï¼Œ[React](https://so.csdn.net/so/search?q=React&spm=1001.2101.3001.7020)ç”¨Keyæ ‡è®°æ¯ä¸ªå…ƒç´ ï¼Œå½“æ•°æ®å˜åŒ–æ—¶ï¼ŒReactå¯ä»¥é€šè¿‡keyçŸ¥é“å“ªäº›å…ƒç´ å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œåªæ¸²æŸ“å‘ç”Ÿå˜åŒ–çš„å…ƒç´ ï¼Œæé«˜æ¸²æŸ“æ•ˆç‡ã€‚

```
<User info={item.info} handleClick={this.handleClick} key={item.id}/>

```

**ä¸æ¨èä½¿ç”¨ç´¢å¼•ä½œä¸ºkey**ï¼Œå› ä¸ºä¸€æ—¦åˆ—è¡¨ä¸­çš„æ•°æ®å‘ç”Ÿé‡æ’ï¼Œæ•°æ®çš„ç´¢å¼•ä¹Ÿä¼šæ”¹å˜ï¼Œä¸åˆ©äºreactæ¸²æŸ“ã€‚**åˆ—è¡¨å…ƒç´ çš„keyä¸èƒ½é‡å¤ï¼Œä½†åªé™äºå½“å‰åˆ—è¡¨ï¼Œä¸æ˜¯å…¨å±€å”¯ä¸€**ã€‚

### 7.äº‹ä»¶å¤„ç†

https://blog.csdn.net/sxww_zyt/article/details/129253483

### 8.å®ç°è‡ªå®šä¹‰createElementå’Œrender

https://blog.csdn.net/sxww_zyt/article/details/132900693

### 9 é™æ€èµ„æºé—®é¢˜

[å‚è€ƒ](https://blog.csdn.net/sophieLV1993/article/details/106335737/)

æ–¹å¼ä¸€ï¼šå°†å›¾ç‰‡æ–‡ä»¶æ”¾ç½®publicæ–‡ä»¶å¤¹ä¸­ï¼Œimgæ ‡ç­¾ç›´æ¥å¼•å…¥å›¾ç‰‡çš„ç»å¯¹è·¯å¾„ã€‚

```
 <img src="/assets/logo.png" alt="" className="logo" />
```

æ–¹å¼äºŒï¼šé€šè¿‡cssæ–‡ä»¶å¼•å…¥

æ³¨ï¼šå¼•å…¥çš„å›¾ç‰‡å¿…é¡»ä½äºsrcæ–‡ä»¶å¤¹å†…
1.åˆ›å»ºsrc-resourceæ–‡ä»¶å¤¹,å›¾ç‰‡æ”¾ç½®å…¶ä¸­

```
background: url('../../resource/assets/img/login-bg.png') center center no-repeat;
background-size: 100% 100%;
```





### 10ç²’å­æ•ˆæœèƒŒæ™¯

http://md-md-e867c335436d-fc.madewith.cn/136

### 11 Bodymovin åˆ›å»ºåŠ¨ç”»

```
Bodymovin æ˜¯ä¸€ä¸ªå°† Adobe After Effects åŠ¨ç”»å¯¼å‡ºä¸º JSON æ ¼å¼çš„å·¥å…·ï¼Œå¯ä»¥ä½¿å¾—åœ¨ Web ä¸Šå±•ç¤ºå‘é‡åŠ¨ç”»æ›´åŠ å®¹æ˜“ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Bodymovin è¿™ä¸ªå¼€æº JavaScript åº“æ¥è§£æ Bodymovin å¯¼å‡ºçš„ JSON æ–‡ä»¶å¹¶å°†å…¶æ¸²æŸ“ä¸º SVG æˆ– Canvasã€‚ä½¿ç”¨ Bodymovin å¯ä»¥è½»æ¾åœ°åœ¨ Web ä¸Šå±•ç¤ºæµç•…ã€é«˜å“è´¨çš„å‘é‡åŠ¨ç”»æ•ˆæœï¼Œè¿™å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´æ˜¯ä¸€å¤§ç¦éŸ³ã€‚

ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒç”±æœ¬ç«™ï¼ˆJavaScriptä¸­æ–‡ç½‘ï¼‰æ‹¥æœ‰ï¼Œä¸¥ç¦æœªç»å…è®¸å¤åˆ¶ã€è½¬è½½ã€ä¼ æ’­ã€ç¯¡æ”¹ç­‰ä»»ä½•è¡Œä¸ºï¼Œå¦‚éœ€è½¬è½½ï¼Œ
npm install bodymovin
```

é¡¹ç›®ä½¿ç”¨

```react
import React from 'react'
import bodymovin from 'bodymovin'

class Loading2 extends React.Component{
  componentDidMount(){
    const animData = {
      wrapper: document.querySelector('#animationWindow'),
      animType: 'svg',
      loop: true,
      prerender: true,
      autoplay: true,
      animationData:require('./data.json')
    };
    this.anim = bodymovin.loadAnimation(animData);
    this.anim.setSpeed(1.42);
  }
  componentWillUnmount(){
    this.anim = null
  }
  render(){
    return (
      <div  style={{width:'100%',height:'100%'}}>
        <div id="animationWindow" style={{width:'100%',height:'100%'}}/>
      </div>
    )
  }
}
export default Loading2
```

### 12 é¡¹ç›®ç«¯å£å·ä¿®æ”¹

https://blog.csdn.net/weixin_45289656/article/details/128458357

ç¬¬ä¸€ç§æ–¹å¼ï¼š

node_modulesé‡Œé¢æœ‰ä¸ªreact-scriptsæ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°scriptsï¼Œå†start.jsæ–‡ä»¶ï¼Œè¿™é‡Œæœ‰HOSTé…ç½®ã€‚

ç¬¬äºŒç§æ–¹å¼ï¼š

è¿™ä¸ªæ–¹æ³•å°±ç›¸å¯¹ç®€å•äº† æˆ‘ä»¬æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½ä¼šæœ‰ä¸€ä¸ªpackage.jsonæ–‡ä»¶ ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯è®°å½•æˆ‘ä»¬é¡¹ç›®å®‰è£…åŒ…çš„æ–‡ä»¶

æ‰¾åˆ°è¿™æ®µè°ƒè¯•ä»£ç ä¿®æ”¹start ç»™ä»–åŠ ä¸Šä¸€ä¸ªPORTå€¼ å¦‚ä¸‹å›¾æ‰€ç¤º

```react

  "scripts": {
    "start": "set PORT=8080  react-scripts start",   <---é‡ç‚¹
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },

```

### 13é¡¹ç›®è‡ªå®šä¹‰ç¯å¢ƒå˜é‡

å‰ç«¯é¡¹ç›®å¼€å‘ä¸€èˆ¬ä¼šåŒºåˆ†ä¸‰ä¸ªç¯å¢ƒï¼š(æµ‹è¯•ç¯å¢ƒtestä¸€èˆ¬å¾ˆå°‘ç”¨)

æœ¬åœ°ç¯å¢ƒï¼ˆåŠå¼€å‘ç¯å¢ƒï¼‰â€” developmentï¼Œ

ç”Ÿäº§ç¯å¢ƒ â€” productionã€‚



é¡¹ç›®ä½¿ç”¨åŒºåˆ†dev å’Œprod

æœ¬é¡¹ç›®é…ç½®ï¼š

```
react18   reactè„šæ‰‹æ¶åˆ›å»ºçš„é¡¹ç›®
```



#### ä¸€ã€å»ºç«‹.envæ–‡ä»¶

å¦‚å›¾æ‰€ç¤ºï¼Œåˆ†åˆ«å»ºç«‹.env.developmentå’Œ.env.productionä¸¤ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º`REACT_APP_ENV = 'XXX'`ã€‚å‘½åæœ€å¥½ä¸¥æ ¼ä¿æŒä¸€è‡´ï¼Œreactåªèƒ½è¯†åˆ«åˆ°ä»¥REACT_APPå¼€å¤´çš„å±æ€§ä½œä¸ºç¯å¢ƒå˜é‡ã€‚

![](https://img-blog.csdnimg.cn/152386c0859d4595b601c1a91406f5a9.png)

#### äºŒ  å¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡

æ¯”å¦‚å°è£…axiosï¼Œæœ¬åœ°ä½¿ç”¨æµ‹è¯•æ¥å£ï¼Œæ‰“åŒ…ä½¿ç”¨çº¿ä¸Šæ¥å£ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨`process.env.REACT_APP_ENV`è¿™ä¸ªå±æ€§æ¥åˆ¤æ–­ï¼š

**![](https://img-blog.csdnimg.cn/4cad825bf7ab4872b5417dbbaa0ac175.png)**

#### ä¸‰ å¦‚æœéƒ¨ç½²ä¸Šçº¿ä¸ºç©ºé¡µé¢

è·¯ç”±é—®é¢˜ã€ä¿®æ”¹BrowserRouterä¸ºHashRouterã€‘

åœ¨package.jsonä¸­é…ç½®homepageï¼Œé˜²æ­¢è®¿é—®ä¸åˆ°å¯¹åº”çš„æ‰“åŒ…èµ„æº

![](https://img-blog.csdnimg.cn/bf49f173c9094f97818508a2dbe4f10d.png)



å‚è€ƒæ–‡ç« 

[reacté…ç½®ç¯å¢ƒå˜é‡](https://blog.csdn.net/yutingwu816/article/details/128787048)

[æ˜¾ç¤ºä¸ºç©º](https://blog.csdn.net/qq_40661003/article/details/125916461?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-125916461-blog-122555527.235%5Ev39%5Epc_relevant_anti_vip_base&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-125916461-blog-122555527.235%5Ev39%5Epc_relevant_anti_vip_base&utm_relevant_index=1)



### 14 é¡¹ç›®ä¸ç”¨é‡æ–°æ‰“åŒ…ï¼Œä¿®æ”¹æ¥å£åŸŸå

#### ç¬¬ä¸€ç§æ–¹æ³•ï¼š

â€‹       å®è´¨å°±æ˜¯æŠŠæœ¬åœ¨é¡¹ç›®ä¸­çš„æ¥å£å‚æ•°ï¼ŒæŠŠurlå˜é‡ï¼Œæ”¾åˆ°public è¿™ä¸ªé™æ€çš„ï¼Œå¯¹å¤–æš´éœ²çš„æ–‡ä»¶ä¸­ã€‚

å¥½å¤„ï¼šä¸ç”¨é‡æ–°æ‰“åŒ…ã€‚

åå¤„ï¼š æµè§ˆå™¨ä¸­å¯ä»¥æŸ¥åˆ°è¿™ä¸ªjsï¼Œè¦ç¡®ä¿éƒ¨ç½²ç¯å¢ƒå®‰å…¨ã€‚

#### ç¬¬äºŒç§æ–¹æ³•ï¼š

ä¹Ÿå¯ä»¥å‚è€ƒå¦‚ä¸‹

[å°†urlç½®äºwindown.xxä¸‹](https://blog.csdn.net/qq_31281245/article/details/127408052?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-127408052-blog-112755889.235%5Ev39%5Epc_relevant_anti_vip_base&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-127408052-blog-112755889.235%5Ev39%5Epc_relevant_anti_vip_base&utm_relevant_index=1)



### hooksä¸­è®°ä½çŠ¶æ€çš„æ–¹å¼

useRef

### å…³äºç”Ÿå‘½å‘¨æœŸ

*1.ç±»ç»„ä»¶ Class Component* æœ‰ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µã€‚

2.å‡½æ•°ç»„ä»¶*Function Component* ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œ

é»˜è®¤ä¸èƒ½ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ å¦‚æœè¦ä½¿ç”¨ é‚£ä¹ˆå°±è¦ä½¿ç”¨HOOKæ¥å®Œæˆã€‚

react16.8ç‰ˆæœ¬ä¹‹åæ–°å¢çš„ä¸€ä¸ªæ¦‚å¿µ

HOOK---useEffect

**useEffectå°±å¯ä»¥è®©å‡½æ•°ç»„ä»¶ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ---ä»–ä¼šåœ¨ æŒ‚è½½å®Œæ¯• ä¿®æ”¹å®Œæ¯• å‡†å¤‡é”€æ¯ è¿™ä¸‰ä¸ªé˜¶æ®µéƒ½è§¦å‘**

è¯­æ³•ï¼š

```javascript
useEffect(ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°,ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„)
```

### 15 SPAå’ŒMPA

SPAå•é¡µé¢  å•é¡µWebåº”ç”¨ï¼ˆsingle page web applicationï¼Œ*SPA*ï¼‰

MPAå¤šé¡µé¢åº”ç”¨ï¼ˆ`Multi-Page Application`ï¼‰ç®€å•çš„è¯´å°±æ˜¯æŒ‡ä¸€ä¸ªåº”ç”¨ä¸­æœ‰å¤šä¸ªé¡µé¢ï¼Œé¡µé¢è·³è½¬æ—¶æ˜¯æ•´é¡µåˆ·æ–°ã€‚

### 16 reacté¡¹ç›®çš„ä¸€èˆ¬è·¨åŸŸé…ç½®

https://create-react-app.dev/docs/proxying-api-requests-in-development

Back-End Integration > Proxying in Development ä½ç½®

srcä¸‹æ–°å»ºè·¨åŸŸjs 

```
src/setupProxy.js
```

å®‰è£…æ’ä»¶

```
$ npm install http-proxy-middleware --save
$ # or
$ yarn add http-proxy-middleware
```

é…ç½®js

```react
const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) {
  app.use(
    '/api',
    createProxyMiddleware({
      target: 'http://localhost:5000',
      changeOrigin: true,
    })
  );
};
```

ä¿®æ”¹é…ç½®åï¼Œé‡å¯ã€‚

æ¼”ç¤ºè·¨åŸŸ  çŒ«çœ¼ç”µå½±https://i.maoyan.com/#movie















## å­˜ç–‘é—®é¢˜ï¼š

è¿™æ˜¯ä»€ä¹ˆå†™æ³•  ç±»ç»„ä»¶å—

```
const Child:React.FC<IProps> = (props)=>{
    return <div>child-{props.name}</div>
}
```

Reactæºç é˜…è¯»â€”React.Children.map

