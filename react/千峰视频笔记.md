# reactå…¨å®¶æ¡¶

## ä¸€ React ä»‹ç»

**1.**  **React** **èµ·æºä¸å‘å±•**

React èµ·æºäº Facebook çš„å†…éƒ¨é¡¹ç›®ï¼Œå› ä¸ºè¯¥å…¬å¸å¯¹å¸‚åœºä¸Šæ‰€æœ‰ JavaScript MVC æ¡†æ¶ï¼Œéƒ½ä¸æ»¡æ„ï¼Œå°±å†³å®šè‡ªå·±å†™ä¸€å¥—ï¼Œç”¨æ¥æ¶è®¾Instagram çš„ç½‘ç«™ã€‚åšå‡ºæ¥ä»¥åï¼Œå‘ç°è¿™å¥—ä¸œè¥¿å¾ˆå¥½ç”¨ï¼Œå°±åœ¨2013å¹´5æœˆå¼€æºäº†ã€‚

**2.**  **React ä¸ä¼ ç»Ÿ **MVC** **çš„å…³ç³»**

è½»é‡çº§çš„è§†å›¾å±‚**åº“**ï¼*A JavaScript library for building user interfaces*

Reactä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„MVCæ¡†æ¶ï¼Œæœ€å¤šå¯ä»¥è®¤ä¸ºæ˜¯MVCä¸­çš„Vï¼ˆViewï¼‰ï¼Œç”šè‡³Reactå¹¶ä¸éå¸¸è®¤å¯MVCå¼€å‘æ¨¡å¼ï¼›React æ„å»ºé¡µé¢ UI çš„åº“ã€‚å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºï¼ŒReact å°†ç•Œé¢åˆ†æˆäº†å„ä¸ªç‹¬ç«‹çš„å°å—ï¼Œæ¯ä¸€ä¸ªå—å°±æ˜¯ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¹‹é—´å¯ä»¥ç»„åˆã€åµŒå¥—ï¼Œå°±æˆäº†æˆ‘ä»¬çš„é¡µé¢ã€‚

**3.**  **React** ç‰¹æ€§

ç‰¹ç‚¹:
1.å£°æ˜å¼è®¾è®¡-Reacté‡‡ç”¨å£°æ˜èŒƒå¼ï¼Œå¯ä»¥è½»æ¾æè¿°åº”ç”¨ã€‚

2.é«˜æ•ˆ-Reacté€šè¿‡å¯¹DOMçš„æ¨¡æ‹Ÿ(è™šæ‹Ÿdom)ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘ä¸DOMçš„äº¤äº’

3.çµæ´»-Reactå¯ä»¥ä¸å·²çŸ¥çš„åº“æˆ–æ¡†æ¶å¾ˆå¥½åœ°é…åˆã€‚

4.JSX-JSXæ˜¯JavaScript è¯­æ³•çš„æ‰©å±•

5.ç»„ä»¶-é€šè¿‡ Reactæ„å»ºç»„ä»¶ï¼Œä½¿å¾—ä»£ç æ›´åŠ å®¹æ˜“å¾—åˆ°å¤ç”¨ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„åº”ç”¨åœ¨å¤§é¡¹ç›®çš„å¼€å‘ä¸­ã€‚

6.å•å‘å“åº”çš„æ•°æ®æµ- React å®ç°äº†å•å‘å“åº”çš„æ•°æ®æµï¼Œä»è€Œå‡å°‘äº†é‡å¤ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯å®ƒä¸ºä»€ä¹ˆæ¯”ä¼ ç»Ÿæ•°æ®ç»‘å®šæ›´ç®€å•

**4.** **è™šæ‹Ÿ** **DOM**

ä¼ ç»Ÿdomæ›´æ–°:
çœŸå®é¡µé¢å¯¹åº”ä¸€ä¸ªDOM æ ‘ã€‚åœ¨ä¼ ç»Ÿé¡µé¢çš„å¼€å‘æ¨¡å¼ä¸­ï¼Œæ¯æ¬¡éœ€è¦æ›´æ–°é¡µé¢æ—¶ï¼Œéƒ½è¦æ‰‹åŠ¨æ“ä½œDOMæ¥è¿›è¡Œæ›´æ–°

![](.\img\å¾®ä¿¡æˆªå›¾_20231113164804.png)

è™šæ‹Ÿdom:
DOMæ“ä½œéå¸¸æ˜‚è´µã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæ€§èƒ½æ¶ˆè€—æœ€å¤§çš„å°±æ˜¯ DOM æ“ä½œï¼Œè€Œä¸”è¿™éƒ¨åˆ†ä»£ç ä¼šè®©æ•´ä½“é¡¹ç›®çš„ä»£ç å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚React æŠŠçœŸå® DOM æ ‘è½¬æ¢æˆJavaScript å¯¹è±¡æ ‘ï¼Œä¹Ÿå°±æ˜¯ Virtual

![](.\img\å¾®ä¿¡æˆªå›¾_20231113164916.png)



## äºŒ create-react-app

å…¨å±€å®‰è£…create-react-app

```
npm install -g create-react-app
```

åˆ›å»ºä¸€ä¸ªé¡¹ç›®

create-react-app your-app æ³¨æ„å‘½åæ–¹å¼

Creating a new React app in /dir/your-app.

Installing packages. This might take a couple of minutes. å®‰è£…è¿‡ç¨‹è¾ƒæ…¢ï¼Œ

Installing react, react-dom, and react-scripts...

å¦‚æœä¸æƒ³å…¨å±€å®‰è£…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨npx

```
npx create-react-app myapp ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœ
```

è¿™éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šä¼šå®‰è£…ä¸‰ä¸ªä¸œè¥¿

![img](file:///C:/Users/15612/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png)react: reactçš„é¡¶çº§åº“

![img](file:///C:/Users/15612/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png)react-dom:  å› ä¸ºreactæœ‰å¾ˆå¤šçš„è¿è¡Œç¯å¢ƒï¼Œæ¯”å¦‚appç«¯çš„react-native,  æˆ‘ä»¬è¦åœ¨webä¸Šè¿è¡Œå°±ä½¿ç”¨

react-dom

![img](file:///C:/Users/15612/AppData/Local/Temp/msohtmlclip1/01/clip_image002.png)react-scripts: åŒ…å«è¿è¡Œå’Œæ‰“åŒ…reactåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è„šæœ¬åŠé…ç½®å‡ºç°ä¸‹é¢çš„ç•Œé¢ï¼Œè¡¨ç¤ºåˆ›å»ºé¡¹ç›®æˆåŠŸ:

```
Success! Created your-app at /dir/your-app

Inside that directory, you can run several commands:

npm start

Starts the development server.

npm run build

Bundles the app into static files for production.
npm test
Starts the test runner.


npm run eject
Removes this tool and copies build dependencies, configuration files and scripts into the app directory. If you do this, you canâ€™t go back!

We suggest that you begin by typing:


cd your-app npm start

Happy hacking!
```

ç”Ÿæˆé¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹:â€œ
æ ¹æ®ä¸Šé¢çš„æç¤ºï¼Œé€šè¿‡cd your-app å‘½ä»¤è¿›å…¥ç›®å½•å¹¶è¿è¡Œnpm start å³å¯è¿è¡Œé¡¹ç›®ã€‚

ç”Ÿæˆé¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹

```
â”œâ”€â”€ README.md   ä½¿ç”¨æ–¹æ³•çš„æ–‡æ¡£
â”œâ”€â”€ node_modules    æ‰€æœ‰çš„ä¾èµ–å®‰è£…çš„ç›®å½•
â”œâ”€â”€ package-lock.json  é”å®šå®‰è£…æ—¶çš„åŒ…çš„ç‰ˆæœ¬å·,ä¿è¯å›¢é˜Ÿçš„ä¾èµ–èƒ½ä¿è¯ä¸€è‡´ã€‚
â”œâ”€â”€ package.json
â”œâ”€â”€ public        é™æ€å…¬å…±ç›®å½•
â””â”€â”€ src            å¼€å‘ç”¨çš„æºä»£ç ç›®å½•

```

![img](file:///C:/Users/15612/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png)npmå®‰è£…å¤±è´¥

åˆ‡æ¢ä¸ºnpmé•œåƒä¸ºæ·˜å®é•œåƒâ€œ

ä½¿ç”¨yarnï¼Œå¦‚æœæœ¬æ¥ä½¿ç”¨yarnè¿˜è¦å¤±è´¥ï¼Œè¿˜å¾—æŠŠyarnçš„æºåˆ‡æ¢åˆ°å›½å†…

å¦‚æœè¿˜æ²¡æœ‰åŠæ³•è§£å†³ï¼Œè¯·åˆ é™¤node.modulesåŠpackage-lockjsonç„¶åé‡æ–°æ‰§è¡Œnpm install å‘½ä»¤

å†ä¸èƒ½è§£å†³å°±åˆ é™¤nodemodulesåŠpackage-lock.jsonçš„åŒæ—¶æ¸…é™¤npmç¼“å­˜npm cacheclean --force

ä¹‹åå†æ‰§è¡Œnpm install å‘½ä»¤

## ä¸‰ ç¼–å†™ä¸€ä¸ªreactåº”ç”¨ç¨‹åº

reactå¼€å‘éœ€è¦å¼•å…¥å¤šä¸ªä¾èµ–æ–‡ä»¶ï¼šreact.jsã€react-dom.jsï¼Œåˆ†åˆ«åˆæœ‰å¼€å‘ç‰ˆæœ¬å’Œç”Ÿäº§ç‰ˆæœ¬ï¼Œcreate- react-appé‡Œå·²ç»å¸®æˆ‘ä»¬æŠŠè¿™äº›ä¸œè¥¿éƒ½å®‰è£…å¥½äº†ã€‚æŠŠé€šè¿‡CRAåˆ›å»ºçš„å·¥ç¨‹ç›®å½•ä¸‹çš„srcç›®å½•æ¸…ç©ºï¼Œç„¶ååœ¨é‡Œé¢é‡æ–°åˆ›å»ºä¸€ä¸ªindex.js. å†™å…¥ä»¥ä¸‹ä»£ç :

```react
// ä» react çš„åŒ…å½“ä¸­å¼•å…¥äº† Reactã€‚
//åªè¦ä½ è¦å†™ React.js ç»„ä»¶å°±å¿…é¡»å¼•å…¥React, å› ä¸ºreacté‡Œæœ‰ä¸€ç§è¯­æ³•å«JSXï¼Œç¨åä¼šè®²åˆ°JSXï¼Œè¦å†™JSXï¼Œå°±å¿…é¡»å¼•å…¥React
import React from 'react'
// ReactDOM å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠ React ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šå»ï¼Œæ²¡æœ‰å…¶å®ƒçš„ä½œç”¨äº†ã€‚å®ƒæ˜¯ä» react-dom ä¸­å¼•å…¥çš„ï¼Œè€Œä¸æ˜¯ä» react å¼•å…¥ã€‚
import ReactDOM from 'react-dom'

// ReactDOMé‡Œæœ‰ä¸€ä¸ªrenderæ–¹æ³•ï¼ŒåŠŸèƒ½å°±æ˜¯æŠŠç»„ä»¶æ¸²æŸ“å¹¶ä¸”æ„é€  DOM æ ‘ï¼Œç„¶åæ’å…¥åˆ°é¡µé¢ä¸ŠæŸä¸ªç‰¹å®šçš„å…ƒç´ ä¸Š
ReactDOM.render(
// è¿™é‡Œå°±æ¯”è¾ƒå¥‡æ€ªäº†ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œçœ‹èµ·æ¥åƒæ˜¯çº¯ HTML ä»£ç å†™åœ¨ JavaScript ä»£ç é‡Œé¢ã€‚è¯­æ³•é”™è¯¯å—ï¼Ÿè¿™å¹¶ä¸æ˜¯åˆæ³•çš„ JavaScript ä»£ç , â€œåœ¨ JavaScript å†™çš„æ ‡ç­¾çš„â€è¯­æ³•å« JSX- JavaScript XMLã€‚
<h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>,
// æ¸²æŸ“åˆ°å“ªé‡Œ
document.getElementById('root')
)

```

<React.StrictMode> 

ç›®å‰æœ‰åŠ©äºè¯†åˆ«ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸ
å…³äºä½¿ç”¨è¿‡æ—¶å­—ç¬¦ä¸²refAPIçš„è­¦å‘Š

æ£€æµ‹æ„å¤–çš„å‰¯ä½œç”¨
æ£€æµ‹è¿‡æ—¶çš„ context AP



## å›› JSXè¯­æ³•ä¸ç»„ä»¶

## 1  JSXè¯­æ³•

JSX å°† HTML è¯­æ³•ç›´æ¥åŠ å…¥åˆ° JavaScript ä»£ç ä¸­ï¼Œå†é€šè¿‡ç¿»è¯‘å™¨è½¬æ¢åˆ°çº¯ JavaScript åç”±æµè§ˆå™¨æ‰§è¡Œã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼ŒJSX åœ¨äº§å“æ‰“åŒ…é˜¶æ®µéƒ½å·²ç»ç¼–è¯‘æˆçº¯ JavaScriptï¼Œä¸ä¼šå¸¦æ¥ä»»ä½•å‰¯ä½œç”¨ï¼Œåè€Œä¼šè®©ä»£ç æ›´åŠ ç›´è§‚å¹¶æ˜“äºç»´æŠ¤ã€‚ ç¼–è¯‘è¿‡ç¨‹ç”±Babel çš„ JSX ç¼–è¯‘å™¨å®ç°

**JSXä¸æ˜¯å¿…éœ€çš„(ä½†åº”é¦–é€‰JSXè¯­æ³•)**

JSXåªæ˜¯React.createElement(component,props,...children)çš„[è¯­æ³•ç³–](https://so.csdn.net/so/search?q=è¯­æ³•ç³–&spm=1001.2101.3001.7020)ï¼Œæ‰€æœ‰çš„JSXè¯­æ³•æœ€ç»ˆéƒ½ä¼šè¢«è½¬æ¢æˆå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚

```react
//JSXè¯­æ³•
const element = <div className='foo'>Hello,world</div>
 
//è½¬æ¢å
const element = React.createElement('div',{className:'foo'},'Hello,React')

```



https://reactjs.org/docs/hello-world.html

åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

è¦æ˜ç™½JSXçš„åŸç†ï¼Œéœ€è¦å…ˆæ˜ç™½å¦‚ä½•ç”¨ JavaScript å¯¹è±¡æ¥è¡¨ç°ä¸€ä¸ª DOM å…ƒç´ çš„ç»“æ„?çœ‹ä¸‹é¢çš„DOMç»“æ„

```react
<div class='app' id='appRoot'>
    <h1 class='title'>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>
    <p>
       React.js æ˜¯ä¸€ä¸ªå¸®åŠ©ä½ æ„å»ºé¡µé¢ UI çš„åº“
    </p>
</div>
```

ä¸Šé¢è¿™ä¸ª HTML æ‰€æœ‰çš„ä¿¡æ¯æˆ‘ä»¬éƒ½å¯ä»¥ç”¨ JavaScript å¯¹è±¡æ¥è¡¨ç¤º

```javascript
{
tag: 'div',
attrs: { className: 'app', id: 'appRoot'},
    children: [
{
    tag: 'h1',
    attrs: { className: 'title' }, 
    children: ['æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ']
},
{
  tag: 'p', attrs: null,
  children: ['React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“']
}
]
}
```

ä½†æ˜¯ç”¨ JavaScript å†™èµ·æ¥å¤ªé•¿äº†ï¼Œç»“æ„çœ‹èµ·æ¥åˆä¸æ¸…æ™°ï¼Œç”¨ HTML çš„æ–¹å¼å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚äºæ˜¯ Reactjs å°±æŠŠ JavaScript çš„è¯­æ³•æ‰©å±•äº†ä¸€ä¸‹ï¼Œè®© JavaScript è¯­è¨€èƒ½å¤Ÿæ”¯æŒè¿™ç§ç›´æ¥åœ¨ JavaScript ä»£ç é‡Œé¢ç¼–å†™ç±»ä¼¼ HTML æ ‡ç­¾ç»“æ„çš„è¯­æ³•ï¼Œè¿™æ ·å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚ç¼–è¯‘çš„è¿‡ç¨‹ä¼šæŠŠç±»ä¼¼ HTMLçš„ JSXç»“æ„è½¬æ¢æˆ JavaScript çš„å¯¹è±¡æ„ã€‚

ä¸‹é¢ä»£ç 

```react
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component { 
 render () {
    return (
    <div className='app' id='appRoot'>
        <h1 className='title'>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>
        <p>
          React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“
        </p>
    </div>
    )
}}


ReactDOM.render(<App />, document.getElementById('root'))
```

ç¼–è¯‘ä¹‹åå°†å¾—åˆ°è¿™æ ·çš„ä»£ç 

```react
import React from 'react'
import ReactDOM from 'react-dom'


class App extends React.Component {
    render() {
        return (React.createElement(
            "div",
            {className: 'app', id: 'appRoot'},
            React.createElement("h1",{ className: 'title' }, "æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ"),
            React.createElement("p", null,"React.js æ˜¯ä¸€ä¸ªæ„å»ºé¡µé¢ UI çš„åº“" )
        )
        )
    }
}

ReactDOM.render(React.createElement(App),
    document.getElementById('root')
)
```

React.createElementä¼šæ„å»ºä¸€ä¸ª JavaScript å¯¹è±¡æ¥æè¿°ä½  HTML ç»“æ„çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ ‡ç­¾åã€å±æ€§
è¿˜æœ‰å­å…ƒç´ ç­‰ï¼Œè¯­æ³•ä¸º

```
React.createElement( 
type,
[props], 
[...children]
)

```

æ‰€è°“çš„ JSX å…¶å®å°±æ˜¯ JavaScript å¯¹è±¡ï¼Œæ‰€ä»¥ä½¿ç”¨ React å’ŒJSX çš„æ—¶å€™ä¸€å®šè¦ç»è¿‡ç¼–è¯‘çš„è¿‡ç¨‹

JSXä¸€ä½¿ç”¨reactæ„é€ ç»„ä»¶ï¼Œbableè¿›è¡Œç¼–è¯‘ -->JavaScriptå¯¹è±¡ ä¸€  ReactDOM.render()->DOMå…ƒç´  ä¸€>æ’å…¥é¡µé¢

## 2. Classç»„ä»¶

ES6çš„åŠ å…¥è®©JavaScriptç›´æ¥æ”¯æŒä½¿ç”¨classæ¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œreactåˆ›å»ºç»„ä»¶çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨çš„ç±»çš„ç»§æ‰¿ï¼ŒES6 Class

æ˜¯ç›®å‰å®˜æ–¹æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä½¿ç”¨äº†ES6æ ‡å‡†è¯­æ³•æ¥æ„å»ºï¼Œçœ‹ä»¥ä¸‹ä»£ç 

```javascript
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component { 
    render () {
            return ( <h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>)
            }
        }

ReactDOM.render(
<App />, document.getElementById('root')
)

```

es6 Classç»„ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªæ„é€ å™¨,æ¯æ¬¡ä½¿ç”¨ç»„ä»¶éƒ½ç›¸å½“äºåœ¨å®ä¾‹åŒ–ç»„ä»¶ï¼Œåƒè¿™æ ·

```
import React from 'react'
import ReactDOM from 'react-dom'

class App extends React.Component {
    render() {
        return (
            <h1>æ¬¢è¿è¿›å…¥{this.props.name}çš„ä¸–ç•Œ</h1>
        )
    }
}

const app = new App({
    name: 'react'
}).render()


ReactDOM.render(app,
    document.getElementById('root')
)
```

## 3.å‡½æ•°å¼ç»„ä»¶

```react
import React from 'react'
import ReactDOM from 'react-dom'

const App = (props) => <h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1> 
ReactDOM.render(
// Reactç»„ä»¶çš„è°ƒç”¨æ–¹å¼
<App />, document.getElementById('root')
)
```

è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„å‡½æ•°å¼ç»„ä»¶å°±å®šä¹‰å¥½äº†ã€‚ä½†è¦**æ³¨æ„ï¼æ³¨æ„ï¼æ³¨æ„ï¼**ç»„ä»¶åå¿…é¡»**å¤§å†™**ï¼Œå¦åˆ™æŠ¥é”™

## 4.ç»„ä»¶çš„æ ·å¼

### è¡Œå†…æ ·å¼

æƒ³ç»™è™šæ‹Ÿdomæ·»åŠ è¡Œå†…æ ·å¼ï¼Œéœ€è¦ä½¿ç”¨è¡¨è¾¾å¼ä¼ å…¥æ ·å¼å¯¹è±¡çš„æ–¹å¼æ¥å®ç°

```react
//  æ³¨æ„è¿™é‡Œçš„ä¸¤ä¸ªæ‹¬å·ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºæˆ‘ä»¬åœ¨è¦JSXé‡Œæ’å…¥JSäº†ï¼Œç¬¬äºŒä¸ªæ˜¯å¯¹è±¡çš„æ‹¬å·

 <p style={{color:'red', fontSize:'14px'}}>Hello world</p>
```

è¡Œå†…æ ·å¼éœ€è¦å†™å…¥ä¸€ä¸ªæ ·å¼å¯¹è±¡ï¼Œè€Œè¿™ä¸ªæ ·å¼å¯¹è±¡çš„ä½ç½®å¯ä»¥æ”¾åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œä¾‹å¦‚ renderå‡½æ•°é‡Œã€ç»„ä»¶åŸå‹ä¸Šã€å¤–é“¾jsæ–‡ä»¶ä¸­

ä½¿ç”¨class

Reactæ¨èæˆ‘ä»¬ä½¿ç”¨è¡Œå†…æ ·å¼ï¼Œå› ä¸ºReactè§‰å¾—æ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•´ä½“

å…¶å®æˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹è¿˜æ˜¯å¤§é‡çš„åœ¨ä¸ºå…ƒç´ æ·»åŠ ç±»åï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,classéœ€è¦å†™æˆ className

å› ä¸ºæ¯•ç«Ÿæ˜¯åœ¨å†™ç±»jsä»£ç ï¼Œä¼šæ”¶åˆ°jsè§„åˆ™çš„ç°åœ¨ï¼Œè€Œclassæ˜¯å…³é”®å­—

```
<p className="hello">Hello world</p>
```

æ³¨æ„:	

```
class ==> className , for ==> htmlFor(label)
```

## 5 äº‹ä»¶å¤„ç†

### 1 ç»‘å®šäº‹ä»¶

é‡‡ç”¨å…³äº+äº‹ä»¶åçš„æ–¹å¼æ¥ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œæ³¨æ„ï¼Œè¿™é‡Œå’ŒåŸç”Ÿçš„äº‹ä»¶æ˜¯æœ‰åŒºåˆ«çš„ï¼ŒåŸç”Ÿçš„äº‹ä»¶å…¨æ˜¯å°å†™ onclickï¼ŒReacté‡Œçš„äº‹ä»¶æ˜¯é©¼å³°onClickï¼ŒReact çš„äº‹ä»¶å¹¶ä¸æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œè€Œæ˜¯åˆæˆäº‹ä»¶ã€‚

### 2 äº‹ä»¶handlerçš„å†™æ³•

a ç›´æ¥åœ¨renderé‡Œå†™è¡Œå†…çš„ç®­å¤´å‡½æ•°(ä¸æ¨è)

båœ¨ç»„ä»¶å†…ä½¿ç”¨ç®­å¤´å‡½æ•°å®šä¹‰ä¸€ä¸ªæ–¹æ³•(æ¨è)

c ç›´æ¥åœ¨ç»„ä»¶å†…å®šä¹‰ä¸€ä¸ªéç®­å¤´å‡½æ•°çš„æ–¹æ³•ï¼Œç„¶ååœ¨renderé‡Œç›´æ¥ä½¿ç”¨ onclick=[thishandleclick,bind(this)}  (ä¸æ¨è)

d ç›´æ¥åœ¨ç»„ä»¶å†…å®šä¹‰ä¸€ä¸ªéç®­å¤´å‡½æ•°çš„æ–¹æ³•ï¼Œç„¶ååœ¨constructoré‡Œbind(this)(æ¨è

### 3 Event å¯¹è±¡

å’Œæ™®é€šæµè§ˆå™¨ä¸€æ ·ï¼Œäº‹ä»¶handlerä¼šè¢«è‡ªåŠ¨ä¼ å…¥ä¸€ä¸ª eventeå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å’Œæ™®é€šçš„æµè§ˆå™¨ event å¯¹è±¡æ‰€åŒ…å«çš„æ–¹æ³•å’Œå±æ€§éƒ½åŸºæœ¬ä¸€è‡´ã€‚ä¸åŒçš„æ˜¯ Reactä¸­çš„ event å¯¹è±¡å¹¶ä¸æ˜¯æµè§ˆå™¨æä¾›çš„ï¼Œè€Œæ˜¯å®ƒè‡ªå·±å†…éƒ¨æ‰€æ„å»ºçš„ã€‚å®ƒåŒæ ·å…·æœ‰ event.stopPropagationã€event.preventDefault è¿™ç§å¸¸ç”¨çš„æ–¹æ³•

## 6.Refçš„åº”ç”¨

a  ç»™æ ‡ç­¾è®¾ç½® ref="username"

é€šè¿‡è¿™ä¸ªè·å–this.refs.username , refå¯ä»¥è·å–åˆ°åº”ç”¨çš„çœŸå®dom

b ç»™ç»„ä»¶è®¾ç½®  ref="username"

é€šè¿‡è¿™ä¸ªè·å– this.refs.username  ,refå¯ä»¥è·å–åˆ°ç»„ä»¶å¯¹è±¡

###    **æ–°çš„å†™æ³•**

```
myRef = React.createRef()

     <div ref={this.myRef}>hello</div>

             è®¿é—®this.myRef.current

```



## äº” ç»„ä»¶çš„æ•°æ®æŒ‚è½½æ–¹å¼

**çŠ¶æ€(state)**

çŠ¶æ€å°±æ˜¯ç»„ä»¶æè¿°æŸç§æ˜¾ç¤ºæƒ…å†µçš„æ•°æ®ï¼Œç”±ç»„ä»¶è‡ªå·±è®¾ç½®å’Œæ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´ç”±ç»„ä»¶è‡ªå·±ç»´æŠ¤ï¼Œä½¿ç”¨çŠ¶æ€çš„ç›®çš„å°±æ˜¯ä¸ºäº†åœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ä½¿ç»„ä»¶çš„æ˜¾ç¤ºä¸åŒ(è‡ªå·±ç®¡ç†ï¼‰

### æ‹“å±•è§£é‡Šï¼š

#### a è®¾è®¡åˆé€‚çš„state

stateå¿…é¡»èƒ½ä»£è¡¨ä¸€ä¸ªç»„ä»¶UIå‘ˆç°çš„å®Œæ•´çŠ¶æ€é›†ï¼Œä»£è¡¨ä¸€ä¸ªç»„ä»¶UIå‘ˆç°çš„æœ€å°çŠ¶æ€é›†ã€‚

stateå¿…é¡»èƒ½ä»£è¡¨ä¸€ä¸ªç»„ä»¶UIå‘ˆç°çš„å®Œæ•´çŠ¶æ€é›†åˆå¯ä»¥åˆ†æˆä¸¤ç±»æ•°æ®ï¼šç”¨ä½œæ¸²æŸ“ç»„ä»¶æ—¶ä½¿ç”¨åˆ°çš„æ•°æ®çš„æ¥æºï¼Œç”¨ä½œç»„ä»¶UIå±•ç°å½¢å¼çš„åˆ¤æ–­ä¾æ®ï¼š

```react
class Hello extends Component {
    constructor(props) {
        super(props);
        this.state = {
            user: 'react', //ç”¨ä½œæ¸²æŸ“ç»„ä»¶æ—¶ä½¿ç”¨åˆ°çš„æ•°æ®çš„æ¥æº
            display: true //ç”¨ä½œç»„ä»¶UIå±•ç°å½¢å¼çš„åˆ¤æ–­ä¾æ®
        }
    }
    render() {
        return (
            <div>
                {
                    this.state.display ? <h1>{this.state.user}</h1> : <></>
                }
            </div>
        )
    }
}
export default Hello;
```

#### b æ™®é€šå±æ€§

åœ¨es6ä¸­ï¼Œå¯ä»¥ä½¿ç”¨this.å±æ€§åå®šä¹‰ä¸€ä¸ªclassçš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è¯´å±æ€§æ˜¯ç›´æ¥æŒ‚è½½åœ¨thisä¸‹çš„ä¸€ä¸ªå˜é‡ã€‚å› æ­¤ï¼Œstateå’Œpropså®é™…ä¸Šä¹Ÿæ˜¯ç»„ä»¶çš„å±æ€§ï¼Œåªä¸è¿‡æ˜¯reactåœ¨Component classä¸­é¢„å®šä¹‰å¥½çš„å±æ€§ã€‚

é™¤äº†stateå’Œpropsä»¥å¤–çš„å…¶ä»–ç»„ä»¶å±æ€§ç§°ä¸ºç»„ä»¶çš„æ™®é€šå±æ€§ã€‚

```react
class Hello extends Component {
    constructor(props) {
        super(props);
        this.timer = null; //æ™®é€šå±æ€§
        this.state = {
            date: new Date()
        }
        this.updateDate = this.updateDate.bind(this);
    }
    componentDidMount(){
        this.timer = setInterval(this.updateDate, 1000);
    }
    componentWillUnmount(){
        clearInterval(this.timer);
    }
    updateDate(){
        this.setState({
            date: new Date()
        })
    }
    render() {
        return (
            <div>
                <h1>{this.state.date.toString()}</h1>
            </div>
        )
    }
}
export default Hello;


```

ç»„ä»¶ä¸­ç”¨åˆ°çš„ä¸€ä¸ªå˜é‡æ˜¯å¦åº”è¯¥ä½œä¸ºstateå¯ä»¥é€šè¿‡ä¸‹é¢4æ¡ä¾æ®åˆ¤æ–­ï¼š

è¿™ä¸ªå˜é‡æ˜¯å¦é€šè¿‡propsä»çˆ¶ç»„ä»¶ä¸­è·å–ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€
è¿™ä¸ªå˜é‡æ˜¯å¦åœ¨ç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¿æŒä¸å˜ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€
è¿™ä¸ªå˜é‡æ˜¯å¦å¯ä»¥é€šè¿‡å…¶ä»–çŠ¶æ€(state)æˆ–è€…å±æ€§(props)è®¡ç®—å¾—åˆ°ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€
è¿™ä¸ªå˜é‡æ˜¯å¦åœ¨ç»„ä»¶çš„renderæ–¹æ³•ä¸­ä½¿ç”¨ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå®ƒä¸æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ç§æƒ…å†µæ›´é€‚åˆå®šä¹‰ä¸ºç»„ä»¶çš„ä¸€ä¸ªæ™®é€šå±æ€§.

#### c æ­£ç¡®ä¿®æ”¹state

â‘ ä¸èƒ½ç›´æ¥ä¿®æ”¹stateï¼Œéœ€è¦ä½¿ç”¨setState()

â‘¡stateçš„æ›´æ–°æ˜¯å¼‚æ­¥çš„

Reactä¼šå°†å¤šæ¬¡setStateçš„çŠ¶æ€åˆå¹¶æˆä¸€æ¬¡çŠ¶æ€ä¿®æ”¹ï¼Œä¸èƒ½ä¾èµ–å½“å‰çš„stateè®¡ç®—ä¸‹ä¸€ä¸ªstate(propsä¹Ÿæ˜¯å¼‚æ­¥çš„)ã€‚

ä¾‹å¦‚ï¼šè¿ç»­ä¸¤æ¬¡ç‚¹å‡»åŠ å…¥è´­ç‰©è½¦ï¼Œå®é™…æ•°é‡åªä¼šåŠ 1ï¼Œåœ¨Reactåˆå¹¶å¤šæ¬¡ä¿®æ”¹ä¸º1æ¬¡çš„æƒ…å†µä¸‹ï¼Œç›¸å½“äºæ‰§è¡Œäº†ï¼š

```react
Object.assign(
    previousState,
    {quantity: this.state.quantity + 1},
    {quantity: this.state.quantity + 1}
)
```

è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°çš„setStateï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“å‰ä¿®æ”¹åçš„æœ€æ–°çŠ¶æ€çš„å‰ä¸€ä¸ªçŠ¶æ€preStateï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å½“å‰æœ€æ–°çš„å±æ€§props:

```
this.setState((preState,props) => ({
    quantity: preState.quantity + 1;
}))
```

â‘¢stateçš„æ›´æ–°æ˜¯ä¸€ä¸ªåˆå¹¶çš„è¿‡ç¨‹

â‘£stateä¸ä¸å¯å˜å¯¹è±¡

ç›´æ¥ä¿®æ”¹stateï¼Œç»„ä»¶ä¸ä¼šrenderï¼›stateåŒ…å«çš„æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå½“stateä¸­æŸä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåº”è¯¥é‡æ–°åˆ›å»ºè¿™ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹åŸæ¥çš„çŠ¶æ€ã€‚åˆ›å»ºæ–°çš„çŠ¶æ€æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š

çŠ¶æ€çš„ç±»å‹æ˜¯ä¸å¯å˜ç±»å‹(æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€nullã€undefined)ï¼šå› ä¸ºçŠ¶æ€æ˜¯ä¸å¯å˜ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥èµ‹ä¸€ä¸ªæ–°å€¼å³å¯
çŠ¶æ€çš„ç±»å‹æ˜¯æ•°ç»„ï¼šå¯ä»¥ä½¿ç”¨æ•°ç»„çš„concatæˆ–è€…es6çš„æ‰©å±•è¯­æ³•ï¼Œsliceæ–¹æ³•ã€filteræ–¹æ³•ã€‚ä¸èƒ½ä½¿ç”¨pushã€popã€shiftã€unshiftã€spliceç­‰æ–¹æ³•ä¿®æ”¹æ•°ç»„ç±»å‹çš„çŠ¶æ€ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•ä¼šåœ¨åŸæ•°ç»„åŸºç¡€ä¸Šä¿®æ”¹ã€‚

```
this.setState((preState) => ({
    arr: [...preState.arr,'react'];
}))
this.setState((preState) => ({
    arr: preState.arr.concat(['react'])
}))
```

- çŠ¶æ€çš„ç±»å‹æ˜¯æ™®é€šå¯¹è±¡(ä¸åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„)ï¼šä½¿ç”¨ES6çš„Object.assginæ–¹æ³•æˆ–è€…å¯¹è±¡æ‰©å±•è¯­æ³•.



### **(1)**  **å®šä¹‰**  **state**

ç¬¬ä¸€ç§æ–¹å¼

```
import React, { Component } from 'react' 
import ReactDOM from 'react-dom'

class App extends Component { 
    state = {
      name: 'React', isLiked: false
    }
    render () { 
        return (
        <div>
            <h1>æ¬¢è¿æ¥åˆ°{this.state.name}çš„ä¸–ç•Œ</h1>
                <button>
                {
                this.state.isLiked ? 'â¤å–æ¶ˆ' : 'ğŸ–¤æ”¶è—'
                }
                </button>
        </div>
        )
       }
    }
ReactDOM.render(
<App/>, document.getElementById('root')
)

```

å¦ä¸€ç§æ–¹å¼

```
import React, { Component } from 'react' 
import ReactDOM from 'react-dom'

class App extends Component { 
    constructor() {
        super() 
        this.state = {
        name: 'React', isLiked: false
        }
    }
    
        render () { 
        return (
            <div>
               <h1>æ¬¢è¿æ¥åˆ°{this.state.name}çš„ä¸–ç•Œ</h1>
                <button>
                {this.state.isLiked ? 'â¤å–æ¶ˆ' : 'ğŸ–¤æ”¶è—'}
                </button>
            </div>
        )
        }
    }
ReactDOM.render(
<App/>, document.getElementById('root')
)

```

this.state æ˜¯çº¯jså¯¹è±¡,åœ¨vueä¸­ï¼Œdataå±æ€§æ˜¯åˆ©ç”¨Object.defineProperty å¤„ç†è¿‡çš„ï¼Œæ›´æ”¹dataçš„æ•°æ®çš„æ—¶å€™ä¼šè§¦å‘æ•°æ®çš„getter å’Œsetter ï¼Œä½†æ˜¯Reactä¸­æ²¡æœ‰åšè¿™æ ·çš„å¤„ç†ï¼Œå¦‚æœç›´æ¥æ›´æ”¹çš„è¯ï¼Œ reactæ˜¯æ— æ³•å¾—çŸ¥çš„ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æ›´æ”¹çŠ¶æ€çš„æ–¹æ³• setState ã€‚

### **(2)**  **setState**

isLiked å­˜æ”¾åœ¨å®ä¾‹çš„ stateså¯¹è±¡å½“ä¸­ï¼Œç»„ä»¶çš„render å‡½æ•°å†…ï¼Œä¼šæ ¹æ®ç»„ä»¶çš„statesçš„ä¸­çš„isLiked ä¸åŒæ˜¾ç¤ºâ€œå–æ¶ˆ"æˆ–â€œæ”¶è—"å†…å®¹ã€‚ä¸‹é¢ç»™buttonåŠ ä¸Šäº†ç‚¹å‡»çš„äº‹ä»¶ç›‘å¬ã€‚

```
import React, { Component } from 'react' import ReactDOM from 'react-dom'

class App extends Component { 
    constructor() {
        super() 
        this.state = {
        name: 'React', isLiked: false
        }
    }

    handleBtnClick = () => { this.setState({
    isLiked: !this.state.isLiked
    })
  }
  
render () { 
    return (
    <div>
         <h1>æ¬¢è¿æ¥åˆ°{this.state.name}çš„ä¸–ç•Œ</h1>
        <button onClick={this.handleBtnClick}>
            {
            this.state.isLiked ? 'â¤å–æ¶ˆ' : 'ğŸ–¤æ”¶è—'
            }
        </button>
    </div>
    )
    }
}
ReactDOM.render(
<App/>, document.getElementById('root')
setState æœ‰ä¸¤ä¸ªå‚æ•°
```

ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–¹æ³•returnä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå‚æ•°å«åš updater

å‚æ•°æ˜¯å¯¹è±¡

```
this.setState({
isLiked: !this.state.isLiked
})
```

å‚æ•°æ˜¯æ–¹æ³•

```
this.setState((prevState, props) => { return {
        isLiked: !prevState.isLiked
        }
})

```

æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸Šä¸€æ¬¡çš„state,  ç¬¬äºŒä¸ªæ˜¯props .

setState æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æƒ³è¦è·å–åˆ°æœ€æ–°çš„stateï¼Œæ²¡æœ‰åŠæ³•è·å–ï¼Œå°±æœ‰äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°

```
this.setState(
(prevState, props) => { 
return {
    isLiked: !prevState.isLiked
}, 
    () => {
    console.log('å›è°ƒé‡Œçš„',this.state.isLiked)
    }
)
console.log('setStateå¤–éƒ¨çš„',this.state.isLiked)

```

### (3)å±æ€§(props)

props æ˜¯æ­£å¸¸æ˜¯å¤–éƒ¨ä¼ å…¥çš„ï¼Œç»„ä»¶å†…éƒ¨ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼æ¥åˆå§‹åŒ–çš„è®¾ç½®ï¼Œå±æ€§ä¸èƒ½è¢«ç»„ä»¶è‡ªå·±æ›´æ”¹ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡çˆ¶ç»„ä»¶ä¸»åŠ¨é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ¥ä¼ å…¥æ–°çš„å±æ€§æ˜¯æè¿°æ€§è´¨ã€ç‰¹ç‚¹çš„ï¼Œç»„ä»¶è‡ªå·±ä¸èƒ½éšæ„æ›´æ”¹ã€‚

ä¹‹å‰çš„ç»„ä»¶ä»£ç é‡Œé¢æœ‰props çš„ç®€å•ä½¿ç”¨ï¼Œæ€»çš„æ¥è¯´ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå‚æ•°æ”¾åœ¨æ ‡ç­¾çš„å±æ€§å½“ä¸­ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½ä¼šä½œä¸ºç»„ä»¶å‚æ•°æ¥æ¥æ”¶props :

```
(1) åœ¨ç»„ä»¶ä¸Šé€šè¿‡key=value å†™å±æ€§,é€šè¿‡this.propsè·å–å±æ€§,è¿™æ ·ç»„ä»¶çš„å¯å¤ç”¨æ€§æé«˜äº†.
(2) æ³¨æ„åœ¨ä¼ å‚æ•°æ—¶å€™ï¼Œå¦‚æœå†™æˆisShow="true" é‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,å¦‚æœå†™æˆisShow={true} è¿™ä¸ªæ˜¯å¸ƒå°”å€¼ã€‚
(3) {...å¯¹è±¡} å±•å¼€èµ‹å€¼
(4) é»˜è®¤å±æ€§å€¼

*.defaultProps = {
     é»˜è®¤éƒ½æ˜¯ç©ºï¼Œæˆ–è€…å†™å…¥
   }
  static defaultProps = { 
  myname:"é»˜è®¤çš„myname", myshow:true
}

(5) prop-types å±æ€§éªŒè¯
import propTypes from "prop-types";

*.propTypes={
     name:propTypes.string, age:propTypes.number
}

static propTypes={ 
        myname:propTypes.string,
        myshow:propTypes.bool
    }

```

### (4)å±æ€§vsçŠ¶æ€

ç›¸ä¼¼ç‚¹ï¼šéƒ½æ˜¯çº¯jså¯¹è±¡ï¼Œéƒ½ä¼šè§¦å‘renderæ›´æ–°ï¼Œéƒ½å…·æœ‰ç¡®å®šæ€§ï¼ˆçŠ¶æ€/å±æ€§ç›¸åŒï¼Œç»“æœç›¸åŒï¼‰

ä¸åŒç‚¹ï¼š

\1.    å±æ€§èƒ½ä»çˆ¶ç»„ä»¶è·å–ï¼ŒçŠ¶æ€ä¸èƒ½

\2.    å±æ€§å¯ä»¥ç”±çˆ¶ç»„ä»¶ä¿®æ”¹ï¼ŒçŠ¶æ€ä¸èƒ½

\3.    å±æ€§èƒ½åœ¨å†…éƒ¨è®¾ç½®é»˜è®¤å€¼ï¼ŒçŠ¶æ€ä¹Ÿå¯ä»¥ï¼Œè®¾ç½®æ–¹å¼ä¸ä¸€æ ·

\4.    å±æ€§ä¸åœ¨ç»„ä»¶å†…éƒ¨ä¿®æ”¹ï¼ŒçŠ¶æ€è¦åœ¨ç»„ä»¶å†…éƒ¨ä¿®æ”¹

\5.    å±æ€§èƒ½è®¾ç½®å­ç»„ä»¶åˆå§‹å€¼ï¼ŒçŠ¶æ€ä¸å¯ä»¥

\6.    å±æ€§å¯ä»¥ä¿®æ”¹å­ç»„ä»¶çš„å€¼ï¼ŒçŠ¶æ€ä¸å¯ä»¥



stateçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºç»„ä»¶ä¿å­˜ã€æ§åˆ¶ã€ä¿®æ”¹è‡ªå·±çš„å¯å˜çŠ¶æ€ã€‚ state åœ¨ç»„ä»¶å†…éƒ¨åˆå§‹åŒ–ï¼Œå¯ä»¥è¢«ç»„ä»¶è‡ªèº«ä¿®æ”¹ï¼Œè€Œå¤–éƒ¨ä¸èƒ½è®¿é—®ä¹Ÿä¸èƒ½ä¿®æ”¹ã€‚ä½ å¯ä»¥è®¤ä¸º state  æ˜¯ä¸€ä¸ªå±€éƒ¨çš„ã€åªèƒ½è¢«ç»„ä»¶è‡ªèº«æ§åˆ¶çš„æ•°æ®æºã€‚

stateä¸­çŠ¶æ€å¯ä»¥é€šè¿‡ this.setState æ–¹æ³•è¿›è¡Œæ›´æ–°ï¼Œ setState ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

propsçš„ä¸»è¦ä½œç”¨æ˜¯è®©ä½¿ç”¨è¯¥ç»„ä»¶çš„çˆ¶ç»„ä»¶å¯ä»¥ä¼ å…¥å‚æ•°æ¥é…ç½®è¯¥ç»„ä»¶ã€‚å®ƒæ˜¯å¤–éƒ¨ä¼ è¿›æ¥çš„é…ç½®å‚æ•°ï¼Œç»„ä»¶å†…éƒ¨æ— æ³•æ§åˆ¶ä¹Ÿæ— æ³•ä¿®æ”¹ã€‚é™¤éå¤–éƒ¨ç»„ä»¶ä¸»åŠ¨ä¼ å…¥æ–°çš„ ï¼Œå¦åˆ™ç»„ä»¶çš„ä¸å˜ã€‚

æ²¡æœ‰state-çš„ç»„ä»¶å«æ— çŠ¶æ€ç»„ä»¶(stateless component)ï¼Œè®¾ç½®äº† stateçš„å«åšæœ‰çŠ¶æ€ç»„ä»¶(stateful component)ã€‚å› ä¸ºçŠ¶æ€ä¼šå¸¦æ¥ç®¡ç†çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬å°½é‡å¤šåœ°å†™æ— çŠ¶æ€ç»„ä»¶ï¼Œå°½é‡å°‘åœ°å†™æœ‰çŠ¶æ€çš„ç»„ä»¶ã€‚è¿™æ ·ä¼šé™ä½ä»£ç ç»´æŠ¤çš„éš¾åº¦ï¼Œä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢å¼ºç»„ä»¶çš„å¯å¤ç”¨æ€§ã€‚

### (5)æ¸²æŸ“æ•°æ®

æ¡ä»¶æ¸²æŸ“

```
{
condition ? 'æ¸²æŸ“åˆ—è¡¨çš„ä»£ç ' : 'ç©ºç©ºå¦‚ä¹Ÿ'
}
```

åˆ—è¡¨æ¸²æŸ“

```
// æ•°æ®
const people = [
{ id: 1,name: 'Leo', age: 35}, 
{id: 2,name: 'XiaoMing', age: 16
}]
// æ¸²æŸ“åˆ—è¡¨
{
    people.map(person => { return (
        <dl key={person.id}>
        <dt>{person.name}</dt>
        <dd>age: {person.age}</dd>
        </dl>
        )
    })
}

```

Reactçš„é«˜æ•ˆä¾èµ–äºæ‰€è°“çš„Virtual-DOMï¼Œå°½é‡ä¸ç¢°DOMã€‚å¯¹äºåˆ—è¡¨å…ƒç´ æ¥è¯´ä¼šæœ‰ä¸€ä¸ªé—®é¢˜:å…ƒç´ å¯èƒ½ä¼šåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­æ”¹å˜ä½ç½®ã€‚è¦å®ç°è¿™ä¸ªæ“ä½œï¼Œåªéœ€è¦äº¤æ¢ä¸€ä¸‹DOMä½ç½®å°±è¡Œäº†ï¼Œä½†æ˜¯Reactå¹¶ä¸çŸ¥é“å…¶å®æˆ‘ä»¬åªæ˜¯æ”¹å˜äº†å…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒä¼šé‡æ–°æ¸²æŸ“åé¢ä¸¤ä¸ªå…ƒç´ (å†æ‰§è¡ŒVitual-DOM )ï¼Œè¿™æ ·ä¼šå¤§å¤§å¢åŠ DOMæ“ä½œã€‚ä½†å¦‚æœç»™æ¯ä¸ªå…ƒç´ åŠ ä¸Šå”¯ä¸€çš„æ ‡è¯†ï¼ŒReactå°±å¯ä»¥çŸ¥é“è¿™ä¸¤ä¸ªå…ƒç´ åªæ˜¯äº¤æ¢äº†ä½ç½®ï¼Œè¿™ä¸ªæ ‡è¯†å°±æ˜¯keyï¼Œè¿™ä¸ªkeyå¿…é¡»æ˜¯æ¯ä¸ªå…ƒç´ å”¯ä¸€çš„æ ‡è¯†

dangerouslySetInnerHTML

å¯¹äºå¯Œæ–‡æœ¬åˆ›å»ºçš„å†…å®¹ï¼Œåå°æ‹¿åˆ°çš„æ•°æ®æ˜¯è¿™æ ·çš„

```
content = "<p>React.jsæ˜¯ä¸€ä¸ªæ„å»ºUIçš„åº“</p>"
```

å¤„äºå®‰å…¨çš„åŸå› ï¼ŒReactå½“ä¸­æ‰€æœ‰è¡¨è¾¾å¼çš„å†…å®¹ä¼šè¢«è½¬ä¹‰ï¼Œå¦‚æœç›´æ¥è¾“å…¥ï¼Œæ ‡ç­¾ä¼šè¢«å½“æˆæ–‡æœ¬ã€‚è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨dangerouslyS.etHTMLå±æ€§ï¼Œå®ƒå…è®¸æˆ‘ä»¬åŠ¨æ€è®¾ç½®innecHTML

```
import React, { Component } from 'react' import ReactDOM from 'react-dom'

class App extends Component { 
       constructor() {
        super() this.state = {
            content : "<p>React.jsæ˜¯ä¸€ä¸ªæ„å»ºUIçš„åº“</p>"
        }
    }
render () { 
   return (
        <div
        // æ³¨æ„è¿™é‡Œæ˜¯ä¸¤ä¸ªä¸‹ä¸‹åˆ’çº¿  __html 
        dangerouslySetInnerHTML={{ __html: this.state.content}}
        />
        )
     }
}

ReactDOM.render(
<App/>, document.getElementById('root')
)

```



## å…­è¡¨å•ä¸­çš„å—æ§ç§Ÿé‡‘æŒ‰å’Œéå—æ§ç»„ä»¶

### éå—æ§ç»„ä»¶:

è¡¨å•å…ƒç´ åœ¨Reactä¸­è‡ªèº«ç»´æŠ¤ä¸€äº›çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å—reactæ§åˆ¶çš„ï¼Œè¿™ç±»çŠ¶æ€ä¸å—reactæ§åˆ¶çš„è¡¨å•å…ƒç´ ç§°ä¸ºéå—æ§ç»„ä»¶ã€‚

### å—æ§ç»„ä»¶:

åœ¨Reactä¸­ï¼ŒçŠ¶æ€çš„ä¿®æ”¹å¿…é¡»é€šè¿‡ç»„ä»¶çš„stateï¼Œ

æ³¨æ„: 

å¦ä¸€ç§è¯´æ³•ï¼ˆå¹¿ä¹‰èŒƒå›´çš„è¯´æ³•ï¼‰ï¼ŒReactç»„ä»¶çš„æ•°æ®æ¸²æŸ“æ˜¯å¦è¢«è°ƒç”¨è€…ä¼ é€’çš„ props å®Œå…¨æ§åˆ¶ï¼Œæ§åˆ¶åˆ™ä¸ºå—æ§ç»„ä»¶ï¼Œå¦åˆ™éå—æ§ç»„ä»¶ã€‚

### æ¼”ç¤º

éå—æ§ç»„ä»¶æœ‰æ‚–äºè¿™ä¸€åŸåˆ™ï¼Œä¸ºäº†è®©è¡¨å•å…ƒç´ çš„çŠ¶æ€å˜æ›´ä¹Ÿèƒ½é€šè¿‡ç»„ä»¶çš„stateç®¡ç†ï¼ŒReactä½¿ç”¨å—æ§ç»„ä»¶çš„æŠ€æœ¯è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚

**å—æ§ç»„ä»¶**

å¦‚æœä¸€ä¸ªè¡¨å•å…ƒç´ çš„å€¼æ˜¯ç”±Reactæ¥ç®¡ç†çš„ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå—æ§ç»„ä»¶ã€‚å¯¹äºä¸åŒçš„è¡¨å•å…ƒç´ ï¼ŒReactçš„æ§åˆ¶æ–¹æ³•ç•¥æœ‰ä¸åŒï¼Œå¸¸ç”¨çš„ä¸‰ç±»è¡¨å•å…ƒç´ æ§åˆ¶æ–¹å¼æ˜¯ï¼š

â‘ æ–‡æœ¬æ¡†

åŒ…å«ç±»å‹ä¸ºtextçš„inputå’Œtextareaå…ƒç´ ï¼Œå®ƒä»¬å—æ§çš„åŸç†æ˜¯ï¼šé€šè¿‡valueå±æ€§è®¾ç½®è¡¨å•å…ƒç´ çš„å€¼ï¼Œé€šè¿‡onChangeæ—¶é—´ç›‘å¬å€¼çš„å˜åŒ–ï¼Œå¹¶å°†å˜åŒ–åŒæ­¥åˆ°Reactç»„ä»¶çš„stateä¸­ï¼š






## ä¸ƒ ç»„ä»¶é€šä¿¡çš„æ–¹å¼

### **1.**   çˆ¶å­ç»„ä»¶é€šä¿¡æ–¹å¼

(1)    çˆ¶ä¼ å­  çœ‹propså°èŠ‚

çˆ¶ç»„ä»¶ä¸­ï¼Œåœ¨å¼•ç”¨çš„å­ç»„ä»¶ä¸Šï¼Œkï¼švæ–¹å¼ä¼ é€’ï¼Œ

å­ç»„ä»¶ä½¿ç”¨propsæ¥æ”¶ã€‚

(2)     ä¼ é€’æ•°æ®(çˆ¶ä¼ å­)ä¸ä¼ é€’æ–¹æ³•(å­ä¼ çˆ¶)

```
ä¼ é€’æ–¹æ³•(å­ä¼ çˆ¶) 
çˆ¶ç»„ä»¶æŠŠä¿®æ”¹è‡ªå·±æ•°æ®çš„æ–¹æ³•ï¼Œé€šè¿‡å˜é‡ï¼Œä½¿ç”¨å­ç»„ä»¶ä¼ é€’è¿‡å»ã€‚å­ç»„ä»¶ä½¿ç”¨this.propsæ¥å—
import React, { Component } from 'react'

å­ç»„ä»¶
class Navbar extends Component{
    render(){
        return <div style={{background:"red"}}>
            <button onClick={()=>{
                   console.log("å­é€šçŸ¥çˆ¶ï¼Œ è®©çˆ¶çš„isSHow å–åã€‚",this.props.event) 

                   this.props.event() //è°ƒç”¨çˆ¶ç»„ä»¶ä¼ æ¥å•Šçš„å›è°ƒå‡½æ•°
            }}>click</button>
            <span>navbar</span>
        </div>
    }
}
çˆ¶ç»„ä»¶
export default class App extends Component {
    state = {
        isShow:false
    }

    handleEvent = ()=>{
        this.setState({
            isShow:!this.state.isShow
        })
        // console.log("çˆ¶ç»„ä»¶å®šä¹‰çš„eventäº‹ä»¶")
    }
    render() {
        return (
            <div>
                <Navbar event={this.handleEvent}/>
                {/* <button onClick={()=>{
                    this.setState({
                        isShow:!this.state.isShow
                    })
                }}>click</button> */}
                {this.state.isShow && <Sidebar/>}
            </div>
        )
    }
}
```

(2)     refæ ‡è®° (çˆ¶ç»„ä»¶æ‹¿åˆ°å­ç»„ä»¶çš„å¼•ç”¨ï¼Œä»è€Œè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•)

åœ¨çˆ¶ç»„ä»¶ä¸­æ¸…é™¤å­ç»„ä»¶çš„inputè¾“å…¥æ¡†çš„valueå€¼ã€‚**this.refs.form.reset()**



### **2.**   éçˆ¶å­ç»„ä»¶é€šä¿¡æ–¹å¼

#### **(1)**   **çŠ¶æ€æå‡**  **(**ä¸­é—´äººæ¨¡å¼**)**

Reactä¸­çš„çŠ¶æ€æå‡æ¦‚æ‹¬æ¥è¯´,å°±æ˜¯å°†å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«çš„çŠ¶æ€æå‡åˆ°å®ƒä»¬æœ€è¿‘çš„çˆ¶ç»„ä»¶ä¸Š.åœ¨çˆ¶ç»„ä»¶ä¸Šæ”¹å˜è¿™ä¸ªçŠ¶æ€ç„¶åé€šè¿‡propsåˆ†å‘ç»™å­ç»„ä»¶. ï¼ˆå®è´¨è¿˜æ˜¯çˆ¶å­é€šä¿¡æ–¹å¼ï¼‰

```
import React, { Component } from 'react'
import axios from 'axios'
import './css/03-communination.css'
export default class App extends Component {

    constructor(){
        super()
        this.state = {
            filmList:[],
            info:""
        }
    }
    æ•°æ®æ¥è‡ªäº’è”ç½‘
    https://m.maizuo.com/v5/#/films/nowPlaying
    componentDidMount(){
        axios.get(`/test.json`).then(res=>{
            console.log(res.data.data.films)
            this.setState({
                filmList:res.data.data.films
            })
        })
    }

    render() {
        return (
            <div>
                {/* {this.state.info} */}
                {
                    this.state.filmList.map(item=>
                        <FilmItem key={item.filmId} {...item} onEvent={(value)=>{
                            // console.log("çˆ¶ç»„ä»¶æ¥å—",value)

                            this.setState({
                                info:value
                            })
                        }}></FilmItem>    
                    )
                }


                <FilmDetail info={this.state.info}></FilmDetail>
            </div>
        )
    }
}

/*å—æ§ç»„ä»¶*/
class FilmItem extends Component{
    render(){
        // console.log(this.props)
        let {name, poster,grade,synopsis}  = this.props
        return <div className="filmitem" onClick={()=>{
            // console.log(synopsis)
            this.props.onEvent(synopsis)
        }}>
            <img src={poster} alt={name}/>
            <h4>{name}</h4>
            <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
        </div>
    }
}

class FilmDetail extends Component{
   
    render(){
        console.log(this.props)
        return <div className="filmdetail">
            {this.props.info}
        </div>
    }
}
```



#### **(2)**   å‘å¸ƒè®¢é˜…æ¨¡å¼å®ç°

çº¯jså®ç° ï¼Œè°è®¢é˜…ï¼Œè°æ¥å—ï¼ŒæŠ›å¼ƒäº†çˆ¶å­å­™å…³ç³»ã€‚

```
/*
 * @ä½œè€…: kerwin
 * @å…¬ä¼—å·: å¤§å‰ç«¯ç§æˆ¿èœ
 */
import React, { Component } from 'react'

export default class App extends Component {
    render() {
        return (
            <div>
                app
            </div>
        )
    }
}

//è°ƒåº¦ä¸­å¿ƒ
var bus = {

    list:[],
    //è®¢é˜…
    subscribe(callback){
        // console.log(callback)

        this.list.push(callback)
    },

    //å‘å¸ƒ
    publish(text){
        //éå†æ‰€æœ‰çš„listï¼Œ å°†å›è°ƒå‡½æ•°æ‰§è¡Œ
        // console.log(this.list)

        this.list.forEach(callback=>{
            callback && callback(text)
        })
    }
}


// è®¢é˜…è€…
bus.subscribe((value)=>{
    console.log("11111",value)
})

bus.subscribe((value)=>{
    console.log("2222",value)
})



//å‘å¸ƒè€…

setTimeout(()=>{
    bus.publish("ç”·äººçœ‹äº†æ²‰é»˜111")
},0)


// Redux åŸºäºè®¢é˜…å‘å¸ƒ 

```



#### **(3)**   **context** çŠ¶æ€æ ‘ä¼ å‚

```
import React, { Component } from 'react'
import axios from 'axios'
import './css/03-communination.css'

const GlobalContext  = React.createContext() //åˆ›å»ºcontextå¯¹è±¡

export default class App extends Component {

    constructor(){
        super()
        this.state = {
            filmList:[],
            info:""
        }
        axios.get(`/test.json`).then(res=>{
            console.log(res.data.data.films)
            this.setState({
                filmList:res.data.data.films
            })
        })
    }

    render() {
        return (
            <GlobalContext.Provider value={{
                call:"æ‰“ç”µè¯",
                sms:"çŸ­ä¿¡",
                info:this.state.info,
                changeInfo:(value)=>{
                    this.setState( {
                        info:value
                    })
                }
            }}>
                <div>
                    {/* {this.state.info} */}
                    {
                        this.state.filmList.map(item=>
                            <FilmItem key={item.filmId} {...item} ></FilmItem>    
                        )
                    }


                    <FilmDetail ></FilmDetail>
                </div>
            </GlobalContext.Provider>
        )
    }
}

/*å—æ§ç»„ä»¶*/
class FilmItem extends Component{
    render(){
        // console.log(this.props)
        let {name, poster,grade,synopsis}  = this.props
        return (
        <GlobalContext.Consumer>
           {
                (value)=>{
                    console.log(value)
                    
                    return <div className="filmitem" onClick={()=>{
                        console.log(synopsis)
                        // this.props.onEvent(synopsis)

                        // value.info = "2222222"

                        // console.log(value)

                        value.changeInfo(synopsis)
                    }}>
                        <img src={poster} alt={name}/>
                        <h4>{name}</h4>
                        <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
                    </div>
                }
           }
        </GlobalContext.Consumer>
        )    
    }
}

class FilmDetail extends Component{
    render(){
        return (
            <GlobalContext.Consumer>
                {
                    (value)=><div className="filmdetail">
                        detail-{value.info}
                    </div>
                }
            </GlobalContext.Consumer>
        )
    }
}
```







## å…« Reactç”Ÿå‘½å‘¨æœŸ

**åªæœ‰ç±»ç»„ä»¶æ‰æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ**

###  1.åˆå§‹åŒ–é˜¶æ®µ

```
componentWillMount: renderä¹‹å‰æœ€åä¸€æ¬¡ä¿®æ”¹çŠ¶æ€çš„æœºä¼š

render: åªèƒ½è®¿é—®this.propså’Œthis.stateï¼Œä¸å…è®¸ä¿®æ”¹çŠ¶æ€å’ŒDOMè¾“å‡º

componentDidMount: æˆåŠŸrenderå¹¶æ¸²æŸ“å®ŒæˆçœŸå®DOMä¹‹åè§¦å‘ï¼Œå¯ä»¥ä¿®æ”¹DOM
```

### 2.è¿è¡Œä¸­é˜¶æ®µ

```
componentWillReceiveProps: çˆ¶ç»„ä»¶ä¿®æ”¹å±æ€§è§¦å‘

shouldComponentUpdate: è¿”å›falseä¼šé˜»æ­¢renderè°ƒç”¨

componentWillUpdate: ä¸èƒ½ä¿®æ”¹å±æ€§å’ŒçŠ¶æ€

render: åªèƒ½è®¿é—®this.propså’Œthis.stateï¼Œä¸å…è®¸ä¿®æ”¹çŠ¶æ€å’ŒDOMè¾“å‡º

componentDidUpdate: å¯ä»¥ä¿®æ”¹DOM
```

### 3.é”€æ¯é˜¶æ®µ

```
componentWillUnmount: åœ¨åˆ é™¤ç»„ä»¶ä¹‹å‰è¿›è¡Œæ¸…ç†æ“ä½œï¼Œæ¯”å¦‚è®¡æ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨
```

### 4.è€ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜

(1)componentWillMount,åœ¨ssrä¸­ è¿™ä¸ªæ–¹æ³•å°†ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ‰€ä»¥ä¼šé‡å¤è§¦å‘å¤šéï¼ŒåŒæ—¶åœ¨è¿™é‡Œå¦‚æœç»‘å®šäº‹ä»¶å°†æ— æ³•è§£ç»‘ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œ å˜å¾—ä¸å¤Ÿå®‰å…¨é«˜æ•ˆé€æ­¥åºŸå¼ƒã€‚

(2) componentWilReceiveProps å¤–éƒ¨ç»„ä»¶å¤šæ¬¡é¢‘ç¹æ›´æ–°ä¼ å…¥å¤šæ¬¡ä¸åŒçš„ propsï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„å¼‚æ­¥è¯·æ±‚

(3)componetWilupdate,æ›´æ–°å‰è®°å½• DOM çŠ¶æ€ï¼Œå¯èƒ½ä¼šåšä¸€äº›å¤„ç†ï¼Œä¸componentDidUpdateç›¸éš”æ—¶é—´å¦‚æœé•¿ï¼Œä¼šå¯¼è‡´ çŠ¶æ€ä¸å¤ªä¿¡

### 5.æ–°ç”Ÿå‘½å‘¨æœŸçš„æ›¿ä»£

(1) getDerivedStateFromProps ç¬¬ä¸€æ¬¡çš„åˆå§‹åŒ–ç»„ä»¶ä»¥åŠåç»­çš„æ›´æ–°è¿‡ç¨‹ä¸­(åŒ…æ‹¬è‡ªèº«çŠ¶æ€æ›´æ–°ä»¥åŠçˆ¶ä¼ å­)è¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ–°çš„stateï¼Œè¿”å›nullåˆ™è¯´æ˜ä¸éœ€è¦åœ¨è¿™é‡Œæ›´æ–°state

```
//è€çš„ç”Ÿå‘½å‘¨æœŸçš„å†™æ³• 
componentDidMount() {
    if (this.props.value !== undefined) {
        this.setState({
            current: this.props.value
        })
    }
}
componentWillReceiveProps(nextProps){
    if (nextProps.value !== undefined) {
        this.setState({
            current: nextProps.value
        })
    }
}

// æ–°çš„ç”Ÿå‘½å‘¨æœŸå†™æ³•
static getDerivedStateFromProps(nextProps, prevState) {
    const {type} = nextProps;
    // å½“ä¼ å…¥çš„typeå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ›´æ–°state
    if (type !== prevState.type) {
        return {
            type,
        };
    }
    // å¦åˆ™ï¼Œå¯¹äºstateä¸è¿›è¡Œä»»ä½•æ“ä½œ
    return null;
}
å¤åˆ¶ä»£ç 
```

 (2) 

getSnapshotBeforeUpdate å–ä»£äº† componetWillUpdate ,è§¦å‘æ—¶é—´ä¸ºupdateå‘ç”Ÿçš„æ—¶å€™ï¼Œåœ¨renderä¹‹å

domæ¸²æŸ“ä¹‹å‰è¿”å›ä¸€ä¸ªå€¼ï¼Œä½œä¸ºcomponentDidUpdateçš„ç¬¬ä¸‰ä¸ªå‚æ•°

```
//æ–°çš„æ•°æ®ä¸æ–­æ’å…¥æ•°æ®å‰é¢ï¼Œ  å¯¼è‡´æˆ‘æ­£åœ¨çœ‹çš„æ•°æ®å‘ä¸‹èµ°ï¼Œå¦‚ä½•ä¿æŒå¯è§†åŒºä¾æ—§æ˜¯æˆ‘ä¹‹å‰çœ‹çš„æ•°æ®å‘¢ï¼Ÿ
getSnapshotBeforeUpdate(){
    return this.refs.wrapper.scrollHeight
}


componentDidUpdate(prevProps, prevState, preHeight) {
    //if(preHeight===200)return ;
    this.refs.wrapper.scrollTop += this.refs.wrapper.scrollHeight - preHeight
}


<div style={{ height: "200px", overflow: "auto" }}} ref="wrapper">
    <ul>
        .........
    </ul>
</div>
```







## ä¹ React Hooks

### 1 ç”¨hooksç†ç”±

1. é«˜é˜¶ç»„ä»¶ä¸ºäº†å¤ç”¨ï¼Œå¯¼è‡´ä»£ç å±‚çº§å¤æ‚

2. ç”Ÿå‘½å‘¨æœŸçš„å¤æ‚
3. å†™æˆfunctionalç»„ä»¶,æ— çŠ¶æ€ç»„ä»¶ ï¼Œå› ä¸ºéœ€è¦çŠ¶æ€ï¼Œåˆæ”¹æˆäº†class,æˆæœ¬é«˜

### 2. useState(ä¿å­˜ç»„ä»¶çŠ¶æ€)

```
const [list,setList] = useState(["aa","bb","cc"])
ç»“æ„å‡ºlistå˜é‡ï¼Œ å’Œä¿®æ”¹listçš„å”¯ä¸€æŒ‡å®šæ–¹æ³•setList

æ¡ˆä¾‹: ç‚¹å‡»æŒ‰é’®num+1; åœ¨å®é™…é¡µé¢æ•ˆæœä¸­ï¼Œç”±äºæ¯æ¬¡åˆ·æ–°ï¼Œnuméƒ½ä¼šå›åˆ°åˆå§‹å€¼ï¼Œæ— æ³•è¾¾åˆ°ç›®çš„ã€‚
import React,{useState,useRef} from 'react'
export default function App() {
    var num = 20;
    const [list,setList] = useState(["aa","bb","cc"])
    
```

### 3. useEffect(å¤„ç†å‰¯ä½œç”¨)å’ŒuseLayoutEffect (åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨)

Function Component ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ä¸è¦æŠŠ Class Component çš„ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µæ¬è¿‡æ¥è¯•å›¾å¯¹å·å…¥åº§ã€‚

```
useEffect(() => {
           //effect æ¸²æŸ“é¡µé¢åæ‰§è¡Œ
return () => {
         //cleanup  é”€æ¯æ—¶æ‰§è¡Œ
};
}, [ä¾èµ–çš„çŠ¶æ€;ç©ºæ•°ç»„,è¡¨ç¤ºä¸ä¾èµ–])
```

ä¸è¦å¯¹ Dependencies æ’’è°, å¦‚æœä½ æ˜æ˜ä½¿ç”¨äº†æŸä¸ªå˜é‡ï¼Œå´æ²¡æœ‰ç”³æ˜åœ¨ä¾èµ–ä¸­ï¼Œä½ ç­‰äºå‘ React æ’’äº†è°ï¼Œåæœ
å°±æ˜¯ï¼Œå½“ä¾èµ–çš„å˜é‡æ”¹å˜æ—¶ï¼ŒuseEffect ä¹Ÿä¸ä¼šå†æ¬¡æ‰§è¡Œ, eslintä¼šæŠ¥è­¦å‘Š

```
let id = props.match.params.myid useEffect(()=>{
axios.get(`/articles/${id}`).then(res => { settitle(res.data.title) setcontent(res.data.content) setcategory(res.data.category)
})
},[id])
```

**useEï¬€ect**å’Œ **useLayoutEï¬€ect**  æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨æ—¶æœºä¸åŒï¼Œ**
useLayoutEffect **å’ŒåŸæ¥** componentDidMount **&** componentDidUpdate **ä¸€è‡´ï¼Œåœ¨ reactå®ŒæˆDOMæ›´æ–°åé©¬ä¸Š**åŒæ­¥**è°ƒç”¨çš„ä»£ç ï¼Œä¼šé˜»å¡é¡µé¢æ¸²æŸ“ã€‚è€Œ**
useEffect **æ˜¯ä¼šåœ¨æ•´ä¸ªé¡µé¢æ¸²æŸ“å®Œæ‰ä¼šè°ƒç”¨çš„ä»£ç **



### 4. useRefï¼ˆæ˜¯hooksä¸€ç§ï¼Œä¸€èˆ¬åœ¨**å‡½æ•°ç»„ä»¶ä½¿ç”¨**ï¼‰

ä½œç”¨æ˜¯ï¼šè®°ä½çŠ¶æ€

```
export default function App() {
    const mytext = useRef() // React.createRef()
    
    const handleAdd = ()=>{
        console.log(mytext.current.value) // è·å–å€¼
    }
 
  return (<div>
            <input ref={mytext}/> 
               <button onClick={handleAdd}>add</button>
```

å®˜æ–¹å»ºè®®ä¼˜å…ˆä½¿ç”¨useEffect

åœ¨å®é™…ä½¿ç”¨æ—¶å¦‚æœæƒ³é¿å…**é¡µé¢æŠ–åŠ¨**ï¼ˆåœ¨useEffect é‡Œä¿®æ”¹DOMå¾ˆæœ‰å¯èƒ½å‡ºç°ï¼‰çš„è¯ï¼Œå¯ä»¥æŠŠéœ€è¦æ“ä½œDOMçš„ä»£ç æ”¾åœ¨useLayoutEffect é‡Œã€‚åœ¨è¿™é‡Œåšç‚¹domæ“ä½œï¼Œè¿™äº›domä¿®æ”¹ä¼šå’Œ
react åšå‡ºçš„æ›´æ”¹ä¸€èµ·è¢«ä¸€æ¬¡æ€§æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œåªæœ‰ä¸€æ¬¡å›æµã€é‡ç»˜çš„ä»£ä»·

### **5. useCallback(**è®°å¿†å‡½æ•°**)**

é˜²æ­¢å› ä¸ºç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´æ–¹æ³•è¢«é‡æ–°åˆ›å»º ï¼Œèµ·åˆ°ç¼“å­˜ä½œç”¨*;* åªæœ‰ç¬¬äºŒä¸ªå‚æ•° å˜åŒ–äº†ï¼Œæ‰é‡æ–°å£°æ˜ä¸€æ¬¡ã€‚

```react
var handleClick = useCallback(()=>{ console.log(name)
},[name])
<button onClick={()=>handleClick()}>hello</button>

//åªæœ‰nameæ”¹å˜åï¼Œ  è¿™ä¸ªå‡½æ•°æ‰ä¼šé‡æ–°å£°æ˜ä¸€æ¬¡ï¼Œ
//å¦‚æœä¼ å…¥ç©ºæ•°ç»„ï¼Œ  é‚£ä¹ˆå°±æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºåå°±è¢«ç¼“å­˜ï¼Œ  å¦‚æœnameåæœŸæ”¹å˜äº†,æ‹¿åˆ°çš„è¿˜æ˜¯è€çš„nameã€‚
//å¦‚æœä¸ä¼ ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°å£°æ˜ä¸€æ¬¡ï¼Œæ‹¿åˆ°çš„å°±æ˜¯æœ€æ–°çš„name.

```

**useMemo** **è®°å¿†ç»„ä»¶**

useCallback çš„åŠŸèƒ½å®Œå…¨å¯ä»¥ç”± useMemo æ‰€å–ä»£ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ä½¿ç”¨ useMemo è¿”å›ä¸€ä¸ªè®°å¿†å‡½æ•°ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„

```react
useCallback(fn, inputs) is equivalent to useMemo(() => fn, inputs).
```

å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼š**useCallback** **ä¸ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œè€Œæ˜¯å°†å®ƒè¿”å›ç»™ä½ ï¼Œè€Œ** **useMemo** **ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°å¹¶****ä¸”å°†å‡½æ•°æ‰§è¡Œç»“æœè¿”å›ç»™ä½ ã€‚**æ‰€ä»¥åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥è¿”å› handleClick æ¥è¾¾åˆ°å­˜å‚¨å‡½æ•°çš„ç›®çš„ã€‚

æ‰€ä»¥ useCallback å¸¸ç”¨è®°å¿†äº‹ä»¶å‡½æ•°ï¼Œç”Ÿæˆè®°å¿†åçš„äº‹ä»¶å‡½æ•°å¹¶ä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨ã€‚è€Œ useMemo æ›´é€‚åˆç»è¿‡å‡½æ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œæ¯”å¦‚è®°å¿†ç»„ä»¶ã€‚(ç±»ä¼¼ä¸vueçš„è®¡ç®—å±æ€§)

### **6. useRef(**ä¿å­˜å¼•ç”¨å€¼**)**

```react
const myswiper = useRef(null);
<Swiper ref={myswiper}/>
```

ref å†™åœ¨domä¸Šæ˜¯valueå€¼ï¼Œå†™åœ¨ç»„ä»¶ä¸Šï¼Œæ˜¯ç»„ä»¶å¯¹è±¡ã€‚



### 7. useContextï¼ˆå‡å°‘ç»„ä»¶å±‚çº§ï¼‰

å¯¹classç±»ç»„ä»¶ä¸­ä½¿ç”¨contextæ–¹æ³•ï¼Œ

åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­çš„ç®€åŒ–å†™æ³•ã€‚ æä¾›ç«¯æ²¡æœ‰ç®€åŒ–ï¼Œæ¥å—ç«¯è¾ƒå¤§ç®€åŒ–ã€‚

```react
import React, { useState,useEffect,useContext } from 'react'
import axios from 'axios'
import './css/index.css'

const GlobalContext  = React.createContext() //åˆ›å»ºcontextå¯¹è±¡

export default function App (){
    const [filmList, setfilmList] = useState([])
    const [info, setinfo] = useState("")

    useEffect(() => {
        axios.get(`/test.json`).then(res=>{
            // console.log(res.data.data.films)
            setfilmList(res.data.data.films)
        })
    }, []);

    return (
        <GlobalContext.Provider value={{
            call:"æ‰“ç”µè¯",
            sms:"çŸ­ä¿¡",
            info:info,
            changeInfo:(value)=>{
                setinfo(value)
            }
        }}>
            <div>
                {/* {this.state.info} */}
                {
                    filmList.map(item=>
                        <FilmItem key={item.filmId} {...item} ></FilmItem>    
                    )
                }


                <FilmDetail ></FilmDetail>
            </div>
        </GlobalContext.Provider>
    )
}

/*å—æ§ç»„ä»¶*/

function FilmItem(props){
    let {name, poster,grade,synopsis}  = props
    const value = useContext(GlobalContext)

    console.log(value)// çˆ¶ç»„ä»¶GlobalContext.Provider æä¾›çš„å€¼ï¼šcall:"æ‰“ç”µè¯",
    return <div className="filmitem" onClick={()=>{
                console.log(synopsis)

                value.changeInfo(synopsis)
            }}>
                <img src={poster} alt={name}/>
                <h4>{name}</h4>
                <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
            </div> 
}



function FilmDetail(){
    const value = useContext(GlobalContext)
    return <div className="filmdetail">
        detail-{value.info}
    </div>
}
```

### 8.useReducer çš„ä½¿ç”¨

åŠŸèƒ½ï¼šHooksæä¾›çš„ä¸€ç§ï¼Œå°†ç»„ä»¶çŠ¶æ€æåˆ°å¤–é¢çš„æ–¹æ³•ã€‚

æ¡ˆä¾‹ï¼š å¯¹countæ•°å­—ï¼Œ +  -- æ“ä½œã€‚

```react
import React,{useReducer} from 'react'
 //å¤„ç†å‡½æ•°
 const reducer = (prevState,action)=>{
    //  console.log("reduercer",prevState,action)
     let newstate = {...prevState}
     switch(action.type){
         case "kerwin-minus":
            newstate.count--
            return newstate

         case "kerwin-add":
            newstate.count++
            return newstate
        
         default:
            return prevState
     }
 }
 // å¤–éƒ¨çš„å¯¹è±¡
 const intialState = {
     count:0,
    //  list:[]
 } 

 export default function App() {
     const [state, dispatch] = useReducer(reducer,intialState)
        console.log(state, dispatch)
     return (
         <div>
             <button onClick={()=>{
                 dispatch({
                     type:"kerwin-minus"
                 })
             }}>-</button>
             {state.count}
             <button onClick={()=>{
                 dispatch({
                    type:"kerwin-add"
                })
             }}>+</button>
         </div>
     )
 }
```

### 9.useReducer + useContexté…åˆä½¿ç”¨ï¼ˆå‡å°‘ç»„ä»¶å±‚çº§ï¼‰

  Hooksæä¾›ç±»ä¼¼reduxæ•°æ®ä»“åº“ç†å¿µçš„å·¥å…·æ–¹æ³•ã€‚

æ¡ˆä¾‹ï¼šappçˆ¶ç»„ä»¶ï¼Œ ä¼ å€¼ç»™ä¸‰ä¸ªå­ç»„ä»¶ï¼Œå…±äº«æ•°æ®å’Œæ–¹æ³•ã€‚child1ç»„ä»¶ï¼Œç‚¹å‡»ï¼Œchild2 child3è§†å›¾å˜åŒ–ã€‚

```react
import React,{useReducer,useContext} from 'react'

const initailState = {
    a:"11111",
    b:"11111"
}

const reducer = (prevState,action)=>{
    let newstate = {...prevState}
    switch(action.type){
        case "change-a":
            newstate.a = action.value
            return newstate
        case "change-b":
            newstate.b = action.value
            return newstate
        default:
            return prevState
    }
    // return prevState
}

const GlobalContext = React.createContext()
export default function App() {
    const [state, dispatch] = useReducer(reducer, initailState)
    
    return (
        <GlobalContext.Provider value={
            {
                state,
                dispatch
            }
        }>
            <div>
                <Child1/>
                <Child2/>
                <Child3/>
            </div>
        </GlobalContext.Provider>
    )
}

function Child1(){
    const {dispatch} = useContext(GlobalContext)
    return <div style={{background:"red"}}>
        <button onClick={()=>{
            dispatch({
                type:"change-a",
                value:"2222222"
            })
        }}>æ”¹å˜a</button>
        <button onClick={()=>{
            dispatch({
                type:"change-b",
                value:"333333"
            })
        }}>æ”¹å˜b</button>
    </div>
}

function Child2(){
    const {state} = useContext(GlobalContext)
    return <div style={{background:"yellow"}}>
        child2-{state.a}
    </div>
}

function Child3(){
    const {state} = useContext(GlobalContext)
    return <div style={{background:"gray"}}>
        child3-{state.b}
    </div>
}
```



### 10 è‡ªå®šä¹‰hooks

åŠŸèƒ½ï¼š é¡µé¢é€»è¾‘æ›´æ¸…æ™°ï¼Œæ›´å¥½é˜…è¯»ï¼Œä½“ç°å‡½æ•°å¼å˜æˆæ€æƒ³ã€‚

å®ç°ï¼š Hooksæä¾›ä¸€ç§æ–¹æ³•ã€‚ å…è®¸ä½ å°†ä¸€ä¸ªå¤§æ–¹æ³•ï¼ŒæŒ‰ä¸€å®šé€»è¾‘ï¼ŒæŠ½ç¦»å‡ºæ¥å†™æˆä¸€ä¸ªuse-å¼€å¤´çš„å°æ–¹æ³•ï¼Œä¸ç”¨æ‹…å¿ƒå¼‚æ­¥é—®é¢˜ã€‚æ¯æ¬¡ä¿®æ”¹ï¼Œä»£ç éƒ½ä¼šé‡æ–°ç»™å‡ºæ–°å€¼ã€‚

æ¡ˆä¾‹å¦‚ä¸‹ï¼›

```
import React, { useState,useEffect,useMemo } from 'react'
import axios from 'axios'

**1 è·å–listæ•°æ®æ–¹æ³•
function useCinemaList(){
    const [cinemaList, setcinemaList] = useState([])


    useEffect(() => {
        axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                
                'X-Host': 'mall.film-ticket.cinema.list'

            }
        }).then(res=>{
            setcinemaList(res.data.data.cinemas)
        })
    }, [])

    return {
        cinemaList
    }
}
 **2è·å–ç­›é€‰åçš„æ•°æ®æ–¹æ³•
function useFilter(cinemaList,mytext){
    const getCinemaList = useMemo(() => cinemaList.filter(item=>item.name.toUpperCase().includes(mytext.toUpperCase()) || 
    item.address.toUpperCase().includes(mytext.toUpperCase())
    ), [cinemaList,mytext])

    return {
        getCinemaList
    }
}

export default function Cinema(){
    const [mytext, setmytext] = useState("")
    
    const {cinemaList}  = useCinemaList()

    const {getCinemaList} = useFilter(cinemaList,mytext)

    return <div>
            {/* {this.state.mytext} */}
                <input value={mytext} onChange={(evt)=>{
                    setmytext(evt.target.value)
                }}/>
                {
                    getCinemaList.map(item=>
                        <dl key={item.cinemaId}>
                            <dt>{item.name}</dt>
                            <dd>{item.address}</dd>
                        </dl>    
                    )
                }
        </div>
}
```







### å°ç»“è§£ç–‘ï¼š

Q:  [reactä¸­useRefä¸createRefçš„åŒºåˆ«](https://www.cnblogs.com/-roc/p/16943895.html)

A:   useRef()                   React.createRef()

useRef ï¼ˆæ˜¯hooksä¸€ç§ï¼Œä¸€èˆ¬åœ¨**å‡½æ•°ç»„ä»¶ä½¿ç”¨**ï¼‰

1.1.è·å–å½“å‰domæ•°æ®ï¼ˆä¸æ¨èï¼Œæ¨èä½¿ç”¨å—æ§ç»„ä»¶-å³ä½¿ç”¨useStateç»‘å®šè¡¨å•å…ƒç´ ï¼‰

1.2ã€ä½œä¸ºå­˜å‚¨ä½¿ç”¨

createRefï¼ˆä¸€èˆ¬ç”¨äºclassç»„ä»¶ï¼Œè·å–å­ç»„ä»¶domï¼‰

1ã€createRefåˆ›å»ºçš„refå¯¹è±¡ï¼Œç»„ä»¶æ¯æ›´æ–°ä¸€æ¬¡ï¼Œrefå¯¹è±¡å°±ä¼šè¢«é‡æ–°åˆ›å»ºã€‚

åŒºåˆ«

1.    useRefåªä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶åˆ›å»º

2.  createRefä¼šåœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™é‡æ–°åˆ›å»º

   

   

## å Reactè·¯ç”±

### **1.**  ä»€ä¹ˆæ˜¯è·¯ç”±ï¼Ÿ

è·¯ç”±æ˜¯æ ¹æ®ä¸åŒçš„ url åœ°å€å±•ç¤ºä¸åŒçš„å†…å®¹æˆ–é¡µé¢ã€‚

ä¸€ä¸ªé’ˆå¯¹Reactè€Œè®¾è®¡çš„è·¯ç”±è§£å†³æ–¹æ¡ˆã€å¯ä»¥å‹å¥½çš„å¸®ä½ è§£å†³React components åˆ°URlä¹‹é—´çš„åŒæ­¥æ˜ å°„å…³ç³»

### 2.è·¯ç”±å®‰è£…

https://reacttraining.com/react-router/web/guides/quick-start

```
npm install react-router-dom@5

"react-router-dom": "^5.3.4",
```

### 3. è·¯ç”±ä½¿ç”¨

####  (1)è·¯ç”±æ–¹æ³•å¯¼å…¥

```
import React from "react"; import {
 BrowserRouter as Router, Switch,
 Route, Link
  } from "react-router-dom";
```

#### (2)å®šä¹‰è·¯ç”±ä»¥åŠé‡å®šå‘ æ¡ˆä¾‹hashæ¨¡å¼

  è·¯ç”±åŸºæœ¬ä½¿ç”¨

```react
<HashRouter>
  <Route path="/films" component={Films}/>
    <Route path="/cinemas" component={Cinemas}/>
</HashRouter>
å½“æµè§ˆå™¨http://localhost:3000/#/filmsæ—¶ï¼Œå±•ç¤ºå¯¹åº”ç»„ä»¶ã€‚æ’ä»¶çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯åŒ¹é…åŠŸèƒ½ã€‚
```

åŠ åŠŸèƒ½1ï¼š

å½“ç”¨æˆ·è¾“å…¥çš„è·¯å¾„ï¼Œæ²¡æœ‰å¯¹åº”é¡µé¢æ—¶ï¼Œè·³åˆ°homeé¡µå»ã€‚

```react
<HashRouter>
  <Switch>
         <Route path="/films" component={Films}/>
         <Route path="/cinemas" component={Cinemas}/>
      
       <Redirect from="/" to="/home" />   //from="/"  æ¨¡ç³ŠåŒ¹é…
   </Switch>
</HashRouter>
SwitchåµŒå¥—è·¯ç”±ï¼Œé…åˆé‡å®šä½æ ‡ç­¾ã€‚å®ç°ï¼š æµè§ˆå™¨è¾“å…¥åœ°å€åï¼Œè‡ªä¸Šè€Œä¸‹åŒ¹é…ï¼Œåªè¦åŒ¹é…åˆ°å°±è·³å‡ºã€‚æ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±é‡å®šä½åˆ°homeå»ã€‚

```

åŠ åŠŸèƒ½2ï¼š

å½“è¿›å…¥/ æ ¹è·¯ç”±ï¼Œå°±è¿›å…¥homeå»ï¼Œ å¦‚æœæ˜¯ /abc  ç­‰ä¹±è¾“å…¥çš„è·¯å¾„ï¼Œå°±è·³å…¥åˆ°NotFound æœªæ‰¾åˆ°é¡µé¢ã€‚

```react
<HashRouter>
    <Switch>
        <Route path="/films" component={Films}/>
        <Route path="/cinemas" component={Cinemas}/>
        <Route path="/center" component={Center}/>
        
        <Redirect from="/" to="/home" exact/>    
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
Redirecté‡å®šå‘æ ‡ç­¾ï¼ŒåŠ exactç²¾å‡†å±æ€§ï¼Œåªæœ‰/ï¼Œæ‰è¿›å…¥home,å…¶ä»–æƒ…å†µï¼Œä¸‡èƒ½åŒ¹é…ï¼Œè¿›å…¥NotFoundé¡µé¢ã€‚
```



è§£æï¼š

exact ç²¾ç¡®åŒ¹é… (Redirect å³ä½¿ä½¿ç”¨äº†exact, å¤–é¢è¿˜è¦åµŒå¥—Switch æ¥ç”¨)ï¼›

Warning: Hash history cannot
PUSH the same path; a new entry will not be added to the history
stack,è¿™ä¸ªè­¦å‘Šåªæœ‰åœ¨hash æ¨¡å¼ä¼šå‡ºç°ã€‚

#### (3)åµŒå¥—è·¯ç”±

é¡µé¢æ•ˆæœï¼š

çˆ¶é¡µé¢ä¸­æ˜¾ç¤ºè½®æ’­å›¾å’Œä¸¤ä¸ªæŒ‰é’®  åˆ†åˆ«æ˜¾ç¤ºä¸åŒçš„å­é¡µé¢ã€‚

ä»£ç é…ç½®ï¼š

router.js  æ ¹è·¯ç”±

```
<HashRouter>
    <Switch>
        <Route path="/films" component={Films}/>   //ä¸è¦åŠ  exact å¦åˆ™å­é¡µé¢ä¸æ˜¾ç¤º
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

filmsç»„ä»¶

```
import React, { Component } from 'react'
import Nowplaying from './films/Nowplaying'
import Comingsoon from './films/Comingsoon'
import {Redirect, Route, Switch} from 'react-router-dom'
export default class Films extends Component {
    render() {
        return (
            <div>
                <div style={{height:"200px",background:"yellow"}}>å¤§è½®æ’­</div>

                <div>å¯¼èˆªæ   æŒ‰é’®1  æŒ‰é’®2</div>

                {/* è·¯ç”±é…ç½® åµŒå¥—è·¯ç”± */}
                <Switch>
                    <Route path="/films/nowplaying" component={Nowplaying}/>
                    <Route path="/films/comingsoon" component={Comingsoon}/>
                    <Redirect from="/films" to="/films/nowplaying"/> 
                </Switch>

            </div>
        )
    }
}

```

#### (4)è·¯ç”±è·³è½¬æ–¹å¼

æŒ‰ç…§æ˜¯å¦ä»¥æ ‡ç­¾ä¾‹å¦‚<a href='#/films'/>,è¿˜æ˜¯jsè·³è½¬é¡µé¢ï¼Œåˆ†ç±»å¦‚ä¸‹ï¼š

##### a.   å£°æ˜å¼å¯¼èˆª

activeClassName å½“å‰æ˜¾ç¤ºé¡µé¢ï¼Œè‡ªåŠ¨åŠ classã€‚é…åˆcss å¯ä»¥é«˜äº®æ˜¾ç¤ºtabã€‚

```
<NavLink to="/films" activeClassName="active">films</NavLink>   //react æµè§ˆå™¨ä¸­ä¼šç¼–è¯‘æˆaæ ‡ç­¾
<NavLink to="/cinemas" activeClassName="active">cinemas</NavLink>
<NavLink to="/center" activeClassName="active">center</NavLink>
```

##### b   ç¼–ç¨‹å¼å¯¼èˆª

æ¡ˆä¾‹

###### router.js  æ ¹è·¯ç”±

```
<HashRouter>
    <Switch>
        <Route path="/films" component={Films}/>   
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

###### filmsç»„ä»¶

```
import React, { Component } from 'react'
import Nowplaying from './films/Nowplaying'
import Comingsoon from './films/Comingsoon'
import {Redirect, Route, Switch} from 'react-router-dom'
export default class Films extends Component {
    render() {
        return (
            <div>
                <div style={{height:"200px",background:"yellow"}}>å¤§è½®æ’­</div>

                <div>å¯¼èˆªæ </div>

                {/* è·¯ç”±é…ç½® åµŒå¥—è·¯ç”± */}
            {/* <Nowplaying/> */}
                <Switch>
                    <Route path="/films/nowplaying" component={Nowplaying}/>
                    <Route path="/films/comingsoon" component={Comingsoon}/>
                    <Redirect from="/films" to="/films/nowplaying"/> 
                </Switch>

            </div>
        )
    }
}
```



###### Nowplayingç»„ä»¶

å½“é¡¹ç›®å¼•å…¥è·¯ç”±ç®¡ç†ï¼Œç»„ä»¶éƒ½ä¼ å…¥routerï¼Œè¿™æ—¶å€™ç»„ä»¶éƒ½æˆä¸ºrouterçš„å­©å­ï¼Œä¸ç®¡æ˜¯ä¸€çº§è·¯ç”±ï¼Œè¿˜æ˜¯é¡µé¢ä¸­åµŒå…¥çš„äºŒçº§è·¯ç”±ï¼Œç»„ä»¶éƒ½å¯ä»¥æ¥å—åˆ°ä¸€ä¸ªpropså‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯è·¯ç”±å¯¹è±¡ã€‚

```javascript
å¯¹è±¡ä¸­åŒ…å«äº†å’Œè·¯ç”±ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•ã€‚
{
  history,(æœ‰è·¯ç”±ç›¸å…³æ–¹æ³•ï¼š push go goBack goForward replace locationç­‰)
  location  
  match  
}
```

propså‚æ•°  æ ¹æ®æ¥æºåˆ†ä¸ºä¸¤ç§ï¼š

ç¬¬ä¸€ç§ï¼šå½¢å‚ä¼ å…¥  æœ‰ä»¥ä¸Šä¸‰ä¸ªå¯¹è±¡

ç¬¬äºŒç§ï¼šä½¿ç”¨routerå¯¹è±¡

```
import { useHistory } from 'react-router-dom'
 const history  = useHistory()
 conosole.log(history)
 è¿™ä¸ªé‡Œé¢åªæœ‰ historyä¸€ä¸ªï¼› èŒƒå›´å°ä¸€äº›ã€‚
```

Nowplayingç»„ä»¶

```
import React,{useState} from 'react'
import { useHistory } from 'react-router-dom'

export default function Nowplaying( props ) {
    const [list, setlist] = useState(["aa","bb","cc"])
    
      const history  = useHistory()
        
    const handleChangePage = (id)=>{
        // console.log("click")
        //  1.åŸç”Ÿjsè·³è½¬
        // window.location.href="#/detail/"+id

        2.ä½¿ç”¨å…¥å‚çš„props
        // props.history.push(`/detail/${id}`)   //å‡½æ•°å¼å†™æ³•ï¼ˆï¼‰
        // this.props.history.push(`/detail/${id}`) // ç±»ç»„ä»¶å¼å†™æ³•
        
  ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ useHistory æ–¹æ³•æ¥è‡ª routeræ’ä»¶æä¾›
        //1 -åŠ¨æ€è·¯ç”±ä¼ å‚
        // history.push(`/detail/${id}`)
    
        // 2- queryä¼ å‚
        // history.push({ pathname : '/detail' ,query : { myid: id} })

        // 3- stateä¼ å‚
        // history.push({pathname:"/detail",state:{myid:id}})
    }

    return (
        <div>
            {
                list.map(item=> <li onClick={()=>handleChangePage(item)}>{item}</li>)
            }
        </div>
    )
}
```

#### (5) è·¯ç”±ä¼ å‚

##### å£°æ˜å¼ä¼ å‚

ç‰¹å¾å’Œä¼˜ç¼ºç‚¹ï¼š

 å‚æ•°ä¿å­˜ä½ç½®ï¼Œ urlè·¯å¾„ä¸­ã€‚    å½“é¡µé¢åˆ·æ–°ï¼Œå‚æ•°ä¸ä¼šä¸¢å¤±ã€‚

router.js  æ ¹è·¯ç”±

```
<HashRouter>
    <Switch>
        {/* /detail/1111  åŠ¨æ€è·¯ç”± */}
         <Route path="/detail/:myid" component={Detail} /> 
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

###### Nowplayingç»„ä»¶   

åˆ—è¡¨ç»„ä»¶  å…¥å‚

```
å¦‚ä¸Šä»£ç å¿«
...
 2.ä½¿ç”¨å…¥å‚çš„props
 // props.history.push(`/detail/${id}`)   //å‡½æ•°å¼å†™æ³•ï¼ˆï¼‰
...
```

detail è¯¦æƒ…ç»„ä»¶ æ¥å‚

å½“å‰è·¯å¾„   http://localhost:3000/#/detail/bb

```
import React from 'react'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")  //bbä¸ºå‚æ•°å€¼  myidä¸ºå½¢å‚
    return (
        <div>
            deteail
        </div>
    )
}
```

##### ç¼–ç¨‹å¼ä¼ å‚    

ç‰¹å¾å’Œä¼˜ç¼ºç‚¹ï¼š

 å‚æ•°ä¿å­˜ä½ç½®ï¼Œ ç¼“å­˜ä¸­ã€‚    å½“é¡µé¢åˆ·æ–°ï¼Œå‚æ•°ä¼šä¸¢å¤±ã€‚

router.js  

æ ¹è·¯ç”±path="/detail" è¿™ç§ä¼ å‚å°±ä¸è¦åŠ å½¢å‚  ï¼šmyidäº†ã€‚

```
<HashRouter>
    <Switch>
         <Route path="/detail" component={Detail} /> 
        <Route path="*" component={NotFound}/>
    </Switch>
</HashRouter>
```

###### 

```
(1)
   å…¥å‚
this.props.history.push({ pathname : '/user' ,query : { day: 'Friday'} }) 
   æ¥å—å‚æ•°
this.props.location.query.day
(2)
    å…¥å‚
this.props.history.push({ pathname:'/user',state:{day : 'Friday' } }) 
  æ¥å—å‚æ•°
this.props.location.state.day
ä»£ç å‚è€ƒï¼ˆ4ï¼‰è·¯ç”±è·³è½¬æ–¹å¼å°ç»“ã€‚
  æµ‹è¯•å‘ç°this.props.history.pushä¼ å…¥çš„å¯¹è±¡ï¼Œ pathnameæ˜¯å¿…é¡»æŒ‰ç…§æ ¼å¼ï¼Œåé¢query stateæˆ–æ˜¯å…¶ä»–å±æ€§ï¼Œéƒ½å¯ä»¥ï¼Œåªè¦åœ¨æ¥å—å‚æ•°å¤„ï¼Œä¸€ä¸€å¯¹åº”å³å¯ã€‚
```

### 4. è·¯ç”±æ‹¦æˆªï¼ˆè·¯ç”±å®ˆå«ï¼‰

react å¹¶æ²¡æœ‰åƒvue router.beforeEachè·¯ç”±å‰ï¼Œè·¯ç”±åç­‰api; æ‰€ä»¥è¿™é‡Œåªæ˜¯ç”¨åŸç”Ÿå‡½æ•°æ–¹æ³•ã€‚

router.js

```
é‰´æƒä»£ç  
function isAuth(){
    return localStorage.getItem("token")
}



<Router>
      <Switch>
          <Route path="/films" component={Films}  />
      <Route path="/center" render={(props)=>{
        return isAuth()?<Center myname="tom"/>:<Redirect to="/login"/>
      }/>                 
```

### 5 è·¯ç”±æ¨¡å¼

##### hashæ¨¡å¼

åƒè¿™ç§å¸¦#å·çš„ï¼Œå«é”šç‚¹ï¼Œè¿™é‡Œç§°hashæ¨¡å¼ã€‚ä¸å‘èµ·è¯·æ±‚ã€‚

å¦‚æœä¸æƒ³çœ‹åˆ°è¿™æ ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¤ä¸€ç§æ¨¡å¼ã€‚

```
http://localhost:3000/#/login

import React, { Component } from 'react'
import { HashRouter as Router,Redirect,Route,Switch} from 'react-router-dom'

export default class IndexRouter extends Component {
    render() {
        return (
            <Router>   æ¨¡å¼æ ‡ç­¾
                <Switch>
                    <Route path="/films" component={Films}  />
```

##### historyæ¨¡å¼

http://localhost:3000/login     åƒä¸€ä¸ªçœŸæ­£çš„è·¯å¾„ã€‚

BrowserRouter æ²¡æœ‰#çš„è·¯å¾„ï¼Œå¥½çœ‹ ï¼ŒçœŸæ­£æœåç«¯å‘è¯·æ±‚è¦é¡µé¢ï¼Œåç«¯æ²¡æœ‰å¯¹åº”çš„è·¯å¾„å¤„ç†è·¯å¾„ï¼Œ å°±ä¼š404ï¼Œ ä¸å¥½çœ‹ã€‚æ‰€ä»¥åå°è¦åšå¤„ç†ï¼Œå› ä¸ºé¡¹ç›®æ˜¯å•é¡µé¢ï¼Œåå°å¹¶æ²¡æœ‰å¯¹åº”èµ„æºï¼Œåªéœ€è¦è¿”å›index.htmlï¼Œå‰å°é‡æ–°æ¸²æŸ“ã€‚

```
import React, { Component } from 'react'
import { BrowserRouter as Router,Redirect,Route,Switch} from 'react-router-dom'
...
 <Router>   æ¨¡å¼æ ‡ç­¾
 æˆ–è€…
 import { BrowserRouter,Redirect,Route,Switch} from 'react-router-dom'
...
 <BrowserRouter>  </BrowserRouter>  æ¨¡å¼æ ‡ç­¾

```

BrowserRouter as Router æ„ä¸ºï¼š BrowserRouter è§£æ„å‡ºæ¥ï¼Œèµ·äº†ä¸€ä¸ªåˆ«åå«Routerã€‚ è¿™æ ·åé¢ä»£ç å°±ä¸ç”¨æ”¹äº†ã€‚æ›´åŠ ä¾¿æ·ã€‚

### 6 ç»„ä»¶ä¸¢çˆ¹historyå’Œå¹²çˆ¹æ”¯æ´ï¼ˆé«˜é˜¶ç»„ä»¶withRouterï¼‰

#### ç¬¬ä¸€ç§æƒ…å†µï¼šrouter ä¼ é€’é¡µé¢ç»„ä»¶ 

##### 

é¦–å…ˆç¡®å®šï¼Œçˆ¶ç»„ä»¶ä¼ å‚ï¼Œå­ç»„ä»¶propsæ¥å—å‚æ•°ã€‚

router.js

```
 <BrowserRouter>
                <Switch>
                    <Route path="/films" component={Films}  />
                    
                     <Route path="/center" render={()=>{
                        return isAuth()?<Center myname="tom"/>:<Redirect to="/login"/>
                    }}/>          
```

å‰é¢è·¯ç”±å®ˆå«æ—¶ï¼Œcenterç»„ä»¶åšäº†å¤„ç†ï¼Œå½“æˆ‘ä»¬åœ¨centerç»„ä»¶ä¸­ï¼Œä½¿ç”¨historyæ–¹æ³•æ—¶ï¼Œé¡µé¢æç¤ºæœªæ‰¾åˆ°æ–¹æ³•ã€‚

centerç»„ä»¶ 

```
export default function Center(props) {
    return (
        <div>
            center

            <div onClick={()=>{
                props.history.push(`/filmsorder`)

                // console.log(props)
            }}>ç”µå½±è®¢å•</div>
        </div>
    )
}
```

å‰é¢æˆ‘ä»¬æåˆ°ï¼Œä½¿ç”¨è·¯ç”±æ—¶ï¼Œè¢«è·¯ç”±æ ‡ç­¾   <Router>   </Router> åŒ…è£¹çš„é¡µé¢ç»„ä»¶ï¼Œéƒ½æ˜¯å­ç»„ä»¶ï¼Œè‡ªç„¶å¯ä»¥æ¥å—propså‚æ•°ï¼ŒåŒ…å«historyç­‰ã€‚

æŸ¥çœ‹routeæ ¸å¿ƒæ–¹æ³•

```
// class Route extends Component{
//     ...

//     render(){
//         var MyComponent = this.props.component
//     return <div>
//             <MyComponent history={} match={}.../>
//         </div>
//     }
// }
```

routeä»¥å˜é‡å½¢å¼ï¼Œæ¥å—ç»„ä»¶ï¼Œä¼ å…¥å‚æ•°ï¼Œå†renderå‡ºå»ã€‚è€Œcenterè¿™æ¡è·¯ç”±ï¼Œç›´æ¥ä½¿ç”¨renderï¼Œå¹¶æ²¡æœ‰ä¼ å‚ï¼Œæµ‹è¯•ä¼ é€’ä¸€ä¸ªè‡ªå®šä¹‰å‚æ•°myname, centerç»„ä»¶ä¸­ï¼Œæ‰“å°propsï¼Œæœç„¶çœ‹åˆ°å‚æ•°tom,è¯å®ç¡®å®æ˜¯routeç»™å‡ºçš„ä¸œè¥¿ï¼Œæ²¡æœ‰ä¼ é€’ä¸‹å»ï¼Œå¯¼è‡´å­ç»„ä»¶historyæ–¹æ³•ç¼ºå¤±ã€‚

```
<Route path="/center" render={()=>{
                        return isAuth()?<Center myname="tom"/>:<Redirect to="/login"/>
                    }}/> 
```

æ”¹è¿›, è§£æ„ï¼Œä¼ å‚ä¸‹å»

```
    <Route path="/center" render={(props)=>{
                        console.log(props,'æ‰§è¡Œäº†')
                        return isAuth()?<Center myname="kerwin" {...props}/>:<Redirect to="/login"/>
                    }}/>
```

#### ç¬¬äºŒç§æƒ…å†µ ç»„ä»¶ä¼ é€’ç»„ä»¶

ä»£ç ä¸­ï¼ŒFilmItemå°ç»„ä»¶ï¼Œ props.history.pushæç¤ºæœªæ‰¾åˆ°ï¼Œæƒ…å†µå’Œç¬¬ä¸€ç§ç›¸ä¼¼ï¼Œéƒ½æ˜¯å‚æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä¸­æ–­ã€‚

```
import React,{useState} from 'react'
export default function Nowplaying(props) {       <----------1è¿™ä¸ªpropså‚æ•°
    const [list, setlist] = useState([1,2,3,4])

    return (
        <div>
            {
                list.map(item=>
                 <FilmItem key={item.filmId} {...item} 	/>     <----------2è¿™é‡Œ {...props}
                )
            }
        </div>
    )
}

function FilmItem(props){
    // console.log(props)  // æ‰“å°æ²¡æœ‰ props.history
    let {name,filmId} = props
    return <li onClick={()=>{
        props.history.push(`/detail/${filmId}`)
    }}>
        {name}
    </li>    
}
```

#### å¹²çˆ¹æ”¯æ´

çˆ¶ç»„ä»¶  ---> å­ç»„ä»¶ ---> å­™ç»„ä»¶ï¼Œ æœ‰ç‚¹éº»çƒ¦ï¼Œæ˜¯å¦æœ‰å…¶ä»–ä¾¿æ·apiï¼Ÿ

routeræä¾›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä½œç”¨æ˜¯ä¸ºæ²¡æœ‰è·¯ç”±å±æ€§å’Œæ–¹æ³•çš„æ™®é€šç»„ä»¶ï¼Œå¢ç›Šæ–¹æ³•ã€‚

```
import {withRouter} from 'react-router-dom'
```

ä½¿ç”¨æ–¹æ³•ï¼š

```
import React,{useState} from 'react'
import {useHistory,withRouter} from 'react-router-dom'

export default function Nowplaying(props) {
    const [list, setlist] = useState([1,2,3,4])

    return (
        <div>
            {
                list.map(item=>
                 <WithFilmItem key={item.filmId} {...item} />
                )
            }
        </div>
    )
}

             è¿™æ˜¯ä¸€ä¸ªæ™®é€šå­™ç»„ä»¶           
function FilmItem(props){
    // console.log(props)
    let {name,filmId} = props
    return <li onClick={()=>{
        props.history.push(`/detail/${filmId}`)
    }}>
        {name}
    </li>    
}


const WithFilmItem = withRouter(FilmItem)  <----- withRouteræ–¹æ³•ï¼ŒåŒ…è£¹æ™®é€šç»„ä»¶ï¼Œåå‡ºæ¥å¢ç›Šç»„ä»¶ã€‚è¿™æ ·ï¼ŒFilmItemä¸­çš„onClické‡Œé¢ï¼Œå°±å¯ä»¥ä½¿ç”¨ props.history.pushäº†ã€‚
```

#### withRouter   çš„åº”ç”¨ä¸åŸç†

You can get access to the history object's properties and the closest <Route>'smatch via the withRouter higher-order component.wi thRouter will pass updatedmatch, location, and history props to the wrapped component whenever itrenders.

```
åªè¦è¢«withRouteråŠ å·¥åï¼Œå°±å¯ä»¥è·å–åˆ°historyç›¸å…³ã€‚
 import { withRouter } from "react-router"; 
 withRouter(MyComponent); 
 withRouter(connect(...)(MyComponent))

```





## åä¸€  Fluxä¸Redux

### Fluxä»‹ç»

æ˜¯ä¸€ç§æ¶æ„æ€æƒ³ï¼Œä¸“é—¨è§£å†³è½¯ä»¶çš„ç»“æ„é—®é¢˜ã€‚å®ƒè·ŸMVCæ¶æ„æ˜¯åŒä¸€ç±»ä¸œè¥¿ï¼Œä½†æ˜¯æ›´åŠ ç®€å•å’Œæ¸…æ™°ã€‚Fluxå­˜åœ¨å¤šç§å®ç°(è‡³å°‘15ç§

[https://github.com/voronianski/ï¬‚ux-comparison](https://github.com/voronianski/flux-comparison)

Facebook Fluxæ˜¯ç”¨æ¥æ„å»ºå®¢æˆ·ç«¯Webåº”ç”¨çš„åº”ç”¨æ¶æ„ã€‚å®ƒåˆ©ç”¨**å•å‘æ•°æ®æµ**çš„æ–¹å¼æ¥ç»„åˆReactä¸­çš„è§†å›¾ç»„ä»¶ã€‚å®ƒæ›´åƒä¸€ä¸ªæ¨¡å¼è€Œä¸æ˜¯ä¸€ä¸ªæ­£å¼çš„æ¡†æ¶ï¼Œå¼€å‘è€…ä¸éœ€è¦å¤ªå¤šçš„æ–°ä»£ç å°±å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹Flux.

![å›¾](.\img\redux.jpg)

### Reduxä»‹ç»

Reduxæœ€ä¸»è¦æ˜¯ç”¨ä½œåº”ç”¨çŠ¶æ€çš„ç®¡ç†ã€‚ç®€è¨€ä¹‹ï¼ŒReduxç”¨ä¸€ä¸ªå•ç‹¬çš„å¸¸é‡çŠ¶æ€æ ‘ï¼ˆstateå¯¹è±¡ï¼‰ä¿å­˜è¿™ä¸€æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼Œè¿™ä¸ªå¯¹è±¡ä¸èƒ½ç›´æ¥è¢«æ”¹å˜ã€‚å½“ä¸€äº›æ•°æ®å˜åŒ–äº†ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºï¼ˆä½¿ç”¨actionså’Œreducersï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œæ•°æ®è¿½è¸ªï¼Œå®ç°æ—¶å…‰æ—…è¡Œã€‚

#### 1  reduxä»‹ç»åŠè®¾è®¡å’Œä½¿ç”¨çš„ä¸‰å¤§åŸåˆ™

åŸå› ï¼š[Redux](https://so.csdn.net/so/search?q=Redux&spm=1001.2101.3001.7020)åº”ç”¨éœ€è¦éµå¾ªä¸‰å¤§åŸåˆ™ï¼Œå¦åˆ™ç¨‹åºå¾ˆå®¹æ˜“å‡ºç°éš¾ä»¥å¯Ÿè§‰çš„é—®é¢˜ã€‚

1  state ä»¥å•ä¸€å¯¹è±¡å­˜å‚¨åœ¨ store å¯¹è±¡ä¸­
2  state åªè¯»(æ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡)

3  ä½¿ç”¨çº¯å‡½æ•° reducer æ‰§è¡Œ state æ›´æ–°

ç»†åŒ–è§£é‡Šï¼š

â‘ å”¯ä¸€æ•°æ®æº

ã€€ã€€Reduxåªç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€å¯¹è±¡ï¼Œå­˜å‚¨åœ¨Reduxçš„storeä¸­ã€‚å”¯ä¸€æ•°æ®æºæ˜¯ä¸€ç§é›†ä¸­å¼ç®¡ç†åº”ç”¨çŠ¶æ€çš„æ–¹   

â€‹       å¼ï¼Œä¾¿äºç›‘æ§ä»»æ„æ—¶åˆ»åº”ç”¨çš„çŠ¶æ€å’Œè°ƒè¯•åº”ç”¨ï¼Œå‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚

â‘¡ä¿æŒåº”ç”¨çŠ¶æ€åªè¯»

ã€€ã€€åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹åº”ç”¨çŠ¶æ€ã€‚å½“éœ€è¦ä¿®æ”¹åº”ç”¨çŠ¶æ€æ—¶ï¼Œå¿…é¡»å‘é€ä¸€ä¸ªactionï¼Œç”±è¿™ä¸ªactionæè¿°å¦‚ä½•   

â€‹       ä¿®æ”¹åº”ç”¨çŠ¶æ€ã€‚

â‘¢åº”ç”¨çŠ¶æ€çš„æ”¹å˜é€šè¿‡çº¯å‡½æ•°å®Œæˆ

ã€€ã€€actionè¡¨æ˜ä¿®æ”¹åº”ç”¨çŠ¶æ€çš„æ„å›¾ï¼ŒçœŸæ­£å¯¹åº”ç”¨çŠ¶æ€åšä¿®æ”¹çš„æ˜¯reducerã€‚reducerå¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥reducer 

â€‹       åœ¨æ¥æ”¶åˆ°actionæ—¶ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹åŸæ¥çš„çŠ¶æ€å¯¹è±¡ï¼Œè€Œæ˜¯è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡è¿”å›ã€‚

çº¯å‡½æ•°æŒ‡çš„æ˜¯ï¼š

â€‹    å¯¹äºåŒæ ·çš„å‚æ•°å€¼ï¼Œå‡½æ•°çš„è¿”å›ç»“æœæ€»æ˜¯ç›¸åŒçš„ã€‚å‡½æ•°çš„æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¾‹å¦‚ä¿®æ”¹å¤–éƒ¨å¯¹è±¡æˆ–è¾“å‡ºåˆ°I/O

 è®¾å¤‡ã€‚

ä¸»è¦ç»„æˆaction
ã€€ã€€actionæ˜¯Reduxä¸­ä¿¡æ¯çš„è½½ä½“ï¼Œæ˜¯storeå”¯ä¸€çš„ä¿¡æ¯æ¥æºã€‚æŠŠactionå‘é€ç»™storeå¿…é¡»é€šè¿‡storeçš„dispatchæ–¹æ³•ã€‚actionæ˜¯æ™®é€šçš„JavaScriptå¯¹è±¡ï¼Œä½†æ¯ä¸€ä¸ªactionå¿…é¡»æœ‰ä¸€ä¸ªtypeå±æ€§æè¿°actionçš„ç±»å‹ï¼Œtypeä¸€èˆ¬ä¸ºå­—ç¬¦ä¸²å¸¸é‡ã€‚é™¤äº†typeå±æ€§å¤–ï¼Œactionçš„ç»“æ„å®Œå…¨ç”±è‡ªå·±å†³å®šã€‚ä¸€èˆ¬é€šè¿‡action creatoråˆ›å»ºactionï¼Œaction creatoræ˜¯è¿”å›actionçš„å‡½æ•°

ç›¸å…³æ–‡æ¡£å‚çœ‹ï¼šhttps://blog.csdn.net/sxww_zyt/article/details/129253498



#### 2. redux å·¥ä½œæµ

æ‘˜è‡ªå®˜ç½‘

![ç¤ºä¾‹](https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif)



![img](.\img\redux2.jpg)



#### 3. reactç»‘å®šåä½¿ç”¨reduxå®ç°æ¡ˆä¾‹

##### npm å¼•å…¥

 å®˜ç½‘ https://cn.redux.js.org/introduction/getting-started/

```
# NPM
npm install redux
```

##### æ¡ˆä¾‹æ¼”ç¤º

ï¼šåˆ—è¡¨é¡µä¸­æ˜¾ç¤ºåœ°å›¾tabbarï¼Œè¿›å…¥è¯¦æƒ…é¡µæ—¶éšè—ã€‚

npmåˆå§‹åŒ–åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»ºreduxæ–‡ä»¶å¤¹å­ï¼Œè¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ–°å»ºstore.jsæ–‡ä»¶ã€‚

###### store.js

```
 //1. å¼•å…¥redux, 
 //2. createStore( reducer )
 import {createStore} from 'redux'

 const reducer = (prevState={ show:true,},action)=>{
    console.log(prevState,action)
    let newState = {...prevState}
    switch(action.type){
       case "0":
         newState.show = false
         return newState     ï¼ˆreturn çš„stateï¼Œå°±å˜æˆæœ€æ–°çš„stateï¼Œappé¡µé¢å¯ä»¥è·å–æœ€æ–°çš„å€¼ï¼‰
       case "1":
         newState.show = true
         return newState
       default:
          return prevState
    }
 }
 const store = createStore(reducer);

 export default store
```



###### App.jsç»„ä»¶   

é¡¹ç›®è¿è¡Œï¼Œå³æ‰§è¡Œ store.subscribe è®¢é˜…ã€‚

åªè¦é‚£ä¸ªé¡µé¢è°ƒç”¨ dispatchï¼Œstore.subscribeå°±ä¼šè¢«è§¦å‘ï¼Œ æ‹¿åˆ°å·²ç»ä¿®æ”¹åçš„æ•°æ®ï¼Œåšè‡ªå·±çš„é€»è¾‘ã€‚

æœ¬é¡µé¢æƒ…å†µæ˜¯ï¼š   

åˆå§‹åŠ è½½Aé¡µé¢ï¼ˆè®¢é˜…è€…ï¼‰ï¼Œè·³è½¬Bé¡µé¢ï¼ˆè§¦å‘è€…ï¼‰ï¼Œå†å›Aé¡µé¢ã€‚  -----ã€‹éœ€è¦store.subscribeè®¢é˜…ã€‚

  ä½†æœ‰ä¸€ç§æƒ…å†µï¼Œ

å°±æ˜¯Aé¡µé¢ï¼Œè·³è½¬Bé¡µé¢ï¼ˆè§¦å‘è€…ï¼‰ï¼Œç„¶åè·³å¾€Cé¡µé¢ï¼Œä¸éœ€è¦è®¢é˜…ï¼Œç›´æ¥æ‹¿å€¼å³å¯ã€‚store.getState()

```
import React, { Component } from 'react'
import MRouter from './router/IndexRouter'
import Tabbar from './components/Tabbar'
import './views/css/App.css'
               import store from './redux/store'
export default class App extends Component {
    state = {
        isShow:store.getState()
    }

    componentDidMount() {
        store.subscribe(()=>{// store.subsribe è®¢é˜…
            console.log("app ä¸­è®¢é˜…",store.getState())

            this.setState({
                isShow:store.getState().show
            })
        })
    }
    
    render() {
        return (
           <div>
                {/* å…¶ä»–çš„å†…å®¹ */}
                <MRouter>
                    {this.state.isShow && <Tabbar></Tabbar>}
                </MRouter>
           </div>
        )
    }
}

```

###### detail.jsç»„ä»¶ 

è¯¦æƒ…ç»„ä»¶

```
import React,{useEffect} from 'react'
import store from '../redux/store'

export default function Detail(props) {
    console.log(props.match.params,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")
    // console.log(props.location.query.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")
    // console.log(props.location.state.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
        // console.log("create") æ¸²æŸ“å®Œæˆè°ƒç”¨
        
        //store.dispatch  é€šçŸ¥
        store.dispatch( {type:"0" } )
        return () => {
            // console.log("destroy") é¡µé¢é”€æ¯æ—¶è°ƒç”¨
            
            store.dispatch( {type:"1" } )
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}

```

##### æ¡ˆä¾‹æ¼”ç¤ºé€»è¾‘è§£æ

ä¸Šé¢æ¡ˆä¾‹å®ç°ï¼Œæ ¸å¿ƒæ–¹æ³•

```
/*
store.subscrbe   appé¡µé¢è¿›å…¥ç›‘å¬

store.dispatch   å…¶ä»–é¡µé¢è°ƒç”¨

store.getState  appé¡µé¢è¢«è§¦å‘åï¼Œä½¿ç”¨è¯¥æ–¹æ³•è·å–æœ€æ–°stateå€¼

*/
```

diyä¸‰ä¸ªæ–¹æ³•

æ”¹å†™store.js

```
 //1. å¼•å…¥redux, 
 //2. createStore( reducer )
 import {createStore} from 'redux'

 const reducer = (prevState={ show:true},action )=>{
    console.log(action)
    let newState = {...prevState}
    switch(action.type){
       case "kerwinhide-tabbar":
         newState.show = false
         return newState
       case "kerwinshow-tabbar":
         newState.show = true
         return newState
       default:
          return prevState
    }
 }
 const store = createKerwinStore(reducer);// åˆå§‹åŒ–createStore,æ›´æ¢ä¸ºä¸‹é¢è‡ªå®šä¹‰æ–¹æ³•ã€‚

 export default store


/*
store.subscrbe   appé¡µé¢è¿›å…¥ç›‘å¬

store.dispatch   å…¶ä»–é¡µé¢è°ƒç”¨

store.getState  appé¡µé¢è¢«è§¦å‘åï¼Œä½¿ç”¨è¯¥æ–¹æ³•è·å–æœ€æ–°stateå€¼

*/
  function createKerwinStore(reducer){
     var list = []
     var state = reducer(undefined,{})
     
     function subscribe(callback){
        list.push(callback)
     }
  
     function dispatch(action){
        state = reducer(state,action)
        for(var i in  list){
           list[i] && list[i]()
        }
     }
  
     function getState(){
        return state
     }
     return {
        subscribe,
        dispatch,
        getState
     }
   }

```

å…¶ä»–é¡µé¢ä¸åŠ¨ï¼Œæµ‹è¯•å‘ç°åŠŸèƒ½æ­£å¸¸ã€‚

##### å¼•ç”³  ä»€ä¹ˆæ—¶çº¯å‡½æ•°

```
 /*
   var obj = {
     myname:"kerwin"
   }
   
   function test(obj){
     var newobj = {...obj}
     newobj.myname="xiaoming"
   
     return newobj
    }
    
    test(obj)  //myname:"xiaoming"
        obj //  myname: "kerwin" objæ²¡æœ‰æ”¹å˜ï¼ˆæ³¨æ„ï¼šè§£æ„æ˜¯æµ…å¤åˆ¶ï¼‰

    çº¯å‡½æ•°ï¼š 
      1. å¯¹å¤–ç•Œæ²¡æœ‰å‰¯ä½œç”¨ --- æŒ‡çš„æ˜¯ä¸ä¼šä¿®æ”¹å½±å“å‡½æ•°å¤–è¾¹çš„å˜é‡ã€‚è¿™é‡ŒæŒ‡ä¸èƒ½ä¿®æ”¹objå¯¹è±¡ã€‚
      2. åŒæ ·çš„è¾“å…¥å¾—åˆ°åŒæ ·çš„è¾“å‡º
 */
```

 æ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œreducers ä¹Ÿå¯ä»¥å½’ç±»äºçº¯å‡½æ•°ç±»ã€‚ å®ƒä¸ä¿®æ”¹stateï¼Œæ¯æ¬¡éƒ½æ˜¯è§£æ„åreturn , åŒæ ·çš„å…¥å‚ï¼Œè¾“å‡ºåŒæ ·çš„å‡ºå‚ã€‚ 

#### 4 reduceræ‰©å±• å¤šå‘½åç©ºé—´ç®¡ç†

å½“é¡¹ç›®è¾ƒå¤§ï¼Œå¤šäººå¼€å‘æ—¶ï¼Œä¸€ä¸ªretucersè‚¯å®šä¸è¡Œçš„ï¼Œæ¥ä¸‹æ¥å¼•å‡ºæ–°æ–¹æ³• - 

```
 combineReducers  from 'redux'
```

ç¤ºä¾‹å¦‚ä¸‹ï¼š

store.js

```
 //1. å¼•å…¥redux, 
 //2. createStore( reducer )
 import {combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 
 const reducer  = combineReducers({CityReducer,TabbarReducer })
 const store = createStore(reducer);
 export default store
```

å­ -- 01

```
const CityReducer = (prevState={
    cityName:"åŒ—äº¬"
   //  ...
 },action)=>{

    let newState = {...prevState}
    switch(action.type){
      
       case "change-city":
         newState.cityName = action.payload
         return newState

       default:
          return prevState
    }
 }

 export default  CityReducer
```

å­ -- 01

```
const TabbarReducer = (prevState={
    show:true
 },action)=>{
    let newState = {...prevState}
    switch(action.type){
       case "kerwinhide-tabbar":
         newState.show = false
         return newState
       case "kerwinshow-tabbar":
         newState.show = true
         return newState
       default:
          return prevState
    }
 }
 export default TabbarReducer
```

ä½¿ç”¨stateå€¼çš„æ—¶å€™ï¼Œä¹Ÿè¦åšç›¸åº”è°ƒæ•´ã€‚

```
æ‰“å°store.getState()å°±å˜æˆ
{
 CityReducer: {cityName: 'åŒ—äº¬'}
 TabbarReducer: {show: true}
}
```



```
    componentDidMount() {
        store.subscribe(()=>{  // store.subsribe è®¢é˜…
            console.log("app ä¸­è®¢é˜…",store.getState())   æ‰“å°çœ‹ä¸Šè¾¹

            this.setState({
                isShow:store.getState().TabbarReducer.show  // éœ€è¦å†é€’è¿›ä¸€å±‚
            })
        })
    }
```

æ€»ç»“ï¼š

å¦‚æœå¦‚æœä¸åŒçš„actionæ‰€å¤„ç†çš„å±æ€§ä¹‹é—´æ²¡æœ‰è”ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠReducer å‡½æ•°æ‹†åˆ†ã€‚ä¸åŒçš„å‡½æ•°è´Ÿè´£å¤„ç†ä¸åŒå±æ€§ï¼Œæœ€ç»ˆæŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå¤§çš„Reducer å³å¯

```
import {combineReducers} from "redux"; 

const reducer = combineReducers({
a: functionA, 
b: functionB, 
c: functionC
})

è®¿é—®ï¼š
(state)=>{ return {
        kerwinstate:state.a (ä¸åŒçš„å‘½åç©ºé—´)
    }
}
```



#### 5. redux ä¸­é—´ä»¶ 

##### ç¬¬ä¸€ç§  redux-thunk

###### 1. ä¸­é—´ä»¶çš„ä½œç”¨

åœ¨reduxé‡Œï¼Œactionä»…ä»…æ˜¯æºå¸¦äº†æ•°æ®çš„æ™®é€šjså¯¹è±¡ã€‚action creatorè¿”å›çš„å€¼æ˜¯è¿™ä¸ªactionç±»å‹çš„å¯¹è±¡ã€‚ç„¶åé€šè¿‡store.dispatch()è¿›è¡Œåˆ†å‘ã€‚åŒæ­¥çš„æƒ…å†µä¸‹ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œä½†æ˜¯reduceræ— æ³•å¤„ç†å¼‚æ­¥çš„æƒ…å†µã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨actionå’Œreducerä¸­é—´æ¶èµ·ä¸€åº§æ¡¥æ¢æ¥å¤„ç†å¼‚æ­¥ã€‚è¿™å°±æ˜¯middlewareã€‚

```
 
 store.dispatch(getCinemaListAction())
 
  dispatchçš„è¿”å›å‡½æ•°ä¸­ï¼Œä¸èƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œå°±å¦‚ä¸‹é¢testå‡½æ•°ï¼Œç«‹å³æ‰§è¡Œåï¼Œå¿…é¡»è¿”å›ä¸œè¥¿ã€‚
```



```
function test(){
    setTimeout(()=>{
        return 1000 
    },2000)

}

test() //undefined
```

è§£å†³è¿™ä¸ªæŠ¥é”™ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸­é—´ä»¶äº†





###### 2. ä¸­é—´ä»¶ redux-thunkçš„ä½¿ç”¨

```
npm i redux-thunk
```

æ”¹é€ store.jsæ–‡ä»¶

åŸæ¥

```
 import {combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 
 const reducer  = combineReducers({CityReducer,TabbarReducer })
 const store = createStore(reducer);
 export default store
```

ç°åœ¨

ä½¿ç”¨äº† 

applyMiddleware  from 'redux'     ï¼ˆreduxä¸­ï¼Œå·²ç»ç»™å‡ºäº†æ’ä»¶æ¥å£ï¼‰

import reduxThunk from 'redux-thunk'

createStoreæ—¶ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå‚æ•° applyMiddleware(reduxThunk)

```
 import {applyMiddleware, combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'
 
 const reducer  = combineReducers({
  CityReducer,
  TabbarReducer,
  CinemaListReducer
 })
 const store = createStore(reducer,applyMiddleware(reduxThunk));
 export default store
```

ä½¿ç”¨é¡µé¢

```
 dispatchä¸­å¯ä»¥åŒ…å«axiosï¼ˆurl:"xxx"ï¼‰ç­‰å¼‚æ­¥çš„æ“ä½œäº†
 store.dispatch(getCinemaListAction())
```

é¡¹ç›®æ¡ˆä¾‹1ï¼š

è¿›å…¥åˆ—è¡¨é¡µï¼Œæ£€æŸ¥storeä¸­æ˜¯å¦å·²ç»æœ‰æ•°æ®ï¼Œæ²¡æœ‰å°±åå°è¯·æ±‚ã€‚

store.jsé…ç½®å¥½ä¸­é—´ä»¶

```
 import {applyMiddleware,combineReducers, createStore} from 'redux' <----- å…³é”®ç‚¹
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'  <----- å…³é”®ç‚¹

 const reducer  = combineReducers({CityReducer,TabbarReducer ,CinemaListReducer})
 const store = createStore(reducer,applyMiddleware(reduxThunk));<----- å…³é”®ç‚¹
 export default store
```



åˆ—è¡¨é¡µ

```
import React,{useState,useEffect} from 'react'
import getCinemaListAction from '../redux/actionCreator/getCinemaListAction'
import store from '../redux/store'
export default function Cinemas(props) {

    const [cityName] = useState(store.getState().CityReducer.cityName)

    const [cinemaList,setCinemaList] = useState(store.getState().CinemaListReducer.list)


    useEffect(() => {
        // if(store.getState)
        // console.log()
        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(getCinemaListAction())
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
        store.subscribe(()=>{
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })

        // windw
    }, [])

    return (
        <div>
            <div onClick={()=>{
                props.history.push(`/city`)
            }}>{cityName}</div>
            {
                  cinemaList.map(item=>
                    <dl key={item.cinemaId} style={{padding:"10px"}}>
                        <dt>{item.name}</dt>
                        <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                    </dl>    
                )
            }
        </div>
    )
}

```

æ•°æ®è¯·æ±‚js

```
import axios from 'axios'
function getCinemaListAction(){

    return (dispatch)=>{
        axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                
                'X-Host': 'mall.film-ticket.cinema.list'
    
            }
        }).then(res=>{
            // console.log(res.data.data.cinemas)
            dispatch({
                type:"change-list",
                payload:res.data.data.cinemas
            })
        })   
    }    
}

export default getCinemaListAction

```

##### ç¬¬äºŒç§ Promiseæ–¹å¼

ä½¿ç”¨æ–¹å¼ï¼š

```
ä½œä¸ºä¸€æ¬¾æ’ä»¶å¼•å…¥
npm i redux-promise
```

store.jsä¸­ä½¿ç”¨

```
 import {applyMiddleware,combineReducers, createStore} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'

 import reduxPromise from 'redux-promise'//ä¸­é—´ä»¶promise <--------é‡ç‚¹
 

 const reducer  = combineReducers(
 {CityReducer,
 TabbarReducer ,
 CinemaListReducer
 })
 
 const store = createStore(
 reducer,
 applyMiddleware(reduxThunk,reduxPromise)); <--------é‡ç‚¹ ä¼ å…¥ç¬¬äºŒæ¬¾ä¸­é—´ä»¶
 
 export default store
```

è§¦å‘é¡µé¢

```
 useEffect(() => {
        // if(store.getState)
        // console.log()
        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(  getCinemaListAction()  )  <--------é‡ç‚¹ dispatchæ–¹æ³•
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
        var unsubscribe = store.subscribe(()=>{
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })
        return ()=>{
            //å–æ¶ˆè®¢é˜…ï¼Ÿ
            unsubscribe() 
        }
    }, [])
```

getCinemaListAction() å°è£…é¡µé¢

ä¸redux-thunkçš„åŒºåˆ«ï¼š

redux-thunk 

```
test(){
return ( dispatch )=>{   <--------é‡ç‚¹ return çš„æ˜¯ä¸€ä¸ªå‡½æ•°
    axios({}).then(res =>{
        dispatch({        <--------é‡ç‚¹ ä½¿ç”¨å…¥å‚æ–¹æ³•dispatchè¿”å›æ•°æ®
                type:"change-list",
                payload:res.data.data.cinemas
            })
    }) 
}

}
export default test
```

promiseç‰ˆæœ¬

```
test(){
 return   axios({}).then(res =>{ <--------é‡ç‚¹ return çš„æ˜¯ä¸€ä¸ªpromise( axioså°±æ˜¯promiseç±»çš„ )
    
       return  { type:"change-list",  <--------é‡ç‚¹ return å‡ºå»å‚æ•°
                payload:res.data.data.cinemas
              }
    }) 


}
export default test
```

åŸç†å°±æ˜¯ï¼š

store.dispatch( xx ï¼‰æ¥å—åˆ°çš„ä¸œè¥¿ï¼Œå®ƒä¼šåˆ¤æ–­ä¸€ä¸ªfunction  ï¼Œå°±ï¼ˆï¼‰æ‰§è¡Œï¼›è¿˜æ˜¯Promise  å°±thenå‡ºå»ã€‚





```
import axios from 'axios'
function getCinemaListAction(){

    // return (dispatch)=>{
        return axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                
                'X-Host': 'mall.film-ticket.cinema.list'
    
            }
        }).then(res=>{
            // console.log(res.data.data.cinemas)
            // dispatch({
            //     type:"change-list",
            //     payload:res.data.data.cinemas
            // })
           return {
                type:"change-list",
                payload:res.data.data.cinemas
            }
        })   
    // }    
}

export default getCinemaListAction
```









#### 6. å…³äºåå¤è®¢é˜…çš„é—®é¢˜

é¡µé¢åˆ—è¡¨ä¸­ï¼Œä½¿ç”¨äº† store.subscribeè®¢é˜…ï¼Œ ä½†æ˜¯å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åªè¦è¿”å›æ•°æ®ï¼Œ æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šè§¦å‘ï¼Œä¸ç®¡ä½ éœ€ä¸éœ€è¦ï¼Œå¹¶ä¸”å•ä¸ªé¡µé¢è¿˜ä¼šé‡å¤è®¢é˜…ã€‚åŸå› æ˜¯ï¼Œreduxæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç¼“å­˜ä¸­çš„é€»è¾‘ï¼Œæ¯æ¬¡è®¢é˜…éƒ½ä¼šå¾€äº‹ä»¶æ•°ç»„åˆ—ä¸­pushæ–°çš„å›è°ƒæ‰§è¡Œï¼Œç„¶åå½“æ•°æ®è¿”å›æ—¶ï¼ŒåˆæŠŠåˆ—è¡¨é‡Œçš„è®¢é˜…äº‹ä»¶ï¼Œæ‰§è¡Œäº†ä¸€éã€‚

```
import React,{useState,useEffect} from 'react'
import getCinemaListAction from '../redux/actionCreator/getCinemaListAction'
import store from '../redux/store'
export default function Cinemas(props) {

    const [cityName] = useState(store.getState().CityReducer.cityName)

    const [cinemaList,setCinemaList] = useState(store.getState().CinemaListReducer.list)


    useEffect(() => {

        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(getCinemaListAction())
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
        store.subscribe(()=>{
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })

    }, [])

    return (
        <div>
            <div onClick={()=>{
                props.history.push(`/city`)
            }}>{cityName}</div>
            {
                  cinemaList.map(item=>
                    <dl key={item.cinemaId} style={{padding:"10px"}}>
                        <dt>{item.name}</dt>
                        <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                    </dl>    
                )
            }
        </div>
    )
}
```

è§£å†³æ–¹æ³•ï¼š

store.subscribeåœ¨è®¢é˜…çš„æ—¶å€™ï¼Œè¿”å›äº†ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„å‡½æ•°ï¼Œåªè¦åœ¨é€‚å½“æ—¶æœºæ‰§è¡Œï¼Œå°±å¯ä»¥å–æ¶ˆè®¢é˜…ã€‚

```

    useEffect(() => {

        if(store.getState().CinemaListReducer.list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            store.dispatch(getCinemaListAction())
        }else{
            console.log("store ç¼“å­˜")
        }
        //è®¢é˜…
       var unsubscribe =  store.subscribe(()=>{ <----- é‡ç‚¹
            console.log("cinema ä¸­è®¢é˜…",store.getState().CinemaListReducer.list)
            setCinemaList(store.getState().CinemaListReducer.list)
        })
       return ()=>{
        //é¡µé¢é”€æ¯æ—¶æ‰§è¡Œ
        // å–æ¶ˆè®¢é˜…
        unsubscribe()  <----- é‡ç‚¹
       }
    }, [])
```





#### 7. æ’ä»¶ï¼ˆå¯è§†åŒ–reduxæ•°æ®ï¼‰

Redux DevToolsExtension ï¼›   ç±»ä¼¼ä¸vue  çš„  vuejsdevtoolsï¼›ä½œç”¨éƒ½æ˜¯å¼€å‘è¾…åŠ©ï¼Œæ–¹ä¾¿æŸ¥çœ‹æ•°æ®å˜åŒ–ã€‚

reduxæ’ä»¶ä¸‹è½½åœ°å€ï¼ˆ å¯ä»¥ä¸‹è½½chromeæµè§ˆå™¨ï¼‰ ä¸‹è½½æ‰©å±•zipåŒ…ï¼Œä¸‹è½½åï¼Œæ‹–åˆ°chromeæ‰©å±•ç¨‹åºå¤„ï¼Œå³è‡ªåŠ¨å®‰è£…ã€‚

https://github.com/zalmoxisus/redux-devtools-extension

ç„¶åï¼Œé¡¹ç›®ä¸­é…ç½®

store.jså‚æ•°é…ç½®

https://github.com/zalmoxisus/redux-devtools-extension#usage

```
import { 
createStore, 
compose    <----- é‡ç‚¹  è§£æ„å‡ºè¿™ä¸ªå‚æ•°
} from 'redux' import reducer from './reducer'

const composeEnhancers = window.  REDUX_DEVTOOLS_EXTENSION_COMPOSE	 || compose; const store = createStore(reducer, 
composeEnhancers( åŸæ¥çš„ä¸­é—´ä»¶ )      <----- é‡ç‚¹  åŒ…è£¹åŸæ¥çš„ä¸­é—´ä»¶
)

```

ç¤ºä¾‹ï¼š

```
 import {applyMiddleware,combineReducers, createStore, compose} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'

 import reduxPromise from 'redux-promise'

 const composeEnhancers = window.  REDUX_DEVTOOLS_EXTENSION_COMPOSE	 || compose;

 const reducer  = combineReducers({CityReducer,TabbarReducer ,CinemaListReducer})
 const store = createStore(reducer, composeEnhancers(applyMiddleware(reduxThunk,reduxPromise)));
 export default store

```

åˆ·æ–°é¡µé¢

![](.\img\å¾®ä¿¡æˆªå›¾_20231112165343.png)



## åäºŒ react-redux 

![img](.\img\clip_image002.jpg)

#### 1 .å£è¿°åŠŸèƒ½

ä½¿ç”¨æœ¬åº“çš„å‰æï¼Œè¦ä½¿ç”¨redux. 

ä¾èµ–ä¸redux,å¢åŠ äº†ä¸€ç‚¹reactç‰¹æ€§ã€‚

react-reduxå°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ŒæŠŠå±æ€§å’Œæ–¹æ³•æ³¨å…¥åˆ°äº†props.  

ç”¨å®ƒæ¥å‘å¸ƒï¼Œè®¢é˜…ï¼Œå–æ¶ˆè®¢é˜…ç­‰ç¹ççš„äº‹æƒ…ï¼Œæ›´åŠ æ³¨é‡ä¸šåŠ¡ã€‚ 

â€‹               æ•ˆæœï¼š            ä½é˜¶ç»„ä»¶--->   å¤„ç†åŒ…è£… ------> é«˜é˜¶ç»„ä»¶  å¢åŠ äº†å±æ€§å’Œæ–¹æ³•

**å®ç°æ–¹å¼ï¼š**

æ˜¯å¢åŠ äº†connectå‡½æ•°ç”Ÿæˆä¸€ä¸ªçˆ¶ç»„ä»¶ï¼Œçˆ¶ä¼ å­æ–¹å¼ï¼Œä¼ é€’å‚æ•°ã€‚

connectï¼ˆä¾›åº”å•†ç»„ä»¶ï¼‰ åŒ…è£¹<app/>æ ‡ç­¾ï¼Œç„¶åæ¯ä¸ªé¡µé¢ç»„ä»¶ä½¿ç”¨ï¼Œå°±æŠŠé‚£ä¸ªç»„ä»¶æ”¹é€ ä¸€ä¸‹ã€‚

#### 2.ä½¿ç”¨

```
npm i react-redux 
```

#### 3. æ¡ˆä¾‹æ¼”ç¤º

index.jsé¡µé¢

```
import React from 'react'
import ReactDOM from 'react-dom'
import App from './05-redux/App'

import {Provider} from 'react-redux'    <---- é‡ç‚¹
import {store} from './06-react-redux/redux/store' <---- é‡ç‚¹

ReactDOM.render(

    <Provider store={store}>  <---- é‡ç‚¹  åœ¨é¡¶çº§æ ‡ç­¾ï¼Œä¾›åº”å•†ç»„ä»¶åŒ…è£¹ï¼Œæ³¨å…¥storeä»“åº“
         <App/>
    </Provider>
    
  ,document.getElementById("root"))
```

##### ç¤ºä¾‹01 

appç»„ä»¶æ”¹é€ ç¤ºä¾‹01 

```
import React, { Component } from 'react'
import MRouter from './router/IndexRouter'
import Tabbar from './components/Tabbar'
import './views/css/App.css'

import { connect } from 'react-redux' <---- é‡ç‚¹  å¼•å…¥connectæ–¹æ³•

 class App extends Component {

    componentDidMount() {
        console.log(this.props)
    }

    render() {
        return (
           <div>
         
                <MRouter>
                  {this.props.isShow && <Tabbar></Tabbar>} <---- é‡ç‚¹ isShowçš„æ‹¿å‚å½¢å¼
               </MRouter>
              
           </div>
        )
    }
}

const mapStateToProps = (state)=>{
    // console.log(state)
    return {
        a:1,
        b:2,
        isShow:state.TabbarReducer.show
    }
}
const  callback = {
    a:()=>{

    },
    b:()=>{

    }
}
    
export default connect( mapStateToProps,callback )(App) <---- é‡ç‚¹ è§£é‡Šå¦‚ä¸‹
```

connectï¼ˆa,bï¼‰è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå†æŠŠAppå…¥å‚ã€‚è¿™æ ·æ˜¯ä¸ºäº†ä¾¿äºæˆ‘ä»¬è‡ªå®šä¹‰ä¼ å‚ã€‚ 

--å½¢å‚a      å°†æ¥ç»™å­©å­ä¼ çš„å±æ€§

æ˜¯ä¸€ä¸ªå‡½æ•° return ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œé¢å¯ä»¥æ‹¿åˆ°é¡¶çº§ä¼ å…¥çš„storeå‚æ•°ï¼Œé€‰å–æœ¬é¡µé¢ä¼šä½¿ç”¨é“åˆ°çš„ isshow .

--å½¢å‚b  å°†æ¥ç»™å­©å­ä¼ çš„å›è°ƒå‡½æ•°

ä¼ å…¥å›è°ƒæ–¹æ³•ï¼Œè¿™é‡Œé¢å¯ä»¥æ˜¯è¯·æ±‚çš„æ•°æ®ï¼Œç­‰è‡ªå®šä¹‰çš„ä¸œè¥¿ã€‚

ä¼ å…¥ä¹‹åï¼Œé¡¹ç›®ä¸­æ‰€æœ‰çš„ç»„ä»¶éƒ½è§†ä¸ºProviderçš„å­ç»„ä»¶ï¼Œé€šè¿‡propsæ‹¿åˆ°è‡ªå·±ä¼ å…¥çš„å‚æ•°ã€‚

##### ç¤ºä¾‹02

detailè¯¦æƒ…ç»„ä»¶ç¤ºä¾‹2

åˆ—è¡¨é¡µæ‰§è¡Œä»£ç 

```
 props.history.push(`/detail/${filmId}`)
```

è¯¦æƒ…é¡µï¼š

```
import React,{useEffect} from 'react'
import { show,hide } from '../redux/actionCreator/TabbarActionCreator'

import {connect} from 'react-redux' <---- é‡ç‚¹

 function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    let  {show,hide,match} = props; // æŠŠå‚æ•°è§£æ„å‡ºæ¥ å¦åˆ™ä¾èµ–è¿‡å¤š æµè§ˆå™¨warmæç¤º

    useEffect(() => {
        // console.log("create")
        // store.dispatch(hide())
                  hide()  <---- é‡ç‚¹ åŸæ¥dispatchçš„æ–¹æ³•æ›¿æ¢ä¸ºæ›´ä¸ºæ›´ä¸ºç®€æ´çš„hide()
        return () => {
            console.log("destroy")
            // store.dispatch(show() )
                    show()  <---- é‡ç‚¹
        }
    }, [match.params.myid, show,hide]) ä¾èµ–å‚æ•°

    return (
        <div>
            deteail
        </div>
    )
}
const mapDispatchToProps  = {
    show,
    hide
}
export default connect(null,mapDispatchToProps)(Detail) <---- é‡ç‚¹ ç»„ä»¶æå‡
```

TabbarActionCreator æ–¹æ³•

```
 function hide(){
     return {
        type:"kerwinhide-tabbar"
    }
 }

 function show(){
    return {
        type:"kerwinshow-tabbar"
    }
 }

 export {show,hide}
```

##### ç¤ºä¾‹03 

city.jsç»„ä»¶æ”¹é€ 

```
import React,{useState} from 'react'
import {connect} from 'react-redux'  <---- é‡ç‚¹

 function City(props) {
    const [list] = useState(["åŒ—äº¬","ä¸Šæµ·","æ·±åœ³","å¹¿å·"])
    return (
        <div>
            city

            <ul>
                {
                    list.map(item=>
                    <li key={item} onClick={()=>{
                        // store.dispatch({
                        //     type:"change-city",
                        //     payload:item
                        // })
                        props.change(item)  <---- é‡ç‚¹ ä¼ å…¥è¡Œå‚æ•°item

                        props.history.goBack()
                    }}>{item}</li>    
                    )
                }
            </ul>
        </div>
    )
}
const mapDispatchToProp =  {
    change(item){     æ¥å—å‚æ•°  item 
        return {
            type:"change-city",       //è¿™é‡Œæ˜¯é€šè¿‡typeæŒ¨ä¸ªåŒºåŒ¹é…reducer
            payload:item
        }
    }
}

export default connect(null,mapDispatchToProp)(City) <---- é‡ç‚¹
```

CityReducer.js

```
const CityReducer = (prevState={
    cityName:"åŒ—äº¬"
   //  ...
 },action)=>{

    let newState = {...prevState}
    switch(action.type){
      
       case "change-city":
         newState.cityName = action.payload
         return newState

       default:
          return prevState
    }
 }

 export default  CityReducer
```

##### ç¤ºä¾‹04

Cinemas.jsç”µå½±åˆ—è¡¨é¡µé¢  æ”¹é€ 

```
import React,{ useEffect } from 'react'
import getCinemaListAction from '../redux/actionCreator/getCinemaListAction'
import { connect } from 'react-redux' <---- é‡ç‚¹

 function Cinemas(props) {

    let {list, getCinemaListAction, cityName} = props

    useEffect(() => {

        if(list.length===0){
            //å»åå°å–æ•°æ®
            // actionCreator é‡Œå†™å¼‚æ­¥
            // store.dispatch(getCinemaListAction())
            getCinemaListAction()  <---- é‡ç‚¹
        }
    }, [list,getCinemaListAction]) <---- é‡ç‚¹
    return (
        <div>
            <div style={{overflow:"hidden"}}>
                <div onClick={()=>{
                    props.history.push(`/city`)
                }} style={{float:"left"}}>{ cityName }</div>
                <div style={{float:"right"}} onClick={()=>{
                    props.history.push(`/cinemas/search`)
                }}>æœç´¢</div>
            </div>
            {
                  list.map(item=> <---- é‡ç‚¹ è¿™é‡Œç›´æ¥ä½¿ç”¨è§£æ„å‡ºæ¥çš„ list
                    <dl key={item.cinemaId} style={{padding:"10px"}}>
                        <dt>{item.name}</dt>
                        <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                    </dl>    
                )
            }
        </div>
    )
}
const mapStateToProps = (state)=>{ <---- é‡ç‚¹  é¡¶çº§ç»„ä»¶ç»™çš„å‚æ•°  æ•°æ®ä»“åº“
    return {
        list:state.CinemaListReducer.list,
        cityName:state.CityReducer.cityName
    }
}

const mapDispatchToProps = {
    getCinemaListAction
}
export default connect(mapStateToProps,mapDispatchToProps)(Cinemas)<---- é‡ç‚¹
```

#### 4.æ€»ç»“

react-reduxæ’ä»¶çš„å¼•å…¥ï¼ŒæŠŠæ•°æ®ä»é¡µé¢æŠ½ç¦»ï¼Œä½¿æ¯ä¸ªé¡µé¢éƒ½å˜æˆäº†Uiç»„ä»¶ã€‚

###### æ‰©å±• ï¼šUIç»„ä»¶å’Œå®¹å™¨ç»„ä»¶

###### 1ï¼‰UIç»„ä»¶

â€¢ åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘

â€¢ æ²¡æœ‰çŠ¶æ€ï¼ˆå³ä¸ä½¿ç”¨this.stateè¿™ä¸ªå˜é‡ï¼‰

â€¢ æ‰€æœ‰æ•°æ®éƒ½ç”±å‚æ•°ï¼ˆthis.propsï¼‰æä¾›

â€¢ ä¸ä½¿ç”¨ä»»ä½• Redux çš„ API

###### (2) å®¹å™¨ç»„ä»¶

â€¢ è´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°

â€¢ å¸¦æœ‰å†…éƒ¨çŠ¶æ€
â€¢ç”¨ Redux çš„ API

###### ç»†åŒ–è§£é‡Šï¼š

å±•ç¤ºç»„ä»¶è´Ÿè´£åº”ç”¨çš„UIå±•ç¤ºï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶å¦‚ä½•æ¸²æŸ“ï¼Œå…·æœ‰å¾ˆå¼ºçš„å†…èšæ€§ã€‚å±•ç¤ºç»„å»ºä¸å…³å¿ƒæ¸²æŸ“æ—¶ä½¿ç”¨çš„æ•°æ®æ˜¯å¦‚ä½•è·å–åˆ°çš„ï¼Œå®ƒåªè¦çŸ¥é“æœ‰äº†è¿™äº›æ•°æ®åï¼Œç»„ä»¶åº”è¯¥å¦‚ä½•æ¸²æŸ“å°±è¶³å¤Ÿäº†ã€‚

å®¹å™¨ç»„ä»¶è´Ÿè´£åº”ç”¨é€»è¾‘çš„å¤„ç†ï¼Œå¦‚å‘é€ç½‘ç»œè¯·æ±‚ã€å¤„ç†è¿”å›æ•°æ®ï¼Œå°†å¤„ç†è¿‡çš„æ•°æ®ä¼ é€’ç»™å±•ç¤ºç»„ä»¶ä½¿ç”¨ç­‰ã€‚å®¹å™¨ç»„ä»¶è¿˜æä¾›ä¿®æ”¹æºæ•°æ®çš„æ–¹æ³•ï¼Œé€šè¿‡å±•ç¤ºç»„ä»¶çš„propsä¼ é€’ç»™å±•ç¤ºç»„ä»¶ï¼Œå½“å±•ç¤ºç»„ä»¶çš„çŠ¶æ€å˜æ›´å¼•èµ·æºæ•°æ®å˜åŒ–æ—¶ï¼Œå±•ç¤ºç»„ä»¶é€šè¿‡è°ƒç”¨å®¹å™¨ç»„ä»¶æä¾›çš„æ–¹æ³•åŒæ­¥è¿™äº›å˜åŒ–ã€‚

å±•ç¤ºç»„ä»¶å’Œå®¹å™¨ç»„ä»¶å¯ä»¥è‡ªç”±åµŒå¥—ã€‚

æ³¨æ„ï¼å±•ç¤ºç»„ä»¶å’Œå®¹å™¨ç»„ä»¶æ˜¯æ ¹æ®ç»„ä»¶æ„å›¾åˆ’åˆ†çš„ï¼Œæ— çŠ¶æ€ç»„ä»¶å’Œæœ‰çŠ¶æ€ç»„ä»¶æ˜¯æ ¹æ®ç»„ä»¶å†…éƒ¨æ˜¯å¦ä½¿ç”¨stateåˆ’åˆ†ç»„ä»¶ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå±•ç¤ºç»„ä»¶æ˜¯é€šè¿‡æ— çŠ¶æ€ç»„ä»¶å®ç°çš„ï¼Œå®¹å™¨ç»„ä»¶æ˜¯é€šè¿‡æœ‰çŠ¶æ€ç»„ä»¶å®ç°çš„ï¼Œä½†æ˜¯å±•ç¤ºç»„ä»¶ä¹Ÿå¯ä»¥æ˜¯æœ‰çŠ¶æ€ç»„ä»¶ã€‚ï¼Œå®¹å™¨ç»„ä»¶ä¹Ÿå¯ä»¥æ˜¯æ— çŠ¶æ€ç»„ä»¶ã€‚


##### **1.**  Provider  ä¸  connect

(1)React-Redux  æä¾›Providerç»„ä»¶ï¼Œå¯ä»¥è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ°state

```
import React from 'react'
import ReactDOM from 'react-dom'


import { Provider } from 'react-redux' import store from './store'

import App from './App'


const rootElement = document.getElementById('root') ReactDOM.render(
<Provider store={store}>
<App />
</Provider>, rootElement
)

```

##### 2. React-Redux æä¾›connectæ–¹æ³•

ï¼Œç”¨äºä» UI ç»„ä»¶ç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚connectçš„æ„æ€ï¼Œå°±æ˜¯å°†è¿™ä¸¤ç§ç»„ä»¶è¿èµ·æ¥

```
import { connect } from 'react-redux'
import { increment, decrement, reset } from './actionCreators'


// const Counter = ...
const mapStateToProps = (state /*, ownProps*/) => { return {
counter: state.counter
}
}
const mapDispatchToProps = { increment, decrement, reset } export default connect(
mapStateToProps, mapDispatchToProps
)(Counter)

```

#####  3  HOCä¸contexté€šä¿¡åœ¨react-reduxåº•å±‚ä¸­çš„åº”ç”¨

(1)     connect æ˜¯HOCï¼Œ é«˜é˜¶ç»„ä»¶

(2)  Providerç»„ä»¶ï¼Œå¯ä»¥è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ°state ï¼Œ ä½¿ç”¨äº†context( è·¨çº§é€šä¿¡ )

##### 4 é«˜é˜¶ç»„ä»¶æ„å»ºä¸åº”ç”¨

HOCä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç¡®åˆ‡è¯´åº”è¯¥æ˜¯ä¸€ä¸ªç»„ä»¶å·¥å‚ï¼Œè·å–ä½é˜¶ç»„ä»¶ï¼Œç”Ÿæˆé«˜é˜¶ç»„ä»¶ã€‚

 (1)ä»£ç å¤ç”¨ï¼Œä»£ç æ¨¡å—åŒ–

(2) å¢åˆ æ”¹props

(3)   æ¸²æŸ“åŠ«æŒ

**ç¤ºä¾‹**

```javascript
// Child.js

//é«˜é˜¶å‡½æ•°  å…¥å‚ä¸ºä½é˜¶ç»„ä»¶
function Control(wrappedComponent) {
  return class MyControl extends React.Component {
    render() {
      if (!this.props.data) {
        return <div>loading...</div>
      }
      return <wrappedComponent {...props} />
    }
  }
}


class MyComponent extends React.Component {
  render() {
    return <div>{this.props.data}</div>
  }
}
export default Control(MyComponent); //è¾“å‡ºé«˜é˜¶ç»„ä»¶



//Parent.js
import MyControlComponent from "./Child"
<MyControlComponent data={this.state.value}/>

//åœ¨çˆ¶çº§ä¼ å…¥dataæ˜¯nullçš„æ—¶å€™ï¼Œè¿™ä¸€å—å„¿å°±åªä¼šæ˜¾ç¤ºloading...,
//ä¸ä¼šæ˜¾ç¤ºç»„ä»¶çš„å…·ä½“å†…å®¹ï¼Œå¦‚æœdataä¸ä¸ºnull,  å°±æ˜¾ç¤ºçœŸå®ç»„ä»¶ä¿¡æ¯ã€‚

```

#### 5.åŸç†æ¢ç©¶

```
...
export default connect(mapStateToProps,mapDispatchToProps)(Cinemas)<---- é‡ç‚¹

è¿™é‡Œç»„ä»¶ä½¿ç”¨connectæ–¹æ³•å¤„ç†åï¼Œä¸ºä½é˜¶ç»„ä»¶ï¼Œå¢åŠ äº†å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹è¿™ä¸€æ ¸å¿ƒæ–¹æ³•è§£æã€‚
```

   æ ¹æ®è¾“å…¥å’Œè¾“å‡ºæ•ˆæœï¼Œè‡ªå®šä¹‰connectæ–¹æ³• 

   å¦‚ä¸‹

```
import React,{useEffect} from 'react'
//ä½é˜¶ç»„ä»¶
function NotFound(props) {
    useEffect(() => {
        console.log(props)
    }, [props])
    return (
        <div>
            404 not found
        </div>
    )
}
è‡ªå®šä¹‰connenctæ–¹æ³•
function kerwinconnenct(cb,obj){
    var value = cb()
    return (MyComponent)=>{
        return (props)=>{
            // console.log()
            return <div style={{color:"red"}}>
                <MyComponent {...value} {...props} {...obj}/>
            </div>
        }
    }
}
è¾“å‡ºé«˜é˜¶ç»„ä»¶
export default kerwinconnenct(()=>{
    return {
        a:1,
        b:2
    }
},{
    aa(){},
    bb(){}
})(NotFound)

```



#### reduxæŒä¹…åŒ–æ”¹é€ 

ä½¿ç”¨æ’ä»¶ redux-persist 

å‰æï¼šæœ€å¥½ä½¿ç”¨äº†react-reduxä¹‹åï¼Œå†ä½¿ç”¨è¿™ä¸ªã€‚

https://github.com/rt2zz/redux-persist

ä½¿ç”¨

```
npm i redux-persist

```

 éœ€è¦æ”¹é€ ä¸¤å¤„

store.jsæ–‡ä»¶

```
 import {applyMiddleware,combineReducers, createStore, compose} from 'redux'
 import CityReducer from './reducers/CityReducer'
 import TabbarReducer from './reducers/TabbarReducer'
 import CinemaListReducer from './reducers/CinemaListReducer'
 import reduxThunk from 'redux-thunk'
 import reduxPromise from 'redux-promise'

 import { persistStore, persistReducer } from 'redux-persist'
 import storage from 'redux-persist/lib/storage' // defaults to localStorage for web
 
 const persistConfig = {
    key: 'kerwin',
    storage,
    whitelist: ['CityReducer']
  }
  
  const reducer  = combineReducers({
    CityReducer,
    TabbarReducer,
    CinemaListReducer
   })
  const persistedReducer = persistReducer(persistConfig, reducer)
  
  
  
   const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;
  
   const store = createStore(persistedReducer,composeEnhancers(applyMiddleware(reduxThunk,reduxPromise)));
   let persistor = persistStore(store)
  
   export {store,persistor}
```

index.js

```
import React from 'react'
import ReactDOM from 'react-dom'
import App from './05-redux/App'

import {Provider} from 'react-redux'
import {store,persistor} from './05-redux/redux/store'

console.log(store)
ReactDOM.render(

    <Provider store={store}>
          <PersistGate loading={null} persistor={persistor}>
             <App/>
          </PersistGate>
        
    </Provider>

  ,document.getElementById("root"))
```

åº”è¯¥å¯ä»¥äº†





## åä¸‰ UIç»„ä»¶åº“

## åå›› Immutable

 è¯ä¹‰ï¼šadj.æ°¸æ’çš„ï¼Œä¸å¯æ”¹å˜çš„

https://github.com/immutable-js/immutable-js

ä½œä¸ºä¸€æ¬¾æ’ä»¶ï¼Œè§£å†³ä¸€ä¸ªç—›ç‚¹ã€‚è¯¥æ’ä»¶çš„ä½œç”¨å°±æ˜¯é«˜æ€§èƒ½çš„æ·±å¤åˆ¶æ•°æ®ï¼ŒåŠŸèƒ½åªæ˜¯æ•°æ®çš„å¤„ç†ï¼Œä¸å…³ä¹æ¡†æ¶ï¼Œ

å¼•å…¥reactçš„åŸå› ï¼Œæ˜¯reactçš„ç‰¹æ€§ï¼Œå•å‘æ•°æ®æµï¼Œåœ¨ä¿®æ”¹dataçš„æ—¶å€™ï¼Œä¸èƒ½æ”¹å˜åŸæ•°æ®ï¼Œä½¿ç”¨åœºæ™¯å¤šä¸€ç‚¹è€Œå·²ã€‚

### 1. ç—›ç‚¹å¼•å…¥

#### ç¬¬ä¸€æ­¥ï¼š

   ```
// å¼•ç”¨å¤åˆ¶ (æµ…å¤åˆ¶)
var obj = {
    name:"zhangsan"
}

var obj2 = obj
obj2.name = "xiaomoing"
console.log(obj,obj2)//  {name: 'xiaomoing'} {name: 'xiaomoing'}
ç»“è®ºï¼šå˜é‡ç›´æ¥ç­‰äºï¼ŒæŒ‡é’ˆå˜åŒ–è€Œå·²ï¼Œæ•°æ®æºåŒä¸€ä¸ªï¼Œä¸€æ—¦ä¿®æ”¹ï¼ŒåŸæ•°æ®ä¹Ÿè·Ÿç€æ”¹å˜ã€‚
   ```

#### ç¬¬äºŒæ­¥ï¼š

```javascript
// æ¯”æµ…å¤åˆ¶å¤šå¤åˆ¶äº†ä¸€å±‚
var myobj = {
    name:"zhangsan",
    arr:[1,2,3]
}
var myobj2 = {  // ä½¿ç”¨è§£æ„å¤åˆ¶
    ...myobj   
}
myobj2.name = "xiaoming"
myobj2.arr.splice(1,1)

console.log(myobj,myobj2) 
//{arr: [1, 3], name: "zhangsan" }  {arr: [1, 3], name: "xiaoming" } 
 ç»“è®ºï¼šè¡¨å±‚æ•°æ®æ²¡æœ‰å½±å“ï¼Œæ·±å±‚è§£æ„è¿˜æ˜¯ä¿®æ”¹äº†
```

#### ç¬¬ä¸‰æ­¥:

```javascript
// json-parse json-stringify -æ·±å¤åˆ¶- ä¸èƒ½æœ‰undefined

var jsonobj ={
    name:"zhangsan",
    arr:[1,2,3],
    address:undefined
}

var jsonobj2 = JSON.parse(JSON.stringify(jsonobj))
jsonobj2.name = "xiaoming"
jsonobj2.arr.splice(1,1)

console.log(jsonobj,jsonobj2)
//{arr: [1,2, 3], name: "zhangsan" }  {arr: [1, 3], name: "xiaoming" } 
ç»“è®ºï¼šæˆåŠŸå¤åˆ¶ï¼Œåˆ‡æ²¡æœ‰æ”¹å˜åŸæ•°æ®ã€‚ ä½†æ˜¯å¤åˆ¶çš„æ•°æ®ä¸­ä¸èƒ½æœ‰undefinedï¼Œä¼šä¸¢å¤±æ‰ã€‚
// deepcopy
// é€’å½’æ·±å¤åˆ¶-ä¸€å±‚å±‚å¤åˆ¶ï¼Œ æ€§èƒ½ä¸å¥½ï¼Œå ç”¨å†…å­˜ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ï¼Œå®ƒæ˜¯å®Œæ•´çš„å¤åˆ¶äº†ä¸€ä»½æ•°æ®ã€‚
```

### 2.Immutableä»‹ç»

#### ImmutableåŠŸèƒ½ï¼š

æ¯æ¬¡ä¿®æ”¹ä¸€ä¸ª  Immutable  å¯¹è±¡æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜çš„å¯¹è±¡ï¼Œåœ¨æ–°å¯¹è±¡ä¸Šæ“ä½œå¹¶ä¸ä¼šå½±å“åˆ°åŸå¯¹è±¡çš„æ•°æ®ã€‚

#### Immutableä¼˜åŒ–æ€§èƒ½çš„æ–¹å¼ï¼š

Immutable å®ç°çš„åŸç†æ˜¯
Persistent Data Structureï¼ˆæŒä¹…åŒ–æ•°æ®ç»“æ„ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ—§æ•°æ®åŒæ—¶å¯ç”¨ä¸”ä¸å˜ã€‚åŒæ—¶ä¸ºäº†é¿å…
deepCopy æŠŠæ‰€æœ‰èŠ‚ç‚¹éƒ½å¤åˆ¶ä¸€éå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒImmutable ä½¿ç”¨äº†
Structural Sharingï¼ˆç»“æ„å…±äº«ï¼‰ï¼Œå³å¦‚æœå¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåªä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹å’Œå—å®ƒå½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹åˆ™è¿›è¡Œå…±äº«

![](https://upload-images.jianshu.io/upload_images/2165169-cebb05bca02f1772)



## 3.æ’ä»¶ä½¿ç”¨

 ```
# using npm
  1. npm i immutabel
  2. import {Map} from 'immutable'
 ```

### å¯¹è±¡çš„ä½¿ç”¨å’Œä¿®æ”¹ Mapæ–¹æ³•

```
import React, { Component } from 'react'
import {Map} from 'immutable'

var obj = {
    name:"zhangsan",
    age:100
}

var oldImmuObj = Map(obj)     //MapæŠŠå¯¹è±¡è½¬åŒ–æˆimmutableå¯¹è±¡
var newImmuObj = oldImmuObj.set("name","xiaoming") //.set(key , value) å½¢å¼ä¿®æ”¹å¯¹è±¡å€¼
// console.log(oldImmuObj,newImmuObj) // æ²¡æœ‰ä¿®æ”¹åŸæ•°æ®

//1 getè·å–immutalble 

console.log(oldImmuObj.get("name"),newImmuObj.get("name"))// è·å–immutableå¯¹è±¡çš„å€¼

//2 immutable===>æ™®é€šå¯¹è±¡

console.log(oldImmuObj.toJS(),newImmuObj.toJS()) //.toJS()æ–¹æ³•ï¼Œè¿˜åŸæˆæ™®é€šçš„jså¯¹è±¡
```

### æ¡ˆä¾‹01:Mapæ–¹æ³•setæ–¹æ³•toJSæ–¹æ³•

ä½¿ç”¨Mapæ–¹æ³•ï¼Œä¿®æ”¹name,ageï¼Œå¹¶æ›´æ–°è§†å›¾ã€‚æ­¤æ¡ˆä¾‹ï¼šimmutableä»…å‚ä¸æ•°æ®å¤„ç†ï¼Œä¸å‚ä¸è§†å›¾æ˜¾ç¤º

```
import React, { Component } from 'react'
import {Map} from 'immutable'

export default class App extends Component {

    state = {
        info:{
            name:"zs",
            age:100
        }
    }
    render() {
        return (
            <div>
                
                <button onClick={()=>{
                
  var old = Map(this.state.info) //1.æ•°æ®ç±»å‹è½¬åŒ–
 var newImmu = old.set("name","xiaoming").set("age",18) //2.æ•°æ®å¤„ç†
                    this.setState({
                        info:newImmu.toJS()  //3.æ•°æ®è¿˜åŸ
                    })
                    
                }}>click</button>
                {this.state.info.name}--
                {this.state.info.age}
            </div>
        )
    }
}
```

### æ¡ˆä¾‹2

immutableåº”ç”¨äºæ·±å±‚æ•°æ®ç»“æ„ä½¿ç”¨æ–¹æ³•ï¼Œå’ŒåŸºäºä¸ä¿®æ”¹ä¿æŒä¸å˜çš„ç‰¹æ€§çš„åˆ©ç”¨

ä¸‹é¢æ¡ˆä¾‹å±•ç¤ºï¼š

01.æ·±å±‚çº§æ•°æ®filterï¼Œä¹Ÿè¦åŠ ä¸ŠMapï¼Œå¦åˆ™ä¼šå½±å“åŸæ•°æ®

02.åˆ©ç”¨ä¸ä¿®æ”¹ä¸å˜æ¢åŸç†ï¼Œå¯ä»¥å‡å°‘å­ç»„ä»¶çš„é‡å¤æ¸²æŸ“



```
import React, { Component } from 'react'
import {Map} from 'immutable'
export default class App extends Component {

    state = {
        info:Map({
            name:"kerwin",
            select:"aa",
            filter:Map({
                text:"",
                up:true,
                down:false
            })
        })
    }

    componentDidMount() {
        console.log(this.state.info.get("filter"))
    }
    
    render() {
        return (
            <div>
                <button onClick={()=>{
                    this.setState({
                        info:this.state.info.set("name","xiaoming").set("select","bb")
                    })
                }}>click</button>
                {this.state.info.get("name")}
                <Child filter={this.state.info.get("filter")}/>
            </div>
        )
    }
}


class Child extends Component{
    shouldComponentUpdate(nextProps, nextState) { // ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ˜¯å¦æ¸²æŸ“ç»„ä»¶ï¼Œfalseåˆ™ä¸å˜
        if(this.props.filter === nextProps.filter){
            return false
        }
        return true
    }
    
    render(){
        return <div>
            child
        </div>
    }

    componentDidUpdate(){
        console.log("componentDidUpdate")
    }
}
```

### æ¡ˆä¾‹3 Listæ–¹æ³•

```javascript
import React, { Component } from 'react'
import {List} from 'immutable'
var arr = List([1,2,3])

var arr2 = arr.push(4) //ä¸ä¼šå½±å“è€çš„å¯¹è±¡ç»“æ„
var arr3 = arr2.concat([5,6,7])
console.log(arr.toJS(),arr2.toJS(),arr3.toJS())
æ‰“å°ç»“æœï¼š
 [1, 2, 3]
 [1, 2, 3, 4]
 [1, 2, 3, 4, 5, 6, 7]
 
export default class App extends Component {
    state = {
        favor:List(["aaa","bbb","ccc"])  
 //immutableçš„æ•°ç»„ï¼Œpush,concatç­‰æ­£å¸¸çš„jsæ–¹æ³•ï¼Œåœ¨è¿™é‡Œéƒ½ä¸ä¼šä¿®æ”¹åŸæ•°æ®ã€‚ï¼ˆä¸ºäº†å‡ä½å­¦ä¹ æˆæœ¬ï¼Œä¿æŒä¸€è‡´ï¼‰
    }
    render() {
        return (
            <div>
                {
                    this.state.favor.map(item=>
                      <li key={item}>{item}</li>    
                    )
                }
            </div>
        )
    }
}
```

### æ¡ˆä¾‹4 Listæ–¹æ³•çš„é¡¹ç›®ä½¿ç”¨

æ¼”ç¤ºlistçš„è·å–ï¼Œä¿®æ”¹ï¼Œåˆ é™¤

```react
import { List,Map } from 'immutable'
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        info:Map({
            name:"kerwin",
            location:Map({
                province:"è¾½å®",
                city:"å¤§è¿"
            }),
            favor:List(["è¯»ä¹¦","çœ‹æŠ¥","å†™ä»£ç "])
        })
    }
    render() {
        return (
            <div>
                <h1>ä¸ªäººä¿¡æ¯ä¿®æ”¹</h1>
                <button onClick={()=>{
                    this.setState({
                    info: this.state.info.set("name","xiaomng")
                     .set("location",this.state.info.get("location").set("city","æ²ˆé˜³"))
                    })
                }}>ä¿®æ”¹</button>
                <div>
                    {this.state.info.get("name")}
                    <br/>
                    {
                        this.state.info.get("location").get("province")
                    }
                    -
                    {
                        this.state.info.get("location").get("city")
                    }
                    <br/>
                    {
                        this.state.info.get("favor").map((item,index)=>
                        <li key={item}>{item}
                            <button onClick={()=>{
                                console.log(index)

                                this.setState({
                                    info:this.state.info.set("favor",
                                    this.state.info.get("favor").splice(index,1))
                                })
                            }}>del</button>
                        </li>    
                        )
                    }
                </div>
            </div>
        )
    }
}
```

### æ¡ˆä¾‹5ï¼šfromJS setIn  updateInæ–¹æ³•

fromJS ï¼šå½“ä¸çŸ¥é“è¿”å›æ•°æ®çš„å±‚çº§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨fromJS ã€‚

.setIn(["å±‚çº§1","å±‚çº§2"],"è¦ä¿®æ”¹çš„æ–°å€¼")

.updateIn( [å±‚çº§]ï¼Œ ï¼ˆï¼‰=>{})  // ç¬¬äºŒä¸ªå€¼æ˜¯ä¸ªå›è°ƒï¼Œå›è°ƒä¸­è¿”å›çš„å°±æ˜¯æ–°å€¼

```react
import { fromJS } from 'immutable'
import React, { Component } from 'react'

export default class App extends Component {
    state = {
        info:fromJS({
            name:"kerwin",
            location:{
                province:"è¾½å®",
                city:"å¤§è¿"
            },
            favor:["è¯»ä¹¦","çœ‹æŠ¥","å†™ä»£ç "]
        })
    }

    componentDidMount() {
        console.log(this.state.info)
    }
    

    render() {
        return (
            <div>
                <h1>ä¸ªäººä¿¡æ¯ä¿®æ”¹</h1>
                <button onClick={()=>{
                    this.setState({
                        info: this.state.info.setIn(["name"],"xiaomng")
                        .setIn(["location","city"],"æ²ˆé˜³")
                    })
                }}>ä¿®æ”¹</button>
                <div>
                    {this.state.info.get("name")}
                    <br/>
                    {
                        this.state.info.get("location").get("province")
                    }
                    -
                    {
                        this.state.info.get("location").get("city")
                    }
                    <br/>
                    {
                        this.state.info.get("favor").map((item,index)=>
                        <li key={item}>{item}
                            <button onClick={()=>{
                                console.log(index)

                                // this.setState({
                                //     info:this.state.info.setIn(["favor",index],"11111") //æ•°ç»„çš„æœ¬è´¨å°±æ˜¯å¯¹è±¡
                                // })

                                this.setState({
                                    info:this.state.info.updateIn(["favor"],(list)=>list.splice(index,1))
                                })
                            }}>del</button>
                        </li>    
                        )
                    }
                </div>
            </div>
        )
    }
}

```

### æ¡ˆä¾‹6ï¼šImmutable+Reduxçš„å¼€å‘æ–¹å¼

  éµå¾ªImmutableåŒ–çš„æ•°æ®ï¼Œå–å€¼å’Œä¿®æ”¹çš„è§„åˆ™ã€‚

```react
//reducer.js
const initialState = fromJS({ category:"",
material:""
})
const reducer = (prevstate = initialState,action={})=>{ let {type,payload} = action
switch(type){
case GET_HOME:
var newstate =prevstate.set("category",fromJS(payload.category)) var newstate2 =newstate.set("material",fromJS(payload.material)) return newstate2;
default:
return prevstate
}
}


//home.js
const mapStateToProps = (state)=>{ return {
category:state.homeReducer.getIn(["category"]) || Map({}), material:state.homeReducer.getIn(["material"]) || Map({})
}
}

this.props.category.get("ç›¸å…³å±æ€§") this.props.category.toJS() //æˆ–è€…è½¬æˆæ™®é€šå¯¹è±¡

```

å»ºè®®ï¼š æœ‰éœ€è¦å»ä½¿ç”¨ï¼Œä¸è¦ä¸ºäº†ä½¿ç”¨è€Œä½¿ç”¨ã€‚

## åäº” Mobx

https://cn.mobx.js.org/

è¿™æ˜¯ä¸€ä¸ªåª²ç¾redux å’Œreact-reduxç»„åˆçš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨æ›´æ–¹é¢ã€‚æ—¢ç„¶æ˜¯å¯¹æ ‡æ’ä»¶ï¼Œæ‰€ä»¥Mobxä¹Ÿæœ‰

Mobxå’Œ mobx-**react** çš„ç»„åˆã€‚

### 1.ä»‹ç»

(1)     Mobxæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ï¼Œä¸Šæ‰‹éå¸¸å®¹æ˜“çš„çŠ¶æ€ç®¡ç†å·¥å…·ã€‚

(2)     MobxèƒŒåçš„å“²å­¦å¾ˆç®€å•:  ä»»ä½•æºè‡ªåº”ç”¨çŠ¶æ€çš„ä¸œè¥¿éƒ½åº”è¯¥è‡ªåŠ¨åœ°è·å¾—ã€‚

(3)     Mobxåˆ©ç”¨getterå’Œsetteræ¥æ”¶é›†ç»„ä»¶çš„æ•°æ®ä¾èµ–å…³ç³»ï¼Œä»è€Œåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶

â€‹        å€™ç²¾ç¡®çŸ¥é“å“ªäº›ç»„ä»¶éœ€è¦é‡ç»˜ï¼Œåœ¨ç•Œé¢çš„è§„æ¨¡å˜å¤§çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šæœ‰å¾ˆå¤šç»†ç²’åº¦æ›´æ–°

![](https://cn.mobx.js.org/flow.png)

### 2.Mobx*ä¸*reduxçš„åŒºåˆ«

1.Mobxå†™æ³•ä¸Šæ›´åå‘äºOOPï¼ˆé¢å‘å¯¹è±¡ï¼‰

2.å¯¹ä¸€ä»½æ•°æ®ç›´æ¥è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œä¸éœ€è¦å§‹ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®

3.å¹¶éå•ä¸€store,å¯ä»¥å¤šstoreã€‚

4.Reduxé»˜è®¤ä»¥JavaScriptåŸç”Ÿå¯¹è±¡å½¢å¼å­˜å‚¨æ•°æ®ï¼Œè€ŒMobxä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡

### 3.ä¼˜ç¼ºç‚¹

##### ä¼˜ç‚¹

a.   å­¦ä¹ æˆæœ¬å°

b.   é¢å‘å¯¹è±¡ç¼–ç¨‹, è€Œä¸”å¯¹ TS å‹å¥½ç¼ºç‚¹ï¼š

##### ç¼ºç‚¹

a.  è¿‡äºè‡ªç”±ï¼šMobxæä¾›çš„çº¦å®šåŠæ¨¡ç‰ˆä»£ç å¾ˆå°‘ï¼Œä»£ç ç¼–å†™å¾ˆè‡ªç”±ï¼Œå¦‚æœä¸åšä¸€äº›çº¦å®šï¼Œæ¯”è¾ƒå®¹æ˜“å¯¼è‡´å›¢é˜Ÿä»£ç é£æ ¼ä¸ç»Ÿä¸€ï¼Œ

b. ç›¸å…³çš„ä¸­é—´ä»¶å¾ˆå°‘ï¼Œé€»è¾‘å±‚ä¸šåŠ¡æ•´åˆæ˜¯é—®é¢˜ã€‚

### 4.Mobxçš„ä½¿ç”¨

é¡¹ç›®å¼•å…¥

````
npm i mobx@5    // æ™®åŠç‡è¾ƒé«˜çš„ç‰ˆæœ¬

import {observable,autorun} from 'mobx'  // <----- 1.å¼•å…¥æ ¸å¿ƒæ–¹æ³•   

var observableNumber = observable.box(10)  // <----- 2.åˆ›å»ºæ•°æ®

autorun(()=>{            // <----- 3.åˆ›å»ºç›‘å¬è€…
    console.log("numberæ”¹å˜äº†",observableNumber.get())
})
````



##### 4.1 ç®€å•å˜é‡çš„ç›‘å¬

###### æ¡ˆä¾‹1:

æ ¸å¿ƒæ–¹æ³•

observable ï¼šå°†æ™®é€šjsæ•°æ®ï¼Œå˜æˆå¯ä»¥ç›‘å¬çš„çŠ¶æ€ï¼Œè¿”å›äº†ä¸€ä¸ªå¢ç›Šå±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ã€‚

autorunï¼šè‡ªåŠ¨ç›‘å¬  å¹¶ä¸”åªå…³æ³¨æŒ‡å®šçš„æ•°æ®å¯¹è±¡å˜åŒ–ï¼Œå°±è§¦å‘ã€‚

mobxå¯¹è±¡çš„ä¿®æ”¹å’Œæå–å€¼    

```
 mobxObj.get()  æå–å€¼
 mobxObj.set(æ–°å€¼)  è®¾ç½®æ–°çš„å€¼
 
```



  æ‰§è¡Œæ•ˆæœï¼šé¡µé¢åŠ è½½åï¼Œä¼šé¦–å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œç›‘å¬æ•°æ®åˆ›å»ºï¼Œè¿›å…¥ç›‘å¬ï¼Œåç»­æ•°æ®çŠ¶æ€å˜åŒ–ï¼Œå¼€å§‹å·¥ä½œã€‚

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'  // <----- 1.å¼•å…¥æ ¸å¿ƒæ–¹æ³•

//å¯¹äºæ™®é€šç±»å‹æ•°æ®çš„ç›‘å¬
var observableNumber = observable.box(10)  // <----- 2.åˆ›å»ºæ•°æ®
var observableName = observable.box("tom")

ç¬¬ä¸€ä¸ªè‡ªåŠ¨ç›‘å¬
autorun(()=>{            // <----- 3.åˆ›å»ºç›‘å¬è€…
    console.log("numberæ”¹å˜äº†",observableNumber.get())
})
ç¬¬äºŒä¸ªè‡ªåŠ¨ç›‘å¬
// ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œ ä¹‹åæ¯æ¬¡æ”¹å˜ä¹Ÿä¼šæ‰§è¡Œ
autorun(()=>{
    console.log("nameæ”¹å˜äº†",observableName.get())
})

setTimeout(()=>{
    observableNumber.set(20)
    observableName.set("xiaoming")
},1000)

æµ‹è¯•ç»“æœï¼š 1såï¼Œä¸¤ä¸ªautorunç›‘å¬æ‰“å°
åŠ è½½é¡µé¢æ‰“å°ï¼›
numberæ”¹å˜äº† 10
nameæ”¹å˜äº† tom
   1såæ‰“å°
numberæ”¹å˜äº† 20
nameæ”¹å˜äº† xiaoming
```

###### æ¡ˆä¾‹2: ç›‘å¬è§„åˆ™

```react
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

//å¯¹äºæ™®é€šç±»å‹æ•°æ®çš„ç›‘å¬
var observableNumber = observable.box(10)
var observableName = observable.box("kerwin")

autorun(()=>{   //autorun01
    console.log("numberæ”¹å˜äº†",observableNumber.get())
})
// ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œ ä¹‹åæ¯æ¬¡æ”¹å˜ä¹Ÿä¼šæ‰§è¡Œ
autorun(()=>{  //autorun02
    console.log("nameæ”¹å˜äº†",observableName.get())
})

setTimeout(()=>{
    observableNumber.set(20)
},1000)

setTimeout(()=>{
    observableName.set("xiaoming")
},2000)

export default class App extends Component {
    render() {
        return (
            <div>
                app
            </div>
        )
    }
}
æµ‹è¯•ç»“æœï¼š
autorun01 1såæ‰“å°
autorun02 2såæ‰“å°
```

###### æ¡ˆä¾‹3

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

//å¯¹äºæ™®é€šç±»å‹æ•°æ®çš„ç›‘å¬
var observableNumber = observable.box(10)
var observableName = observable.box("tom")

autorun(()=>{
    console.log("numberæ”¹å˜äº†",observableNumber.get())
    console.log("nameæ”¹å˜äº†",observableName.get())
})

setTimeout(()=>{
    observableNumber.set(20)
},1000)

setTimeout(()=>{
    observableName.set("xiaoming")
},2000)
æµ‹è¯•ç»“æœï¼š
ç¬¬ä¸€æ¬¡æ‰“å°
tom 10
ä¸€ç§’é’Ÿå
tom 20
ä¸¤ç§’é’Ÿå
xiaoming 20 
    è¯´æ˜autorunåˆ¤æ–­è‡ªå·±å†…éƒ¨æœ‰æ•°æ®å˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨æŠŠè‡ªå·±å†…éƒ¨jsæ‰§è¡Œä¸€éã€‚æ‰€ä»¥é¡¹ç›®ä½¿ç”¨æ—¶ï¼Œè¦æ³¨æ„ã€‚
```

#### 4.2 å¯¹è±¡çš„ç›‘å¬æ–¹æ³•

ç¬¬ä¸€ç§ï¼šå£°æ˜å’Œä¿®æ”¹æ–¹æ³•

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

var myobj = observable.map({  // <----- é‡ç‚¹ å£°æ˜æ–¹æ³•
    name:"tom",
    age:100
})

autorun(()=>{
    console.log("å¯¹è±¡çš„nameå±æ€§æ”¹å˜äº†",myobj.get("name")) // <-----3såæ‰“å°ä¿®æ”¹åçš„å€¼xiaoming
})
setTimeout(()=>{
    myobj.set("name","xiaoming")  // <----- é‡ç‚¹  ä¿®æ”¹æ–¹æ³•
},3000)
```

ç¬¬äºŒç§ï¼šå£°æ˜å’Œä¿®æ”¹æ–¹æ³•

```
import React, { Component } from 'react'
import {observable,autorun} from 'mobx'

var myobj = observable({  // <----- é‡ç‚¹ å£°æ˜æ–¹æ³•
    name:"kerwin",
    age:100
})

autorun(()=>{
    console.log("å¯¹è±¡çš„nameå±æ€§æ”¹å˜äº†",myobj.name)
})
setTimeout(()=>{
    myobj.name= "xiaoming"   // <----- é‡ç‚¹  ä¿®æ”¹æ–¹æ³•
},1000)
```

### 5.é¡¹ç›®ä¸­ä½¿ç”¨é¡µé¢é…ç½®ï¼ˆæ— ES7è¯­æ³•ï¼‰

##### ç¬¬ä¸€ç§æ•°æ®ä¿®æ”¹æ— ç›‘ç®¡æƒ…å†µä¸‹  

ï¼ˆå„ä¸ªé¡µé¢éƒ½å¯ä»¥ä¿®æ”¹ï¼Œè¿‡äºéšæ„ï¼Œå‡ºç°bugï¼Œä¸å¥½æŸ¥æ‰¾ã€‚ï¼‰

store.js æ•°æ®ä»“åº“

```
import {observable, } from 'mobx'


const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",

})

export default store
```

App.js

ä½¿ç”¨ä»“åº“æ•°æ®   

```react
import React, { Component } from 'react'

import {autorun } from 'mobx'
import store from './mobx/store'  <--- é‡ç‚¹   å¼•å…¥ä»“åº“

class App extends Component { 
    state = {
        isShow:false
    }
    
    componentDidMount() {
        autorun(()=>{
            this.setState({
                isShow:store.isTabbarShow   <--- é‡ç‚¹   ä½¿ç”¨æ•°æ®å¹¶ä¿å­˜åˆ°ç»„ä»¶state
            })
        })
    }
    
    render() {
        return (
           <div>
                <MRouter>
                    {this.state.isShow && <Tabbar></Tabbar>} <--- é‡ç‚¹ 
                </MRouter>
           </div>
        )
    }
}

export default App

```

detail.js è¯¦æƒ…é¡µé¢

å¼•å…¥åŒä¸€ä¸ªæ•°æ®ä»“åº“ store,ç›´æ¥ä¿®æ”¹storeæ•°æ®

```
import React,{useEffect} from 'react'
import store from '../mobx/store'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
    
        store.isTabbarShow = false  <--- é‡ç‚¹ 
        return () => {
            console.log("destroy")
            store.isTabbarShow = true  <--- é‡ç‚¹ 
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}
```

##### ç¬¬äºŒç§æ•°æ®ä¿®æ”¹- ä¸¥æ ¼æ¨¡å¼

å¼€å¯ä¸¥æ ¼æ¨¡å¼ä¸‹  æ•°æ®ä¿®æ”¹åªèƒ½åœ¨storeä¸­æ³¨å†Œäº‹ä»¶ï¼Œå¦åˆ™æŠ¥é”™ã€‚

å¼€å¯æ–¹å¼

```react
å…³é”®ä»£ç ï¼š
import {observable,configure } from 'mobx'

const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",

})

configure({
    // enforceActions:'always'  å¼€å¯ä¸¥æ ¼æ¨¡å¼
    enforceActions:'never'  ä¸å¼€å¯
})
```

é¡µé¢ä½¿ç”¨çš„å‚æ•°é…ç½®   **configure**  **action** ä¸¥æ ¼æ¨¡å¼é…ç½®

store.jsé…ç½®

```react
import {observable,configure ,action } from 'mobx'

const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",
    changeShow(){
        this.isTabbarShow = true
    },
    changeHide(){
        this.isTabbarShow = false
    }
},{
    changeHide:action,
    changeShow:action //æ ‡è®°ä¸¤ä¸ªæ–¹æ³•æ˜¯actionï¼Œä¸“é—¨ä¿®æ”¹å¯è§‚æµ‹çš„value
})

configure({
    enforceActions:'always'
})

export default store
```

detail.jsè¯¦æƒ…é¡µé¢

```react
import React,{useEffect} from 'react'
import store from '../mobx/store'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
        // console.log("create")
       // store.isTabbarShow = false   
        store.changeHide()    <--- é‡ç‚¹  è°ƒç”¨æ–¹æ³•  ä¸èƒ½ç›´æ¥ä¿®æ”¹äº†
        return () => {
            console.log("destroy")

            //store.isTabbarShow = true
             store.changeShow()   <--- é‡ç‚¹  è°ƒç”¨æ–¹æ³•  ä¸èƒ½ç›´æ¥ä¿®æ”¹äº†
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}

```

### 6.å¼•å…¥Es7 è£…é¥°å™¨å†™æ³•ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰

#### è£…é¥°å™¨ï¼š

```java
è£…é¥°å™¨(Decorator)æ˜¯ES7çš„ä¸€ä¸ªè¯­æ³•ï¼Œæ˜¯ä¸€ç§ä¸ç±»ç›¸å…³çš„è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»çš„æ–¹æ³•ã€‚

è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆÂ @ +Â å‡½æ•°åã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢
class Store {
    @observable  isTabbarShow = true
    @observable  list = []

    @action changeShow(){   // @actionç›¸å½“äºä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠchangeShowæ–¹æ³•å…¥å‚ï¼Œåå‡ºæ¥ä¸€ä¸ªå¢å¼ºå‡½æ•°
        this.isTabbarShow = true
    }

    @action changeHide(){
        this.isTabbarShow = false
    }


è£…é¥°å™¨(Decorator) ä¹Ÿå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå…¶ä»–è¯­è¨€æ¯”å¦‚ Javaï¼ŒPythonç­‰å·²ç»å¾ˆæ—©å°±æœ‰äº†ï¼ŒES7ä¸­çš„è£…é¥°å™¨(Decorator)å€Ÿé‰´äº†å…¶ä»–è¯­è¨€çš„å†™æ³•ï¼Œä¸è¿‡ä¾èµ–äºES5çš„Object.definePropertyÂ æ–¹æ³• ã€‚
```

ä½¿ç”¨ES7è£…é¥°å™¨è¯­æ³•ï¼Œéœ€è¦é…ç½®ä»£ç ç¼–è¾‘å™¨vscode ,  é¡¹ç›®webpack è¯­æ³•loader,ç¼–è¯‘æˆæµè§ˆå™¨èƒ½è§£æçš„jsã€‚

##### ç¬¬ä¸€æ­¥ï¼š è°ƒæ•´vscode 

  è®©å®ƒä¸å†è®¤ä¸ºES7è£…é¥°å™¨æ˜¯ä¸ªè¯­æ³•é”™è¯¯

â€‹      ç‚¹å‡» å·¦ä¸Šè§’ æ–‡ä»¶ --ã€‹  é¦–é€‰é¡¹ --ã€‹ è¾“å…¥experimentalDecorators   é€‰ä¸­åï¼Œé€€å‡ºã€‚

##### ç¬¬äºŒæ­¥ï¼š webpacké…ç½®

1.

```
npm i @babel/core @babel/plugin-proposal-decorators @babel/preset-env
```

2.

**æ ¹ç›®å½•ä¸‹åˆ›å»º** **.babelrc**  é…ç½®å¦‚ä¸‹

```
{
    "presets": [
        "@babel/preset-env"
    ],
    "plugins": [
        [
            "@babel/plugin-proposal-decorators",
            {
                "legacy": true
            }
        ]
    ]
}
```

3.

**æ ¹ç›®å½•ä¸‹åˆ›å»º** **conï¬g-overrides.js ** é…ç½®å¦‚ä¸‹

```
const path = require('path')
const { override, addDecoratorsLegacy } = require('customize-cra')

function resolve(dir) {
    return path.join(__dirname, dir)
}

const customize = () => (config, env) => {
    config.resolve.alias['@'] = resolve('src')
    if (env === 'production') {
        config.externals = {
            'react': 'React',
            'react-dom': 'ReactDOM'
        }
    }

    return config
};


module.exports = override(addDecoratorsLegacy(), customize())
```

4.

è‡ªå®šä¹‰è¦†ç›–webpacké…ç½®

```
npm i customize-cra react-app-rewired
```

ä½œç”¨ï¼šä½¿ç”¨è‡ªå·±é…ç½®çš„å¯åŠ¨æ–¹å¼

5.

ä¿®æ”¹package.json

```json
åŸæ¥    å¯åŠ¨å‘½ä»¤æ˜¯è„šæ‰‹æ¶çš„å¿«æ·å¯åŠ¨
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
 æ”¹ä¸ºä¸‹é¢
  "scripts": {
    "start": "react-app-rewired start",
    "build": "react-app-rewired build", 
    "test": "react-app-rewired test", 
    "eject": "react-app-rewired eject" // è¿™ä¸ªå‘½ä»¤æ˜¯å§é…ç½®æš´éœ²å‡ºæ¥ æ“ä½œä¸å¯é€† æ…ç”¨
 },
...
 ä¿®æ”¹çš„ç›®çš„ï¼š å¯åŠ¨æ—¶è¦†ç›–åŸæ¥çš„å¯åŠ¨æ–¹å¼ï¼Œè®©é¡¹ç›®è¯»å–.babelrc å’Œconfig-overridesé‡å†™é…ç½®ï¼› ç„¶åå†å¼€å¯æœåŠ¡
  
  
```

##### é…ç½®åé¡¹ç›®å†™æ³•

è€å†™æ³•

```
import {observable,configure ,action } from 'mobx'

const store = observable( {
    isTabbarShow:true,
    list:[],
    cityName:"åŒ—äº¬",
    changeShow(){
        this.isTabbarShow = true
    },
    changeHide(){
        this.isTabbarShow = false
    }
},{
    changeHide:action,
    changeShow:action //æ ‡è®°ä¸¤ä¸ªæ–¹æ³•æ˜¯actionï¼Œä¸“é—¨ä¿®æ”¹å¯è§‚æµ‹çš„value
})

configure({
    enforceActions:'always'
})

export default store
```

æ–°å†™æ³•ï¼ˆè¿™ç§æ›´ç®€æ´ï¼‰

```react
import {observable,configure ,action } from 'mobx'
    configure({
        enforceActions:'always'
    })

 class Store {
    @observable  isTabbarShow = true    
    @observable  list = []

    @action changeShow(){
        this.isTabbarShow = true
    }

    @action changeHide(){
        this.isTabbarShow = false
    }
    
const store = new Store()
export default store    
```

##### Mobxå¯¹å¼‚æ­¥çš„å¤„ç†

store.js

runInAction æ ¸å¿ƒæ–¹æ³•

```react
import {observable,configure ,action ,runInAction} from 'mobx'
import axios from 'axios'

configure({
    enforceActions:'always'  ä¸¥æ ¼æ¨¡å¼
})


class Store {
    @observable  isTabbarShow = true
    @observable  list = []

    @action changeShow(){
        this.isTabbarShow = true
    }

    @action changeHide(){
        this.isTabbarShow = false
    }

    @action async getList(){
        var list = await axios({
            url:"https://m.maizuo.com/gateway?cityId=110100&ticketFlag=1&k=7406159",
            method:"get",
            headers:{
                'X-Client-Info': '{"a":"3000","ch":"1002","v":"5.0.4","e":"16395416565231270166529","bc":"110100"}',
                'X-Host': 'mall.film-ticket.cinema.list'
            }
        }).then(res=>{
            // console.log(res.data.data.cinemas)
           return res.data.data.cinemas
        })

        runInAction(()=>{   <--- é‡ç‚¹  å¤„ç†å¼‚æ­¥
            this.list = list
        })
    }
}

const store = new Store()
export default store
```

detail.jsè¯¦æƒ… ä½¿ç”¨é¡µé¢

```react
import React,{useEffect ,useState} from 'react'

import store from '../mobx/store'
import {autorun} from 'mobx'

export default function Cinemas(props) {

const [cinemaList,setCinemaList] = useState([])

    useEffect(() => {
        if(store.list.length===0){
            store.getList()
        }
        
        var unsubscribe  = autorun(()=>{
            console.log(store.list,store.isTabbarShow)

            setCinemaList(store.list)
        })

        return ()=>{
            //å–æ¶ˆè®¢é˜…ï¼Ÿ
            unsubscribe()  <--- é‡ç‚¹  å¤„ç†å¤šæ¬¡æ³¨å†Œç›‘å¬
        }

    }, [])

    return (
        <div>
            {
    cinemaList.map(item=>
              <dl key={item.cinemaId} style={{padding:"10px"}}>
                  <dt>{item.name}</dt>
                   <dd style={{fontSize:"12px",color:"gray"}}>{item.address}</dd>
                  </dl>    
                    )
            }
        </div>
    )
}
```

#### 7.mobx-react çš„ä½¿ç”¨

åŠŸèƒ½ï¼šç®€åŒ–mobx, è¾¾åˆ°ä¸ç”¨autorunç›‘å¬ï¼Œå’Œå–æ¶ˆç›‘å¬çš„æ“ä½œ   å³å¯è·å–æ•°æ®ã€‚

```
npm i mobx-react@5   // ç¨³å®šç‰ˆæœ¬
```

  é¡¹ç›®æ”¹é€ å¦‚ä¸‹

###### index.jsï¼ˆå‡½æ•°å¼ç»„ä»¶å’ŒClassç»„ä»¶ä¸­ è¿™ä¸ªéƒ½æ˜¯ä¸€æ ·çš„é…ç½®ï¼‰

```
import React from 'react'
import ReactDOM from 'react-dom'

import App from './10-mobx/04-router/App'

import {Provider}  from 'mobx-react'
import store from './10-mobx/04-router/mobx/store'

æ„å»ºä¸€ä¸ª çˆ¶ç»„ä»¶ -é«˜é˜¶ç»„ä»¶mobx-react
ReactDOM.render(
    // <React.StrictMode>
    <Provider store={store}>    <--- é‡ç‚¹ åŠ çˆ¶ç»„ä»¶ æ³¨å…¥storeæ•°æ®
        <App/>
    </Provider>
    
    // </React.StrictMode>
    ,document.getElementById("root"))
```

###### appå‡½æ•°å¼ç»„ä»¶

app.js ç»„ä»¶ï¼Œç›´æ¥å˜æˆæ— çŠ¶æ€ç»„ä»¶

```react
import React, { Component } from 'react'
import MRouter from './router/IndexRouter'
import Tabbar from './components/Tabbar'
import './views/css/App.css'

import { inject, observer } from 'mobx-react'

//æ„å»ºä¸€ä¸ª çˆ¶ç»„ä»¶ -é«˜é˜¶ç»„ä»¶mobx-react
@inject("store")  // æ³¨å…¥æ•°æ®
@observer  //æ„å»ºçˆ¶ç»„ä»¶  é«˜é˜¶ç»„ä»¶ åŒ…è£…appç»„ä»¶
class App extends Component {

    componentDidMount() {
        console.log(this.props.store.isTabbarShow)
    }
    render() {
        return (
           <div>
                {/* å…¶ä»–çš„å†…å®¹ */}
                <MRouter>
                    {this.props.store.isTabbarShow && <Tabbar></Tabbar>}
                </MRouter>
           </div>
        )
    }
}

export default App
```

###### ç±»ç»„ä»¶ä¸­ä½¿ç”¨

è°ƒæ•´ç‚¹ï¼š å¼•å…¥Observerç»„ä»¶ï¼Œ ç»„ä»¶å†…çš„jsxä»¥ç®­å¤´å‡½æ•°ï¼Œè¿”å›ã€‚

```react
import React, { useEffect, useState } from 'react'

import { Observer } from 'mobx-react'
import store from '../mobx/store'
export default function Cinemas(props) {

    useEffect(() => {
        if (store.list.length === 0) {
            store.getList()
        }
        return () => {
            //å–æ¶ˆè®¢é˜…ï¼Ÿ
        }
    }, [])

    return (
        <div>
                  {/* // å‡½æ•°å¼ç»„ä»¶ä¸­ Observeræ‰§è¡Œç›‘å¬å’Œå–æ¶ˆç›‘å¬çš„æ–¹æ³• */}
            <Observer>  
            {() => {
                    return store.list.map(item =>
                        <dl key={item.cinemaId} style={{ padding: "10px" }}>
                            <dt>{item.name}</dt>
                            <dd>{item.address}</dd>
                        </dl>
                    )
                }
                }
            </Observer>

        </div>
    )
}
```

## åå…­ TS

### 1.ç®€ä»‹

TSå¯¹é¡¹ç›®çš„å¸®åŠ©

ä¸¾ä¾‹ï¼š

```
é¡¹ç›®ä¸­jså†™
let str = "tom";
   str.map(...) 
åƒè¿™æ ·çš„è¯­æ³•é”™è¯¯ï¼Œwebpackç¼–è¯‘å™¨æ˜¯å‘ç°ä¸äº†çš„ï¼Œ å®ƒæ­£å¸¸ç¼–è¯‘ï¼Œç„¶åæ‰“å¼€æµè§ˆå™¨ï¼Œæ‰ä¼šæŠ¥é”™ã€‚è¿™ç§è¯­æ³•å‘ç°æ—¶æœºæ˜æ˜¾å»¶åï¼Œä¸ºäº†åœ¨ä»£ç ç¼–å†™è¿‡ç¨‹ä¸­ï¼Œ æå‰å‘ç°è¯­æ³•é”™è¯¯ã€‚ å¯ä»¥ä½¿ç”¨TSã€‚ typeScript
```

å®˜ç½‘

https://zhongsp.gitbooks.io/typescript-handbook/content/doc/handbook/

æ€»ç»“ï¼š

\1.    TypeScript  çš„å®šä½æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåœ¨å†™ä»£ç é˜¶æ®µå°±èƒ½æ£€æŸ¥é”™è¯¯ï¼Œè€Œéè¿è¡Œé˜¶æ®µ

\2.    ç±»å‹ç³»ç»Ÿæ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œå¢åŠ äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

\3.    æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œéœ€è¦ç†è§£æ¥å£ï¼ˆInterfacesï¼‰ã€æ³›å‹ï¼ˆGenericsï¼‰ã€ç±»ï¼ˆClassesï¼‰ç­‰

\4.    tsæœ€åè¢«ç¼–è¯‘æˆjs



åˆ›å»ºTSç‰ˆreacté¡¹ç›®

```
create-react-app my-app --template typescript

é¡¹ç›®åˆ›å»ºä¹‹åˆå°±è¦ç¡®å®šé€‰å‹ï¼ŒTSå’Œjsè¿˜æ˜¯ä¸ä¸€æ ·çš„ã€‚
```

é¡¹ç›®åˆ›å»ºå¯èƒ½ä¼šç¢°åˆ°çš„é—®é¢˜ï¼š

vscode å¯¹TSæœ‰æ³¢æµªçº¿æç¤ºé”™è¯¯ï¼Œ ä¸èƒ½è§£æã€‚

æ–¹æ³•ï¼š1.æ›´æ–°vscodeç‰ˆæœ¬  2.reactä¸­æœ‰TSä¾èµ–åŒ…ï¼Œcontro+shift+p é€‰æ‹©ä½¿ç”¨å·¥ä½œåŒºç‰ˆæœ¬TSåº“ã€‚

### 2.å˜é‡å£°æ˜

##### å­—ç¬¦ä¸²ï¼Œ æ•°å­—ï¼Œ å¸ƒå°”

```
// å­—ç¬¦ä¸²ï¼Œ æ•°å­—ï¼Œ å¸ƒå°”ï¼Œ

 var myname:string = "kerwin" //æ¨èå†™æ³• å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²   
 myname.substring(0,1)  // å¦‚æœmynameä¸Šä½¿ç”¨æ•°å­—çš„æ–¹æ³•ï¼Œå°†æŠ¥é”™ã€‚

var type = "123"   //åˆæ¬¡å£°æ˜çš„å˜é‡ç±»å‹å°†é»˜è®¤ä¸ºåŸºå‡† åç»­å†ä¿®æ”¹ç±»å‹   ä¼šæç¤ºæŠ¥é”™
type = 40  //æŠ¥é”™


 var myage:number = 100  //æ¨èå†™æ³• å£°æ˜ä¸€ä¸ªæ•°å­—
 myage.toFixed(1)

 var myshow:boolean = true  //æ¨èå†™æ³• å£°æ˜ä¸€ä¸ªå¸ƒå°”
 myshow = false 

 var my:string | number  ="kerwin"  //å˜é‡å¯ä»¥æ˜¯æ•°å­—æˆ–å­—ç¬¦ä¸²
 my = 100

 var myany:any = 100  //å˜é‡å¯ä»¥æ˜¯ä»»æ„å€¼

 export default {}
```

##### æ•°ç»„

```
var list1:string[] = ["1","2","3",4]  //å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²å‹çš„æ•°ç»„ 4æ˜¯ä¸ªæ•°å­—  æç¤ºæŠ¥é”™
list1.push("daa") //æ·»åŠ ä¸€ä¸ªé¡¹  å­—ç¬¦ä¸²å¯ä»¥
// list.push(4)  //æ·»åŠ ä¸€ä¸ªé¡¹  æ•°å­—ç±»å‹ä¸å¯ä»¥

var list2:number[] = [1,2,3]   //å£°æ˜ä¸€ä¸ªæ•°å­—å‹çš„æ•°ç»„
list2.push(5) // å¯ä»¥

var list3:(number | string)[] = [1,2,"aa","bbb"]//å£°æ˜ä¸€ä¸ª åŒ…å«æ•°å­—æˆ–å­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„
list3.push("aaaa")  //å­—ç¬¦ä¸²  å¯ä»¥

-----------------------------èŒƒå‹-----å¦ä¸€ç§å†™æ³•---------------------------------
var mylist1:Array<string> = ["aa","bb","cc"]   //å£°æ˜å­—ç¬¦ä¸²æ•°ç»„
mylist1.push("dw")

var mylist2:Array<string|number> = [1,2,"aaa"]  //å£°æ˜å­—ç¬¦ä¸²æˆ–æ•°å­—ä¸¤ç§ç±»å‹çš„æ•°ç»„
mylist2.push(3)  å¯ä»¥
mylist2.push(â€˜44â€™) å¯ä»¥
```

##### å¯¹è±¡

æ¥å£æ¦‚å¿µ:    æ¥å£æè¿°ä¸€ä¸ªå½¢çŠ¶ï¼Œä¸€ä¸ªè§„èŒƒã€‚ å…³é”®å­— **interface**ï¼ˆn.ï¼ˆäººæœºï¼‰ç•Œé¢  v.ï¼ˆé€šè¿‡ç•Œé¢æˆ–æ¥å£ï¼‰è¿æ¥ï¼‰

```
// å¯¹è±¡  æ¥å£
 interface IObj {
     name:string,
     age:number,
     location?:string,   //  å¯é€‰å±æ€§
     [propName:string]:any //propName å…¶ä½™å±æ€§çœç•¥ å€¼ ä»»æ„ 
 }


 var obj1:IObj = {  //æ¥å£ä½¿ç”¨
     name:"kerwin",  //å­—ç¬¦ä¸²
     age:100,  //æ•°å­—
     
     location:"å¤§è¿", //å¯å†™å¯ä¸å†™
     
     grade: "7.7",      //ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
    isPresale: true, //ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
    isSale: false,//ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
    item: {name: "4D", type: 13},//ä¸é™åˆ¶æ˜¯å¦å­˜åœ¨  key value ä»»æ„
 }
 
console.log(obj1.location) //ä½¿ç”¨æ²¡æœ‰çš„keyã€‚ä¼šæç¤º
```

##### å‡½æ•°

```
// æ¡ˆä¾‹1 å£°æ˜ä¸€ä¸ªtest1æ–¹æ³•  å…¥å‚a å­—ç¬¦ä¸² b å­—ç¬¦ä¸² c å¯é€‰ æ•°å­—  è¿”å›å€¼ï¼šå­—ç¬¦ä¸²
 function test1(a:string,b:string,c?:number):string{
    console.log(a.substring(0,1)+b.substring(0,1))

    return a.substring(0,1)+b.substring(0,1)
 }

 var myname:string = test1("aaa","bbb",100) // è°ƒç”¨
 console.log(myname)

 //---------------------------------

// æ¡ˆä¾‹2  ä¸ºæ–¹æ³• åˆ›å»ºæ¥å£ å…¥å‚a å­—ç¬¦ä¸² b å­—ç¬¦ä¸² c å¯é€‰ æ•°å­—  è¿”å›å€¼ï¼šå­—ç¬¦ä¸²
 interface IFunc{(a:string,b:string,c?:number):string}

//    å£°æ˜ä¸€ä¸ªmyfunc2ä½¿ç”¨IFuncæ¥å£é™åˆ¶
 var myfunc2:IFunc = function test1(a:string,b:string,c?:number):string{
    console.log(a.substring(0,1)+b.substring(0,1))

    return a.substring(0,1)+b.substring(0,1)
 }


// æ¡ˆä¾‹3 åˆ›å»ºä¸€ä¸ªæ¥å£  åŒ…å«å±æ€§å’Œæ–¹æ³•
 interface Iobj {
     name:string,
     age:number,
     getName:(name:string)=>string
 }
// æ¡ˆä¾‹3 å£°æ˜ä¸€ä¸ªå¯¹è±¡ ä½¿ç”¨æ¥å£Iobj
 var obj:Iobj = {
     name:"kerwin",
     age:100,
     getName:(name:string)=>{
         return name
     }
 }

 var name:string =  obj.getName("aaaa")//å…¥å‚ä¸æ˜¯å­—ç¬¦ä¸²çš„è¯æç¤ºé”™è¯¯
console.log(name)
export default {}
```

##### ç±»

```
class Bus {
    public name = "kerwin" //å…±æœ‰å±æ€§
    private _list: any = [] //ç§æœ‰å˜é‡   _ä¸‹åˆ’çº¿  å›å­åå®š é»˜è®¤ä¸ºç§æœ‰å˜é‡

    protected age = 100   //å­©å­å¯ä»¥ä½¿ç”¨
    public subscribe(cb: any) { // è®¾ç½®ä¸ºå…±æœ‰æ–¹æ³•
        this._list.push(cb)
    }

    public dispatch() {  // è®¾ç½®ä¸ºå…±æœ‰æ–¹æ³•
        this._list.forEach((cb: any) => {
            cb && cb()
        })
    }
}


class Child extends Bus {

    aaa() {
        console.log(this.name, this.age) //é™¤äº†Busçš„ç§æœ‰ å…¶ä»–å¯ä»¥ä½¿ç”¨
    }
}

var obj = new Bus()  //é™¤äº†Busçš„ç§æœ‰ å…¶ä»–å¯ä»¥ä½¿ç”¨
obj.subscribe(() => {

})

console.log(obj.name)
//  obj._list = [] // ä¸‹åˆ’çº¿ä¹Ÿå¯ä»¥ä½¿ç”¨  é™¤éåŠ äº†å±æ€§privateé™åˆ¶
//  console.log(obj._list)


export default {}
```

##### ç±»+æ¥å£

```react
// 1. åˆ›å»ºä¸€ä¸ªæ¥å£  è¦æ±‚ä½¿ç”¨æœ¬æ¥å£çš„å¯¹è±¡ å¿…é¡»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•
 interface Ifunc {
    getName:()=>string,  //å¹¶ä¸” è¿”å›å€¼ ä¸ºå­—ç¬¦ä¸²
    getAge:()=>number //å¹¶ä¸” è¿”å›å€¼ ä¸ºæ•°å­—
}

class A implements Ifunc{ // å£°æ˜ä¸€ä¸ªç±» å®ç°ï¼ˆimplementsï¼‰æ¥å£Ifunc
    getAge(){
        return 100
    }
    a1(){

    }

    a2(){

    }

    getName(){
        return "AAA"
    }
}

class B implements Ifunc{ // å£°æ˜ä¸€ä¸ªç±» å®ç°ï¼ˆimplementsï¼‰æ¥å£Ifunc
    getAge(){
        return 100
    }
    b1(){

    }

    b2(){

    }

    getName(){
        return "CCC"
    }
}

class C implements Ifunc{ // å£°æ˜ä¸€ä¸ªç±» å®ç°ï¼ˆimplementsï¼‰æ¥å£Ifunc
    getAge(){
        return 100
    }
    getName(){
        return "CCC"
    }
}

function init(obj:Ifunc){ //åˆ›å»ºä¸€ä¸ªå‡½æ•°  å…¥å‚objéœ€è¦ç¬¦åˆæ¥å£Ifuncçš„å½¢çŠ¶
    obj.getName()
    obj.getAge()
}
var objA = new A()
var objB = new B()
var objC = new C()

init(objA)
init(objB)
init(objC)
```

#### 3.TS-ç±»ç»„ä»¶











## åä¸ƒ styled-components

## åå…« å•å…ƒæµ‹è¯•

## åä¹ redux-saga

## äºŒå Reactè¡¥å……

## äºŒåä¸€ Reactæ‰©å±•

## äºŒåäºŒ å‰ç«¯ä»£ç†ï¼ˆåå‘ä»£ç†ï¼‰

å®˜ç½‘ï¼š

 https://facebook.github.io/create-react-app/docs/proxying-api-requests-in-development

 å¼•å…¥æ’ä»¶

```
npm install http-proxy-middleware --save
```

srcä¸‹åˆ›å»º src/setupProxy.jsæ–‡ä»¶ï¼Œå‚æ•°å¦‚ä¸‹

```

const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) { app.use(
  '/api', createProxyMiddleware({
    target: 'http://localhost:5000', 
    changeOrigin: true,
   })
   );
};
è¡¨ç¤ºï¼šä»£ç†æ‹¦æˆª/apiå¼€å¤´çš„è¯·æ±‚ï¼Œå¹¶åœ¨å…¶urlå‰é¢åŠ ä¸Šhttp://localhost:5000åŸŸåã€‚
```



æ¡ˆä¾‹ï¼šæŸçœ¼ç”µå½±æ¥å£

```
https://i.maoyan.com/#movie/.f-hot
```

è¯·æ±‚å¾…æ˜ åˆ—è¡¨æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨æç¤ºè·¨åŸŸã€‚

```
https://i.maoyan.com/ajax/mostExpected?limit=10&offset=0&token=&optimus_uuid=B13246E07BC511EE8C86B72966AD43929DD65EA435C340D6A572D95977F59FCA&optimus_risk_level=71&optimus_code=10
```

é¡¹ç›®é…ç½®å¦‚ä¸‹ï¼š

setupProxy.jsæ–‡ä»¶

```
const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) {
  app.use(
    '/ajax',
    createProxyMiddleware({
      target: 'https://i.maoyan.com',
      changeOrigin: true,
    })
  );
};
```

ç»„ä»¶å¦‚ä¸‹:   

```
import React, {  Component } from 'react'
import axios from 'axios'
export default class Comingsoon extends Component {

  componentWillMount(){
    axios({
        url:"/ajax/mostExpected?limit=10&offset=0&token=&optimus_uuid=B13246E07BC511EE8C86B72966AD43929DD65EA435C340D6A572D95977F59FCA&optimus_risk_level=71&optimus_code=10", 
    }).then(res=>{
        // console.log(res.data.data.films) æˆåŠŸè¿”å›æ•°æ®
    
    })
  }
    render() {
        return (
            <div>
                Comingsoon
            </div>
        )
    }
}

```

## äºŒåä¸‰  css module

å®˜ç½‘

https://facebook.github.io/create-react-app/docs/adding-a-css-modules-stylesheet

å¼•å…¥èƒŒæ™¯ï¼š

reactæ˜¯å•é¡µé¢ï¼Œ æ¯ä¸ªç»„ä»¶å¼•å…¥çš„cssæ ·å¼ï¼Œç¼–è¯‘æ—¶ï¼Œä¼šè‡ªåŠ¨æ’å…¥åˆ°index.htmlé¡µé¢ä¸­ï¼Œé€ æˆæ ·å¼æ±¡æŸ“ã€‚

film.css

```
.father{
  border: 1px solid red;
}
```

filmç»„ä»¶

```
import '../css/film.css' //å¯¼å…¥ cssæ¨¡å—ï¼Œ  webpackçš„æ”¯æŒã€‚

        return (
                <div className='father'>å¯¼èˆªæ </div>
```

å­ç»„ä»¶

```
  render() {
        return (
            <div className='father'>
                Comingsoon
            </div>
```

çˆ¶ç»„ä»¶å¼•å…¥çš„æ ·å¼ï¼Œ æ±¡æŸ“åˆ°äº†å­ç»„ä»¶ã€‚

è§£å†³æ–¹å¼ï¼š

file.css æ–‡ä»¶åå­—ï¼Œæ”¹é€ ä¸ºfilm.module.css   è§„å®šå†™æ³•

```
.father{
  border: 1px solid red;
  .child{
    color: yellow;
  }
}
#id{
  color: red;
}


ç§æœ‰æ ·å¼æ–‡ä»¶ä¸­  å†™å…¨å±€css   ï¼›å»ºè®®å¦‚æœæ˜¯é¡¹ç›®å…¨å±€css, å•ç‹¬æ–°å»ºä¸€ä¸ª common.css æ¯”è¾ƒå¥½ã€‚
:global(.active){

}

```

film.jsç»„ä»¶

```
import style from  '../css/film.module.css' //å¯¼å…¥ cssæ¨¡å—ï¼Œ  webpackçš„æ”¯æŒã€‚

    render() {
        return (
            <div>
                <div className={style.father +" othercss"}>å¯¼èˆªæ </div>  
                //å˜é‡å†™æ³• å› ä¸ºç±»ååŠ åç¼€åŠ¨æ€åŒ– ç§æœ‰åŒ–


css æ‰“å°å‡ºæ¥å˜é‡åå­— å’Œjsç›¸ä¼¼
console.log(style)
{
father: 'film_father__HgGKs', 
child: 'film_child__2Bvwp', 
id: 'film_id__2TOI9'
}

```











## å…¶ä»–

### 1.å‡½æ•°å¼ç»„ä»¶çš„æ³¨æ„ç‚¹ 

å¦‚æœé¡µé¢æœ‰axiosè¯·æ±‚ï¼Œæ”¾åˆ°useEffectä¸­ï¼Œåœ¨é¡µé¢å®é™…æƒ…å†µä¸­ï¼Œå‡½æ•°å¼ç»„ä»¶å¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œä»¥ç¡®ä¿æ•°æ®éƒ½æ›´æ–°è¿‡æ¥äº†ã€‚ä¸ºé¿å…æ¥å£å¤šæ¬¡è¯·æ±‚ï¼ŒåŠ¡å¿…éµå®ˆã€‚

```
import React,{useEffect} from 'react'
import { show,hide } from '../redux/actionCreator/TabbarActionCreator'
import store from '../redux/store'

export default function Detail(props) {
    console.log(props.match.params.myid,"åˆ©ç”¨idå»åç«¯æ‹¿æ•°æ®ã€‚")

    useEffect(() => {
        // console.log("create")

        //store.dispatch  é€šçŸ¥
        store.dispatch(hide())
        return () => {
            console.log("destroy")
            store.dispatch(show() )
        }
    }, [])

    return (
        <div>
            deteail
        </div>
    )
}
```

### 2.è‡ªå®šä¹‰DOMå±æ€§

[React](https://so.csdn.net/so/search?q=React&spm=1001.2101.3001.7020) 16 ä¹‹å‰ä¼šå¿½ç•¥ä¸æ˜¯æŠŠçš„HTMLå’ŒSVGå±æ€§ï¼Œç°åœ¨Reactä¼šæŠŠä¸è¯†åˆ«çš„å±æ€§ä¼ é€’ç»™DOM

React16ä¹‹å‰ï¼š

```
 <div cust-attr="someting"></div>
```

  ä¼šè¢«æ¸²æŸ“æˆ

```
<div></div>ã€€
```

React 16æ¸²æŸ“å‡ºæ¥çš„èŠ‚ç‚¹ï¼š

```
<div cust-attr="someting"></div>ã€€ã€€
```

### 3. Portals

https://blog.csdn.net/sxww_zyt/article/details/129253485

### 4.é”™è¯¯å¤„ç†

https://blog.csdn.net/sxww_zyt/article/details/129253482

### 5.renderæ–°çš„è¿”å›ç±»å‹

React16ä¹‹å‰ï¼Œrende[ræ–¹](https://so.csdn.net/so/search?q=ræ–¹&spm=1001.2101.3001.7020)æ³•å¿…é¡»è¿”å›å•ä¸ªå…ƒç´ ã€‚ç°åœ¨ï¼Œrenderæ”¯æŒä¸¤ç§æ–°çš„è¿”å›ç±»å‹ï¼šæ•°ç»„(æœ‰Reactå…ƒç´ ç»„æˆ)å’Œå­—ç¬¦ä¸²ã€‚

```
render() {
 return [
    <li key="a">a</li>,
    <li key="b">b</li>,
    <li key="c">c</li>
 ]
}
```



```
render() {
 return  "just a string";
}
```

### 6.åˆ—è¡¨å’ŒKeys

æ¸²æŸ“åˆ—è¡¨æ•°æ®æ˜¯éå¸¸å¸¸è§çš„åœºæ™¯ï¼Œä¾‹å¦‚åšä¸€ä¸ªå±•ç¤ºç”¨æˆ·çš„åˆ—è¡¨ï¼Œéœ€è¦æ ¹æ®è·å–çš„ç”¨æˆ·æ•°æ®è¿›è¡Œæ¸²æŸ“åˆ—è¡¨ã€‚

è¿è¡Œåæ§åˆ¶å°æŠ¥é”™ï¼šåº”è¯¥ä¸ºåˆ—è¡¨æ¯ä¸€é¡¹æ·»åŠ key(ä¸€èˆ¬ä½¿ç”¨åˆ—è¡¨æ•°æ®çš„idä½œä¸ºkey)ï¼Œ[React](https://so.csdn.net/so/search?q=React&spm=1001.2101.3001.7020)ç”¨Keyæ ‡è®°æ¯ä¸ªå…ƒç´ ï¼Œå½“æ•°æ®å˜åŒ–æ—¶ï¼ŒReactå¯ä»¥é€šè¿‡keyçŸ¥é“å“ªäº›å…ƒç´ å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œåªæ¸²æŸ“å‘ç”Ÿå˜åŒ–çš„å…ƒç´ ï¼Œæé«˜æ¸²æŸ“æ•ˆç‡ã€‚

```
<User info={item.info} handleClick={this.handleClick} key={item.id}/>

```

**ä¸æ¨èä½¿ç”¨ç´¢å¼•ä½œä¸ºkey**ï¼Œå› ä¸ºä¸€æ—¦åˆ—è¡¨ä¸­çš„æ•°æ®å‘ç”Ÿé‡æ’ï¼Œæ•°æ®çš„ç´¢å¼•ä¹Ÿä¼šæ”¹å˜ï¼Œä¸åˆ©äºreactæ¸²æŸ“ã€‚**åˆ—è¡¨å…ƒç´ çš„keyä¸èƒ½é‡å¤ï¼Œä½†åªé™äºå½“å‰åˆ—è¡¨ï¼Œä¸æ˜¯å…¨å±€å”¯ä¸€**ã€‚

### 7.äº‹ä»¶å¤„ç†

https://blog.csdn.net/sxww_zyt/article/details/129253483

### 8.å®ç°è‡ªå®šä¹‰createElementå’Œrender

https://blog.csdn.net/sxww_zyt/article/details/132900693







### hooksä¸­è®°ä½çŠ¶æ€çš„æ–¹å¼

useRef

### å…³äºç”Ÿå‘½å‘¨æœŸ

*1.ç±»ç»„ä»¶ Class Component* æœ‰ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µã€‚

2.å‡½æ•°ç»„ä»¶*Function Component* ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œ

é»˜è®¤ä¸èƒ½ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ å¦‚æœè¦ä½¿ç”¨ é‚£ä¹ˆå°±è¦ä½¿ç”¨HOOKæ¥å®Œæˆã€‚

react16.8ç‰ˆæœ¬ä¹‹åæ–°å¢çš„ä¸€ä¸ªæ¦‚å¿µ

HOOK---useEffect

**useEffectå°±å¯ä»¥è®©å‡½æ•°ç»„ä»¶ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ---ä»–ä¼šåœ¨ æŒ‚è½½å®Œæ¯• ä¿®æ”¹å®Œæ¯• å‡†å¤‡é”€æ¯ è¿™ä¸‰ä¸ªé˜¶æ®µéƒ½è§¦å‘**

è¯­æ³•ï¼š

```javascript
useEffect(ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°,ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„)
```